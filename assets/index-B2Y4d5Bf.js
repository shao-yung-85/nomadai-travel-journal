(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function Y0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rv={exports:{}},Eh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WS;function CD(){if(WS)return Eh;WS=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var d in s)d!=="key"&&(o[d]=s[d])}else o=s;return s=o.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:o}}return Eh.Fragment=e,Eh.jsx=t,Eh.jsxs=t,Eh}var YS;function bD(){return YS||(YS=1,rv.exports=CD()),rv.exports}var _=bD(),ov={exports:{}},ft={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JS;function ID(){if(JS)return ft;JS=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),C=Symbol.iterator;function A(K){return K===null||typeof K!="object"?null:(K=C&&K[C]||K["@@iterator"],typeof K=="function"?K:null)}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,H={};function X(K,me,Ie){this.props=K,this.context=me,this.refs=H,this.updater=Ie||D}X.prototype.isReactComponent={},X.prototype.setState=function(K,me){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,me,"setState")},X.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function re(){}re.prototype=X.prototype;function Q(K,me,Ie){this.props=K,this.context=me,this.refs=H,this.updater=Ie||D}var he=Q.prototype=new re;he.constructor=Q,F(he,X.prototype),he.isPureReactComponent=!0;var fe=Array.isArray;function Y(){}var k={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function O(K,me,Ie){var le=Ie.ref;return{$$typeof:n,type:K,key:me,ref:le!==void 0?le:null,props:Ie}}function q(K,me){return O(K.type,me,K.props)}function G(K){return typeof K=="object"&&K!==null&&K.$$typeof===n}function W(K){var me={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(Ie){return me[Ie]})}var z=/\/+/g;function Ge(K,me){return typeof K=="object"&&K!==null&&K.key!=null?W(""+K.key):me.toString(36)}function $e(K){switch(K.status){case"fulfilled":return K.value;case"rejected":throw K.reason;default:switch(typeof K.status=="string"?K.then(Y,Y):(K.status="pending",K.then(function(me){K.status==="pending"&&(K.status="fulfilled",K.value=me)},function(me){K.status==="pending"&&(K.status="rejected",K.reason=me)})),K.status){case"fulfilled":return K.value;case"rejected":throw K.reason}}throw K}function se(K,me,Ie,le,ge){var we=typeof K;(we==="undefined"||we==="boolean")&&(K=null);var Ke=!1;if(K===null)Ke=!0;else switch(we){case"bigint":case"string":case"number":Ke=!0;break;case"object":switch(K.$$typeof){case n:case e:Ke=!0;break;case T:return Ke=K._init,se(Ke(K._payload),me,Ie,le,ge)}}if(Ke)return ge=ge(K),Ke=le===""?"."+Ge(K,0):le,fe(ge)?(Ie="",Ke!=null&&(Ie=Ke.replace(z,"$&/")+"/"),se(ge,me,Ie,"",function(Nt){return Nt})):ge!=null&&(G(ge)&&(ge=q(ge,Ie+(ge.key==null||K&&K.key===ge.key?"":(""+ge.key).replace(z,"$&/")+"/")+Ke)),me.push(ge)),1;Ke=0;var Fe=le===""?".":le+":";if(fe(K))for(var Ye=0;Ye<K.length;Ye++)le=K[Ye],we=Fe+Ge(le,Ye),Ke+=se(le,me,Ie,we,ge);else if(Ye=A(K),typeof Ye=="function")for(K=Ye.call(K),Ye=0;!(le=K.next()).done;)le=le.value,we=Fe+Ge(le,Ye++),Ke+=se(le,me,Ie,we,ge);else if(we==="object"){if(typeof K.then=="function")return se($e(K),me,Ie,le,ge);throw me=String(K),Error("Objects are not valid as a React child (found: "+(me==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":me)+"). If you meant to render a collection of children, use an array instead.")}return Ke}function Ce(K,me,Ie){if(K==null)return K;var le=[],ge=0;return se(K,le,"","",function(we){return me.call(Ie,we,ge++)}),le}function be(K){if(K._status===-1){var me=K._result;me=me(),me.then(function(Ie){(K._status===0||K._status===-1)&&(K._status=1,K._result=Ie)},function(Ie){(K._status===0||K._status===-1)&&(K._status=2,K._result=Ie)}),K._status===-1&&(K._status=0,K._result=me)}if(K._status===1)return K._result.default;throw K._result}var it=typeof reportError=="function"?reportError:function(K){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var me=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof K=="object"&&K!==null&&typeof K.message=="string"?String(K.message):String(K),error:K});if(!window.dispatchEvent(me))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",K);return}console.error(K)},Pe={map:Ce,forEach:function(K,me,Ie){Ce(K,function(){me.apply(this,arguments)},Ie)},count:function(K){var me=0;return Ce(K,function(){me++}),me},toArray:function(K){return Ce(K,function(me){return me})||[]},only:function(K){if(!G(K))throw Error("React.Children.only expected to receive a single React element child.");return K}};return ft.Activity=x,ft.Children=Pe,ft.Component=X,ft.Fragment=t,ft.Profiler=s,ft.PureComponent=Q,ft.StrictMode=i,ft.Suspense=h,ft.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,ft.__COMPILER_RUNTIME={__proto__:null,c:function(K){return k.H.useMemoCache(K)}},ft.cache=function(K){return function(){return K.apply(null,arguments)}},ft.cacheSignal=function(){return null},ft.cloneElement=function(K,me,Ie){if(K==null)throw Error("The argument must be a React element, but you passed "+K+".");var le=F({},K.props),ge=K.key;if(me!=null)for(we in me.key!==void 0&&(ge=""+me.key),me)!B.call(me,we)||we==="key"||we==="__self"||we==="__source"||we==="ref"&&me.ref===void 0||(le[we]=me[we]);var we=arguments.length-2;if(we===1)le.children=Ie;else if(1<we){for(var Ke=Array(we),Fe=0;Fe<we;Fe++)Ke[Fe]=arguments[Fe+2];le.children=Ke}return O(K.type,ge,le)},ft.createContext=function(K){return K={$$typeof:l,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null},K.Provider=K,K.Consumer={$$typeof:o,_context:K},K},ft.createElement=function(K,me,Ie){var le,ge={},we=null;if(me!=null)for(le in me.key!==void 0&&(we=""+me.key),me)B.call(me,le)&&le!=="key"&&le!=="__self"&&le!=="__source"&&(ge[le]=me[le]);var Ke=arguments.length-2;if(Ke===1)ge.children=Ie;else if(1<Ke){for(var Fe=Array(Ke),Ye=0;Ye<Ke;Ye++)Fe[Ye]=arguments[Ye+2];ge.children=Fe}if(K&&K.defaultProps)for(le in Ke=K.defaultProps,Ke)ge[le]===void 0&&(ge[le]=Ke[le]);return O(K,we,ge)},ft.createRef=function(){return{current:null}},ft.forwardRef=function(K){return{$$typeof:d,render:K}},ft.isValidElement=G,ft.lazy=function(K){return{$$typeof:T,_payload:{_status:-1,_result:K},_init:be}},ft.memo=function(K,me){return{$$typeof:p,type:K,compare:me===void 0?null:me}},ft.startTransition=function(K){var me=k.T,Ie={};k.T=Ie;try{var le=K(),ge=k.S;ge!==null&&ge(Ie,le),typeof le=="object"&&le!==null&&typeof le.then=="function"&&le.then(Y,it)}catch(we){it(we)}finally{me!==null&&Ie.types!==null&&(me.types=Ie.types),k.T=me}},ft.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},ft.use=function(K){return k.H.use(K)},ft.useActionState=function(K,me,Ie){return k.H.useActionState(K,me,Ie)},ft.useCallback=function(K,me){return k.H.useCallback(K,me)},ft.useContext=function(K){return k.H.useContext(K)},ft.useDebugValue=function(){},ft.useDeferredValue=function(K,me){return k.H.useDeferredValue(K,me)},ft.useEffect=function(K,me){return k.H.useEffect(K,me)},ft.useEffectEvent=function(K){return k.H.useEffectEvent(K)},ft.useId=function(){return k.H.useId()},ft.useImperativeHandle=function(K,me,Ie){return k.H.useImperativeHandle(K,me,Ie)},ft.useInsertionEffect=function(K,me){return k.H.useInsertionEffect(K,me)},ft.useLayoutEffect=function(K,me){return k.H.useLayoutEffect(K,me)},ft.useMemo=function(K,me){return k.H.useMemo(K,me)},ft.useOptimistic=function(K,me){return k.H.useOptimistic(K,me)},ft.useReducer=function(K,me,Ie){return k.H.useReducer(K,me,Ie)},ft.useRef=function(K){return k.H.useRef(K)},ft.useState=function(K){return k.H.useState(K)},ft.useSyncExternalStore=function(K,me,Ie){return k.H.useSyncExternalStore(K,me,Ie)},ft.useTransition=function(){return k.H.useTransition()},ft.version="19.2.0",ft}var ZS;function J0(){return ZS||(ZS=1,ov.exports=ID()),ov.exports}var Z=J0();const lf=Y0(Z);var av={exports:{}},xh={},lv={exports:{}},uv={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QS;function AD(){return QS||(QS=1,(function(n){function e(se,Ce){var be=se.length;se.push(Ce);e:for(;0<be;){var it=be-1>>>1,Pe=se[it];if(0<s(Pe,Ce))se[it]=Ce,se[be]=Pe,be=it;else break e}}function t(se){return se.length===0?null:se[0]}function i(se){if(se.length===0)return null;var Ce=se[0],be=se.pop();if(be!==Ce){se[0]=be;e:for(var it=0,Pe=se.length,K=Pe>>>1;it<K;){var me=2*(it+1)-1,Ie=se[me],le=me+1,ge=se[le];if(0>s(Ie,be))le<Pe&&0>s(ge,Ie)?(se[it]=ge,se[le]=be,it=le):(se[it]=Ie,se[me]=be,it=me);else if(le<Pe&&0>s(ge,be))se[it]=ge,se[le]=be,it=le;else break e}}return Ce}function s(se,Ce){var be=se.sortIndex-Ce.sortIndex;return be!==0?be:se.id-Ce.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();n.unstable_now=function(){return l.now()-d}}var h=[],p=[],T=1,x=null,C=3,A=!1,D=!1,F=!1,H=!1,X=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;function he(se){for(var Ce=t(p);Ce!==null;){if(Ce.callback===null)i(p);else if(Ce.startTime<=se)i(p),Ce.sortIndex=Ce.expirationTime,e(h,Ce);else break;Ce=t(p)}}function fe(se){if(F=!1,he(se),!D)if(t(h)!==null)D=!0,Y||(Y=!0,W());else{var Ce=t(p);Ce!==null&&$e(fe,Ce.startTime-se)}}var Y=!1,k=-1,B=5,O=-1;function q(){return H?!0:!(n.unstable_now()-O<B)}function G(){if(H=!1,Y){var se=n.unstable_now();O=se;var Ce=!0;try{e:{D=!1,F&&(F=!1,re(k),k=-1),A=!0;var be=C;try{t:{for(he(se),x=t(h);x!==null&&!(x.expirationTime>se&&q());){var it=x.callback;if(typeof it=="function"){x.callback=null,C=x.priorityLevel;var Pe=it(x.expirationTime<=se);if(se=n.unstable_now(),typeof Pe=="function"){x.callback=Pe,he(se),Ce=!0;break t}x===t(h)&&i(h),he(se)}else i(h);x=t(h)}if(x!==null)Ce=!0;else{var K=t(p);K!==null&&$e(fe,K.startTime-se),Ce=!1}}break e}finally{x=null,C=be,A=!1}Ce=void 0}}finally{Ce?W():Y=!1}}}var W;if(typeof Q=="function")W=function(){Q(G)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,Ge=z.port2;z.port1.onmessage=G,W=function(){Ge.postMessage(null)}}else W=function(){X(G,0)};function $e(se,Ce){k=X(function(){se(n.unstable_now())},Ce)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(se){se.callback=null},n.unstable_forceFrameRate=function(se){0>se||125<se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<se?Math.floor(1e3/se):5},n.unstable_getCurrentPriorityLevel=function(){return C},n.unstable_next=function(se){switch(C){case 1:case 2:case 3:var Ce=3;break;default:Ce=C}var be=C;C=Ce;try{return se()}finally{C=be}},n.unstable_requestPaint=function(){H=!0},n.unstable_runWithPriority=function(se,Ce){switch(se){case 1:case 2:case 3:case 4:case 5:break;default:se=3}var be=C;C=se;try{return Ce()}finally{C=be}},n.unstable_scheduleCallback=function(se,Ce,be){var it=n.unstable_now();switch(typeof be=="object"&&be!==null?(be=be.delay,be=typeof be=="number"&&0<be?it+be:it):be=it,se){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=be+Pe,se={id:T++,callback:Ce,priorityLevel:se,startTime:be,expirationTime:Pe,sortIndex:-1},be>it?(se.sortIndex=be,e(p,se),t(h)===null&&se===t(p)&&(F?(re(k),k=-1):F=!0,$e(fe,be-it))):(se.sortIndex=Pe,e(h,se),D||A||(D=!0,Y||(Y=!0,W()))),se},n.unstable_shouldYield=q,n.unstable_wrapCallback=function(se){var Ce=C;return function(){var be=C;C=Ce;try{return se.apply(this,arguments)}finally{C=be}}}})(uv)),uv}var $S;function ND(){return $S||($S=1,lv.exports=AD()),lv.exports}var cv={exports:{}},Ri={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XS;function RD(){if(XS)return Ri;XS=1;var n=J0();function e(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var T=2;T<arguments.length;T++)p+="&args[]="+encodeURIComponent(arguments[T])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,p,T){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:x==null?null:""+x,children:h,containerInfo:p,implementation:T}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Ri.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ri.createPortal=function(h,p){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return o(h,p,null,T)},Ri.flushSync=function(h){var p=l.T,T=i.p;try{if(l.T=null,i.p=2,h)return h()}finally{l.T=p,i.p=T,i.d.f()}},Ri.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(h,p))},Ri.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Ri.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var T=p.as,x=d(T,p.crossOrigin),C=typeof p.integrity=="string"?p.integrity:void 0,A=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;T==="style"?i.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:x,integrity:C,fetchPriority:A}):T==="script"&&i.d.X(h,{crossOrigin:x,integrity:C,fetchPriority:A,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Ri.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var T=d(p.as,p.crossOrigin);i.d.M(h,{crossOrigin:T,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(h)},Ri.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var T=p.as,x=d(T,p.crossOrigin);i.d.L(h,T,{crossOrigin:x,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Ri.preloadModule=function(h,p){if(typeof h=="string")if(p){var T=d(p.as,p.crossOrigin);i.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:T,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(h)},Ri.requestFormReset=function(h){i.d.r(h)},Ri.unstable_batchedUpdates=function(h,p){return h(p)},Ri.useFormState=function(h,p,T){return l.H.useFormState(h,p,T)},Ri.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ri.version="19.2.0",Ri}var eC;function T1(){if(eC)return cv.exports;eC=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),cv.exports=RD(),cv.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tC;function MD(){if(tC)return xh;tC=1;var n=ND(),e=J0(),t=T1();function i(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,c=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(c=a.return),r=a.return;while(r)}return a.tag===3?c:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function d(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function h(r){if(o(r)!==r)throw Error(i(188))}function p(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(i(188));return a!==r?null:r}for(var c=r,m=a;;){var w=c.return;if(w===null)break;var S=w.alternate;if(S===null){if(m=w.return,m!==null){c=m;continue}break}if(w.child===S.child){for(S=w.child;S;){if(S===c)return h(w),r;if(S===m)return h(w),a;S=S.sibling}throw Error(i(188))}if(c.return!==m.return)c=w,m=S;else{for(var R=!1,V=w.child;V;){if(V===c){R=!0,c=w,m=S;break}if(V===m){R=!0,m=w,c=S;break}V=V.sibling}if(!R){for(V=S.child;V;){if(V===c){R=!0,c=S,m=w;break}if(V===m){R=!0,m=S,c=w;break}V=V.sibling}if(!R)throw Error(i(189))}}if(c.alternate!==m)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?r:a}function T(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=T(r),a!==null)return a;r=r.sibling}return null}var x=Object.assign,C=Symbol.for("react.element"),A=Symbol.for("react.transitional.element"),D=Symbol.for("react.portal"),F=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),re=Symbol.for("react.consumer"),Q=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),fe=Symbol.for("react.suspense"),Y=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),q=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function W(r){return r===null||typeof r!="object"?null:(r=G&&r[G]||r["@@iterator"],typeof r=="function"?r:null)}var z=Symbol.for("react.client.reference");function Ge(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===z?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case F:return"Fragment";case X:return"Profiler";case H:return"StrictMode";case fe:return"Suspense";case Y:return"SuspenseList";case O:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case D:return"Portal";case Q:return r.displayName||"Context";case re:return(r._context.displayName||"Context")+".Consumer";case he:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case k:return a=r.displayName||null,a!==null?a:Ge(r.type)||"Memo";case B:a=r._payload,r=r._init;try{return Ge(r(a))}catch{}}return null}var $e=Array.isArray,se=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ce=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,be={pending:!1,data:null,method:null,action:null},it=[],Pe=-1;function K(r){return{current:r}}function me(r){0>Pe||(r.current=it[Pe],it[Pe]=null,Pe--)}function Ie(r,a){Pe++,it[Pe]=r.current,r.current=a}var le=K(null),ge=K(null),we=K(null),Ke=K(null);function Fe(r,a){switch(Ie(we,a),Ie(ge,r),Ie(le,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?gS(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=gS(a),r=_S(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}me(le),Ie(le,r)}function Ye(){me(le),me(ge),me(we)}function Nt(r){r.memoizedState!==null&&Ie(Ke,r);var a=le.current,c=_S(a,r.type);a!==c&&(Ie(ge,r),Ie(le,c))}function Jt(r){ge.current===r&&(me(le),me(ge)),Ke.current===r&&(me(Ke),_h._currentValue=be)}var ct,mn;function Rn(r){if(ct===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);ct=a&&a[1]||"",mn=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ct+r+mn}var Yt=!1;function Rt(r,a){if(!r||Yt)return"";Yt=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(a){var xe=function(){throw Error()};if(Object.defineProperty(xe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xe,[])}catch(pe){var ce=pe}Reflect.construct(r,[],xe)}else{try{xe.call()}catch(pe){ce=pe}r.call(xe.prototype)}}else{try{throw Error()}catch(pe){ce=pe}(xe=r())&&typeof xe.catch=="function"&&xe.catch(function(){})}}catch(pe){if(pe&&ce&&typeof pe.stack=="string")return[pe.stack,ce.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=m.DetermineComponentFrameRoot(),R=S[0],V=S[1];if(R&&V){var J=R.split(`
`),ae=V.split(`
`);for(w=m=0;m<J.length&&!J[m].includes("DetermineComponentFrameRoot");)m++;for(;w<ae.length&&!ae[w].includes("DetermineComponentFrameRoot");)w++;if(m===J.length||w===ae.length)for(m=J.length-1,w=ae.length-1;1<=m&&0<=w&&J[m]!==ae[w];)w--;for(;1<=m&&0<=w;m--,w--)if(J[m]!==ae[w]){if(m!==1||w!==1)do if(m--,w--,0>w||J[m]!==ae[w]){var ye=`
`+J[m].replace(" at new "," at ");return r.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",r.displayName)),ye}while(1<=m&&0<=w);break}}}finally{Yt=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Rn(c):""}function Mt(r,a){switch(r.tag){case 26:case 27:case 5:return Rn(r.type);case 16:return Rn("Lazy");case 13:return r.child!==a&&a!==null?Rn("Suspense Fallback"):Rn("Suspense");case 19:return Rn("SuspenseList");case 0:case 15:return Rt(r.type,!1);case 11:return Rt(r.type.render,!1);case 1:return Rt(r.type,!0);case 31:return Rn("Activity");default:return""}}function Se(r){try{var a="",c=null;do a+=Mt(r,c),c=r,r=r.return;while(r);return a}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Qe=Object.prototype.hasOwnProperty,_e=n.unstable_scheduleCallback,ke=n.unstable_cancelCallback,He=n.unstable_shouldYield,mt=n.unstable_requestPaint,lt=n.unstable_now,un=n.unstable_getCurrentPriorityLevel,ri=n.unstable_ImmediatePriority,Ji=n.unstable_UserBlockingPriority,pn=n.unstable_NormalPriority,Ts=n.unstable_LowPriority,Vr=n.unstable_IdlePriority,Or=n.log,ho=n.unstable_setDisableYieldValue,vi=null,Ne=null;function ht(r){if(typeof Or=="function"&&ho(r),Ne&&typeof Ne.setStrictMode=="function")try{Ne.setStrictMode(vi,r)}catch{}}var dt=Math.clz32?Math.clz32:Es,rn=Math.log,wi=Math.LN2;function Es(r){return r>>>=0,r===0?32:31-(rn(r)/wi|0)|0}var Fn=256,Zi=262144,gn=4194304;function Bi(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function zi(r,a,c){var m=r.pendingLanes;if(m===0)return 0;var w=0,S=r.suspendedLanes,R=r.pingedLanes;r=r.warmLanes;var V=m&134217727;return V!==0?(m=V&~S,m!==0?w=Bi(m):(R&=V,R!==0?w=Bi(R):c||(c=V&~r,c!==0&&(w=Bi(c))))):(V=m&~S,V!==0?w=Bi(V):R!==0?w=Bi(R):c||(c=m&~r,c!==0&&(w=Bi(c)))),w===0?0:a!==0&&a!==w&&(a&S)===0&&(S=w&-w,c=a&-a,S>=c||S===32&&(c&4194048)!==0)?a:w}function Xn(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function Od(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hu(){var r=gn;return gn<<=1,(gn&62914560)===0&&(gn=4194304),r}function Hs(r){for(var a=[],c=0;31>c;c++)a.push(r);return a}function cr(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ud(r,a,c,m,w,S){var R=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var V=r.entanglements,J=r.expirationTimes,ae=r.hiddenUpdates;for(c=R&~c;0<c;){var ye=31-dt(c),xe=1<<ye;V[ye]=0,J[ye]=-1;var ce=ae[ye];if(ce!==null)for(ae[ye]=null,ye=0;ye<ce.length;ye++){var pe=ce[ye];pe!==null&&(pe.lane&=-536870913)}c&=~xe}m!==0&&fo(r,m,0),S!==0&&w===0&&r.tag!==0&&(r.suspendedLanes|=S&~(R&~a))}function fo(r,a,c){r.pendingLanes|=a,r.suspendedLanes&=~a;var m=31-dt(a);r.entangledLanes|=a,r.entanglements[m]=r.entanglements[m]|1073741824|c&261930}function xl(r,a){var c=r.entangledLanes|=a;for(r=r.entanglements;c;){var m=31-dt(c),w=1<<m;w&a|r[m]&a&&(r[m]|=a),c&=~w}}function wl(r,a){var c=a&-a;return c=(c&42)!==0?1:oi(c),(c&(r.suspendedLanes|a))!==0?0:c}function oi(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Be(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Sl(){var r=Ce.p;return r!==0?r:(r=window.event,r===void 0?32:BS(r.type))}function Qi(r,a){var c=Ce.p;try{return Ce.p=r,a()}finally{Ce.p=c}}var $i=Math.random().toString(36).slice(2),bn="__reactFiber$"+$i,Mn="__reactProps$"+$i,xs="__reactContainer$"+$i,ws="__reactEvents$"+$i,ju="__reactListeners$"+$i,Ku="__reactHandles$"+$i,Wu="__reactResources$"+$i,js="__reactMarker$"+$i;function oa(r){delete r[bn],delete r[Mn],delete r[ws],delete r[ju],delete r[Ku]}function Ss(r){var a=r[bn];if(a)return a;for(var c=r.parentNode;c;){if(a=c[xs]||c[bn]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(r=SS(r);r!==null;){if(c=r[bn])return c;r=SS(r)}return a}r=c,c=r.parentNode}return null}function Xi(r){if(r=r[bn]||r[xs]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function ai(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(i(33))}function Ks(r){var a=r[Wu];return a||(a=r[Wu]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Pn(r){r[js]=!0}var Cl=new Set,bl={};function Ws(r,a){es(r,a),es(r+"Capture",a)}function es(r,a){for(bl[r]=a,r=0;r<a.length;r++)Cl.add(a[r])}var dr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),aa={},la={};function Ur(r){return Qe.call(la,r)?!0:Qe.call(aa,r)?!1:dr.test(r)?la[r]=!0:(aa[r]=!0,!1)}function vt(r,a,c){if(Ur(a))if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var m=a.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+c)}}function xt(r,a,c){if(c===null)r.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+c)}}function yn(r,a,c,m){if(m===null)r.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(a,c,""+m)}}function vn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function qi(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function mo(r,a,c){var m=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var w=m.get,S=m.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return w.call(this)},set:function(R){c=""+R,S.call(this,R)}}),Object.defineProperty(r,a,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function Ue(r){if(!r._valueTracker){var a=qi(r)?"checked":"value";r._valueTracker=mo(r,a,""+r[a])}}function Zt(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var c=a.getValue(),m="";return r&&(m=qi(r)?r.checked?"true":"false":r.value),r=m,r!==c?(a.setValue(r),!0):!1}function ts(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ys=/[\n"\\]/g;function cn(r){return r.replace(Ys,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function ua(r,a,c,m,w,S,R,V){r.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?r.type=R:r.removeAttribute("type"),a!=null?R==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+vn(a)):r.value!==""+vn(a)&&(r.value=""+vn(a)):R!=="submit"&&R!=="reset"||r.removeAttribute("value"),a!=null?Cs(r,R,vn(a)):c!=null?Cs(r,R,vn(c)):m!=null&&r.removeAttribute("value"),w==null&&S!=null&&(r.defaultChecked=!!S),w!=null&&(r.checked=w&&typeof w!="function"&&typeof w!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?r.name=""+vn(V):r.removeAttribute("name")}function po(r,a,c,m,w,S,R,V){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(r.type=S),a!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||a!=null)){Ue(r);return}c=c!=null?""+vn(c):"",a=a!=null?""+vn(a):c,V||a===r.value||(r.value=a),r.defaultValue=a}m=m??w,m=typeof m!="function"&&typeof m!="symbol"&&!!m,r.checked=V?r.checked:!!m,r.defaultChecked=!!m,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(r.name=R),Ue(r)}function Cs(r,a,c){a==="number"&&ts(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Qt(r,a,c,m){if(r=r.options,a){a={};for(var w=0;w<c.length;w++)a["$"+c[w]]=!0;for(c=0;c<r.length;c++)w=a.hasOwnProperty("$"+r[c].value),r[c].selected!==w&&(r[c].selected=w),w&&m&&(r[c].defaultSelected=!0)}else{for(c=""+vn(c),a=null,w=0;w<r.length;w++){if(r[w].value===c){r[w].selected=!0,m&&(r[w].defaultSelected=!0);return}a!==null||r[w].disabled||(a=r[w])}a!==null&&(a.selected=!0)}}function Js(r,a,c){if(a!=null&&(a=""+vn(a),a!==r.value&&(r.value=a),c==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=c!=null?""+vn(c):""}function ns(r,a,c,m){if(a==null){if(m!=null){if(c!=null)throw Error(i(92));if($e(m)){if(1<m.length)throw Error(i(93));m=m[0]}c=m}c==null&&(c=""),a=c}c=vn(a),r.defaultValue=c,m=r.textContent,m===c&&m!==""&&m!==null&&(r.value=m),Ue(r)}function jn(r,a){if(a){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=a;return}}r.textContent=a}var ca=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function hr(r,a,c){var m=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":m?r.setProperty(a,c):typeof c!="number"||c===0||ca.has(a)?a==="float"?r.cssFloat=c:r[a]=(""+c).trim():r[a]=c+"px"}function go(r,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(r=r.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||a!=null&&a.hasOwnProperty(m)||(m.indexOf("--")===0?r.setProperty(m,""):m==="float"?r.cssFloat="":r[m]="");for(var w in a)m=a[w],a.hasOwnProperty(w)&&c[w]!==m&&hr(r,w,m)}else for(var S in a)a.hasOwnProperty(S)&&hr(r,S,a[S])}function Fr(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _o=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Zs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Br(r){return Zs.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Si(){}var da=null;function Ci(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var zr=null,tt=null;function li(r){var a=Xi(r);if(a&&(r=a.stateNode)){var c=r[Mn]||null;e:switch(r=a.stateNode,a.type){case"input":if(ua(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+cn(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var m=c[a];if(m!==r&&m.form===r.form){var w=m[Mn]||null;if(!w)throw Error(i(90));ua(m,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(a=0;a<c.length;a++)m=c[a],m.form===r.form&&Zt(m)}break e;case"textarea":Js(r,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&Qt(r,!!c.multiple,a,!1)}}}var Ft=!1;function fr(r,a,c){if(Ft)return r(a,c);Ft=!0;try{var m=r(a);return m}finally{if(Ft=!1,(zr!==null||tt!==null)&&(Mm(),zr&&(a=zr,r=tt,tt=zr=null,li(a),r)))for(a=0;a<r.length;a++)li(r[a])}}function Gi(r,a){var c=r.stateNode;if(c===null)return null;var m=c[Mn]||null;if(m===null)return null;c=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(r=r.type,m=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!m;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mr=!1;if(bi)try{var Pt={};Object.defineProperty(Pt,"passive",{get:function(){mr=!0}}),window.addEventListener("test",Pt,Pt),window.removeEventListener("test",Pt,Pt)}catch{mr=!1}var is=null,pr=null,Tn=null;function bs(){if(Tn)return Tn;var r,a=pr,c=a.length,m,w="value"in is?is.value:is.textContent,S=w.length;for(r=0;r<c&&a[r]===w[r];r++);var R=c-r;for(m=1;m<=R&&a[c-m]===w[S-m];m++);return Tn=w.slice(r,1<m?1-m:void 0)}function qr(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function Qs(){return!0}function Is(){return!1}function Kn(r){function a(c,m,w,S,R){this._reactName=c,this._targetInst=w,this.type=m,this.nativeEvent=S,this.target=R,this.currentTarget=null;for(var V in r)r.hasOwnProperty(V)&&(c=r[V],this[V]=c?c(S):S[V]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Qs:Is,this.isPropagationStopped=Is,this}return x(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Qs)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Qs)},persist:function(){},isPersistent:Qs}),a}var As={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$s=Kn(As),gr=x({},As,{view:0,detail:0}),yt=Kn(gr),Gr,ui,Ii,yo=x({},gr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hr,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ii&&(Ii&&r.type==="mousemove"?(Gr=r.screenX-Ii.screenX,ui=r.screenY-Ii.screenY):ui=Gr=0,Ii=r),Gr)},movementY:function(r){return"movementY"in r?r.movementY:ui}}),Il=Kn(yo),_r=x({},yo,{dataTransfer:0}),Yu=Kn(_r),Al=x({},gr,{relatedTarget:0}),vo=Kn(Al),Nl=x({},As,{animationName:0,elapsedTime:0,pseudoElement:0}),ha=Kn(Nl),fa=x({},As,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Hi=Kn(fa),Ju=x({},As,{data:0}),Ns=Kn(Ju),Rs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ml={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ma(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=Ml[r])?!!a[r]:!1}function Hr(){return ma}var ci=x({},gr,{key:function(r){if(r.key){var a=Rs[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=qr(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Rl[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hr,charCode:function(r){return r.type==="keypress"?qr(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?qr(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Pl=Kn(ci),Zu=x({},yo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yr=Kn(Zu),v=x({},gr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hr}),I=Kn(v),M=x({},As,{propertyName:0,elapsedTime:0,pseudoElement:0}),U=Kn(M),ne=x({},yo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),de=Kn(ne),Re=x({},As,{newState:0,oldState:0}),st=Kn(Re),Vt=[9,13,27,32],Ot=bi&&"CompositionEvent"in window,dn=null;bi&&"documentMode"in document&&(dn=document.documentMode);var ss=bi&&"TextEvent"in window&&!dn,rs=bi&&(!Ot||dn&&8<dn&&11>=dn),ji=" ",Ms=!1;function To(r,a){switch(r){case"keyup":return Vt.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Eo(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var pa=!1;function Ps(r,a){switch(r){case"compositionend":return Eo(a);case"keypress":return a.which!==32?null:(Ms=!0,ji);case"textInput":return r=a.data,r===ji&&Ms?null:r;default:return null}}function ga(r,a){if(pa)return r==="compositionend"||!Ot&&To(r,a)?(r=bs(),Tn=pr=is=null,pa=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return rs&&a.locale!=="ko"?null:a.data;default:return null}}var w_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xs(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!w_[r.type]:a==="textarea"}function Yf(r,a,c,m){zr?tt?tt.push(m):tt=[m]:zr=m,a=Um(a,"onChange"),0<a.length&&(c=new $s("onChange","change",null,c,m),r.push({event:c,listeners:a}))}var er=null,kl=null;function Dl(r){cS(r,0)}function Ll(r){var a=ai(r);if(Zt(a))return r}function Vl(r,a){if(r==="change")return a}var Jf=!1;if(bi){var tr;if(bi){var _a="oninput"in document;if(!_a){var Zf=document.createElement("div");Zf.setAttribute("oninput","return;"),_a=typeof Zf.oninput=="function"}tr=_a}else tr=!1;Jf=tr&&(!document.documentMode||9<document.documentMode)}function Qu(){er&&(er.detachEvent("onpropertychange",Qf),kl=er=null)}function Qf(r){if(r.propertyName==="value"&&Ll(kl)){var a=[];Yf(a,kl,r,Ci(r)),fr(Dl,a)}}function vr(r,a,c){r==="focusin"?(Qu(),er=a,kl=c,er.attachEvent("onpropertychange",Qf)):r==="focusout"&&Qu()}function S_(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ll(kl)}function ya(r,a){if(r==="click")return Ll(a)}function C_(r,a){if(r==="input"||r==="change")return Ll(a)}function Tr(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var di=typeof Object.is=="function"?Object.is:Tr;function va(r,a){if(di(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var c=Object.keys(r),m=Object.keys(a);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var w=c[m];if(!Qe.call(a,w)||!di(r[w],a[w]))return!1}return!0}function $u(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Ol(r,a){var c=$u(r);r=0;for(var m;c;){if(c.nodeType===3){if(m=r+c.textContent.length,r<=a&&m>=a)return{node:c,offset:a-r};r=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=$u(c)}}function Xu(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?Xu(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function Ul(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=ts(r.document);a instanceof r.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)r=a.contentWindow;else break;a=ts(r.document)}return a}function jr(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var ec=bi&&"documentMode"in document&&11>=document.documentMode,Kr=null,tc=null,Fl=null,Ta=!1;function $f(r,a,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Ta||Kr==null||Kr!==ts(m)||(m=Kr,"selectionStart"in m&&jr(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Fl&&va(Fl,m)||(Fl=m,m=Um(tc,"onSelect"),0<m.length&&(a=new $s("onSelect","select",null,a,c),r.push({event:a,listeners:m}),a.target=Kr)))}function Wr(r,a){var c={};return c[r.toLowerCase()]=a.toLowerCase(),c["Webkit"+r]="webkit"+a,c["Moz"+r]="moz"+a,c}var Ea={animationend:Wr("Animation","AnimationEnd"),animationiteration:Wr("Animation","AnimationIteration"),animationstart:Wr("Animation","AnimationStart"),transitionrun:Wr("Transition","TransitionRun"),transitionstart:Wr("Transition","TransitionStart"),transitioncancel:Wr("Transition","TransitionCancel"),transitionend:Wr("Transition","TransitionEnd")},nc={},Xf={};bi&&(Xf=document.createElement("div").style,"AnimationEvent"in window||(delete Ea.animationend.animation,delete Ea.animationiteration.animation,delete Ea.animationstart.animation),"TransitionEvent"in window||delete Ea.transitionend.transition);function hi(r){if(nc[r])return nc[r];if(!Ea[r])return r;var a=Ea[r],c;for(c in a)if(a.hasOwnProperty(c)&&c in Xf)return nc[r]=a[c];return r}var Bl=hi("animationend"),em=hi("animationiteration"),zl=hi("animationstart"),b_=hi("transitionrun"),tm=hi("transitionstart"),I_=hi("transitioncancel"),xa=hi("transitionend"),nm=new Map,Yr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yr.push("scrollEnd");function os(r,a){nm.set(r,a),Ws(a,[r])}var ql=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},as=[],Ai=0,ic=0;function Gl(){for(var r=Ai,a=ic=Ai=0;a<r;){var c=as[a];as[a++]=null;var m=as[a];as[a++]=null;var w=as[a];as[a++]=null;var S=as[a];if(as[a++]=null,m!==null&&w!==null){var R=m.pending;R===null?w.next=w:(w.next=R.next,R.next=w),m.pending=w}S!==0&&wa(c,w,S)}}function Jr(r,a,c,m){as[Ai++]=r,as[Ai++]=a,as[Ai++]=c,as[Ai++]=m,ic|=m,r.lanes|=m,r=r.alternate,r!==null&&(r.lanes|=m)}function Fd(r,a,c,m){return Jr(r,a,c,m),Hl(r)}function nr(r,a){return Jr(r,null,null,a),Hl(r)}function wa(r,a,c){r.lanes|=c;var m=r.alternate;m!==null&&(m.lanes|=c);for(var w=!1,S=r.return;S!==null;)S.childLanes|=c,m=S.alternate,m!==null&&(m.childLanes|=c),S.tag===22&&(r=S.stateNode,r===null||r._visibility&1||(w=!0)),r=S,S=S.return;return r.tag===3?(S=r.stateNode,w&&a!==null&&(w=31-dt(c),r=S.hiddenUpdates,m=r[w],m===null?r[w]=[a]:m.push(a),a.lane=c|536870912),S):null}function Hl(r){if(50<ch)throw ch=0,Ny=null,Error(i(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var xo={};function A_(r,a,c,m){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ni(r,a,c,m){return new A_(r,a,c,m)}function sc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ir(r,a){var c=r.alternate;return c===null?(c=Ni(r.tag,a,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=a,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,a=r.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Bd(r,a){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,a=c.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function jl(r,a,c,m,w,S){var R=0;if(m=r,typeof r=="function")sc(r)&&(R=1);else if(typeof r=="string")R=fD(r,c,le.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case O:return r=Ni(31,c,a,w),r.elementType=O,r.lanes=S,r;case F:return wo(c.children,w,S,a);case H:R=8,w|=24;break;case X:return r=Ni(12,c,a,w|2),r.elementType=X,r.lanes=S,r;case fe:return r=Ni(13,c,a,w),r.elementType=fe,r.lanes=S,r;case Y:return r=Ni(19,c,a,w),r.elementType=Y,r.lanes=S,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Q:R=10;break e;case re:R=9;break e;case he:R=11;break e;case k:R=14;break e;case B:R=16,m=null;break e}R=29,c=Error(i(130,r===null?"null":typeof r,"")),m=null}return a=Ni(R,c,a,w),a.elementType=r,a.type=m,a.lanes=S,a}function wo(r,a,c,m){return r=Ni(7,r,m,a),r.lanes=c,r}function rc(r,a,c){return r=Ni(6,r,null,a),r.lanes=c,r}function zd(r){var a=Ni(18,null,null,0);return a.stateNode=r,a}function qd(r,a,c){return a=Ni(4,r.children!==null?r.children:[],r.key,a),a.lanes=c,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var u=new WeakMap;function f(r,a){if(typeof r=="object"&&r!==null){var c=u.get(r);return c!==void 0?c:(a={value:r,source:a,stack:Se(a)},u.set(r,a),a)}return{value:r,source:a,stack:Se(a)}}var E=[],b=0,N=null,P=0,j=[],te=0,ue=null,Ee=1,Le="";function Je(r,a){E[b++]=P,E[b++]=N,N=r,P=a}function gt(r,a,c){j[te++]=Ee,j[te++]=Le,j[te++]=ue,ue=r;var m=Ee;r=Le;var w=32-dt(m)-1;m&=~(1<<w),c+=1;var S=32-dt(a)+w;if(30<S){var R=w-w%5;S=(m&(1<<R)-1).toString(32),m>>=R,w-=R,Ee=1<<32-dt(a)+w|c<<w|m,Le=S+r}else Ee=1<<S|c<<w|m,Le=r}function ei(r){r.return!==null&&(Je(r,1),gt(r,1,0))}function kn(r){for(;r===N;)N=E[--b],E[b]=null,P=E[--b],E[b]=null;for(;r===ue;)ue=j[--te],j[te]=null,Le=j[--te],j[te]=null,Ee=j[--te],j[te]=null}function Ki(r,a){j[te++]=Ee,j[te++]=Le,j[te++]=ue,Ee=a.id,Le=a.overflow,ue=r}var Bt=null,zt=null,wt=!1,Zr=null,ls=!1,oc=Error(i(519));function Qr(r){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(f(a,r)),oc}function Gd(r){var a=r.stateNode,c=r.type,m=r.memoizedProps;switch(a[bn]=r,a[Mn]=m,c){case"dialog":Ct("cancel",a),Ct("close",a);break;case"iframe":case"object":case"embed":Ct("load",a);break;case"video":case"audio":for(c=0;c<hh.length;c++)Ct(hh[c],a);break;case"source":Ct("error",a);break;case"img":case"image":case"link":Ct("error",a),Ct("load",a);break;case"details":Ct("toggle",a);break;case"input":Ct("invalid",a),po(a,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Ct("invalid",a);break;case"textarea":Ct("invalid",a),ns(a,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||m.suppressHydrationWarning===!0||mS(a.textContent,c)?(m.popover!=null&&(Ct("beforetoggle",a),Ct("toggle",a)),m.onScroll!=null&&Ct("scroll",a),m.onScrollEnd!=null&&Ct("scrollend",a),m.onClick!=null&&(a.onclick=Si),a=!0):a=!1,a||Qr(r,!0)}function In(r){for(Bt=r.return;Bt;)switch(Bt.tag){case 5:case 31:case 13:ls=!1;return;case 27:case 3:ls=!0;return;default:Bt=Bt.return}}function Er(r){if(r!==Bt)return!1;if(!wt)return In(r),wt=!0,!1;var a=r.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Hy(r.type,r.memoizedProps)),c=!c),c&&zt&&Qr(r),In(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));zt=wS(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));zt=wS(r)}else a===27?(a=zt,Oa(r.type)?(r=Jy,Jy=null,zt=r):zt=a):zt=Bt?rr(r.stateNode.nextSibling):null;return!0}function So(){zt=Bt=null,wt=!1}function Hd(){var r=Zr;return r!==null&&(hs===null?hs=r:hs.push.apply(hs,r),Zr=null),r}function Kl(r){Zr===null?Zr=[r]:Zr.push(r)}var Wl=K(null),$r=null,xr=null;function Sa(r,a,c){Ie(Wl,a._currentValue),a._currentValue=c}function Co(r){r._currentValue=Wl.current,me(Wl)}function N_(r,a,c){for(;r!==null;){var m=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),r===c)break;r=r.return}}function R_(r,a,c,m){var w=r.child;for(w!==null&&(w.return=r);w!==null;){var S=w.dependencies;if(S!==null){var R=w.child;S=S.firstContext;e:for(;S!==null;){var V=S;S=w;for(var J=0;J<a.length;J++)if(V.context===a[J]){S.lanes|=c,V=S.alternate,V!==null&&(V.lanes|=c),N_(S.return,c,r),m||(R=null);break e}S=V.next}}else if(w.tag===18){if(R=w.return,R===null)throw Error(i(341));R.lanes|=c,S=R.alternate,S!==null&&(S.lanes|=c),N_(R,c,r),R=null}else R=w.child;if(R!==null)R.return=w;else for(R=w;R!==null;){if(R===r){R=null;break}if(w=R.sibling,w!==null){w.return=R.return,R=w;break}R=R.return}w=R}}function ac(r,a,c,m){r=null;for(var w=a,S=!1;w!==null;){if(!S){if((w.flags&524288)!==0)S=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var R=w.alternate;if(R===null)throw Error(i(387));if(R=R.memoizedProps,R!==null){var V=w.type;di(w.pendingProps.value,R.value)||(r!==null?r.push(V):r=[V])}}else if(w===Ke.current){if(R=w.alternate,R===null)throw Error(i(387));R.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(r!==null?r.push(_h):r=[_h])}w=w.return}r!==null&&R_(a,r,c,m),a.flags|=262144}function im(r){for(r=r.firstContext;r!==null;){if(!di(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Yl(r){$r=r,xr=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Ti(r){return XE($r,r)}function sm(r,a){return $r===null&&Yl(r),XE(r,a)}function XE(r,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},xr===null){if(r===null)throw Error(i(308));xr=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else xr=xr.next=a;return c}var uk=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(c,m){r.push(m)}};this.abort=function(){a.aborted=!0,r.forEach(function(c){return c()})}},ck=n.unstable_scheduleCallback,dk=n.unstable_NormalPriority,Wn={$$typeof:Q,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function M_(){return{controller:new uk,data:new Map,refCount:0}}function jd(r){r.refCount--,r.refCount===0&&ck(dk,function(){r.controller.abort()})}var Kd=null,P_=0,lc=0,uc=null;function hk(r,a){if(Kd===null){var c=Kd=[];P_=0,lc=Ly(),uc={status:"pending",value:void 0,then:function(m){c.push(m)}}}return P_++,a.then(ex,ex),a}function ex(){if(--P_===0&&Kd!==null){uc!==null&&(uc.status="fulfilled");var r=Kd;Kd=null,lc=0,uc=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function fk(r,a){var c=[],m={status:"pending",value:null,reason:null,then:function(w){c.push(w)}};return r.then(function(){m.status="fulfilled",m.value=a;for(var w=0;w<c.length;w++)(0,c[w])(a)},function(w){for(m.status="rejected",m.reason=w,w=0;w<c.length;w++)(0,c[w])(void 0)}),m}var tx=se.S;se.S=function(r,a){Uw=lt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&hk(r,a),tx!==null&&tx(r,a)};var Jl=K(null);function k_(){var r=Jl.current;return r!==null?r:hn.pooledCache}function rm(r,a){a===null?Ie(Jl,Jl.current):Ie(Jl,a.pool)}function nx(){var r=k_();return r===null?null:{parent:Wn._currentValue,pool:r}}var cc=Error(i(460)),D_=Error(i(474)),om=Error(i(542)),am={then:function(){}};function ix(r){return r=r.status,r==="fulfilled"||r==="rejected"}function sx(r,a,c){switch(c=r[c],c===void 0?r.push(a):c!==a&&(a.then(Si,Si),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,ox(r),r;default:if(typeof a.status=="string")a.then(Si,Si);else{if(r=hn,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=a,r.status="pending",r.then(function(m){if(a.status==="pending"){var w=a;w.status="fulfilled",w.value=m}},function(m){if(a.status==="pending"){var w=a;w.status="rejected",w.reason=m}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,ox(r),r}throw Ql=a,cc}}function Zl(r){try{var a=r._init;return a(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Ql=c,cc):c}}var Ql=null;function rx(){if(Ql===null)throw Error(i(459));var r=Ql;return Ql=null,r}function ox(r){if(r===cc||r===om)throw Error(i(483))}var dc=null,Wd=0;function lm(r){var a=Wd;return Wd+=1,dc===null&&(dc=[]),sx(dc,r,a)}function Yd(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function um(r,a){throw a.$$typeof===C?Error(i(525)):(r=Object.prototype.toString.call(a),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function ax(r){function a(ee,$){if(r){var oe=ee.deletions;oe===null?(ee.deletions=[$],ee.flags|=16):oe.push($)}}function c(ee,$){if(!r)return null;for(;$!==null;)a(ee,$),$=$.sibling;return null}function m(ee){for(var $=new Map;ee!==null;)ee.key!==null?$.set(ee.key,ee):$.set(ee.index,ee),ee=ee.sibling;return $}function w(ee,$){return ee=ir(ee,$),ee.index=0,ee.sibling=null,ee}function S(ee,$,oe){return ee.index=oe,r?(oe=ee.alternate,oe!==null?(oe=oe.index,oe<$?(ee.flags|=67108866,$):oe):(ee.flags|=67108866,$)):(ee.flags|=1048576,$)}function R(ee){return r&&ee.alternate===null&&(ee.flags|=67108866),ee}function V(ee,$,oe,Te){return $===null||$.tag!==6?($=rc(oe,ee.mode,Te),$.return=ee,$):($=w($,oe),$.return=ee,$)}function J(ee,$,oe,Te){var Xe=oe.type;return Xe===F?ye(ee,$,oe.props.children,Te,oe.key):$!==null&&($.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===B&&Zl(Xe)===$.type)?($=w($,oe.props),Yd($,oe),$.return=ee,$):($=jl(oe.type,oe.key,oe.props,null,ee.mode,Te),Yd($,oe),$.return=ee,$)}function ae(ee,$,oe,Te){return $===null||$.tag!==4||$.stateNode.containerInfo!==oe.containerInfo||$.stateNode.implementation!==oe.implementation?($=qd(oe,ee.mode,Te),$.return=ee,$):($=w($,oe.children||[]),$.return=ee,$)}function ye(ee,$,oe,Te,Xe){return $===null||$.tag!==7?($=wo(oe,ee.mode,Te,Xe),$.return=ee,$):($=w($,oe),$.return=ee,$)}function xe(ee,$,oe){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=rc(""+$,ee.mode,oe),$.return=ee,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case A:return oe=jl($.type,$.key,$.props,null,ee.mode,oe),Yd(oe,$),oe.return=ee,oe;case D:return $=qd($,ee.mode,oe),$.return=ee,$;case B:return $=Zl($),xe(ee,$,oe)}if($e($)||W($))return $=wo($,ee.mode,oe,null),$.return=ee,$;if(typeof $.then=="function")return xe(ee,lm($),oe);if($.$$typeof===Q)return xe(ee,sm(ee,$),oe);um(ee,$)}return null}function ce(ee,$,oe,Te){var Xe=$!==null?$.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return Xe!==null?null:V(ee,$,""+oe,Te);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case A:return oe.key===Xe?J(ee,$,oe,Te):null;case D:return oe.key===Xe?ae(ee,$,oe,Te):null;case B:return oe=Zl(oe),ce(ee,$,oe,Te)}if($e(oe)||W(oe))return Xe!==null?null:ye(ee,$,oe,Te,null);if(typeof oe.then=="function")return ce(ee,$,lm(oe),Te);if(oe.$$typeof===Q)return ce(ee,$,sm(ee,oe),Te);um(ee,oe)}return null}function pe(ee,$,oe,Te,Xe){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ee=ee.get(oe)||null,V($,ee,""+Te,Xe);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case A:return ee=ee.get(Te.key===null?oe:Te.key)||null,J($,ee,Te,Xe);case D:return ee=ee.get(Te.key===null?oe:Te.key)||null,ae($,ee,Te,Xe);case B:return Te=Zl(Te),pe(ee,$,oe,Te,Xe)}if($e(Te)||W(Te))return ee=ee.get(oe)||null,ye($,ee,Te,Xe,null);if(typeof Te.then=="function")return pe(ee,$,oe,lm(Te),Xe);if(Te.$$typeof===Q)return pe(ee,$,oe,sm($,Te),Xe);um($,Te)}return null}function qe(ee,$,oe,Te){for(var Xe=null,qt=null,We=$,_t=$=0,Dt=null;We!==null&&_t<oe.length;_t++){We.index>_t?(Dt=We,We=null):Dt=We.sibling;var Gt=ce(ee,We,oe[_t],Te);if(Gt===null){We===null&&(We=Dt);break}r&&We&&Gt.alternate===null&&a(ee,We),$=S(Gt,$,_t),qt===null?Xe=Gt:qt.sibling=Gt,qt=Gt,We=Dt}if(_t===oe.length)return c(ee,We),wt&&Je(ee,_t),Xe;if(We===null){for(;_t<oe.length;_t++)We=xe(ee,oe[_t],Te),We!==null&&($=S(We,$,_t),qt===null?Xe=We:qt.sibling=We,qt=We);return wt&&Je(ee,_t),Xe}for(We=m(We);_t<oe.length;_t++)Dt=pe(We,ee,_t,oe[_t],Te),Dt!==null&&(r&&Dt.alternate!==null&&We.delete(Dt.key===null?_t:Dt.key),$=S(Dt,$,_t),qt===null?Xe=Dt:qt.sibling=Dt,qt=Dt);return r&&We.forEach(function(qa){return a(ee,qa)}),wt&&Je(ee,_t),Xe}function nt(ee,$,oe,Te){if(oe==null)throw Error(i(151));for(var Xe=null,qt=null,We=$,_t=$=0,Dt=null,Gt=oe.next();We!==null&&!Gt.done;_t++,Gt=oe.next()){We.index>_t?(Dt=We,We=null):Dt=We.sibling;var qa=ce(ee,We,Gt.value,Te);if(qa===null){We===null&&(We=Dt);break}r&&We&&qa.alternate===null&&a(ee,We),$=S(qa,$,_t),qt===null?Xe=qa:qt.sibling=qa,qt=qa,We=Dt}if(Gt.done)return c(ee,We),wt&&Je(ee,_t),Xe;if(We===null){for(;!Gt.done;_t++,Gt=oe.next())Gt=xe(ee,Gt.value,Te),Gt!==null&&($=S(Gt,$,_t),qt===null?Xe=Gt:qt.sibling=Gt,qt=Gt);return wt&&Je(ee,_t),Xe}for(We=m(We);!Gt.done;_t++,Gt=oe.next())Gt=pe(We,ee,_t,Gt.value,Te),Gt!==null&&(r&&Gt.alternate!==null&&We.delete(Gt.key===null?_t:Gt.key),$=S(Gt,$,_t),qt===null?Xe=Gt:qt.sibling=Gt,qt=Gt);return r&&We.forEach(function(SD){return a(ee,SD)}),wt&&Je(ee,_t),Xe}function ln(ee,$,oe,Te){if(typeof oe=="object"&&oe!==null&&oe.type===F&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case A:e:{for(var Xe=oe.key;$!==null;){if($.key===Xe){if(Xe=oe.type,Xe===F){if($.tag===7){c(ee,$.sibling),Te=w($,oe.props.children),Te.return=ee,ee=Te;break e}}else if($.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===B&&Zl(Xe)===$.type){c(ee,$.sibling),Te=w($,oe.props),Yd(Te,oe),Te.return=ee,ee=Te;break e}c(ee,$);break}else a(ee,$);$=$.sibling}oe.type===F?(Te=wo(oe.props.children,ee.mode,Te,oe.key),Te.return=ee,ee=Te):(Te=jl(oe.type,oe.key,oe.props,null,ee.mode,Te),Yd(Te,oe),Te.return=ee,ee=Te)}return R(ee);case D:e:{for(Xe=oe.key;$!==null;){if($.key===Xe)if($.tag===4&&$.stateNode.containerInfo===oe.containerInfo&&$.stateNode.implementation===oe.implementation){c(ee,$.sibling),Te=w($,oe.children||[]),Te.return=ee,ee=Te;break e}else{c(ee,$);break}else a(ee,$);$=$.sibling}Te=qd(oe,ee.mode,Te),Te.return=ee,ee=Te}return R(ee);case B:return oe=Zl(oe),ln(ee,$,oe,Te)}if($e(oe))return qe(ee,$,oe,Te);if(W(oe)){if(Xe=W(oe),typeof Xe!="function")throw Error(i(150));return oe=Xe.call(oe),nt(ee,$,oe,Te)}if(typeof oe.then=="function")return ln(ee,$,lm(oe),Te);if(oe.$$typeof===Q)return ln(ee,$,sm(ee,oe),Te);um(ee,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint"?(oe=""+oe,$!==null&&$.tag===6?(c(ee,$.sibling),Te=w($,oe),Te.return=ee,ee=Te):(c(ee,$),Te=rc(oe,ee.mode,Te),Te.return=ee,ee=Te),R(ee)):c(ee,$)}return function(ee,$,oe,Te){try{Wd=0;var Xe=ln(ee,$,oe,Te);return dc=null,Xe}catch(We){if(We===cc||We===om)throw We;var qt=Ni(29,We,null,ee.mode);return qt.lanes=Te,qt.return=ee,qt}finally{}}}var $l=ax(!0),lx=ax(!1),Ca=!1;function L_(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function V_(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ba(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ia(r,a,c){var m=r.updateQueue;if(m===null)return null;if(m=m.shared,(jt&2)!==0){var w=m.pending;return w===null?a.next=a:(a.next=w.next,w.next=a),m.pending=a,a=Hl(r),wa(r,null,c),a}return Jr(r,m,a,c),Hl(r)}function Jd(r,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var m=a.lanes;m&=r.pendingLanes,c|=m,a.lanes=c,xl(r,c)}}function O_(r,a){var c=r.updateQueue,m=r.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var w=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?w=S=R:S=S.next=R,c=c.next}while(c!==null);S===null?w=S=a:S=S.next=a}else w=S=a;c={baseState:m.baseState,firstBaseUpdate:w,lastBaseUpdate:S,shared:m.shared,callbacks:m.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=a:r.next=a,c.lastBaseUpdate=a}var U_=!1;function Zd(){if(U_){var r=uc;if(r!==null)throw r}}function Qd(r,a,c,m){U_=!1;var w=r.updateQueue;Ca=!1;var S=w.firstBaseUpdate,R=w.lastBaseUpdate,V=w.shared.pending;if(V!==null){w.shared.pending=null;var J=V,ae=J.next;J.next=null,R===null?S=ae:R.next=ae,R=J;var ye=r.alternate;ye!==null&&(ye=ye.updateQueue,V=ye.lastBaseUpdate,V!==R&&(V===null?ye.firstBaseUpdate=ae:V.next=ae,ye.lastBaseUpdate=J))}if(S!==null){var xe=w.baseState;R=0,ye=ae=J=null,V=S;do{var ce=V.lane&-536870913,pe=ce!==V.lane;if(pe?(kt&ce)===ce:(m&ce)===ce){ce!==0&&ce===lc&&(U_=!0),ye!==null&&(ye=ye.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});e:{var qe=r,nt=V;ce=a;var ln=c;switch(nt.tag){case 1:if(qe=nt.payload,typeof qe=="function"){xe=qe.call(ln,xe,ce);break e}xe=qe;break e;case 3:qe.flags=qe.flags&-65537|128;case 0:if(qe=nt.payload,ce=typeof qe=="function"?qe.call(ln,xe,ce):qe,ce==null)break e;xe=x({},xe,ce);break e;case 2:Ca=!0}}ce=V.callback,ce!==null&&(r.flags|=64,pe&&(r.flags|=8192),pe=w.callbacks,pe===null?w.callbacks=[ce]:pe.push(ce))}else pe={lane:ce,tag:V.tag,payload:V.payload,callback:V.callback,next:null},ye===null?(ae=ye=pe,J=xe):ye=ye.next=pe,R|=ce;if(V=V.next,V===null){if(V=w.shared.pending,V===null)break;pe=V,V=pe.next,pe.next=null,w.lastBaseUpdate=pe,w.shared.pending=null}}while(!0);ye===null&&(J=xe),w.baseState=J,w.firstBaseUpdate=ae,w.lastBaseUpdate=ye,S===null&&(w.shared.lanes=0),Pa|=R,r.lanes=R,r.memoizedState=xe}}function ux(r,a){if(typeof r!="function")throw Error(i(191,r));r.call(a)}function cx(r,a){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)ux(c[r],a)}var hc=K(null),cm=K(0);function dx(r,a){r=Do,Ie(cm,r),Ie(hc,a),Do=r|a.baseLanes}function F_(){Ie(cm,Do),Ie(hc,hc.current)}function B_(){Do=cm.current,me(hc),me(cm)}var ks=K(null),sr=null;function Aa(r){var a=r.alternate;Ie(Bn,Bn.current&1),Ie(ks,r),sr===null&&(a===null||hc.current!==null||a.memoizedState!==null)&&(sr=r)}function z_(r){Ie(Bn,Bn.current),Ie(ks,r),sr===null&&(sr=r)}function hx(r){r.tag===22?(Ie(Bn,Bn.current),Ie(ks,r),sr===null&&(sr=r)):Na()}function Na(){Ie(Bn,Bn.current),Ie(ks,ks.current)}function Ds(r){me(ks),sr===r&&(sr=null),me(Bn)}var Bn=K(0);function dm(r){for(var a=r;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Wy(c)||Yy(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var bo=0,pt=null,on=null,Yn=null,hm=!1,fc=!1,Xl=!1,fm=0,$d=0,mc=null,mk=0;function Dn(){throw Error(i(321))}function q_(r,a){if(a===null)return!1;for(var c=0;c<a.length&&c<r.length;c++)if(!di(r[c],a[c]))return!1;return!0}function G_(r,a,c,m,w,S){return bo=S,pt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,se.H=r===null||r.memoizedState===null?Jx:sy,Xl=!1,S=c(m,w),Xl=!1,fc&&(S=mx(a,c,m,w)),fx(r),S}function fx(r){se.H=th;var a=on!==null&&on.next!==null;if(bo=0,Yn=on=pt=null,hm=!1,$d=0,mc=null,a)throw Error(i(300));r===null||Jn||(r=r.dependencies,r!==null&&im(r)&&(Jn=!0))}function mx(r,a,c,m){pt=r;var w=0;do{if(fc&&(mc=null),$d=0,fc=!1,25<=w)throw Error(i(301));if(w+=1,Yn=on=null,r.updateQueue!=null){var S=r.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}se.H=Zx,S=a(c,m)}while(fc);return S}function pk(){var r=se.H,a=r.useState()[0];return a=typeof a.then=="function"?Xd(a):a,r=r.useState()[0],(on!==null?on.memoizedState:null)!==r&&(pt.flags|=1024),a}function H_(){var r=fm!==0;return fm=0,r}function j_(r,a,c){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~c}function K_(r){if(hm){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}hm=!1}bo=0,Yn=on=pt=null,fc=!1,$d=fm=0,mc=null}function Wi(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yn===null?pt.memoizedState=Yn=r:Yn=Yn.next=r,Yn}function zn(){if(on===null){var r=pt.alternate;r=r!==null?r.memoizedState:null}else r=on.next;var a=Yn===null?pt.memoizedState:Yn.next;if(a!==null)Yn=a,on=r;else{if(r===null)throw pt.alternate===null?Error(i(467)):Error(i(310));on=r,r={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},Yn===null?pt.memoizedState=Yn=r:Yn=Yn.next=r}return Yn}function mm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Xd(r){var a=$d;return $d+=1,mc===null&&(mc=[]),r=sx(mc,r,a),a=pt,(Yn===null?a.memoizedState:Yn.next)===null&&(a=a.alternate,se.H=a===null||a.memoizedState===null?Jx:sy),r}function pm(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Xd(r);if(r.$$typeof===Q)return Ti(r)}throw Error(i(438,String(r)))}function W_(r){var a=null,c=pt.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var m=pt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(a={data:m.data.map(function(w){return w.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=mm(),pt.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(r),m=0;m<r;m++)c[m]=q;return a.index++,c}function Io(r,a){return typeof a=="function"?a(r):a}function gm(r){var a=zn();return Y_(a,on,r)}function Y_(r,a,c){var m=r.queue;if(m===null)throw Error(i(311));m.lastRenderedReducer=c;var w=r.baseQueue,S=m.pending;if(S!==null){if(w!==null){var R=w.next;w.next=S.next,S.next=R}a.baseQueue=w=S,m.pending=null}if(S=r.baseState,w===null)r.memoizedState=S;else{a=w.next;var V=R=null,J=null,ae=a,ye=!1;do{var xe=ae.lane&-536870913;if(xe!==ae.lane?(kt&xe)===xe:(bo&xe)===xe){var ce=ae.revertLane;if(ce===0)J!==null&&(J=J.next={lane:0,revertLane:0,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),xe===lc&&(ye=!0);else if((bo&ce)===ce){ae=ae.next,ce===lc&&(ye=!0);continue}else xe={lane:0,revertLane:ae.revertLane,gesture:null,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},J===null?(V=J=xe,R=S):J=J.next=xe,pt.lanes|=ce,Pa|=ce;xe=ae.action,Xl&&c(S,xe),S=ae.hasEagerState?ae.eagerState:c(S,xe)}else ce={lane:xe,revertLane:ae.revertLane,gesture:ae.gesture,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null},J===null?(V=J=ce,R=S):J=J.next=ce,pt.lanes|=xe,Pa|=xe;ae=ae.next}while(ae!==null&&ae!==a);if(J===null?R=S:J.next=V,!di(S,r.memoizedState)&&(Jn=!0,ye&&(c=uc,c!==null)))throw c;r.memoizedState=S,r.baseState=R,r.baseQueue=J,m.lastRenderedState=S}return w===null&&(m.lanes=0),[r.memoizedState,m.dispatch]}function J_(r){var a=zn(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=r;var m=c.dispatch,w=c.pending,S=a.memoizedState;if(w!==null){c.pending=null;var R=w=w.next;do S=r(S,R.action),R=R.next;while(R!==w);di(S,a.memoizedState)||(Jn=!0),a.memoizedState=S,a.baseQueue===null&&(a.baseState=S),c.lastRenderedState=S}return[S,m]}function px(r,a,c){var m=pt,w=zn(),S=wt;if(S){if(c===void 0)throw Error(i(407));c=c()}else c=a();var R=!di((on||w).memoizedState,c);if(R&&(w.memoizedState=c,Jn=!0),w=w.queue,$_(yx.bind(null,m,w,r),[r]),w.getSnapshot!==a||R||Yn!==null&&Yn.memoizedState.tag&1){if(m.flags|=2048,pc(9,{destroy:void 0},_x.bind(null,m,w,c,a),null),hn===null)throw Error(i(349));S||(bo&127)!==0||gx(m,a,c)}return c}function gx(r,a,c){r.flags|=16384,r={getSnapshot:a,value:c},a=pt.updateQueue,a===null?(a=mm(),pt.updateQueue=a,a.stores=[r]):(c=a.stores,c===null?a.stores=[r]:c.push(r))}function _x(r,a,c,m){a.value=c,a.getSnapshot=m,vx(a)&&Tx(r)}function yx(r,a,c){return c(function(){vx(a)&&Tx(r)})}function vx(r){var a=r.getSnapshot;r=r.value;try{var c=a();return!di(r,c)}catch{return!0}}function Tx(r){var a=nr(r,2);a!==null&&fs(a,r,2)}function Z_(r){var a=Wi();if(typeof r=="function"){var c=r;if(r=c(),Xl){ht(!0);try{c()}finally{ht(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:r},a}function Ex(r,a,c,m){return r.baseState=c,Y_(r,on,typeof m=="function"?m:Io)}function gk(r,a,c,m,w){if(vm(r))throw Error(i(485));if(r=a.action,r!==null){var S={payload:w,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){S.listeners.push(R)}};se.T!==null?c(!0):S.isTransition=!1,m(S),c=a.pending,c===null?(S.next=a.pending=S,xx(a,S)):(S.next=c.next,a.pending=c.next=S)}}function xx(r,a){var c=a.action,m=a.payload,w=r.state;if(a.isTransition){var S=se.T,R={};se.T=R;try{var V=c(w,m),J=se.S;J!==null&&J(R,V),wx(r,a,V)}catch(ae){Q_(r,a,ae)}finally{S!==null&&R.types!==null&&(S.types=R.types),se.T=S}}else try{S=c(w,m),wx(r,a,S)}catch(ae){Q_(r,a,ae)}}function wx(r,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){Sx(r,a,m)},function(m){return Q_(r,a,m)}):Sx(r,a,c)}function Sx(r,a,c){a.status="fulfilled",a.value=c,Cx(a),r.state=c,a=r.pending,a!==null&&(c=a.next,c===a?r.pending=null:(c=c.next,a.next=c,xx(r,c)))}function Q_(r,a,c){var m=r.pending;if(r.pending=null,m!==null){m=m.next;do a.status="rejected",a.reason=c,Cx(a),a=a.next;while(a!==m)}r.action=null}function Cx(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function bx(r,a){return a}function Ix(r,a){if(wt){var c=hn.formState;if(c!==null){e:{var m=pt;if(wt){if(zt){t:{for(var w=zt,S=ls;w.nodeType!==8;){if(!S){w=null;break t}if(w=rr(w.nextSibling),w===null){w=null;break t}}S=w.data,w=S==="F!"||S==="F"?w:null}if(w){zt=rr(w.nextSibling),m=w.data==="F!";break e}}Qr(m)}m=!1}m&&(a=c[0])}}return c=Wi(),c.memoizedState=c.baseState=a,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bx,lastRenderedState:a},c.queue=m,c=Kx.bind(null,pt,m),m.dispatch=c,m=Z_(!1),S=iy.bind(null,pt,!1,m.queue),m=Wi(),w={state:a,dispatch:null,action:r,pending:null},m.queue=w,c=gk.bind(null,pt,w,S,c),w.dispatch=c,m.memoizedState=r,[a,c,!1]}function Ax(r){var a=zn();return Nx(a,on,r)}function Nx(r,a,c){if(a=Y_(r,a,bx)[0],r=gm(Io)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var m=Xd(a)}catch(R){throw R===cc?om:R}else m=a;a=zn();var w=a.queue,S=w.dispatch;return c!==a.memoizedState&&(pt.flags|=2048,pc(9,{destroy:void 0},_k.bind(null,w,c),null)),[m,S,r]}function _k(r,a){r.action=a}function Rx(r){var a=zn(),c=on;if(c!==null)return Nx(a,c,r);zn(),a=a.memoizedState,c=zn();var m=c.queue.dispatch;return c.memoizedState=r,[a,m,!1]}function pc(r,a,c,m){return r={tag:r,create:c,deps:m,inst:a,next:null},a=pt.updateQueue,a===null&&(a=mm(),pt.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=r.next=r:(m=c.next,c.next=r,r.next=m,a.lastEffect=r),r}function Mx(){return zn().memoizedState}function _m(r,a,c,m){var w=Wi();pt.flags|=r,w.memoizedState=pc(1|a,{destroy:void 0},c,m===void 0?null:m)}function ym(r,a,c,m){var w=zn();m=m===void 0?null:m;var S=w.memoizedState.inst;on!==null&&m!==null&&q_(m,on.memoizedState.deps)?w.memoizedState=pc(a,S,c,m):(pt.flags|=r,w.memoizedState=pc(1|a,S,c,m))}function Px(r,a){_m(8390656,8,r,a)}function $_(r,a){ym(2048,8,r,a)}function yk(r){pt.flags|=4;var a=pt.updateQueue;if(a===null)a=mm(),pt.updateQueue=a,a.events=[r];else{var c=a.events;c===null?a.events=[r]:c.push(r)}}function kx(r){var a=zn().memoizedState;return yk({ref:a,nextImpl:r}),function(){if((jt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function Dx(r,a){return ym(4,2,r,a)}function Lx(r,a){return ym(4,4,r,a)}function Vx(r,a){if(typeof a=="function"){r=r();var c=a(r);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function Ox(r,a,c){c=c!=null?c.concat([r]):null,ym(4,4,Vx.bind(null,a,r),c)}function X_(){}function Ux(r,a){var c=zn();a=a===void 0?null:a;var m=c.memoizedState;return a!==null&&q_(a,m[1])?m[0]:(c.memoizedState=[r,a],r)}function Fx(r,a){var c=zn();a=a===void 0?null:a;var m=c.memoizedState;if(a!==null&&q_(a,m[1]))return m[0];if(m=r(),Xl){ht(!0);try{r()}finally{ht(!1)}}return c.memoizedState=[m,a],m}function ey(r,a,c){return c===void 0||(bo&1073741824)!==0&&(kt&261930)===0?r.memoizedState=a:(r.memoizedState=c,r=Bw(),pt.lanes|=r,Pa|=r,c)}function Bx(r,a,c,m){return di(c,a)?c:hc.current!==null?(r=ey(r,c,m),di(r,a)||(Jn=!0),r):(bo&42)===0||(bo&1073741824)!==0&&(kt&261930)===0?(Jn=!0,r.memoizedState=c):(r=Bw(),pt.lanes|=r,Pa|=r,a)}function zx(r,a,c,m,w){var S=Ce.p;Ce.p=S!==0&&8>S?S:8;var R=se.T,V={};se.T=V,iy(r,!1,a,c);try{var J=w(),ae=se.S;if(ae!==null&&ae(V,J),J!==null&&typeof J=="object"&&typeof J.then=="function"){var ye=fk(J,m);eh(r,a,ye,Os(r))}else eh(r,a,m,Os(r))}catch(xe){eh(r,a,{then:function(){},status:"rejected",reason:xe},Os())}finally{Ce.p=S,R!==null&&V.types!==null&&(R.types=V.types),se.T=R}}function vk(){}function ty(r,a,c,m){if(r.tag!==5)throw Error(i(476));var w=qx(r).queue;zx(r,w,a,be,c===null?vk:function(){return Gx(r),c(m)})}function qx(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:be,baseState:be,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:be},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:c},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function Gx(r){var a=qx(r);a.next===null&&(a=r.alternate.memoizedState),eh(r,a.next.queue,{},Os())}function ny(){return Ti(_h)}function Hx(){return zn().memoizedState}function jx(){return zn().memoizedState}function Tk(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var c=Os();r=ba(c);var m=Ia(a,r,c);m!==null&&(fs(m,a,c),Jd(m,a,c)),a={cache:M_()},r.payload=a;return}a=a.return}}function Ek(r,a,c){var m=Os();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},vm(r)?Wx(a,c):(c=Fd(r,a,c,m),c!==null&&(fs(c,r,m),Yx(c,a,m)))}function Kx(r,a,c){var m=Os();eh(r,a,c,m)}function eh(r,a,c,m){var w={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(vm(r))Wx(a,w);else{var S=r.alternate;if(r.lanes===0&&(S===null||S.lanes===0)&&(S=a.lastRenderedReducer,S!==null))try{var R=a.lastRenderedState,V=S(R,c);if(w.hasEagerState=!0,w.eagerState=V,di(V,R))return Jr(r,a,w,0),hn===null&&Gl(),!1}catch{}finally{}if(c=Fd(r,a,w,m),c!==null)return fs(c,r,m),Yx(c,a,m),!0}return!1}function iy(r,a,c,m){if(m={lane:2,revertLane:Ly(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},vm(r)){if(a)throw Error(i(479))}else a=Fd(r,c,m,2),a!==null&&fs(a,r,2)}function vm(r){var a=r.alternate;return r===pt||a!==null&&a===pt}function Wx(r,a){fc=hm=!0;var c=r.pending;c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a}function Yx(r,a,c){if((c&4194048)!==0){var m=a.lanes;m&=r.pendingLanes,c|=m,a.lanes=c,xl(r,c)}}var th={readContext:Ti,use:pm,useCallback:Dn,useContext:Dn,useEffect:Dn,useImperativeHandle:Dn,useLayoutEffect:Dn,useInsertionEffect:Dn,useMemo:Dn,useReducer:Dn,useRef:Dn,useState:Dn,useDebugValue:Dn,useDeferredValue:Dn,useTransition:Dn,useSyncExternalStore:Dn,useId:Dn,useHostTransitionStatus:Dn,useFormState:Dn,useActionState:Dn,useOptimistic:Dn,useMemoCache:Dn,useCacheRefresh:Dn};th.useEffectEvent=Dn;var Jx={readContext:Ti,use:pm,useCallback:function(r,a){return Wi().memoizedState=[r,a===void 0?null:a],r},useContext:Ti,useEffect:Px,useImperativeHandle:function(r,a,c){c=c!=null?c.concat([r]):null,_m(4194308,4,Vx.bind(null,a,r),c)},useLayoutEffect:function(r,a){return _m(4194308,4,r,a)},useInsertionEffect:function(r,a){_m(4,2,r,a)},useMemo:function(r,a){var c=Wi();a=a===void 0?null:a;var m=r();if(Xl){ht(!0);try{r()}finally{ht(!1)}}return c.memoizedState=[m,a],m},useReducer:function(r,a,c){var m=Wi();if(c!==void 0){var w=c(a);if(Xl){ht(!0);try{c(a)}finally{ht(!1)}}}else w=a;return m.memoizedState=m.baseState=w,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:w},m.queue=r,r=r.dispatch=Ek.bind(null,pt,r),[m.memoizedState,r]},useRef:function(r){var a=Wi();return r={current:r},a.memoizedState=r},useState:function(r){r=Z_(r);var a=r.queue,c=Kx.bind(null,pt,a);return a.dispatch=c,[r.memoizedState,c]},useDebugValue:X_,useDeferredValue:function(r,a){var c=Wi();return ey(c,r,a)},useTransition:function(){var r=Z_(!1);return r=zx.bind(null,pt,r.queue,!0,!1),Wi().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,c){var m=pt,w=Wi();if(wt){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),hn===null)throw Error(i(349));(kt&127)!==0||gx(m,a,c)}w.memoizedState=c;var S={value:c,getSnapshot:a};return w.queue=S,Px(yx.bind(null,m,S,r),[r]),m.flags|=2048,pc(9,{destroy:void 0},_x.bind(null,m,S,c,a),null),c},useId:function(){var r=Wi(),a=hn.identifierPrefix;if(wt){var c=Le,m=Ee;c=(m&~(1<<32-dt(m)-1)).toString(32)+c,a="_"+a+"R_"+c,c=fm++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=mk++,a="_"+a+"r_"+c.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:ny,useFormState:Ix,useActionState:Ix,useOptimistic:function(r){var a=Wi();a.memoizedState=a.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=iy.bind(null,pt,!0,c),c.dispatch=a,[r,a]},useMemoCache:W_,useCacheRefresh:function(){return Wi().memoizedState=Tk.bind(null,pt)},useEffectEvent:function(r){var a=Wi(),c={impl:r};return a.memoizedState=c,function(){if((jt&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},sy={readContext:Ti,use:pm,useCallback:Ux,useContext:Ti,useEffect:$_,useImperativeHandle:Ox,useInsertionEffect:Dx,useLayoutEffect:Lx,useMemo:Fx,useReducer:gm,useRef:Mx,useState:function(){return gm(Io)},useDebugValue:X_,useDeferredValue:function(r,a){var c=zn();return Bx(c,on.memoizedState,r,a)},useTransition:function(){var r=gm(Io)[0],a=zn().memoizedState;return[typeof r=="boolean"?r:Xd(r),a]},useSyncExternalStore:px,useId:Hx,useHostTransitionStatus:ny,useFormState:Ax,useActionState:Ax,useOptimistic:function(r,a){var c=zn();return Ex(c,on,r,a)},useMemoCache:W_,useCacheRefresh:jx};sy.useEffectEvent=kx;var Zx={readContext:Ti,use:pm,useCallback:Ux,useContext:Ti,useEffect:$_,useImperativeHandle:Ox,useInsertionEffect:Dx,useLayoutEffect:Lx,useMemo:Fx,useReducer:J_,useRef:Mx,useState:function(){return J_(Io)},useDebugValue:X_,useDeferredValue:function(r,a){var c=zn();return on===null?ey(c,r,a):Bx(c,on.memoizedState,r,a)},useTransition:function(){var r=J_(Io)[0],a=zn().memoizedState;return[typeof r=="boolean"?r:Xd(r),a]},useSyncExternalStore:px,useId:Hx,useHostTransitionStatus:ny,useFormState:Rx,useActionState:Rx,useOptimistic:function(r,a){var c=zn();return on!==null?Ex(c,on,r,a):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:W_,useCacheRefresh:jx};Zx.useEffectEvent=kx;function ry(r,a,c,m){a=r.memoizedState,c=c(m,a),c=c==null?a:x({},a,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var oy={enqueueSetState:function(r,a,c){r=r._reactInternals;var m=Os(),w=ba(m);w.payload=a,c!=null&&(w.callback=c),a=Ia(r,w,m),a!==null&&(fs(a,r,m),Jd(a,r,m))},enqueueReplaceState:function(r,a,c){r=r._reactInternals;var m=Os(),w=ba(m);w.tag=1,w.payload=a,c!=null&&(w.callback=c),a=Ia(r,w,m),a!==null&&(fs(a,r,m),Jd(a,r,m))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var c=Os(),m=ba(c);m.tag=2,a!=null&&(m.callback=a),a=Ia(r,m,c),a!==null&&(fs(a,r,c),Jd(a,r,c))}};function Qx(r,a,c,m,w,S,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(m,S,R):a.prototype&&a.prototype.isPureReactComponent?!va(c,m)||!va(w,S):!0}function $x(r,a,c,m){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,m),a.state!==r&&oy.enqueueReplaceState(a,a.state,null)}function eu(r,a){var c=a;if("ref"in a){c={};for(var m in a)m!=="ref"&&(c[m]=a[m])}if(r=r.defaultProps){c===a&&(c=x({},c));for(var w in r)c[w]===void 0&&(c[w]=r[w])}return c}function Xx(r){ql(r)}function ew(r){console.error(r)}function tw(r){ql(r)}function Tm(r,a){try{var c=r.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(m){setTimeout(function(){throw m})}}function nw(r,a,c){try{var m=r.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function ay(r,a,c){return c=ba(c),c.tag=3,c.payload={element:null},c.callback=function(){Tm(r,a)},c}function iw(r){return r=ba(r),r.tag=3,r}function sw(r,a,c,m){var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var S=m.value;r.payload=function(){return w(S)},r.callback=function(){nw(a,c,m)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(r.callback=function(){nw(a,c,m),typeof w!="function"&&(ka===null?ka=new Set([this]):ka.add(this));var V=m.stack;this.componentDidCatch(m.value,{componentStack:V!==null?V:""})})}function xk(r,a,c,m,w){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(a=c.alternate,a!==null&&ac(a,c,w,!0),c=ks.current,c!==null){switch(c.tag){case 31:case 13:return sr===null?Pm():c.alternate===null&&Ln===0&&(Ln=3),c.flags&=-257,c.flags|=65536,c.lanes=w,m===am?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([m]):a.add(m),Py(r,m,w)),!1;case 22:return c.flags|=65536,m===am?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([m]):c.add(m)),Py(r,m,w)),!1}throw Error(i(435,c.tag))}return Py(r,m,w),Pm(),!1}if(wt)return a=ks.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=w,m!==oc&&(r=Error(i(422),{cause:m}),Kl(f(r,c)))):(m!==oc&&(a=Error(i(423),{cause:m}),Kl(f(a,c))),r=r.current.alternate,r.flags|=65536,w&=-w,r.lanes|=w,m=f(m,c),w=ay(r.stateNode,m,w),O_(r,w),Ln!==4&&(Ln=2)),!1;var S=Error(i(520),{cause:m});if(S=f(S,c),uh===null?uh=[S]:uh.push(S),Ln!==4&&(Ln=2),a===null)return!0;m=f(m,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,r=w&-w,c.lanes|=r,r=ay(c.stateNode,m,r),O_(c,r),!1;case 1:if(a=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(ka===null||!ka.has(S))))return c.flags|=65536,w&=-w,c.lanes|=w,w=iw(w),sw(w,r,c,m),O_(c,w),!1}c=c.return}while(c!==null);return!1}var ly=Error(i(461)),Jn=!1;function Ei(r,a,c,m){a.child=r===null?lx(a,null,c,m):$l(a,r.child,c,m)}function rw(r,a,c,m,w){c=c.render;var S=a.ref;if("ref"in m){var R={};for(var V in m)V!=="ref"&&(R[V]=m[V])}else R=m;return Yl(a),m=G_(r,a,c,R,S,w),V=H_(),r!==null&&!Jn?(j_(r,a,w),Ao(r,a,w)):(wt&&V&&ei(a),a.flags|=1,Ei(r,a,m,w),a.child)}function ow(r,a,c,m,w){if(r===null){var S=c.type;return typeof S=="function"&&!sc(S)&&S.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=S,aw(r,a,S,m,w)):(r=jl(c.type,null,m,a,a.mode,w),r.ref=a.ref,r.return=a,a.child=r)}if(S=r.child,!gy(r,w)){var R=S.memoizedProps;if(c=c.compare,c=c!==null?c:va,c(R,m)&&r.ref===a.ref)return Ao(r,a,w)}return a.flags|=1,r=ir(S,m),r.ref=a.ref,r.return=a,a.child=r}function aw(r,a,c,m,w){if(r!==null){var S=r.memoizedProps;if(va(S,m)&&r.ref===a.ref)if(Jn=!1,a.pendingProps=m=S,gy(r,w))(r.flags&131072)!==0&&(Jn=!0);else return a.lanes=r.lanes,Ao(r,a,w)}return uy(r,a,c,m,w)}function lw(r,a,c,m){var w=m.children,S=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((a.flags&128)!==0){if(S=S!==null?S.baseLanes|c:c,r!==null){for(m=a.child=r.child,w=0;m!==null;)w=w|m.lanes|m.childLanes,m=m.sibling;m=w&~S}else m=0,a.child=null;return uw(r,a,S,c,m)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&rm(a,S!==null?S.cachePool:null),S!==null?dx(a,S):F_(),hx(a);else return m=a.lanes=536870912,uw(r,a,S!==null?S.baseLanes|c:c,c,m)}else S!==null?(rm(a,S.cachePool),dx(a,S),Na(),a.memoizedState=null):(r!==null&&rm(a,null),F_(),Na());return Ei(r,a,w,c),a.child}function nh(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function uw(r,a,c,m,w){var S=k_();return S=S===null?null:{parent:Wn._currentValue,pool:S},a.memoizedState={baseLanes:c,cachePool:S},r!==null&&rm(a,null),F_(),hx(a),r!==null&&ac(r,a,m,!0),a.childLanes=w,null}function Em(r,a){return a=wm({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function cw(r,a,c){return $l(a,r.child,null,c),r=Em(a,a.pendingProps),r.flags|=2,Ds(a),a.memoizedState=null,r}function wk(r,a,c){var m=a.pendingProps,w=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(wt){if(m.mode==="hidden")return r=Em(a,m),a.lanes=536870912,nh(null,r);if(z_(a),(r=zt)?(r=xS(r,ls),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:ue!==null?{id:Ee,overflow:Le}:null,retryLane:536870912,hydrationErrors:null},c=zd(r),c.return=a,a.child=c,Bt=a,zt=null)):r=null,r===null)throw Qr(a);return a.lanes=536870912,null}return Em(a,m)}var S=r.memoizedState;if(S!==null){var R=S.dehydrated;if(z_(a),w)if(a.flags&256)a.flags&=-257,a=cw(r,a,c);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(i(558));else if(Jn||ac(r,a,c,!1),w=(c&r.childLanes)!==0,Jn||w){if(m=hn,m!==null&&(R=wl(m,c),R!==0&&R!==S.retryLane))throw S.retryLane=R,nr(r,R),fs(m,r,R),ly;Pm(),a=cw(r,a,c)}else r=S.treeContext,zt=rr(R.nextSibling),Bt=a,wt=!0,Zr=null,ls=!1,r!==null&&Ki(a,r),a=Em(a,m),a.flags|=4096;return a}return r=ir(r.child,{mode:m.mode,children:m.children}),r.ref=a.ref,a.child=r,r.return=a,r}function xm(r,a){var c=a.ref;if(c===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(r===null||r.ref!==c)&&(a.flags|=4194816)}}function uy(r,a,c,m,w){return Yl(a),c=G_(r,a,c,m,void 0,w),m=H_(),r!==null&&!Jn?(j_(r,a,w),Ao(r,a,w)):(wt&&m&&ei(a),a.flags|=1,Ei(r,a,c,w),a.child)}function dw(r,a,c,m,w,S){return Yl(a),a.updateQueue=null,c=mx(a,m,c,w),fx(r),m=H_(),r!==null&&!Jn?(j_(r,a,S),Ao(r,a,S)):(wt&&m&&ei(a),a.flags|=1,Ei(r,a,c,S),a.child)}function hw(r,a,c,m,w){if(Yl(a),a.stateNode===null){var S=xo,R=c.contextType;typeof R=="object"&&R!==null&&(S=Ti(R)),S=new c(m,S),a.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=oy,a.stateNode=S,S._reactInternals=a,S=a.stateNode,S.props=m,S.state=a.memoizedState,S.refs={},L_(a),R=c.contextType,S.context=typeof R=="object"&&R!==null?Ti(R):xo,S.state=a.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(ry(a,c,R,m),S.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(R=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),R!==S.state&&oy.enqueueReplaceState(S,S.state,null),Qd(a,m,S,w),Zd(),S.state=a.memoizedState),typeof S.componentDidMount=="function"&&(a.flags|=4194308),m=!0}else if(r===null){S=a.stateNode;var V=a.memoizedProps,J=eu(c,V);S.props=J;var ae=S.context,ye=c.contextType;R=xo,typeof ye=="object"&&ye!==null&&(R=Ti(ye));var xe=c.getDerivedStateFromProps;ye=typeof xe=="function"||typeof S.getSnapshotBeforeUpdate=="function",V=a.pendingProps!==V,ye||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(V||ae!==R)&&$x(a,S,m,R),Ca=!1;var ce=a.memoizedState;S.state=ce,Qd(a,m,S,w),Zd(),ae=a.memoizedState,V||ce!==ae||Ca?(typeof xe=="function"&&(ry(a,c,xe,m),ae=a.memoizedState),(J=Ca||Qx(a,c,J,m,ce,ae,R))?(ye||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=ae),S.props=m,S.state=ae,S.context=R,m=J):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{S=a.stateNode,V_(r,a),R=a.memoizedProps,ye=eu(c,R),S.props=ye,xe=a.pendingProps,ce=S.context,ae=c.contextType,J=xo,typeof ae=="object"&&ae!==null&&(J=Ti(ae)),V=c.getDerivedStateFromProps,(ae=typeof V=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==xe||ce!==J)&&$x(a,S,m,J),Ca=!1,ce=a.memoizedState,S.state=ce,Qd(a,m,S,w),Zd();var pe=a.memoizedState;R!==xe||ce!==pe||Ca||r!==null&&r.dependencies!==null&&im(r.dependencies)?(typeof V=="function"&&(ry(a,c,V,m),pe=a.memoizedState),(ye=Ca||Qx(a,c,ye,m,ce,pe,J)||r!==null&&r.dependencies!==null&&im(r.dependencies))?(ae||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(m,pe,J),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(m,pe,J)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||R===r.memoizedProps&&ce===r.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&ce===r.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=pe),S.props=m,S.state=pe,S.context=J,m=ye):(typeof S.componentDidUpdate!="function"||R===r.memoizedProps&&ce===r.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&ce===r.memoizedState||(a.flags|=1024),m=!1)}return S=m,xm(r,a),m=(a.flags&128)!==0,S||m?(S=a.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:S.render(),a.flags|=1,r!==null&&m?(a.child=$l(a,r.child,null,w),a.child=$l(a,null,c,w)):Ei(r,a,c,w),a.memoizedState=S.state,r=a.child):r=Ao(r,a,w),r}function fw(r,a,c,m){return So(),a.flags|=256,Ei(r,a,c,m),a.child}var cy={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function dy(r){return{baseLanes:r,cachePool:nx()}}function hy(r,a,c){return r=r!==null?r.childLanes&~c:0,a&&(r|=Vs),r}function mw(r,a,c){var m=a.pendingProps,w=!1,S=(a.flags&128)!==0,R;if((R=S)||(R=r!==null&&r.memoizedState===null?!1:(Bn.current&2)!==0),R&&(w=!0,a.flags&=-129),R=(a.flags&32)!==0,a.flags&=-33,r===null){if(wt){if(w?Aa(a):Na(),(r=zt)?(r=xS(r,ls),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:ue!==null?{id:Ee,overflow:Le}:null,retryLane:536870912,hydrationErrors:null},c=zd(r),c.return=a,a.child=c,Bt=a,zt=null)):r=null,r===null)throw Qr(a);return Yy(r)?a.lanes=32:a.lanes=536870912,null}var V=m.children;return m=m.fallback,w?(Na(),w=a.mode,V=wm({mode:"hidden",children:V},w),m=wo(m,w,c,null),V.return=a,m.return=a,V.sibling=m,a.child=V,m=a.child,m.memoizedState=dy(c),m.childLanes=hy(r,R,c),a.memoizedState=cy,nh(null,m)):(Aa(a),fy(a,V))}var J=r.memoizedState;if(J!==null&&(V=J.dehydrated,V!==null)){if(S)a.flags&256?(Aa(a),a.flags&=-257,a=my(r,a,c)):a.memoizedState!==null?(Na(),a.child=r.child,a.flags|=128,a=null):(Na(),V=m.fallback,w=a.mode,m=wm({mode:"visible",children:m.children},w),V=wo(V,w,c,null),V.flags|=2,m.return=a,V.return=a,m.sibling=V,a.child=m,$l(a,r.child,null,c),m=a.child,m.memoizedState=dy(c),m.childLanes=hy(r,R,c),a.memoizedState=cy,a=nh(null,m));else if(Aa(a),Yy(V)){if(R=V.nextSibling&&V.nextSibling.dataset,R)var ae=R.dgst;R=ae,m=Error(i(419)),m.stack="",m.digest=R,Kl({value:m,source:null,stack:null}),a=my(r,a,c)}else if(Jn||ac(r,a,c,!1),R=(c&r.childLanes)!==0,Jn||R){if(R=hn,R!==null&&(m=wl(R,c),m!==0&&m!==J.retryLane))throw J.retryLane=m,nr(r,m),fs(R,r,m),ly;Wy(V)||Pm(),a=my(r,a,c)}else Wy(V)?(a.flags|=192,a.child=r.child,a=null):(r=J.treeContext,zt=rr(V.nextSibling),Bt=a,wt=!0,Zr=null,ls=!1,r!==null&&Ki(a,r),a=fy(a,m.children),a.flags|=4096);return a}return w?(Na(),V=m.fallback,w=a.mode,J=r.child,ae=J.sibling,m=ir(J,{mode:"hidden",children:m.children}),m.subtreeFlags=J.subtreeFlags&65011712,ae!==null?V=ir(ae,V):(V=wo(V,w,c,null),V.flags|=2),V.return=a,m.return=a,m.sibling=V,a.child=m,nh(null,m),m=a.child,V=r.child.memoizedState,V===null?V=dy(c):(w=V.cachePool,w!==null?(J=Wn._currentValue,w=w.parent!==J?{parent:J,pool:J}:w):w=nx(),V={baseLanes:V.baseLanes|c,cachePool:w}),m.memoizedState=V,m.childLanes=hy(r,R,c),a.memoizedState=cy,nh(r.child,m)):(Aa(a),c=r.child,r=c.sibling,c=ir(c,{mode:"visible",children:m.children}),c.return=a,c.sibling=null,r!==null&&(R=a.deletions,R===null?(a.deletions=[r],a.flags|=16):R.push(r)),a.child=c,a.memoizedState=null,c)}function fy(r,a){return a=wm({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function wm(r,a){return r=Ni(22,r,null,a),r.lanes=0,r}function my(r,a,c){return $l(a,r.child,null,c),r=fy(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function pw(r,a,c){r.lanes|=a;var m=r.alternate;m!==null&&(m.lanes|=a),N_(r.return,a,c)}function py(r,a,c,m,w,S){var R=r.memoizedState;R===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:w,treeForkCount:S}:(R.isBackwards=a,R.rendering=null,R.renderingStartTime=0,R.last=m,R.tail=c,R.tailMode=w,R.treeForkCount=S)}function gw(r,a,c){var m=a.pendingProps,w=m.revealOrder,S=m.tail;m=m.children;var R=Bn.current,V=(R&2)!==0;if(V?(R=R&1|2,a.flags|=128):R&=1,Ie(Bn,R),Ei(r,a,m,c),m=wt?P:0,!V&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&pw(r,c,a);else if(r.tag===19)pw(r,c,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(w){case"forwards":for(c=a.child,w=null;c!==null;)r=c.alternate,r!==null&&dm(r)===null&&(w=c),c=c.sibling;c=w,c===null?(w=a.child,a.child=null):(w=c.sibling,c.sibling=null),py(a,!1,w,c,S,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,w=a.child,a.child=null;w!==null;){if(r=w.alternate,r!==null&&dm(r)===null){a.child=w;break}r=w.sibling,w.sibling=c,c=w,w=r}py(a,!0,c,null,S,m);break;case"together":py(a,!1,null,null,void 0,m);break;default:a.memoizedState=null}return a.child}function Ao(r,a,c){if(r!==null&&(a.dependencies=r.dependencies),Pa|=a.lanes,(c&a.childLanes)===0)if(r!==null){if(ac(r,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(i(153));if(a.child!==null){for(r=a.child,c=ir(r,r.pendingProps),a.child=c,c.return=a;r.sibling!==null;)r=r.sibling,c=c.sibling=ir(r,r.pendingProps),c.return=a;c.sibling=null}return a.child}function gy(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&im(r)))}function Sk(r,a,c){switch(a.tag){case 3:Fe(a,a.stateNode.containerInfo),Sa(a,Wn,r.memoizedState.cache),So();break;case 27:case 5:Nt(a);break;case 4:Fe(a,a.stateNode.containerInfo);break;case 10:Sa(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,z_(a),null;break;case 13:var m=a.memoizedState;if(m!==null)return m.dehydrated!==null?(Aa(a),a.flags|=128,null):(c&a.child.childLanes)!==0?mw(r,a,c):(Aa(a),r=Ao(r,a,c),r!==null?r.sibling:null);Aa(a);break;case 19:var w=(r.flags&128)!==0;if(m=(c&a.childLanes)!==0,m||(ac(r,a,c,!1),m=(c&a.childLanes)!==0),w){if(m)return gw(r,a,c);a.flags|=128}if(w=a.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Ie(Bn,Bn.current),m)break;return null;case 22:return a.lanes=0,lw(r,a,c,a.pendingProps);case 24:Sa(a,Wn,r.memoizedState.cache)}return Ao(r,a,c)}function _w(r,a,c){if(r!==null)if(r.memoizedProps!==a.pendingProps)Jn=!0;else{if(!gy(r,c)&&(a.flags&128)===0)return Jn=!1,Sk(r,a,c);Jn=(r.flags&131072)!==0}else Jn=!1,wt&&(a.flags&1048576)!==0&&gt(a,P,a.index);switch(a.lanes=0,a.tag){case 16:e:{var m=a.pendingProps;if(r=Zl(a.elementType),a.type=r,typeof r=="function")sc(r)?(m=eu(r,m),a.tag=1,a=hw(null,a,r,m,c)):(a.tag=0,a=uy(null,a,r,m,c));else{if(r!=null){var w=r.$$typeof;if(w===he){a.tag=11,a=rw(null,a,r,m,c);break e}else if(w===k){a.tag=14,a=ow(null,a,r,m,c);break e}}throw a=Ge(r)||r,Error(i(306,a,""))}}return a;case 0:return uy(r,a,a.type,a.pendingProps,c);case 1:return m=a.type,w=eu(m,a.pendingProps),hw(r,a,m,w,c);case 3:e:{if(Fe(a,a.stateNode.containerInfo),r===null)throw Error(i(387));m=a.pendingProps;var S=a.memoizedState;w=S.element,V_(r,a),Qd(a,m,null,c);var R=a.memoizedState;if(m=R.cache,Sa(a,Wn,m),m!==S.cache&&R_(a,[Wn],c,!0),Zd(),m=R.element,S.isDehydrated)if(S={element:m,isDehydrated:!1,cache:R.cache},a.updateQueue.baseState=S,a.memoizedState=S,a.flags&256){a=fw(r,a,m,c);break e}else if(m!==w){w=f(Error(i(424)),a),Kl(w),a=fw(r,a,m,c);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(zt=rr(r.firstChild),Bt=a,wt=!0,Zr=null,ls=!0,c=lx(a,null,m,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(So(),m===w){a=Ao(r,a,c);break e}Ei(r,a,m,c)}a=a.child}return a;case 26:return xm(r,a),r===null?(c=AS(a.type,null,a.pendingProps,null))?a.memoizedState=c:wt||(c=a.type,r=a.pendingProps,m=Fm(we.current).createElement(c),m[bn]=a,m[Mn]=r,xi(m,c,r),Pn(m),a.stateNode=m):a.memoizedState=AS(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return Nt(a),r===null&&wt&&(m=a.stateNode=CS(a.type,a.pendingProps,we.current),Bt=a,ls=!0,w=zt,Oa(a.type)?(Jy=w,zt=rr(m.firstChild)):zt=w),Ei(r,a,a.pendingProps.children,c),xm(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&wt&&((w=m=zt)&&(m=eD(m,a.type,a.pendingProps,ls),m!==null?(a.stateNode=m,Bt=a,zt=rr(m.firstChild),ls=!1,w=!0):w=!1),w||Qr(a)),Nt(a),w=a.type,S=a.pendingProps,R=r!==null?r.memoizedProps:null,m=S.children,Hy(w,S)?m=null:R!==null&&Hy(w,R)&&(a.flags|=32),a.memoizedState!==null&&(w=G_(r,a,pk,null,null,c),_h._currentValue=w),xm(r,a),Ei(r,a,m,c),a.child;case 6:return r===null&&wt&&((r=c=zt)&&(c=tD(c,a.pendingProps,ls),c!==null?(a.stateNode=c,Bt=a,zt=null,r=!0):r=!1),r||Qr(a)),null;case 13:return mw(r,a,c);case 4:return Fe(a,a.stateNode.containerInfo),m=a.pendingProps,r===null?a.child=$l(a,null,m,c):Ei(r,a,m,c),a.child;case 11:return rw(r,a,a.type,a.pendingProps,c);case 7:return Ei(r,a,a.pendingProps,c),a.child;case 8:return Ei(r,a,a.pendingProps.children,c),a.child;case 12:return Ei(r,a,a.pendingProps.children,c),a.child;case 10:return m=a.pendingProps,Sa(a,a.type,m.value),Ei(r,a,m.children,c),a.child;case 9:return w=a.type._context,m=a.pendingProps.children,Yl(a),w=Ti(w),m=m(w),a.flags|=1,Ei(r,a,m,c),a.child;case 14:return ow(r,a,a.type,a.pendingProps,c);case 15:return aw(r,a,a.type,a.pendingProps,c);case 19:return gw(r,a,c);case 31:return wk(r,a,c);case 22:return lw(r,a,c,a.pendingProps);case 24:return Yl(a),m=Ti(Wn),r===null?(w=k_(),w===null&&(w=hn,S=M_(),w.pooledCache=S,S.refCount++,S!==null&&(w.pooledCacheLanes|=c),w=S),a.memoizedState={parent:m,cache:w},L_(a),Sa(a,Wn,w)):((r.lanes&c)!==0&&(V_(r,a),Qd(a,null,null,c),Zd()),w=r.memoizedState,S=a.memoizedState,w.parent!==m?(w={parent:m,cache:m},a.memoizedState=w,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=w),Sa(a,Wn,m)):(m=S.cache,Sa(a,Wn,m),m!==w.cache&&R_(a,[Wn],c,!0))),Ei(r,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function No(r){r.flags|=4}function _y(r,a,c,m,w){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(w&335544128)===w)if(r.stateNode.complete)r.flags|=8192;else if(Hw())r.flags|=8192;else throw Ql=am,D_}else r.flags&=-16777217}function yw(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!kS(a))if(Hw())r.flags|=8192;else throw Ql=am,D_}function Sm(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?Hu():536870912,r.lanes|=a,vc|=a)}function ih(r,a){if(!wt)switch(r.tailMode){case"hidden":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:m.sibling=null}}function En(r){var a=r.alternate!==null&&r.alternate.child===r.child,c=0,m=0;if(a)for(var w=r.child;w!==null;)c|=w.lanes|w.childLanes,m|=w.subtreeFlags&65011712,m|=w.flags&65011712,w.return=r,w=w.sibling;else for(w=r.child;w!==null;)c|=w.lanes|w.childLanes,m|=w.subtreeFlags,m|=w.flags,w.return=r,w=w.sibling;return r.subtreeFlags|=m,r.childLanes=c,a}function Ck(r,a,c){var m=a.pendingProps;switch(kn(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return En(a),null;case 1:return En(a),null;case 3:return c=a.stateNode,m=null,r!==null&&(m=r.memoizedState.cache),a.memoizedState.cache!==m&&(a.flags|=2048),Co(Wn),Ye(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Er(a)?No(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Hd())),En(a),null;case 26:var w=a.type,S=a.memoizedState;return r===null?(No(a),S!==null?(En(a),yw(a,S)):(En(a),_y(a,w,null,m,c))):S?S!==r.memoizedState?(No(a),En(a),yw(a,S)):(En(a),a.flags&=-16777217):(r=r.memoizedProps,r!==m&&No(a),En(a),_y(a,w,r,m,c)),null;case 27:if(Jt(a),c=we.current,w=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==m&&No(a);else{if(!m){if(a.stateNode===null)throw Error(i(166));return En(a),null}r=le.current,Er(a)?Gd(a):(r=CS(w,m,c),a.stateNode=r,No(a))}return En(a),null;case 5:if(Jt(a),w=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==m&&No(a);else{if(!m){if(a.stateNode===null)throw Error(i(166));return En(a),null}if(S=le.current,Er(a))Gd(a);else{var R=Fm(we.current);switch(S){case 1:S=R.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:S=R.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":S=R.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":S=R.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":S=R.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof m.is=="string"?R.createElement("select",{is:m.is}):R.createElement("select"),m.multiple?S.multiple=!0:m.size&&(S.size=m.size);break;default:S=typeof m.is=="string"?R.createElement(w,{is:m.is}):R.createElement(w)}}S[bn]=a,S[Mn]=m;e:for(R=a.child;R!==null;){if(R.tag===5||R.tag===6)S.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===a)break e;for(;R.sibling===null;){if(R.return===null||R.return===a)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}a.stateNode=S;e:switch(xi(S,w,m),w){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&No(a)}}return En(a),_y(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,c),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==m&&No(a);else{if(typeof m!="string"&&a.stateNode===null)throw Error(i(166));if(r=we.current,Er(a)){if(r=a.stateNode,c=a.memoizedProps,m=null,w=Bt,w!==null)switch(w.tag){case 27:case 5:m=w.memoizedProps}r[bn]=a,r=!!(r.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||mS(r.nodeValue,c)),r||Qr(a,!0)}else r=Fm(r).createTextNode(m),r[bn]=a,a.stateNode=r}return En(a),null;case 31:if(c=a.memoizedState,r===null||r.memoizedState!==null){if(m=Er(a),c!==null){if(r===null){if(!m)throw Error(i(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[bn]=a}else So(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;En(a),r=!1}else c=Hd(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return a.flags&256?(Ds(a),a):(Ds(a),null);if((a.flags&128)!==0)throw Error(i(558))}return En(a),null;case 13:if(m=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(w=Er(a),m!==null&&m.dehydrated!==null){if(r===null){if(!w)throw Error(i(318));if(w=a.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(i(317));w[bn]=a}else So(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;En(a),w=!1}else w=Hd(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=w),w=!0;if(!w)return a.flags&256?(Ds(a),a):(Ds(a),null)}return Ds(a),(a.flags&128)!==0?(a.lanes=c,a):(c=m!==null,r=r!==null&&r.memoizedState!==null,c&&(m=a.child,w=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(w=m.alternate.memoizedState.cachePool.pool),S=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(S=m.memoizedState.cachePool.pool),S!==w&&(m.flags|=2048)),c!==r&&c&&(a.child.flags|=8192),Sm(a,a.updateQueue),En(a),null);case 4:return Ye(),r===null&&Fy(a.stateNode.containerInfo),En(a),null;case 10:return Co(a.type),En(a),null;case 19:if(me(Bn),m=a.memoizedState,m===null)return En(a),null;if(w=(a.flags&128)!==0,S=m.rendering,S===null)if(w)ih(m,!1);else{if(Ln!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(S=dm(r),S!==null){for(a.flags|=128,ih(m,!1),r=S.updateQueue,a.updateQueue=r,Sm(a,r),a.subtreeFlags=0,r=c,c=a.child;c!==null;)Bd(c,r),c=c.sibling;return Ie(Bn,Bn.current&1|2),wt&&Je(a,m.treeForkCount),a.child}r=r.sibling}m.tail!==null&&lt()>Nm&&(a.flags|=128,w=!0,ih(m,!1),a.lanes=4194304)}else{if(!w)if(r=dm(S),r!==null){if(a.flags|=128,w=!0,r=r.updateQueue,a.updateQueue=r,Sm(a,r),ih(m,!0),m.tail===null&&m.tailMode==="hidden"&&!S.alternate&&!wt)return En(a),null}else 2*lt()-m.renderingStartTime>Nm&&c!==536870912&&(a.flags|=128,w=!0,ih(m,!1),a.lanes=4194304);m.isBackwards?(S.sibling=a.child,a.child=S):(r=m.last,r!==null?r.sibling=S:a.child=S,m.last=S)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=lt(),r.sibling=null,c=Bn.current,Ie(Bn,w?c&1|2:c&1),wt&&Je(a,m.treeForkCount),r):(En(a),null);case 22:case 23:return Ds(a),B_(),m=a.memoizedState!==null,r!==null?r.memoizedState!==null!==m&&(a.flags|=8192):m&&(a.flags|=8192),m?(c&536870912)!==0&&(a.flags&128)===0&&(En(a),a.subtreeFlags&6&&(a.flags|=8192)):En(a),c=a.updateQueue,c!==null&&Sm(a,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),m=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(m=a.memoizedState.cachePool.pool),m!==c&&(a.flags|=2048),r!==null&&me(Jl),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Co(Wn),En(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function bk(r,a){switch(kn(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Co(Wn),Ye(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return Jt(a),null;case 31:if(a.memoizedState!==null){if(Ds(a),a.alternate===null)throw Error(i(340));So()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(Ds(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(i(340));So()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return me(Bn),null;case 4:return Ye(),null;case 10:return Co(a.type),null;case 22:case 23:return Ds(a),B_(),r!==null&&me(Jl),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return Co(Wn),null;case 25:return null;default:return null}}function vw(r,a){switch(kn(a),a.tag){case 3:Co(Wn),Ye();break;case 26:case 27:case 5:Jt(a);break;case 4:Ye();break;case 31:a.memoizedState!==null&&Ds(a);break;case 13:Ds(a);break;case 19:me(Bn);break;case 10:Co(a.type);break;case 22:case 23:Ds(a),B_(),r!==null&&me(Jl);break;case 24:Co(Wn)}}function sh(r,a){try{var c=a.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var w=m.next;c=w;do{if((c.tag&r)===r){m=void 0;var S=c.create,R=c.inst;m=S(),R.destroy=m}c=c.next}while(c!==w)}}catch(V){Xt(a,a.return,V)}}function Ra(r,a,c){try{var m=a.updateQueue,w=m!==null?m.lastEffect:null;if(w!==null){var S=w.next;m=S;do{if((m.tag&r)===r){var R=m.inst,V=R.destroy;if(V!==void 0){R.destroy=void 0,w=a;var J=c,ae=V;try{ae()}catch(ye){Xt(w,J,ye)}}}m=m.next}while(m!==S)}}catch(ye){Xt(a,a.return,ye)}}function Tw(r){var a=r.updateQueue;if(a!==null){var c=r.stateNode;try{cx(a,c)}catch(m){Xt(r,r.return,m)}}}function Ew(r,a,c){c.props=eu(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(m){Xt(r,a,m)}}function rh(r,a){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var m=r.stateNode;break;case 30:m=r.stateNode;break;default:m=r.stateNode}typeof c=="function"?r.refCleanup=c(m):c.current=m}}catch(w){Xt(r,a,w)}}function Xr(r,a){var c=r.ref,m=r.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(w){Xt(r,a,w)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(w){Xt(r,a,w)}else c.current=null}function xw(r){var a=r.type,c=r.memoizedProps,m=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(w){Xt(r,r.return,w)}}function yy(r,a,c){try{var m=r.stateNode;Yk(m,r.type,c,a),m[Mn]=a}catch(w){Xt(r,r.return,w)}}function ww(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Oa(r.type)||r.tag===4}function vy(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ww(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Oa(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ty(r,a,c){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(r),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Si));else if(m!==4&&(m===27&&Oa(r.type)&&(c=r.stateNode,a=null),r=r.child,r!==null))for(Ty(r,a,c),r=r.sibling;r!==null;)Ty(r,a,c),r=r.sibling}function Cm(r,a,c){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?c.insertBefore(r,a):c.appendChild(r);else if(m!==4&&(m===27&&Oa(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Cm(r,a,c),r=r.sibling;r!==null;)Cm(r,a,c),r=r.sibling}function Sw(r){var a=r.stateNode,c=r.memoizedProps;try{for(var m=r.type,w=a.attributes;w.length;)a.removeAttributeNode(w[0]);xi(a,m,c),a[bn]=r,a[Mn]=c}catch(S){Xt(r,r.return,S)}}var Ro=!1,Zn=!1,Ey=!1,Cw=typeof WeakSet=="function"?WeakSet:Set,fi=null;function Ik(r,a){if(r=r.containerInfo,qy=Km,r=Ul(r),jr(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var w=m.anchorOffset,S=m.focusNode;m=m.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var R=0,V=-1,J=-1,ae=0,ye=0,xe=r,ce=null;t:for(;;){for(var pe;xe!==c||w!==0&&xe.nodeType!==3||(V=R+w),xe!==S||m!==0&&xe.nodeType!==3||(J=R+m),xe.nodeType===3&&(R+=xe.nodeValue.length),(pe=xe.firstChild)!==null;)ce=xe,xe=pe;for(;;){if(xe===r)break t;if(ce===c&&++ae===w&&(V=R),ce===S&&++ye===m&&(J=R),(pe=xe.nextSibling)!==null)break;xe=ce,ce=xe.parentNode}xe=pe}c=V===-1||J===-1?null:{start:V,end:J}}else c=null}c=c||{start:0,end:0}}else c=null;for(Gy={focusedElem:r,selectionRange:c},Km=!1,fi=a;fi!==null;)if(a=fi,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,fi=r;else for(;fi!==null;){switch(a=fi,S=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)w=r[c],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&S!==null){r=void 0,c=a,w=S.memoizedProps,S=S.memoizedState,m=c.stateNode;try{var qe=eu(c.type,w);r=m.getSnapshotBeforeUpdate(qe,S),m.__reactInternalSnapshotBeforeUpdate=r}catch(nt){Xt(c,c.return,nt)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,c=r.nodeType,c===9)Ky(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Ky(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=a.sibling,r!==null){r.return=a.return,fi=r;break}fi=a.return}}function bw(r,a,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:Po(r,c),m&4&&sh(5,c);break;case 1:if(Po(r,c),m&4)if(r=c.stateNode,a===null)try{r.componentDidMount()}catch(R){Xt(c,c.return,R)}else{var w=eu(c.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(w,a,r.__reactInternalSnapshotBeforeUpdate)}catch(R){Xt(c,c.return,R)}}m&64&&Tw(c),m&512&&rh(c,c.return);break;case 3:if(Po(r,c),m&64&&(r=c.updateQueue,r!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{cx(r,a)}catch(R){Xt(c,c.return,R)}}break;case 27:a===null&&m&4&&Sw(c);case 26:case 5:Po(r,c),a===null&&m&4&&xw(c),m&512&&rh(c,c.return);break;case 12:Po(r,c);break;case 31:Po(r,c),m&4&&Nw(r,c);break;case 13:Po(r,c),m&4&&Rw(r,c),m&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=Vk.bind(null,c),nD(r,c))));break;case 22:if(m=c.memoizedState!==null||Ro,!m){a=a!==null&&a.memoizedState!==null||Zn,w=Ro;var S=Zn;Ro=m,(Zn=a)&&!S?ko(r,c,(c.subtreeFlags&8772)!==0):Po(r,c),Ro=w,Zn=S}break;case 30:break;default:Po(r,c)}}function Iw(r){var a=r.alternate;a!==null&&(r.alternate=null,Iw(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&oa(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Sn=null,us=!1;function Mo(r,a,c){for(c=c.child;c!==null;)Aw(r,a,c),c=c.sibling}function Aw(r,a,c){if(Ne&&typeof Ne.onCommitFiberUnmount=="function")try{Ne.onCommitFiberUnmount(vi,c)}catch{}switch(c.tag){case 26:Zn||Xr(c,a),Mo(r,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Zn||Xr(c,a);var m=Sn,w=us;Oa(c.type)&&(Sn=c.stateNode,us=!1),Mo(r,a,c),mh(c.stateNode),Sn=m,us=w;break;case 5:Zn||Xr(c,a);case 6:if(m=Sn,w=us,Sn=null,Mo(r,a,c),Sn=m,us=w,Sn!==null)if(us)try{(Sn.nodeType===9?Sn.body:Sn.nodeName==="HTML"?Sn.ownerDocument.body:Sn).removeChild(c.stateNode)}catch(S){Xt(c,a,S)}else try{Sn.removeChild(c.stateNode)}catch(S){Xt(c,a,S)}break;case 18:Sn!==null&&(us?(r=Sn,TS(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),Ic(r)):TS(Sn,c.stateNode));break;case 4:m=Sn,w=us,Sn=c.stateNode.containerInfo,us=!0,Mo(r,a,c),Sn=m,us=w;break;case 0:case 11:case 14:case 15:Ra(2,c,a),Zn||Ra(4,c,a),Mo(r,a,c);break;case 1:Zn||(Xr(c,a),m=c.stateNode,typeof m.componentWillUnmount=="function"&&Ew(c,a,m)),Mo(r,a,c);break;case 21:Mo(r,a,c);break;case 22:Zn=(m=Zn)||c.memoizedState!==null,Mo(r,a,c),Zn=m;break;default:Mo(r,a,c)}}function Nw(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Ic(r)}catch(c){Xt(a,a.return,c)}}}function Rw(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Ic(r)}catch(c){Xt(a,a.return,c)}}function Ak(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new Cw),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new Cw),a;default:throw Error(i(435,r.tag))}}function bm(r,a){var c=Ak(r);a.forEach(function(m){if(!c.has(m)){c.add(m);var w=Ok.bind(null,r,m);m.then(w,w)}})}function cs(r,a){var c=a.deletions;if(c!==null)for(var m=0;m<c.length;m++){var w=c[m],S=r,R=a,V=R;e:for(;V!==null;){switch(V.tag){case 27:if(Oa(V.type)){Sn=V.stateNode,us=!1;break e}break;case 5:Sn=V.stateNode,us=!1;break e;case 3:case 4:Sn=V.stateNode.containerInfo,us=!0;break e}V=V.return}if(Sn===null)throw Error(i(160));Aw(S,R,w),Sn=null,us=!1,S=w.alternate,S!==null&&(S.return=null),w.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Mw(a,r),a=a.sibling}var wr=null;function Mw(r,a){var c=r.alternate,m=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:cs(a,r),ds(r),m&4&&(Ra(3,r,r.return),sh(3,r),Ra(5,r,r.return));break;case 1:cs(a,r),ds(r),m&512&&(Zn||c===null||Xr(c,c.return)),m&64&&Ro&&(r=r.updateQueue,r!==null&&(m=r.callbacks,m!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var w=wr;if(cs(a,r),ds(r),m&512&&(Zn||c===null||Xr(c,c.return)),m&4){var S=c!==null?c.memoizedState:null;if(m=r.memoizedState,c===null)if(m===null)if(r.stateNode===null){e:{m=r.type,c=r.memoizedProps,w=w.ownerDocument||w;t:switch(m){case"title":S=w.getElementsByTagName("title")[0],(!S||S[js]||S[bn]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=w.createElement(m),w.head.insertBefore(S,w.querySelector("head > title"))),xi(S,m,c),S[bn]=r,Pn(S),m=S;break e;case"link":var R=MS("link","href",w).get(m+(c.href||""));if(R){for(var V=0;V<R.length;V++)if(S=R[V],S.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice(V,1);break t}}S=w.createElement(m),xi(S,m,c),w.head.appendChild(S);break;case"meta":if(R=MS("meta","content",w).get(m+(c.content||""))){for(V=0;V<R.length;V++)if(S=R[V],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice(V,1);break t}}S=w.createElement(m),xi(S,m,c),w.head.appendChild(S);break;default:throw Error(i(468,m))}S[bn]=r,Pn(S),m=S}r.stateNode=m}else PS(w,r.type,r.stateNode);else r.stateNode=RS(w,m,r.memoizedProps);else S!==m?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,m===null?PS(w,r.type,r.stateNode):RS(w,m,r.memoizedProps)):m===null&&r.stateNode!==null&&yy(r,r.memoizedProps,c.memoizedProps)}break;case 27:cs(a,r),ds(r),m&512&&(Zn||c===null||Xr(c,c.return)),c!==null&&m&4&&yy(r,r.memoizedProps,c.memoizedProps);break;case 5:if(cs(a,r),ds(r),m&512&&(Zn||c===null||Xr(c,c.return)),r.flags&32){w=r.stateNode;try{jn(w,"")}catch(qe){Xt(r,r.return,qe)}}m&4&&r.stateNode!=null&&(w=r.memoizedProps,yy(r,w,c!==null?c.memoizedProps:w)),m&1024&&(Ey=!0);break;case 6:if(cs(a,r),ds(r),m&4){if(r.stateNode===null)throw Error(i(162));m=r.memoizedProps,c=r.stateNode;try{c.nodeValue=m}catch(qe){Xt(r,r.return,qe)}}break;case 3:if(qm=null,w=wr,wr=Bm(a.containerInfo),cs(a,r),wr=w,ds(r),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Ic(a.containerInfo)}catch(qe){Xt(r,r.return,qe)}Ey&&(Ey=!1,Pw(r));break;case 4:m=wr,wr=Bm(r.stateNode.containerInfo),cs(a,r),ds(r),wr=m;break;case 12:cs(a,r),ds(r);break;case 31:cs(a,r),ds(r),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,bm(r,m)));break;case 13:cs(a,r),ds(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Am=lt()),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,bm(r,m)));break;case 22:w=r.memoizedState!==null;var J=c!==null&&c.memoizedState!==null,ae=Ro,ye=Zn;if(Ro=ae||w,Zn=ye||J,cs(a,r),Zn=ye,Ro=ae,ds(r),m&8192)e:for(a=r.stateNode,a._visibility=w?a._visibility&-2:a._visibility|1,w&&(c===null||J||Ro||Zn||tu(r)),c=null,a=r;;){if(a.tag===5||a.tag===26){if(c===null){J=c=a;try{if(S=J.stateNode,w)R=S.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{V=J.stateNode;var xe=J.memoizedProps.style,ce=xe!=null&&xe.hasOwnProperty("display")?xe.display:null;V.style.display=ce==null||typeof ce=="boolean"?"":(""+ce).trim()}}catch(qe){Xt(J,J.return,qe)}}}else if(a.tag===6){if(c===null){J=a;try{J.stateNode.nodeValue=w?"":J.memoizedProps}catch(qe){Xt(J,J.return,qe)}}}else if(a.tag===18){if(c===null){J=a;try{var pe=J.stateNode;w?ES(pe,!0):ES(J.stateNode,!1)}catch(qe){Xt(J,J.return,qe)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}m&4&&(m=r.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,bm(r,c))));break;case 19:cs(a,r),ds(r),m&4&&(m=r.updateQueue,m!==null&&(r.updateQueue=null,bm(r,m)));break;case 30:break;case 21:break;default:cs(a,r),ds(r)}}function ds(r){var a=r.flags;if(a&2){try{for(var c,m=r.return;m!==null;){if(ww(m)){c=m;break}m=m.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var w=c.stateNode,S=vy(r);Cm(r,S,w);break;case 5:var R=c.stateNode;c.flags&32&&(jn(R,""),c.flags&=-33);var V=vy(r);Cm(r,V,R);break;case 3:case 4:var J=c.stateNode.containerInfo,ae=vy(r);Ty(r,ae,J);break;default:throw Error(i(161))}}catch(ye){Xt(r,r.return,ye)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function Pw(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;Pw(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Po(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)bw(r,a.alternate,a),a=a.sibling}function tu(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Ra(4,a,a.return),tu(a);break;case 1:Xr(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&Ew(a,a.return,c),tu(a);break;case 27:mh(a.stateNode);case 26:case 5:Xr(a,a.return),tu(a);break;case 22:a.memoizedState===null&&tu(a);break;case 30:tu(a);break;default:tu(a)}r=r.sibling}}function ko(r,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var m=a.alternate,w=r,S=a,R=S.flags;switch(S.tag){case 0:case 11:case 15:ko(w,S,c),sh(4,S);break;case 1:if(ko(w,S,c),m=S,w=m.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(ae){Xt(m,m.return,ae)}if(m=S,w=m.updateQueue,w!==null){var V=m.stateNode;try{var J=w.shared.hiddenCallbacks;if(J!==null)for(w.shared.hiddenCallbacks=null,w=0;w<J.length;w++)ux(J[w],V)}catch(ae){Xt(m,m.return,ae)}}c&&R&64&&Tw(S),rh(S,S.return);break;case 27:Sw(S);case 26:case 5:ko(w,S,c),c&&m===null&&R&4&&xw(S),rh(S,S.return);break;case 12:ko(w,S,c);break;case 31:ko(w,S,c),c&&R&4&&Nw(w,S);break;case 13:ko(w,S,c),c&&R&4&&Rw(w,S);break;case 22:S.memoizedState===null&&ko(w,S,c),rh(S,S.return);break;case 30:break;default:ko(w,S,c)}a=a.sibling}}function xy(r,a){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&jd(c))}function wy(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&jd(r))}function Sr(r,a,c,m){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)kw(r,a,c,m),a=a.sibling}function kw(r,a,c,m){var w=a.flags;switch(a.tag){case 0:case 11:case 15:Sr(r,a,c,m),w&2048&&sh(9,a);break;case 1:Sr(r,a,c,m);break;case 3:Sr(r,a,c,m),w&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&jd(r)));break;case 12:if(w&2048){Sr(r,a,c,m),r=a.stateNode;try{var S=a.memoizedProps,R=S.id,V=S.onPostCommit;typeof V=="function"&&V(R,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(J){Xt(a,a.return,J)}}else Sr(r,a,c,m);break;case 31:Sr(r,a,c,m);break;case 13:Sr(r,a,c,m);break;case 23:break;case 22:S=a.stateNode,R=a.alternate,a.memoizedState!==null?S._visibility&2?Sr(r,a,c,m):oh(r,a):S._visibility&2?Sr(r,a,c,m):(S._visibility|=2,gc(r,a,c,m,(a.subtreeFlags&10256)!==0||!1)),w&2048&&xy(R,a);break;case 24:Sr(r,a,c,m),w&2048&&wy(a.alternate,a);break;default:Sr(r,a,c,m)}}function gc(r,a,c,m,w){for(w=w&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var S=r,R=a,V=c,J=m,ae=R.flags;switch(R.tag){case 0:case 11:case 15:gc(S,R,V,J,w),sh(8,R);break;case 23:break;case 22:var ye=R.stateNode;R.memoizedState!==null?ye._visibility&2?gc(S,R,V,J,w):oh(S,R):(ye._visibility|=2,gc(S,R,V,J,w)),w&&ae&2048&&xy(R.alternate,R);break;case 24:gc(S,R,V,J,w),w&&ae&2048&&wy(R.alternate,R);break;default:gc(S,R,V,J,w)}a=a.sibling}}function oh(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=r,m=a,w=m.flags;switch(m.tag){case 22:oh(c,m),w&2048&&xy(m.alternate,m);break;case 24:oh(c,m),w&2048&&wy(m.alternate,m);break;default:oh(c,m)}a=a.sibling}}var ah=8192;function _c(r,a,c){if(r.subtreeFlags&ah)for(r=r.child;r!==null;)Dw(r,a,c),r=r.sibling}function Dw(r,a,c){switch(r.tag){case 26:_c(r,a,c),r.flags&ah&&r.memoizedState!==null&&mD(c,wr,r.memoizedState,r.memoizedProps);break;case 5:_c(r,a,c);break;case 3:case 4:var m=wr;wr=Bm(r.stateNode.containerInfo),_c(r,a,c),wr=m;break;case 22:r.memoizedState===null&&(m=r.alternate,m!==null&&m.memoizedState!==null?(m=ah,ah=16777216,_c(r,a,c),ah=m):_c(r,a,c));break;default:_c(r,a,c)}}function Lw(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function lh(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];fi=m,Ow(m,r)}Lw(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Vw(r),r=r.sibling}function Vw(r){switch(r.tag){case 0:case 11:case 15:lh(r),r.flags&2048&&Ra(9,r,r.return);break;case 3:lh(r);break;case 12:lh(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Im(r)):lh(r);break;default:lh(r)}}function Im(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var m=a[c];fi=m,Ow(m,r)}Lw(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Ra(8,a,a.return),Im(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Im(a));break;default:Im(a)}r=r.sibling}}function Ow(r,a){for(;fi!==null;){var c=fi;switch(c.tag){case 0:case 11:case 15:Ra(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:jd(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,fi=m;else e:for(c=r;fi!==null;){m=fi;var w=m.sibling,S=m.return;if(Iw(m),m===c){fi=null;break e}if(w!==null){w.return=S,fi=w;break e}fi=S}}}var Nk={getCacheForType:function(r){var a=Ti(Wn),c=a.data.get(r);return c===void 0&&(c=r(),a.data.set(r,c)),c},cacheSignal:function(){return Ti(Wn).controller.signal}},Rk=typeof WeakMap=="function"?WeakMap:Map,jt=0,hn=null,St=null,kt=0,$t=0,Ls=null,Ma=!1,yc=!1,Sy=!1,Do=0,Ln=0,Pa=0,nu=0,Cy=0,Vs=0,vc=0,uh=null,hs=null,by=!1,Am=0,Uw=0,Nm=1/0,Rm=null,ka=null,ti=0,Da=null,Tc=null,Lo=0,Iy=0,Ay=null,Fw=null,ch=0,Ny=null;function Os(){return(jt&2)!==0&&kt!==0?kt&-kt:se.T!==null?Ly():Sl()}function Bw(){if(Vs===0)if((kt&536870912)===0||wt){var r=Zi;Zi<<=1,(Zi&3932160)===0&&(Zi=262144),Vs=r}else Vs=536870912;return r=ks.current,r!==null&&(r.flags|=32),Vs}function fs(r,a,c){(r===hn&&($t===2||$t===9)||r.cancelPendingCommit!==null)&&(Ec(r,0),La(r,kt,Vs,!1)),cr(r,c),((jt&2)===0||r!==hn)&&(r===hn&&((jt&2)===0&&(nu|=c),Ln===4&&La(r,kt,Vs,!1)),eo(r))}function zw(r,a,c){if((jt&6)!==0)throw Error(i(327));var m=!c&&(a&127)===0&&(a&r.expiredLanes)===0||Xn(r,a),w=m?kk(r,a):My(r,a,!0),S=m;do{if(w===0){yc&&!m&&La(r,a,0,!1);break}else{if(c=r.current.alternate,S&&!Mk(c)){w=My(r,a,!1),S=!1;continue}if(w===2){if(S=a,r.errorRecoveryDisabledLanes&S)var R=0;else R=r.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){a=R;e:{var V=r;w=uh;var J=V.current.memoizedState.isDehydrated;if(J&&(Ec(V,R).flags|=256),R=My(V,R,!1),R!==2){if(Sy&&!J){V.errorRecoveryDisabledLanes|=S,nu|=S,w=4;break e}S=hs,hs=w,S!==null&&(hs===null?hs=S:hs.push.apply(hs,S))}w=R}if(S=!1,w!==2)continue}}if(w===1){Ec(r,0),La(r,a,0,!0);break}e:{switch(m=r,S=w,S){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:La(m,a,Vs,!Ma);break e;case 2:hs=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(w=Am+300-lt(),10<w)){if(La(m,a,Vs,!Ma),zi(m,0,!0)!==0)break e;Lo=a,m.timeoutHandle=yS(qw.bind(null,m,c,hs,Rm,by,a,Vs,nu,vc,Ma,S,"Throttled",-0,0),w);break e}qw(m,c,hs,Rm,by,a,Vs,nu,vc,Ma,S,null,-0,0)}}break}while(!0);eo(r)}function qw(r,a,c,m,w,S,R,V,J,ae,ye,xe,ce,pe){if(r.timeoutHandle=-1,xe=a.subtreeFlags,xe&8192||(xe&16785408)===16785408){xe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Si},Dw(a,S,xe);var qe=(S&62914560)===S?Am-lt():(S&4194048)===S?Uw-lt():0;if(qe=pD(xe,qe),qe!==null){Lo=S,r.cancelPendingCommit=qe(Zw.bind(null,r,a,S,c,m,w,R,V,J,ye,xe,null,ce,pe)),La(r,S,R,!ae);return}}Zw(r,a,S,c,m,w,R,V,J)}function Mk(r){for(var a=r;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var w=c[m],S=w.getSnapshot;w=w.value;try{if(!di(S(),w))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function La(r,a,c,m){a&=~Cy,a&=~nu,r.suspendedLanes|=a,r.pingedLanes&=~a,m&&(r.warmLanes|=a),m=r.expirationTimes;for(var w=a;0<w;){var S=31-dt(w),R=1<<S;m[S]=-1,w&=~R}c!==0&&fo(r,c,a)}function Mm(){return(jt&6)===0?(dh(0),!1):!0}function Ry(){if(St!==null){if($t===0)var r=St.return;else r=St,xr=$r=null,K_(r),dc=null,Wd=0,r=St;for(;r!==null;)vw(r.alternate,r),r=r.return;St=null}}function Ec(r,a){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,Qk(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Lo=0,Ry(),hn=r,St=c=ir(r.current,null),kt=a,$t=0,Ls=null,Ma=!1,yc=Xn(r,a),Sy=!1,vc=Vs=Cy=nu=Pa=Ln=0,hs=uh=null,by=!1,(a&8)!==0&&(a|=a&32);var m=r.entangledLanes;if(m!==0)for(r=r.entanglements,m&=a;0<m;){var w=31-dt(m),S=1<<w;a|=r[w],m&=~S}return Do=a,Gl(),c}function Gw(r,a){pt=null,se.H=th,a===cc||a===om?(a=rx(),$t=3):a===D_?(a=rx(),$t=4):$t=a===ly?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ls=a,St===null&&(Ln=1,Tm(r,f(a,r.current)))}function Hw(){var r=ks.current;return r===null?!0:(kt&4194048)===kt?sr===null:(kt&62914560)===kt||(kt&536870912)!==0?r===sr:!1}function jw(){var r=se.H;return se.H=th,r===null?th:r}function Kw(){var r=se.A;return se.A=Nk,r}function Pm(){Ln=4,Ma||(kt&4194048)!==kt&&ks.current!==null||(yc=!0),(Pa&134217727)===0&&(nu&134217727)===0||hn===null||La(hn,kt,Vs,!1)}function My(r,a,c){var m=jt;jt|=2;var w=jw(),S=Kw();(hn!==r||kt!==a)&&(Rm=null,Ec(r,a)),a=!1;var R=Ln;e:do try{if($t!==0&&St!==null){var V=St,J=Ls;switch($t){case 8:Ry(),R=6;break e;case 3:case 2:case 9:case 6:ks.current===null&&(a=!0);var ae=$t;if($t=0,Ls=null,xc(r,V,J,ae),c&&yc){R=0;break e}break;default:ae=$t,$t=0,Ls=null,xc(r,V,J,ae)}}Pk(),R=Ln;break}catch(ye){Gw(r,ye)}while(!0);return a&&r.shellSuspendCounter++,xr=$r=null,jt=m,se.H=w,se.A=S,St===null&&(hn=null,kt=0,Gl()),R}function Pk(){for(;St!==null;)Ww(St)}function kk(r,a){var c=jt;jt|=2;var m=jw(),w=Kw();hn!==r||kt!==a?(Rm=null,Nm=lt()+500,Ec(r,a)):yc=Xn(r,a);e:do try{if($t!==0&&St!==null){a=St;var S=Ls;t:switch($t){case 1:$t=0,Ls=null,xc(r,a,S,1);break;case 2:case 9:if(ix(S)){$t=0,Ls=null,Yw(a);break}a=function(){$t!==2&&$t!==9||hn!==r||($t=7),eo(r)},S.then(a,a);break e;case 3:$t=7;break e;case 4:$t=5;break e;case 7:ix(S)?($t=0,Ls=null,Yw(a)):($t=0,Ls=null,xc(r,a,S,7));break;case 5:var R=null;switch(St.tag){case 26:R=St.memoizedState;case 5:case 27:var V=St;if(R?kS(R):V.stateNode.complete){$t=0,Ls=null;var J=V.sibling;if(J!==null)St=J;else{var ae=V.return;ae!==null?(St=ae,km(ae)):St=null}break t}}$t=0,Ls=null,xc(r,a,S,5);break;case 6:$t=0,Ls=null,xc(r,a,S,6);break;case 8:Ry(),Ln=6;break e;default:throw Error(i(462))}}Dk();break}catch(ye){Gw(r,ye)}while(!0);return xr=$r=null,se.H=m,se.A=w,jt=c,St!==null?0:(hn=null,kt=0,Gl(),Ln)}function Dk(){for(;St!==null&&!He();)Ww(St)}function Ww(r){var a=_w(r.alternate,r,Do);r.memoizedProps=r.pendingProps,a===null?km(r):St=a}function Yw(r){var a=r,c=a.alternate;switch(a.tag){case 15:case 0:a=dw(c,a,a.pendingProps,a.type,void 0,kt);break;case 11:a=dw(c,a,a.pendingProps,a.type.render,a.ref,kt);break;case 5:K_(a);default:vw(c,a),a=St=Bd(a,Do),a=_w(c,a,Do)}r.memoizedProps=r.pendingProps,a===null?km(r):St=a}function xc(r,a,c,m){xr=$r=null,K_(a),dc=null,Wd=0;var w=a.return;try{if(xk(r,w,a,c,kt)){Ln=1,Tm(r,f(c,r.current)),St=null;return}}catch(S){if(w!==null)throw St=w,S;Ln=1,Tm(r,f(c,r.current)),St=null;return}a.flags&32768?(wt||m===1?r=!0:yc||(kt&536870912)!==0?r=!1:(Ma=r=!0,(m===2||m===9||m===3||m===6)&&(m=ks.current,m!==null&&m.tag===13&&(m.flags|=16384))),Jw(a,r)):km(a)}function km(r){var a=r;do{if((a.flags&32768)!==0){Jw(a,Ma);return}r=a.return;var c=Ck(a.alternate,a,Do);if(c!==null){St=c;return}if(a=a.sibling,a!==null){St=a;return}St=a=r}while(a!==null);Ln===0&&(Ln=5)}function Jw(r,a){do{var c=bk(r.alternate,r);if(c!==null){c.flags&=32767,St=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(r=r.sibling,r!==null)){St=r;return}St=r=c}while(r!==null);Ln=6,St=null}function Zw(r,a,c,m,w,S,R,V,J){r.cancelPendingCommit=null;do Dm();while(ti!==0);if((jt&6)!==0)throw Error(i(327));if(a!==null){if(a===r.current)throw Error(i(177));if(S=a.lanes|a.childLanes,S|=ic,Ud(r,c,S,R,V,J),r===hn&&(St=hn=null,kt=0),Tc=a,Da=r,Lo=c,Iy=S,Ay=w,Fw=m,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Uk(pn,function(){return tS(),null})):(r.callbackNode=null,r.callbackPriority=0),m=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||m){m=se.T,se.T=null,w=Ce.p,Ce.p=2,R=jt,jt|=4;try{Ik(r,a,c)}finally{jt=R,Ce.p=w,se.T=m}}ti=1,Qw(),$w(),Xw()}}function Qw(){if(ti===1){ti=0;var r=Da,a=Tc,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=se.T,se.T=null;var m=Ce.p;Ce.p=2;var w=jt;jt|=4;try{Mw(a,r);var S=Gy,R=Ul(r.containerInfo),V=S.focusedElem,J=S.selectionRange;if(R!==V&&V&&V.ownerDocument&&Xu(V.ownerDocument.documentElement,V)){if(J!==null&&jr(V)){var ae=J.start,ye=J.end;if(ye===void 0&&(ye=ae),"selectionStart"in V)V.selectionStart=ae,V.selectionEnd=Math.min(ye,V.value.length);else{var xe=V.ownerDocument||document,ce=xe&&xe.defaultView||window;if(ce.getSelection){var pe=ce.getSelection(),qe=V.textContent.length,nt=Math.min(J.start,qe),ln=J.end===void 0?nt:Math.min(J.end,qe);!pe.extend&&nt>ln&&(R=ln,ln=nt,nt=R);var ee=Ol(V,nt),$=Ol(V,ln);if(ee&&$&&(pe.rangeCount!==1||pe.anchorNode!==ee.node||pe.anchorOffset!==ee.offset||pe.focusNode!==$.node||pe.focusOffset!==$.offset)){var oe=xe.createRange();oe.setStart(ee.node,ee.offset),pe.removeAllRanges(),nt>ln?(pe.addRange(oe),pe.extend($.node,$.offset)):(oe.setEnd($.node,$.offset),pe.addRange(oe))}}}}for(xe=[],pe=V;pe=pe.parentNode;)pe.nodeType===1&&xe.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<xe.length;V++){var Te=xe[V];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}Km=!!qy,Gy=qy=null}finally{jt=w,Ce.p=m,se.T=c}}r.current=a,ti=2}}function $w(){if(ti===2){ti=0;var r=Da,a=Tc,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=se.T,se.T=null;var m=Ce.p;Ce.p=2;var w=jt;jt|=4;try{bw(r,a.alternate,a)}finally{jt=w,Ce.p=m,se.T=c}}ti=3}}function Xw(){if(ti===4||ti===3){ti=0,mt();var r=Da,a=Tc,c=Lo,m=Fw;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?ti=5:(ti=0,Tc=Da=null,eS(r,r.pendingLanes));var w=r.pendingLanes;if(w===0&&(ka=null),Be(c),a=a.stateNode,Ne&&typeof Ne.onCommitFiberRoot=="function")try{Ne.onCommitFiberRoot(vi,a,void 0,(a.current.flags&128)===128)}catch{}if(m!==null){a=se.T,w=Ce.p,Ce.p=2,se.T=null;try{for(var S=r.onRecoverableError,R=0;R<m.length;R++){var V=m[R];S(V.value,{componentStack:V.stack})}}finally{se.T=a,Ce.p=w}}(Lo&3)!==0&&Dm(),eo(r),w=r.pendingLanes,(c&261930)!==0&&(w&42)!==0?r===Ny?ch++:(ch=0,Ny=r):ch=0,dh(0)}}function eS(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,jd(a)))}function Dm(){return Qw(),$w(),Xw(),tS()}function tS(){if(ti!==5)return!1;var r=Da,a=Iy;Iy=0;var c=Be(Lo),m=se.T,w=Ce.p;try{Ce.p=32>c?32:c,se.T=null,c=Ay,Ay=null;var S=Da,R=Lo;if(ti=0,Tc=Da=null,Lo=0,(jt&6)!==0)throw Error(i(331));var V=jt;if(jt|=4,Vw(S.current),kw(S,S.current,R,c),jt=V,dh(0,!1),Ne&&typeof Ne.onPostCommitFiberRoot=="function")try{Ne.onPostCommitFiberRoot(vi,S)}catch{}return!0}finally{Ce.p=w,se.T=m,eS(r,a)}}function nS(r,a,c){a=f(c,a),a=ay(r.stateNode,a,2),r=Ia(r,a,2),r!==null&&(cr(r,2),eo(r))}function Xt(r,a,c){if(r.tag===3)nS(r,r,c);else for(;a!==null;){if(a.tag===3){nS(a,r,c);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ka===null||!ka.has(m))){r=f(c,r),c=iw(2),m=Ia(a,c,2),m!==null&&(sw(c,m,a,r),cr(m,2),eo(m));break}}a=a.return}}function Py(r,a,c){var m=r.pingCache;if(m===null){m=r.pingCache=new Rk;var w=new Set;m.set(a,w)}else w=m.get(a),w===void 0&&(w=new Set,m.set(a,w));w.has(c)||(Sy=!0,w.add(c),r=Lk.bind(null,r,a,c),a.then(r,r))}function Lk(r,a,c){var m=r.pingCache;m!==null&&m.delete(a),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,hn===r&&(kt&c)===c&&(Ln===4||Ln===3&&(kt&62914560)===kt&&300>lt()-Am?(jt&2)===0&&Ec(r,0):Cy|=c,vc===kt&&(vc=0)),eo(r)}function iS(r,a){a===0&&(a=Hu()),r=nr(r,a),r!==null&&(cr(r,a),eo(r))}function Vk(r){var a=r.memoizedState,c=0;a!==null&&(c=a.retryLane),iS(r,c)}function Ok(r,a){var c=0;switch(r.tag){case 31:case 13:var m=r.stateNode,w=r.memoizedState;w!==null&&(c=w.retryLane);break;case 19:m=r.stateNode;break;case 22:m=r.stateNode._retryCache;break;default:throw Error(i(314))}m!==null&&m.delete(a),iS(r,c)}function Uk(r,a){return _e(r,a)}var Lm=null,wc=null,ky=!1,Vm=!1,Dy=!1,Va=0;function eo(r){r!==wc&&r.next===null&&(wc===null?Lm=wc=r:wc=wc.next=r),Vm=!0,ky||(ky=!0,Bk())}function dh(r,a){if(!Dy&&Vm){Dy=!0;do for(var c=!1,m=Lm;m!==null;){if(r!==0){var w=m.pendingLanes;if(w===0)var S=0;else{var R=m.suspendedLanes,V=m.pingedLanes;S=(1<<31-dt(42|r)+1)-1,S&=w&~(R&~V),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(c=!0,aS(m,S))}else S=kt,S=zi(m,m===hn?S:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(S&3)===0||Xn(m,S)||(c=!0,aS(m,S));m=m.next}while(c);Dy=!1}}function Fk(){sS()}function sS(){Vm=ky=!1;var r=0;Va!==0&&Zk()&&(r=Va);for(var a=lt(),c=null,m=Lm;m!==null;){var w=m.next,S=rS(m,a);S===0?(m.next=null,c===null?Lm=w:c.next=w,w===null&&(wc=c)):(c=m,(r!==0||(S&3)!==0)&&(Vm=!0)),m=w}ti!==0&&ti!==5||dh(r),Va!==0&&(Va=0)}function rS(r,a){for(var c=r.suspendedLanes,m=r.pingedLanes,w=r.expirationTimes,S=r.pendingLanes&-62914561;0<S;){var R=31-dt(S),V=1<<R,J=w[R];J===-1?((V&c)===0||(V&m)!==0)&&(w[R]=Od(V,a)):J<=a&&(r.expiredLanes|=V),S&=~V}if(a=hn,c=kt,c=zi(r,r===a?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),m=r.callbackNode,c===0||r===a&&($t===2||$t===9)||r.cancelPendingCommit!==null)return m!==null&&m!==null&&ke(m),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Xn(r,c)){if(a=c&-c,a===r.callbackPriority)return a;switch(m!==null&&ke(m),Be(c)){case 2:case 8:c=Ji;break;case 32:c=pn;break;case 268435456:c=Vr;break;default:c=pn}return m=oS.bind(null,r),c=_e(c,m),r.callbackPriority=a,r.callbackNode=c,a}return m!==null&&m!==null&&ke(m),r.callbackPriority=2,r.callbackNode=null,2}function oS(r,a){if(ti!==0&&ti!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Dm()&&r.callbackNode!==c)return null;var m=kt;return m=zi(r,r===hn?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),m===0?null:(zw(r,m,a),rS(r,lt()),r.callbackNode!=null&&r.callbackNode===c?oS.bind(null,r):null)}function aS(r,a){if(Dm())return null;zw(r,a,!0)}function Bk(){$k(function(){(jt&6)!==0?_e(ri,Fk):sS()})}function Ly(){if(Va===0){var r=lc;r===0&&(r=Fn,Fn<<=1,(Fn&261888)===0&&(Fn=256)),Va=r}return Va}function lS(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Br(""+r)}function uS(r,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,r.id&&c.setAttribute("form",r.id),a.parentNode.insertBefore(c,a),r=new FormData(r),c.parentNode.removeChild(c),r}function zk(r,a,c,m,w){if(a==="submit"&&c&&c.stateNode===w){var S=lS((w[Mn]||null).action),R=m.submitter;R&&(a=(a=R[Mn]||null)?lS(a.formAction):R.getAttribute("formAction"),a!==null&&(S=a,R=null));var V=new $s("action","action",null,m,w);r.push({event:V,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Va!==0){var J=R?uS(w,R):new FormData(w);ty(c,{pending:!0,data:J,method:w.method,action:S},null,J)}}else typeof S=="function"&&(V.preventDefault(),J=R?uS(w,R):new FormData(w),ty(c,{pending:!0,data:J,method:w.method,action:S},S,J))},currentTarget:w}]})}}for(var Vy=0;Vy<Yr.length;Vy++){var Oy=Yr[Vy],qk=Oy.toLowerCase(),Gk=Oy[0].toUpperCase()+Oy.slice(1);os(qk,"on"+Gk)}os(Bl,"onAnimationEnd"),os(em,"onAnimationIteration"),os(zl,"onAnimationStart"),os("dblclick","onDoubleClick"),os("focusin","onFocus"),os("focusout","onBlur"),os(b_,"onTransitionRun"),os(tm,"onTransitionStart"),os(I_,"onTransitionCancel"),os(xa,"onTransitionEnd"),es("onMouseEnter",["mouseout","mouseover"]),es("onMouseLeave",["mouseout","mouseover"]),es("onPointerEnter",["pointerout","pointerover"]),es("onPointerLeave",["pointerout","pointerover"]),Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hk=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hh));function cS(r,a){a=(a&4)!==0;for(var c=0;c<r.length;c++){var m=r[c],w=m.event;m=m.listeners;e:{var S=void 0;if(a)for(var R=m.length-1;0<=R;R--){var V=m[R],J=V.instance,ae=V.currentTarget;if(V=V.listener,J!==S&&w.isPropagationStopped())break e;S=V,w.currentTarget=ae;try{S(w)}catch(ye){ql(ye)}w.currentTarget=null,S=J}else for(R=0;R<m.length;R++){if(V=m[R],J=V.instance,ae=V.currentTarget,V=V.listener,J!==S&&w.isPropagationStopped())break e;S=V,w.currentTarget=ae;try{S(w)}catch(ye){ql(ye)}w.currentTarget=null,S=J}}}}function Ct(r,a){var c=a[ws];c===void 0&&(c=a[ws]=new Set);var m=r+"__bubble";c.has(m)||(dS(a,r,2,!1),c.add(m))}function Uy(r,a,c){var m=0;a&&(m|=4),dS(c,r,m,a)}var Om="_reactListening"+Math.random().toString(36).slice(2);function Fy(r){if(!r[Om]){r[Om]=!0,Cl.forEach(function(c){c!=="selectionchange"&&(Hk.has(c)||Uy(c,!1,r),Uy(c,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[Om]||(a[Om]=!0,Uy("selectionchange",!1,a))}}function dS(r,a,c,m){switch(BS(a)){case 2:var w=yD;break;case 8:w=vD;break;default:w=ev}c=w.bind(null,a,c,r),w=void 0,!mr||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(w=!0),m?w!==void 0?r.addEventListener(a,c,{capture:!0,passive:w}):r.addEventListener(a,c,!0):w!==void 0?r.addEventListener(a,c,{passive:w}):r.addEventListener(a,c,!1)}function By(r,a,c,m,w){var S=m;if((a&1)===0&&(a&2)===0&&m!==null)e:for(;;){if(m===null)return;var R=m.tag;if(R===3||R===4){var V=m.stateNode.containerInfo;if(V===w)break;if(R===4)for(R=m.return;R!==null;){var J=R.tag;if((J===3||J===4)&&R.stateNode.containerInfo===w)return;R=R.return}for(;V!==null;){if(R=Ss(V),R===null)return;if(J=R.tag,J===5||J===6||J===26||J===27){m=S=R;continue e}V=V.parentNode}}m=m.return}fr(function(){var ae=S,ye=Ci(c),xe=[];e:{var ce=nm.get(r);if(ce!==void 0){var pe=$s,qe=r;switch(r){case"keypress":if(qr(c)===0)break e;case"keydown":case"keyup":pe=Pl;break;case"focusin":qe="focus",pe=vo;break;case"focusout":qe="blur",pe=vo;break;case"beforeblur":case"afterblur":pe=vo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Il;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=Yu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=I;break;case Bl:case em:case zl:pe=ha;break;case xa:pe=U;break;case"scroll":case"scrollend":pe=yt;break;case"wheel":pe=de;break;case"copy":case"cut":case"paste":pe=Hi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=yr;break;case"toggle":case"beforetoggle":pe=st}var nt=(a&4)!==0,ln=!nt&&(r==="scroll"||r==="scrollend"),ee=nt?ce!==null?ce+"Capture":null:ce;nt=[];for(var $=ae,oe;$!==null;){var Te=$;if(oe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||oe===null||ee===null||(Te=Gi($,ee),Te!=null&&nt.push(fh($,Te,oe))),ln)break;$=$.return}0<nt.length&&(ce=new pe(ce,qe,null,c,ye),xe.push({event:ce,listeners:nt}))}}if((a&7)===0){e:{if(ce=r==="mouseover"||r==="pointerover",pe=r==="mouseout"||r==="pointerout",ce&&c!==da&&(qe=c.relatedTarget||c.fromElement)&&(Ss(qe)||qe[xs]))break e;if((pe||ce)&&(ce=ye.window===ye?ye:(ce=ye.ownerDocument)?ce.defaultView||ce.parentWindow:window,pe?(qe=c.relatedTarget||c.toElement,pe=ae,qe=qe?Ss(qe):null,qe!==null&&(ln=o(qe),nt=qe.tag,qe!==ln||nt!==5&&nt!==27&&nt!==6)&&(qe=null)):(pe=null,qe=ae),pe!==qe)){if(nt=Il,Te="onMouseLeave",ee="onMouseEnter",$="mouse",(r==="pointerout"||r==="pointerover")&&(nt=yr,Te="onPointerLeave",ee="onPointerEnter",$="pointer"),ln=pe==null?ce:ai(pe),oe=qe==null?ce:ai(qe),ce=new nt(Te,$+"leave",pe,c,ye),ce.target=ln,ce.relatedTarget=oe,Te=null,Ss(ye)===ae&&(nt=new nt(ee,$+"enter",qe,c,ye),nt.target=oe,nt.relatedTarget=ln,Te=nt),ln=Te,pe&&qe)t:{for(nt=jk,ee=pe,$=qe,oe=0,Te=ee;Te;Te=nt(Te))oe++;Te=0;for(var Xe=$;Xe;Xe=nt(Xe))Te++;for(;0<oe-Te;)ee=nt(ee),oe--;for(;0<Te-oe;)$=nt($),Te--;for(;oe--;){if(ee===$||$!==null&&ee===$.alternate){nt=ee;break t}ee=nt(ee),$=nt($)}nt=null}else nt=null;pe!==null&&hS(xe,ce,pe,nt,!1),qe!==null&&ln!==null&&hS(xe,ln,qe,nt,!0)}}e:{if(ce=ae?ai(ae):window,pe=ce.nodeName&&ce.nodeName.toLowerCase(),pe==="select"||pe==="input"&&ce.type==="file")var qt=Vl;else if(Xs(ce))if(Jf)qt=C_;else{qt=S_;var We=vr}else pe=ce.nodeName,!pe||pe.toLowerCase()!=="input"||ce.type!=="checkbox"&&ce.type!=="radio"?ae&&Fr(ae.elementType)&&(qt=Vl):qt=ya;if(qt&&(qt=qt(r,ae))){Yf(xe,qt,c,ye);break e}We&&We(r,ce,ae),r==="focusout"&&ae&&ce.type==="number"&&ae.memoizedProps.value!=null&&Cs(ce,"number",ce.value)}switch(We=ae?ai(ae):window,r){case"focusin":(Xs(We)||We.contentEditable==="true")&&(Kr=We,tc=ae,Fl=null);break;case"focusout":Fl=tc=Kr=null;break;case"mousedown":Ta=!0;break;case"contextmenu":case"mouseup":case"dragend":Ta=!1,$f(xe,c,ye);break;case"selectionchange":if(ec)break;case"keydown":case"keyup":$f(xe,c,ye)}var _t;if(Ot)e:{switch(r){case"compositionstart":var Dt="onCompositionStart";break e;case"compositionend":Dt="onCompositionEnd";break e;case"compositionupdate":Dt="onCompositionUpdate";break e}Dt=void 0}else pa?To(r,c)&&(Dt="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Dt="onCompositionStart");Dt&&(rs&&c.locale!=="ko"&&(pa||Dt!=="onCompositionStart"?Dt==="onCompositionEnd"&&pa&&(_t=bs()):(is=ye,pr="value"in is?is.value:is.textContent,pa=!0)),We=Um(ae,Dt),0<We.length&&(Dt=new Ns(Dt,r,null,c,ye),xe.push({event:Dt,listeners:We}),_t?Dt.data=_t:(_t=Eo(c),_t!==null&&(Dt.data=_t)))),(_t=ss?Ps(r,c):ga(r,c))&&(Dt=Um(ae,"onBeforeInput"),0<Dt.length&&(We=new Ns("onBeforeInput","beforeinput",null,c,ye),xe.push({event:We,listeners:Dt}),We.data=_t)),zk(xe,r,ae,c,ye)}cS(xe,a)})}function fh(r,a,c){return{instance:r,listener:a,currentTarget:c}}function Um(r,a){for(var c=a+"Capture",m=[];r!==null;){var w=r,S=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||S===null||(w=Gi(r,c),w!=null&&m.unshift(fh(r,w,S)),w=Gi(r,a),w!=null&&m.push(fh(r,w,S))),r.tag===3)return m;r=r.return}return[]}function jk(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function hS(r,a,c,m,w){for(var S=a._reactName,R=[];c!==null&&c!==m;){var V=c,J=V.alternate,ae=V.stateNode;if(V=V.tag,J!==null&&J===m)break;V!==5&&V!==26&&V!==27||ae===null||(J=ae,w?(ae=Gi(c,S),ae!=null&&R.unshift(fh(c,ae,J))):w||(ae=Gi(c,S),ae!=null&&R.push(fh(c,ae,J)))),c=c.return}R.length!==0&&r.push({event:a,listeners:R})}var Kk=/\r\n?/g,Wk=/\u0000|\uFFFD/g;function fS(r){return(typeof r=="string"?r:""+r).replace(Kk,`
`).replace(Wk,"")}function mS(r,a){return a=fS(a),fS(r)===a}function an(r,a,c,m,w,S){switch(c){case"children":typeof m=="string"?a==="body"||a==="textarea"&&m===""||jn(r,m):(typeof m=="number"||typeof m=="bigint")&&a!=="body"&&jn(r,""+m);break;case"className":xt(r,"class",m);break;case"tabIndex":xt(r,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":xt(r,c,m);break;case"style":go(r,m,S);break;case"data":if(a!=="object"){xt(r,"data",m);break}case"src":case"href":if(m===""&&(a!=="a"||c!=="href")){r.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){r.removeAttribute(c);break}m=Br(""+m),r.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(a!=="input"&&an(r,a,"name",w.name,w,null),an(r,a,"formEncType",w.formEncType,w,null),an(r,a,"formMethod",w.formMethod,w,null),an(r,a,"formTarget",w.formTarget,w,null)):(an(r,a,"encType",w.encType,w,null),an(r,a,"method",w.method,w,null),an(r,a,"target",w.target,w,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){r.removeAttribute(c);break}m=Br(""+m),r.setAttribute(c,m);break;case"onClick":m!=null&&(r.onclick=Si);break;case"onScroll":m!=null&&Ct("scroll",r);break;case"onScrollEnd":m!=null&&Ct("scrollend",r);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(i(61));if(c=m.__html,c!=null){if(w.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"multiple":r.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":r.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){r.removeAttribute("xlink:href");break}c=Br(""+m),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(c,""+m):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":m===!0?r.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?r.setAttribute(c,m):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?r.setAttribute(c,m):r.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?r.removeAttribute(c):r.setAttribute(c,m);break;case"popover":Ct("beforetoggle",r),Ct("toggle",r),vt(r,"popover",m);break;case"xlinkActuate":yn(r,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":yn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":yn(r,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":yn(r,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":yn(r,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":yn(r,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":yn(r,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":yn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":yn(r,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":vt(r,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=_o.get(c)||c,vt(r,c,m))}}function zy(r,a,c,m,w,S){switch(c){case"style":go(r,m,S);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(i(61));if(c=m.__html,c!=null){if(w.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"children":typeof m=="string"?jn(r,m):(typeof m=="number"||typeof m=="bigint")&&jn(r,""+m);break;case"onScroll":m!=null&&Ct("scroll",r);break;case"onScrollEnd":m!=null&&Ct("scrollend",r);break;case"onClick":m!=null&&(r.onclick=Si);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!bl.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(w=c.endsWith("Capture"),a=c.slice(2,w?c.length-7:void 0),S=r[Mn]||null,S=S!=null?S[c]:null,typeof S=="function"&&r.removeEventListener(a,S,w),typeof m=="function")){typeof S!="function"&&S!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(a,m,w);break e}c in r?r[c]=m:m===!0?r.setAttribute(c,""):vt(r,c,m)}}}function xi(r,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ct("error",r),Ct("load",r);var m=!1,w=!1,S;for(S in c)if(c.hasOwnProperty(S)){var R=c[S];if(R!=null)switch(S){case"src":m=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:an(r,a,S,R,c,null)}}w&&an(r,a,"srcSet",c.srcSet,c,null),m&&an(r,a,"src",c.src,c,null);return;case"input":Ct("invalid",r);var V=S=R=w=null,J=null,ae=null;for(m in c)if(c.hasOwnProperty(m)){var ye=c[m];if(ye!=null)switch(m){case"name":w=ye;break;case"type":R=ye;break;case"checked":J=ye;break;case"defaultChecked":ae=ye;break;case"value":S=ye;break;case"defaultValue":V=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(i(137,a));break;default:an(r,a,m,ye,c,null)}}po(r,S,V,J,ae,R,w,!1);return;case"select":Ct("invalid",r),m=R=S=null;for(w in c)if(c.hasOwnProperty(w)&&(V=c[w],V!=null))switch(w){case"value":S=V;break;case"defaultValue":R=V;break;case"multiple":m=V;default:an(r,a,w,V,c,null)}a=S,c=R,r.multiple=!!m,a!=null?Qt(r,!!m,a,!1):c!=null&&Qt(r,!!m,c,!0);return;case"textarea":Ct("invalid",r),S=w=m=null;for(R in c)if(c.hasOwnProperty(R)&&(V=c[R],V!=null))switch(R){case"value":m=V;break;case"defaultValue":w=V;break;case"children":S=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(i(91));break;default:an(r,a,R,V,c,null)}ns(r,m,w,S);return;case"option":for(J in c)if(c.hasOwnProperty(J)&&(m=c[J],m!=null))switch(J){case"selected":r.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:an(r,a,J,m,c,null)}return;case"dialog":Ct("beforetoggle",r),Ct("toggle",r),Ct("cancel",r),Ct("close",r);break;case"iframe":case"object":Ct("load",r);break;case"video":case"audio":for(m=0;m<hh.length;m++)Ct(hh[m],r);break;case"image":Ct("error",r),Ct("load",r);break;case"details":Ct("toggle",r);break;case"embed":case"source":case"link":Ct("error",r),Ct("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ae in c)if(c.hasOwnProperty(ae)&&(m=c[ae],m!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:an(r,a,ae,m,c,null)}return;default:if(Fr(a)){for(ye in c)c.hasOwnProperty(ye)&&(m=c[ye],m!==void 0&&zy(r,a,ye,m,c,void 0));return}}for(V in c)c.hasOwnProperty(V)&&(m=c[V],m!=null&&an(r,a,V,m,c,null))}function Yk(r,a,c,m){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,S=null,R=null,V=null,J=null,ae=null,ye=null;for(pe in c){var xe=c[pe];if(c.hasOwnProperty(pe)&&xe!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":J=xe;default:m.hasOwnProperty(pe)||an(r,a,pe,null,m,xe)}}for(var ce in m){var pe=m[ce];if(xe=c[ce],m.hasOwnProperty(ce)&&(pe!=null||xe!=null))switch(ce){case"type":S=pe;break;case"name":w=pe;break;case"checked":ae=pe;break;case"defaultChecked":ye=pe;break;case"value":R=pe;break;case"defaultValue":V=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,a));break;default:pe!==xe&&an(r,a,ce,pe,m,xe)}}ua(r,R,V,J,ae,ye,S,w);return;case"select":pe=R=V=ce=null;for(S in c)if(J=c[S],c.hasOwnProperty(S)&&J!=null)switch(S){case"value":break;case"multiple":pe=J;default:m.hasOwnProperty(S)||an(r,a,S,null,m,J)}for(w in m)if(S=m[w],J=c[w],m.hasOwnProperty(w)&&(S!=null||J!=null))switch(w){case"value":ce=S;break;case"defaultValue":V=S;break;case"multiple":R=S;default:S!==J&&an(r,a,w,S,m,J)}a=V,c=R,m=pe,ce!=null?Qt(r,!!c,ce,!1):!!m!=!!c&&(a!=null?Qt(r,!!c,a,!0):Qt(r,!!c,c?[]:"",!1));return;case"textarea":pe=ce=null;for(V in c)if(w=c[V],c.hasOwnProperty(V)&&w!=null&&!m.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:an(r,a,V,null,m,w)}for(R in m)if(w=m[R],S=c[R],m.hasOwnProperty(R)&&(w!=null||S!=null))switch(R){case"value":ce=w;break;case"defaultValue":pe=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(i(91));break;default:w!==S&&an(r,a,R,w,m,S)}Js(r,ce,pe);return;case"option":for(var qe in c)if(ce=c[qe],c.hasOwnProperty(qe)&&ce!=null&&!m.hasOwnProperty(qe))switch(qe){case"selected":r.selected=!1;break;default:an(r,a,qe,null,m,ce)}for(J in m)if(ce=m[J],pe=c[J],m.hasOwnProperty(J)&&ce!==pe&&(ce!=null||pe!=null))switch(J){case"selected":r.selected=ce&&typeof ce!="function"&&typeof ce!="symbol";break;default:an(r,a,J,ce,m,pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nt in c)ce=c[nt],c.hasOwnProperty(nt)&&ce!=null&&!m.hasOwnProperty(nt)&&an(r,a,nt,null,m,ce);for(ae in m)if(ce=m[ae],pe=c[ae],m.hasOwnProperty(ae)&&ce!==pe&&(ce!=null||pe!=null))switch(ae){case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(i(137,a));break;default:an(r,a,ae,ce,m,pe)}return;default:if(Fr(a)){for(var ln in c)ce=c[ln],c.hasOwnProperty(ln)&&ce!==void 0&&!m.hasOwnProperty(ln)&&zy(r,a,ln,void 0,m,ce);for(ye in m)ce=m[ye],pe=c[ye],!m.hasOwnProperty(ye)||ce===pe||ce===void 0&&pe===void 0||zy(r,a,ye,ce,m,pe);return}}for(var ee in c)ce=c[ee],c.hasOwnProperty(ee)&&ce!=null&&!m.hasOwnProperty(ee)&&an(r,a,ee,null,m,ce);for(xe in m)ce=m[xe],pe=c[xe],!m.hasOwnProperty(xe)||ce===pe||ce==null&&pe==null||an(r,a,xe,ce,m,pe)}function pS(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jk(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var w=c[m],S=w.transferSize,R=w.initiatorType,V=w.duration;if(S&&V&&pS(R)){for(R=0,V=w.responseEnd,m+=1;m<c.length;m++){var J=c[m],ae=J.startTime;if(ae>V)break;var ye=J.transferSize,xe=J.initiatorType;ye&&pS(xe)&&(J=J.responseEnd,R+=ye*(J<V?1:(V-ae)/(J-ae)))}if(--m,a+=8*(S+R)/(w.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var qy=null,Gy=null;function Fm(r){return r.nodeType===9?r:r.ownerDocument}function gS(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _S(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Hy(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var jy=null;function Zk(){var r=window.event;return r&&r.type==="popstate"?r===jy?!1:(jy=r,!0):(jy=null,!1)}var yS=typeof setTimeout=="function"?setTimeout:void 0,Qk=typeof clearTimeout=="function"?clearTimeout:void 0,vS=typeof Promise=="function"?Promise:void 0,$k=typeof queueMicrotask=="function"?queueMicrotask:typeof vS<"u"?function(r){return vS.resolve(null).then(r).catch(Xk)}:yS;function Xk(r){setTimeout(function(){throw r})}function Oa(r){return r==="head"}function TS(r,a){var c=a,m=0;do{var w=c.nextSibling;if(r.removeChild(c),w&&w.nodeType===8)if(c=w.data,c==="/$"||c==="/&"){if(m===0){r.removeChild(w),Ic(a);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")mh(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,mh(c);for(var S=c.firstChild;S;){var R=S.nextSibling,V=S.nodeName;S[js]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=R}}else c==="body"&&mh(r.ownerDocument.body);c=w}while(c);Ic(a)}function ES(r,a){var c=r;r=0;do{var m=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=m}while(c)}function Ky(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Ky(c),oa(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function eD(r,a,c,m){for(;r.nodeType===1;){var w=c;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!m&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(m){if(!r[js])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(S=r.getAttribute("rel"),S==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(S!==w.rel||r.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||r.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||r.getAttribute("title")!==(w.title==null?null:w.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(S=r.getAttribute("src"),(S!==(w.src==null?null:w.src)||r.getAttribute("type")!==(w.type==null?null:w.type)||r.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&S&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var S=w.name==null?null:""+w.name;if(w.type==="hidden"&&r.getAttribute("name")===S)return r}else return r;if(r=rr(r.nextSibling),r===null)break}return null}function tD(r,a,c){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=rr(r.nextSibling),r===null))return null;return r}function xS(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=rr(r.nextSibling),r===null))return null;return r}function Wy(r){return r.data==="$?"||r.data==="$~"}function Yy(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function nD(r,a){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||c.readyState!=="loading")a();else{var m=function(){a(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),r._reactRetry=m}}function rr(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var Jy=null;function wS(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(a===0)return rr(r.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}r=r.nextSibling}return null}function SS(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return r;a--}else c!=="/$"&&c!=="/&"||a++}r=r.previousSibling}return null}function CS(r,a,c){switch(a=Fm(c),r){case"html":if(r=a.documentElement,!r)throw Error(i(452));return r;case"head":if(r=a.head,!r)throw Error(i(453));return r;case"body":if(r=a.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function mh(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);oa(r)}var or=new Map,bS=new Set;function Bm(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Vo=Ce.d;Ce.d={f:iD,r:sD,D:rD,C:oD,L:aD,m:lD,X:cD,S:uD,M:dD};function iD(){var r=Vo.f(),a=Mm();return r||a}function sD(r){var a=Xi(r);a!==null&&a.tag===5&&a.type==="form"?Gx(a):Vo.r(r)}var Sc=typeof document>"u"?null:document;function IS(r,a,c){var m=Sc;if(m&&typeof a=="string"&&a){var w=cn(a);w='link[rel="'+r+'"][href="'+w+'"]',typeof c=="string"&&(w+='[crossorigin="'+c+'"]'),bS.has(w)||(bS.add(w),r={rel:r,crossOrigin:c,href:a},m.querySelector(w)===null&&(a=m.createElement("link"),xi(a,"link",r),Pn(a),m.head.appendChild(a)))}}function rD(r){Vo.D(r),IS("dns-prefetch",r,null)}function oD(r,a){Vo.C(r,a),IS("preconnect",r,a)}function aD(r,a,c){Vo.L(r,a,c);var m=Sc;if(m&&r&&a){var w='link[rel="preload"][as="'+cn(a)+'"]';a==="image"&&c&&c.imageSrcSet?(w+='[imagesrcset="'+cn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(w+='[imagesizes="'+cn(c.imageSizes)+'"]')):w+='[href="'+cn(r)+'"]';var S=w;switch(a){case"style":S=Cc(r);break;case"script":S=bc(r)}or.has(S)||(r=x({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:r,as:a},c),or.set(S,r),m.querySelector(w)!==null||a==="style"&&m.querySelector(ph(S))||a==="script"&&m.querySelector(gh(S))||(a=m.createElement("link"),xi(a,"link",r),Pn(a),m.head.appendChild(a)))}}function lD(r,a){Vo.m(r,a);var c=Sc;if(c&&r){var m=a&&typeof a.as=="string"?a.as:"script",w='link[rel="modulepreload"][as="'+cn(m)+'"][href="'+cn(r)+'"]',S=w;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=bc(r)}if(!or.has(S)&&(r=x({rel:"modulepreload",href:r},a),or.set(S,r),c.querySelector(w)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(gh(S)))return}m=c.createElement("link"),xi(m,"link",r),Pn(m),c.head.appendChild(m)}}}function uD(r,a,c){Vo.S(r,a,c);var m=Sc;if(m&&r){var w=Ks(m).hoistableStyles,S=Cc(r);a=a||"default";var R=w.get(S);if(!R){var V={loading:0,preload:null};if(R=m.querySelector(ph(S)))V.loading=5;else{r=x({rel:"stylesheet",href:r,"data-precedence":a},c),(c=or.get(S))&&Zy(r,c);var J=R=m.createElement("link");Pn(J),xi(J,"link",r),J._p=new Promise(function(ae,ye){J.onload=ae,J.onerror=ye}),J.addEventListener("load",function(){V.loading|=1}),J.addEventListener("error",function(){V.loading|=2}),V.loading|=4,zm(R,a,m)}R={type:"stylesheet",instance:R,count:1,state:V},w.set(S,R)}}}function cD(r,a){Vo.X(r,a);var c=Sc;if(c&&r){var m=Ks(c).hoistableScripts,w=bc(r),S=m.get(w);S||(S=c.querySelector(gh(w)),S||(r=x({src:r,async:!0},a),(a=or.get(w))&&Qy(r,a),S=c.createElement("script"),Pn(S),xi(S,"link",r),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(w,S))}}function dD(r,a){Vo.M(r,a);var c=Sc;if(c&&r){var m=Ks(c).hoistableScripts,w=bc(r),S=m.get(w);S||(S=c.querySelector(gh(w)),S||(r=x({src:r,async:!0,type:"module"},a),(a=or.get(w))&&Qy(r,a),S=c.createElement("script"),Pn(S),xi(S,"link",r),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},m.set(w,S))}}function AS(r,a,c,m){var w=(w=we.current)?Bm(w):null;if(!w)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=Cc(c.href),c=Ks(w).hoistableStyles,m=c.get(a),m||(m={type:"style",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=Cc(c.href);var S=Ks(w).hoistableStyles,R=S.get(r);if(R||(w=w.ownerDocument||w,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(r,R),(S=w.querySelector(ph(r)))&&!S._p&&(R.instance=S,R.state.loading=5),or.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},or.set(r,c),S||hD(w,r,c,R.state))),a&&m===null)throw Error(i(528,""));return R}if(a&&m!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=bc(c),c=Ks(w).hoistableScripts,m=c.get(a),m||(m={type:"script",instance:null,count:0,state:null},c.set(a,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Cc(r){return'href="'+cn(r)+'"'}function ph(r){return'link[rel="stylesheet"]['+r+"]"}function NS(r){return x({},r,{"data-precedence":r.precedence,precedence:null})}function hD(r,a,c,m){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?m.loading=1:(a=r.createElement("link"),m.preload=a,a.addEventListener("load",function(){return m.loading|=1}),a.addEventListener("error",function(){return m.loading|=2}),xi(a,"link",c),Pn(a),r.head.appendChild(a))}function bc(r){return'[src="'+cn(r)+'"]'}function gh(r){return"script[async]"+r}function RS(r,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var m=r.querySelector('style[data-href~="'+cn(c.href)+'"]');if(m)return a.instance=m,Pn(m),m;var w=x({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(r.ownerDocument||r).createElement("style"),Pn(m),xi(m,"style",w),zm(m,c.precedence,r),a.instance=m;case"stylesheet":w=Cc(c.href);var S=r.querySelector(ph(w));if(S)return a.state.loading|=4,a.instance=S,Pn(S),S;m=NS(c),(w=or.get(w))&&Zy(m,w),S=(r.ownerDocument||r).createElement("link"),Pn(S);var R=S;return R._p=new Promise(function(V,J){R.onload=V,R.onerror=J}),xi(S,"link",m),a.state.loading|=4,zm(S,c.precedence,r),a.instance=S;case"script":return S=bc(c.src),(w=r.querySelector(gh(S)))?(a.instance=w,Pn(w),w):(m=c,(w=or.get(S))&&(m=x({},c),Qy(m,w)),r=r.ownerDocument||r,w=r.createElement("script"),Pn(w),xi(w,"link",m),r.head.appendChild(w),a.instance=w);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(m=a.instance,a.state.loading|=4,zm(m,c.precedence,r));return a.instance}function zm(r,a,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=m.length?m[m.length-1]:null,S=w,R=0;R<m.length;R++){var V=m[R];if(V.dataset.precedence===a)S=V;else if(S!==w)break}S?S.parentNode.insertBefore(r,S.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(r,a.firstChild))}function Zy(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Qy(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var qm=null;function MS(r,a,c){if(qm===null){var m=new Map,w=qm=new Map;w.set(c,m)}else w=qm,m=w.get(c),m||(m=new Map,w.set(c,m));if(m.has(r))return m;for(m.set(r,null),c=c.getElementsByTagName(r),w=0;w<c.length;w++){var S=c[w];if(!(S[js]||S[bn]||r==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var R=S.getAttribute(a)||"";R=r+R;var V=m.get(R);V?V.push(S):m.set(R,[S])}}return m}function PS(r,a,c){r=r.ownerDocument||r,r.head.insertBefore(c,a==="title"?r.querySelector("head > title"):null)}function fD(r,a,c){if(c===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function kS(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function mD(r,a,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=Cc(m.href),S=a.querySelector(ph(w));if(S){a=S._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=Gm.bind(r),a.then(r,r)),c.state.loading|=4,c.instance=S,Pn(S);return}S=a.ownerDocument||a,m=NS(m),(w=or.get(w))&&Zy(m,w),S=S.createElement("link"),Pn(S);var R=S;R._p=new Promise(function(V,J){R.onload=V,R.onerror=J}),xi(S,"link",m),c.instance=S}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=Gm.bind(r),a.addEventListener("load",c),a.addEventListener("error",c))}}var $y=0;function pD(r,a){return r.stylesheets&&r.count===0&&jm(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var m=setTimeout(function(){if(r.stylesheets&&jm(r,r.stylesheets),r.unsuspend){var S=r.unsuspend;r.unsuspend=null,S()}},6e4+a);0<r.imgBytes&&$y===0&&($y=62500*Jk());var w=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&jm(r,r.stylesheets),r.unsuspend)){var S=r.unsuspend;r.unsuspend=null,S()}},(r.imgBytes>$y?50:800)+a);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(m),clearTimeout(w)}}:null}function Gm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)jm(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Hm=null;function jm(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Hm=new Map,a.forEach(gD,r),Hm=null,Gm.call(r))}function gD(r,a){if(!(a.state.loading&4)){var c=Hm.get(r);if(c)var m=c.get(null);else{c=new Map,Hm.set(r,c);for(var w=r.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<w.length;S++){var R=w[S];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),m=R)}m&&c.set(null,m)}w=a.instance,R=w.getAttribute("data-precedence"),S=c.get(R)||m,S===m&&c.set(null,w),c.set(R,w),this.count++,m=Gm.bind(this),w.addEventListener("load",m),w.addEventListener("error",m),S?S.parentNode.insertBefore(w,S.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(w,r.firstChild)),a.state.loading|=4}}var _h={$$typeof:Q,Provider:null,Consumer:null,_currentValue:be,_currentValue2:be,_threadCount:0};function _D(r,a,c,m,w,S,R,V,J){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hs(0),this.hiddenUpdates=Hs(null),this.identifierPrefix=m,this.onUncaughtError=w,this.onCaughtError=S,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=J,this.incompleteTransitions=new Map}function DS(r,a,c,m,w,S,R,V,J,ae,ye,xe){return r=new _D(r,a,c,R,J,ae,ye,xe,V),a=1,S===!0&&(a|=24),S=Ni(3,null,null,a),r.current=S,S.stateNode=r,a=M_(),a.refCount++,r.pooledCache=a,a.refCount++,S.memoizedState={element:m,isDehydrated:c,cache:a},L_(S),r}function LS(r){return r?(r=xo,r):xo}function VS(r,a,c,m,w,S){w=LS(w),m.context===null?m.context=w:m.pendingContext=w,m=ba(a),m.payload={element:c},S=S===void 0?null:S,S!==null&&(m.callback=S),c=Ia(r,m,a),c!==null&&(fs(c,r,a),Jd(c,r,a))}function OS(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<a?c:a}}function Xy(r,a){OS(r,a),(r=r.alternate)&&OS(r,a)}function US(r){if(r.tag===13||r.tag===31){var a=nr(r,67108864);a!==null&&fs(a,r,67108864),Xy(r,67108864)}}function FS(r){if(r.tag===13||r.tag===31){var a=Os();a=oi(a);var c=nr(r,a);c!==null&&fs(c,r,a),Xy(r,a)}}var Km=!0;function yD(r,a,c,m){var w=se.T;se.T=null;var S=Ce.p;try{Ce.p=2,ev(r,a,c,m)}finally{Ce.p=S,se.T=w}}function vD(r,a,c,m){var w=se.T;se.T=null;var S=Ce.p;try{Ce.p=8,ev(r,a,c,m)}finally{Ce.p=S,se.T=w}}function ev(r,a,c,m){if(Km){var w=tv(m);if(w===null)By(r,a,m,Wm,c),zS(r,m);else if(ED(w,r,a,c,m))m.stopPropagation();else if(zS(r,m),a&4&&-1<TD.indexOf(r)){for(;w!==null;){var S=Xi(w);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var R=Bi(S.pendingLanes);if(R!==0){var V=S;for(V.pendingLanes|=2,V.entangledLanes|=2;R;){var J=1<<31-dt(R);V.entanglements[1]|=J,R&=~J}eo(S),(jt&6)===0&&(Nm=lt()+500,dh(0))}}break;case 31:case 13:V=nr(S,2),V!==null&&fs(V,S,2),Mm(),Xy(S,2)}if(S=tv(m),S===null&&By(r,a,m,Wm,c),S===w)break;w=S}w!==null&&m.stopPropagation()}else By(r,a,m,null,c)}}function tv(r){return r=Ci(r),nv(r)}var Wm=null;function nv(r){if(Wm=null,r=Ss(r),r!==null){var a=o(r);if(a===null)r=null;else{var c=a.tag;if(c===13){if(r=l(a),r!==null)return r;r=null}else if(c===31){if(r=d(a),r!==null)return r;r=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return Wm=r,null}function BS(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(un()){case ri:return 2;case Ji:return 8;case pn:case Ts:return 32;case Vr:return 268435456;default:return 32}default:return 32}}var iv=!1,Ua=null,Fa=null,Ba=null,yh=new Map,vh=new Map,za=[],TD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zS(r,a){switch(r){case"focusin":case"focusout":Ua=null;break;case"dragenter":case"dragleave":Fa=null;break;case"mouseover":case"mouseout":Ba=null;break;case"pointerover":case"pointerout":yh.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":vh.delete(a.pointerId)}}function Th(r,a,c,m,w,S){return r===null||r.nativeEvent!==S?(r={blockedOn:a,domEventName:c,eventSystemFlags:m,nativeEvent:S,targetContainers:[w]},a!==null&&(a=Xi(a),a!==null&&US(a)),r):(r.eventSystemFlags|=m,a=r.targetContainers,w!==null&&a.indexOf(w)===-1&&a.push(w),r)}function ED(r,a,c,m,w){switch(a){case"focusin":return Ua=Th(Ua,r,a,c,m,w),!0;case"dragenter":return Fa=Th(Fa,r,a,c,m,w),!0;case"mouseover":return Ba=Th(Ba,r,a,c,m,w),!0;case"pointerover":var S=w.pointerId;return yh.set(S,Th(yh.get(S)||null,r,a,c,m,w)),!0;case"gotpointercapture":return S=w.pointerId,vh.set(S,Th(vh.get(S)||null,r,a,c,m,w)),!0}return!1}function qS(r){var a=Ss(r.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){r.blockedOn=a,Qi(r.priority,function(){FS(c)});return}}else if(a===31){if(a=d(c),a!==null){r.blockedOn=a,Qi(r.priority,function(){FS(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Ym(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var c=tv(r.nativeEvent);if(c===null){c=r.nativeEvent;var m=new c.constructor(c.type,c);da=m,c.target.dispatchEvent(m),da=null}else return a=Xi(c),a!==null&&US(a),r.blockedOn=c,!1;a.shift()}return!0}function GS(r,a,c){Ym(r)&&c.delete(a)}function xD(){iv=!1,Ua!==null&&Ym(Ua)&&(Ua=null),Fa!==null&&Ym(Fa)&&(Fa=null),Ba!==null&&Ym(Ba)&&(Ba=null),yh.forEach(GS),vh.forEach(GS)}function Jm(r,a){r.blockedOn===a&&(r.blockedOn=null,iv||(iv=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,xD)))}var Zm=null;function HS(r){Zm!==r&&(Zm=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Zm===r&&(Zm=null);for(var a=0;a<r.length;a+=3){var c=r[a],m=r[a+1],w=r[a+2];if(typeof m!="function"){if(nv(m||c)===null)continue;break}var S=Xi(c);S!==null&&(r.splice(a,3),a-=3,ty(S,{pending:!0,data:w,method:c.method,action:m},m,w))}}))}function Ic(r){function a(J){return Jm(J,r)}Ua!==null&&Jm(Ua,r),Fa!==null&&Jm(Fa,r),Ba!==null&&Jm(Ba,r),yh.forEach(a),vh.forEach(a);for(var c=0;c<za.length;c++){var m=za[c];m.blockedOn===r&&(m.blockedOn=null)}for(;0<za.length&&(c=za[0],c.blockedOn===null);)qS(c),c.blockedOn===null&&za.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var w=c[m],S=c[m+1],R=w[Mn]||null;if(typeof S=="function")R||HS(c);else if(R){var V=null;if(S&&S.hasAttribute("formAction")){if(w=S,R=S[Mn]||null)V=R.formAction;else if(nv(w)!==null)continue}else V=R.action;typeof V=="function"?c[m+1]=V:(c.splice(m,3),m-=3),HS(c)}}}function jS(){function r(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(R){return w=R})},focusReset:"manual",scroll:"manual"})}function a(){w!==null&&(w(),w=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,w=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),w!==null&&(w(),w=null)}}}function sv(r){this._internalRoot=r}Qm.prototype.render=sv.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,m=Os();VS(c,m,r,a,null,null)},Qm.prototype.unmount=sv.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;VS(r.current,2,null,r,null,null),Mm(),a[xs]=null}};function Qm(r){this._internalRoot=r}Qm.prototype.unstable_scheduleHydration=function(r){if(r){var a=Sl();r={blockedOn:null,target:r,priority:a};for(var c=0;c<za.length&&a!==0&&a<za[c].priority;c++);za.splice(c,0,r),c===0&&qS(r)}};var KS=e.version;if(KS!=="19.2.0")throw Error(i(527,KS,"19.2.0"));Ce.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=p(a),r=r!==null?T(r):null,r=r===null?null:r.stateNode,r};var wD={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:se,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$m.isDisabled&&$m.supportsFiber)try{vi=$m.inject(wD),Ne=$m}catch{}}return xh.createRoot=function(r,a){if(!s(r))throw Error(i(299));var c=!1,m="",w=Xx,S=ew,R=tw;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onUncaughtError!==void 0&&(w=a.onUncaughtError),a.onCaughtError!==void 0&&(S=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError)),a=DS(r,1,!1,null,null,c,m,null,w,S,R,jS),r[xs]=a.current,Fy(r),new sv(a)},xh.hydrateRoot=function(r,a,c){if(!s(r))throw Error(i(299));var m=!1,w="",S=Xx,R=ew,V=tw,J=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(V=c.onRecoverableError),c.formState!==void 0&&(J=c.formState)),a=DS(r,1,!0,a,c??null,m,w,J,S,R,V,jS),a.context=LS(null),c=a.current,m=Os(),m=oi(m),w=ba(m),w.callback=null,Ia(c,w,m),c=m,a.current.lanes=c,cr(a,c),eo(a),r[xs]=a.current,Fy(r),new Qm(a)},xh.version="19.2.0",xh}var nC;function PD(){if(nC)return av.exports;nC=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),av.exports=MD(),av.exports}var kD=PD();const DD=Y0(kD);var ot=(n=>(n.HOME="HOME",n.ADD_TRIP="ADD_TRIP",n.TRIP_DETAILS="TRIP_DETAILS",n.SETTINGS="SETTINGS",n.MAGIC_EDITOR="MAGIC_EDITOR",n.AI_PLANNER="AI_PLANNER",n.TOOLS="TOOLS",n.TRIP_MEMORY="TRIP_MEMORY",n))(ot||{});const iC=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})}),LD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),VD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),Sg=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),Xa=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"})}),Xc=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:[_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"})]}),Lv=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:[_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})]}),vs=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})}),Vv=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})}),OD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),E1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",className:n,children:_.jsx("path",{d:"M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5Z"})}),x1=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:[_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 0 1 9 14.437V9.564Z"})]}),w1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z"})}),S1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})}),UD=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",className:n,children:[_.jsx("path",{d:"M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.85 7h10.29l1.08 3.11H5.77L6.85 7zM19 17H5v-5h14v5z"}),_.jsx("circle",{cx:"7.5",cy:"14.5",r:"1.5"}),_.jsx("circle",{cx:"16.5",cy:"14.5",r:"1.5"})]}),sC=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"})}),Z0=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 0 0 2.25-2.25V6a2.25 2.25 0 0 0-2.25-2.25H6A2.25 2.25 0 0 0 3.75 6v2.25A2.25 2.25 0 0 0 6 10.5Zm0 9.75h2.25A2.25 2.25 0 0 0 10.5 18v-2.25a2.25 2.25 0 0 0-2.25-2.25H6a2.25 2.25 0 0 0-2.25 2.25V18A2.25 2.25 0 0 0 6 20.25Zm9.75-9.75H18a2.25 2.25 0 0 0 2.25-2.25V6A2.25 2.25 0 0 0 18 3.75h-2.25A2.25 2.25 0 0 0 13.5 6v2.25a2.25 2.25 0 0 0 2.25 2.25Z"})}),al=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),FD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 .06-.312m-2.24 2.39a4.493 4.493 0 0 0-1.757 4.306 4.493 4.493 0 0 0 4.306-1.758M16.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"})}),BD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15a4.5 4.5 0 0 0 4.5 4.5H18a3.75 3.75 0 0 0 1.332-7.257 3 3 0 0 0-3.758-3.848 5.25 5.25 0 0 0-10.233 2.33A4.502 4.502 0 0 0 2.25 15Z"})}),C1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),zD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"})}),Ov=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-1.94c.955-.13 1.93-.32 2.795-.591 3.615-1.133 4.705-4.884 2.636-7.962-1.373-2.042-3.738-3.257-6.236-3.257-4.14 0-7.5 3.36-7.5 7.5 0 2.053.84 3.942 2.22 5.297.808.796 1.83 1.344 2.923 1.564V18m2.25 0h-4.5m4.5 0a2.25 2.25 0 0 1-2.25 2.25h-1.5A2.25 2.25 0 0 1 7.5 18m9-9h.008v.008H16.5V9Zm-4.5 0h.008v.008H12V9Zm-4.5 0h.008v.008H7.5V9Z"})}),qD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.125 2.25h3.375c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125h-3.375c-.621 0-1.125-.504-1.125-1.125v-1.5c0-.621.504-1.125 1.125-1.125Zm-3 7.5h10.5a.75.75 0 0 1 .75.75v3.375a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V10.5a.75.75 0 0 1 .75-.75Zm9.375 12a1.125 1.125 0 1 0 0-2.25 1.125 1.125 0 0 0 0 2.25Z"})}),GD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})}),rC=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6 0 3.375 3.375 0 0 1 6 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"})}),b1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 17.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),HD=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:[_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l-.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z"}),_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),jD=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:[_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}),_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})]}),KD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})}),I1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),A1=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),WD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 016-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.785.147 2.666.257m-4.589 8.495a18.023 18.023 0 01-3.827-5.802"})}),YD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})}),oC=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3m3-3v3M9 3.75V5.25m3-1.5h3m-3 0v1.5m0-1.5h-3m3 0v1.5M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"})}),JD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",className:n,children:_.jsx("path",{d:"M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4S4 2.5 4 6v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H6V6h12v5z"})}),ZD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",className:n,children:_.jsx("path",{d:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7"})}),QD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})}),$D=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"})}),XD=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})}),e5=({className:n})=>_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:n,children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})}),nn={"zh-TW":{back:"",cancel:"",confirm:"",save:"",delete:"",edit:"",loading:"...",day:"Day",my_trips:"",start_adventure:"",click_to_add:"",trips_count:"",new_trip:"",trip_destination_title:" / ",cover_photo:"",upload_photo:"",ai_generate_cover:"AI ",start_date:"",end_date:"",create_trip:"",add_trip_hint:"",itinerary:"",map:"",budget:"",bookings:"",shopping_list:"",shopping:"",origin:"",label_destination:"",status_confirmed:"",status_pending:"",status_cancelled:"",ai_guide:"AI ",add_activity:"",edit_activity:"",add_expense:"",add_booking:"",weather:"",nav_quick_jump:"",no_itinerary:"",no_bookings:"",click_add:"",delete_trip_title:"",delete_trip_confirm:"{title}",confirm_delete:"",activity_name:"",time:"",location:"",notes:" ()",duration:"",details:"",placeholder_duration:"15 ",placeholder_details:"JR ",ai_route:"AI ",optimize_route:"AI ",expense_item:"",amount:"",payer:"",payment_method:"",booking_type:"",provider:" / ",booking_ref:" ()",ai_planner_title:"AI ",ai_planner_intro:" AI ",ai_planning:" 10-20 ",ai_done:"",input_placeholder:"...",planning_process:"...",magic_editor_title:"",upload_hint:"",magic_prompt_placeholder:"...",start_magic:"",generating:"...",settings_title:"",general:"",language:"",appearance:"",minimalist_mode:"",minimalist_desc:"",data_mgmt:"",reset_all:"",reset_confirm:"",tools_title:"",tool_emergency:"",tool_card:"",tool_map:"",tool_restroom:"",tool_visa:"",tool_translation:"",tool_culture:"",api_settings:"API ",api_key_label:"Gemini API Key",api_key_placeholder:" API Key",api_key_help:" Key ",api_key_saved:"API Key ",theme_color:"",payer_me:"",payer_other:"",payment_cash:"",payment_card:"",split_individual:"",split_shared:"",translate_to:"",enter_text:"...",translate_result:"",desc_translator:"AI ",desc_emergency:" / ",desc_card:"",desc_map:"",desc_restroom:"",desc_visa:"",desc_culture:"",prompt_tokyo:"",prompt_bangkok:"",prompt_paris:"",placeholder_item:"",placeholder_payer:"",lang_ja:"",lang_en:"",lang_zh:"",lang_ko:"",lang_th:"",lang_fr:"",lang_es:"",share_trip:"",share_success:"",travel_time:"",travel_mode:"",travel_details:" ( JR )",mode_walk:"",mode_train:"/",mode_bus:"/",mode_car:"/",mode_flight:"",minutes:"",search_placeholder:" (: )",search_location:""},"en-US":{back:"Back",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",loading:"Loading...",day:"Day",my_trips:"My Trips",start_adventure:"Start New Adventure",click_to_add:"Click button below to add trip",trips_count:"items",new_trip:"New Trip",trip_destination_title:"Destination / Title",cover_photo:"Cover Photo",upload_photo:"Upload",ai_generate_cover:"AI Generate",start_date:"Start Date",end_date:"End Date",create_trip:"Create Trip",add_trip_hint:"You can add detailed itinerary later",itinerary:"Itinerary",map:"Map",budget:"Budget",shopping_list:"Shopping List",shopping:"Shopping",bookings:"Bookings",origin:"Origin",label_destination:"Destination",status_confirmed:"Confirmed",status_pending:"Pending",status_cancelled:"Cancelled",ai_guide:"AI Guide",add_activity:"Add Activity",edit_activity:"Edit Activity",add_expense:"Add Expense",add_booking:"Add Booking",weather:"Weather",nav_quick_jump:"Jump to",no_itinerary:"No itinerary yet",no_bookings:"No bookings yet",click_add:"Click button to add",delete_trip_title:"Delete Trip?",delete_trip_confirm:'Are you sure you want to delete "{title}"? This cannot be undone.',confirm_delete:"Delete",activity_name:"Activity Name",time:"Time",location:"Location",notes:"Notes (Optional)",duration:"Duration",details:"Details",placeholder_duration:"e.g. 15 min",placeholder_details:"e.g. JR Line",ai_route:"AI Route",optimize_route:"AI Route Optimization",expense_item:"Item Name",amount:"Amount",payer:"Payer",payment_method:"Method",booking_type:"Type",provider:"Provider / Name",booking_ref:"Ref Number (Optional)",ai_planner_title:"AI Planner",ai_planner_intro:"Hi! I am your AI travel assistant. Where do you want to go?",ai_planning:"Sure! I am planning your trip. This takes about 10-20 seconds.",ai_done:"Planning complete! Check your trip list. ",input_placeholder:"Enter your travel ideas...",planning_process:"Processing...",magic_editor_title:"Magic Editor",upload_hint:"Upload Photo",magic_prompt_placeholder:"Make it sunny, add balloons...",start_magic:"Generate",generating:"Processing...",settings_title:"Settings",api_settings:"API Settings",api_key_label:"Gemini API Key",api_key_placeholder:"Paste your API Key here",api_key_help:"Your key is stored locally in your browser.",api_key_saved:"API Key Saved",general:"General",language:"Language",appearance:"Appearance",minimalist_mode:"Minimalist Mode",minimalist_desc:"Hide images, focus on text",data_mgmt:"Data Management",reset_all:"Reset All Data",reset_confirm:"Are you sure? This will delete all trips and settings. This cannot be undone.",tools_title:"Tools",tool_emergency:"Emergency",tool_card:"Card Tips",tool_map:"Scratch Map",tool_restroom:"Restroom",tool_visa:"Visa Check",tool_culture:"Culture",share_trip:"Share Trip",share_success:"Copied to clipboard!",travel_time:"Travel Time",travel_mode:"Travel Mode",travel_details:"Details (e.g. JR Line)",mode_walk:"Walk",mode_train:"Train/Subway",mode_bus:"Bus",mode_car:"Car/Taxi",mode_flight:"Flight",minutes:"min",search_placeholder:"Search location (e.g. Tokyo Tower)",search_location:"Search"},"ja-JP":{back:"",cancel:"",confirm:"",save:"",delete:"",edit:"",loading:"...",day:"Day",my_trips:"",start_adventure:"",click_to_add:"",trips_count:"",new_trip:"",trip_destination_title:" / ",cover_photo:"",upload_photo:"",ai_generate_cover:"AI",start_date:"",end_date:"",create_trip:"",add_trip_hint:"",itinerary:"",map:"",budget:"",shopping_list:"",shopping:"",bookings:"",origin:"",label_destination:"",status_confirmed:"",status_pending:"",status_cancelled:"",ai_guide:"AI",add_activity:"",edit_activity:"",add_expense:"",add_booking:"",weather:"",nav_quick_jump:"",no_itinerary:"",no_bookings:"",click_add:"",delete_trip_title:"",delete_trip_confirm:"{title}",confirm_delete:"",activity_name:"",time:"",location:"",notes:" ()",duration:"",details:"",placeholder_duration:"15",placeholder_details:"JR",ai_route:"AI",optimize_route:"AI",expense_item:"",amount:"",payer:"",payment_method:"",booking_type:"",provider:" / ",booking_ref:" ()",ai_planner_title:"AI",ai_planner_intro:"AI",ai_planning:"1020",ai_done:"",input_placeholder:"...",planning_process:"...",magic_editor_title:"",upload_hint:"",magic_prompt_placeholder:"...",start_magic:"",generating:"...",settings_title:"",general:"",language:"",appearance:"",minimalist_mode:"",minimalist_desc:"",data_mgmt:"",reset_all:"",reset_confirm:"",tools_title:"",tool_emergency:"",tool_card:"",tool_map:"",tool_restroom:"",tool_visa:"",tool_culture:"",share_trip:"",share_success:"",travel_time:"",travel_mode:"",travel_details:" (: JR)",mode_walk:"",mode_train:"/",mode_bus:"",mode_car:"/",mode_flight:"",minutes:"",search_placeholder:" (: )",search_location:""}},t5=({trips:n,onSelectTrip:e,onAddTrip:t,onOpenSettings:i,settings:s})=>{const[o,l]=Z.useState(new Set),[d,h]=Z.useState(new Set),p=nn[s.language]||nn["zh-TW"],T=x=>{l(C=>{const A=new Set(C);return A.add(x),A})};return _.jsxs("div",{className:"flex flex-col h-full bg-paper pt-safe",children:[_.jsxs("div",{className:"px-6 py-5 sticky top-0 z-10 flex justify-between items-center bg-paper/90 backdrop-blur-sm",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-14 h-14 flex items-center justify-center overflow-hidden",children:_.jsx("img",{src:"/nomadai-travel-journal_app_icon.png",alt:"Icon",className:"w-full h-full object-cover"})}),_.jsx("h1",{className:"text-3xl font-extrabold text-ink tracking-tight",children:p.my_trips})]}),_.jsx("button",{onClick:i,className:"p-2.5 bg-white shadow-card rounded-full text-gray-400 hover:text-coral transition-colors active:scale-95",children:_.jsx(HD,{className:"w-6 h-6"})})]}),_.jsx("div",{className:"flex-1 overflow-y-auto px-5 py-2 space-y-6 pb-32 no-scrollbar",children:n.length===0?_.jsxs("div",{className:"flex flex-col items-center justify-center h-80 text-center animate-fade-in border-2 border-dashed border-sand rounded-3xl m-4",children:[_.jsx("div",{className:"w-16 h-16 bg-white shadow-soft rounded-full flex items-center justify-center mb-4 text-coral",children:_.jsx(Lv,{className:"w-8 h-8"})}),_.jsx("h3",{className:"text-xl font-bold text-ink mb-1",children:p.start_adventure}),_.jsx("p",{className:"text-gray-400 text-sm",children:p.click_to_add})]}):n==null?void 0:n.map(x=>{var C;return _.jsxs("div",{onClick:()=>e(x),className:`group cursor-pointer active:scale-[0.98] transition-all transform bg-white rounded-3xl shadow-card hover:shadow-soft overflow-hidden ${s.minimalistMode?"p-5 border border-sand":"p-3"}`,children:[!s.minimalistMode&&_.jsxs("div",{className:"aspect-[2/1] w-full relative overflow-hidden rounded-2xl bg-gray-100 mb-4 shadow-inner group",children:[x.coverImage&&!o.has(x.id)?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:`absolute inset-0 bg-gray-200 transition-opacity duration-500 ${d.has(x.id)?"opacity-0 pointer-events-none":"opacity-100"}`}),_.jsx("img",{src:x.coverImage,alt:x.title,onLoad:()=>h(A=>new Set(A).add(x.id)),onError:()=>T(x.id),className:`w-full h-full object-cover transition-all duration-700 ${d.has(x.id)?"opacity-100 group-hover:scale-105":"opacity-0"}`})]}):_.jsx("div",{className:"w-full h-full bg-sand/30 flex items-center justify-center",children:_.jsx(Lv,{className:"w-12 h-12 text-gray-300"})}),_.jsxs("div",{className:"absolute top-3 right-3 bg-white/90 backdrop-blur text-ink text-xs font-bold px-3 py-1.5 rounded-full shadow-sm z-10",children:[((C=x.itinerary)==null?void 0:C.length)||0," ",p.trips_count]})]}),_.jsxs("div",{className:`${s.minimalistMode?"flex justify-between items-center":"px-2 pb-2"}`,children:[_.jsxs("div",{children:[_.jsx("h3",{className:`font-bold text-ink leading-tight ${s.minimalistMode?"text-lg":"text-xl mb-1"}`,children:x.title}),_.jsxs("div",{className:"flex items-center text-sm text-gray-400 font-medium",children:[_.jsx(Vv,{className:"w-4 h-4 mr-1.5 text-coral"}),_.jsxs("span",{children:[x.startDate," - ",x.endDate]})]})]}),s.minimalistMode&&_.jsx("div",{className:"w-8 h-8 bg-paper rounded-full flex items-center justify-center text-coral",children:_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-4 h-4",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})})})]})]},x.id)})}),_.jsx("button",{onClick:t,className:"fixed bottom-28 right-6 w-16 h-16 bg-coral text-white rounded-full shadow-float flex items-center justify-center transition-all active:scale-90 hover:bg-coralDark z-50 ring-4 ring-white",children:_.jsx(Sg,{className:"w-8 h-8 stroke-[2]"})})]})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let n5,i5;function s5(){return{geminiUrl:n5,vertexUrl:i5}}function r5(n,e,t,i){var s,o;if(!(n!=null&&n.baseUrl)){const l=s5();return e?(s=l.vertexUrl)!==null&&s!==void 0?s:t:(o=l.geminiUrl)!==null&&o!==void 0?o:i}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ea{}function Oe(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];return o!=null?String(o):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function y(n,e,t){for(let o=0;o<e.length-1;o++){const l=e[o];if(l.endsWith("[]")){const d=l.slice(0,-2);if(!(d in n))if(Array.isArray(t))n[d]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[d])){const h=n[d];if(Array.isArray(t))for(let p=0;p<h.length;p++){const T=h[p];y(T,e.slice(o+1),t[p])}else for(const p of h)y(p,e.slice(o+1),t)}return}else if(l.endsWith("[0]")){const d=l.slice(0,-3);d in n||(n[d]=[{}]);const h=n[d];y(h[0],e.slice(o+1),t);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const i=e[e.length-1],s=n[i];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function g(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;const s=e[i];if(s.endsWith("[]")){const o=s.slice(0,-2);if(o in n){const l=n[o];return Array.isArray(l)?l.map(d=>g(d,e.slice(i+1),t)):t}else return t}else n=n[s]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function o5(n,e){for(const[t,i]of Object.entries(e)){const s=t.split("."),o=i.split("."),l=new Set;let d=-1;for(let h=0;h<s.length;h++)if(s[h]==="*"){d=h;break}if(d!==-1&&o.length>d)for(let h=d;h<o.length;h++){const p=o[h];p!=="*"&&!p.endsWith("[]")&&!p.endsWith("[0]")&&l.add(p)}Uv(n,s,o,0,l)}}function Uv(n,e,t,i,s){if(i>=e.length||typeof n!="object"||n===null)return;const o=e[i];if(o.endsWith("[]")){const l=o.slice(0,-2),d=n;if(l in d&&Array.isArray(d[l]))for(const h of d[l])Uv(h,e,t,i+1,s)}else if(o==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const l=n,d=Object.keys(l).filter(p=>!p.startsWith("_")&&!s.has(p)),h={};for(const p of d)h[p]=l[p];for(const[p,T]of Object.entries(h)){const x=[];for(const C of t.slice(i))C==="*"?x.push(p):x.push(C);y(l,x,T)}for(const p of d)delete l[p]}}else{const l=n;o in l&&Uv(l[o],e,t,i+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Q0(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function a5(n){const e={},t=g(n,["operationName"]);t!=null&&y(e,["operationName"],t);const i=g(n,["resourceName"]);return i!=null&&y(e,["_url","resourceName"],i),e}function l5(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response","generateVideoResponse"]);return l!=null&&y(e,["response"],c5(l)),e}function u5(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response"]);return l!=null&&y(e,["response"],d5(l)),e}function c5(n){const e={},t=g(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>h5(l))),y(e,["generatedVideos"],o)}const i=g(n,["raiMediaFilteredCount"]);i!=null&&y(e,["raiMediaFilteredCount"],i);const s=g(n,["raiMediaFilteredReasons"]);return s!=null&&y(e,["raiMediaFilteredReasons"],s),e}function d5(n){const e={},t=g(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>f5(l))),y(e,["generatedVideos"],o)}const i=g(n,["raiMediaFilteredCount"]);i!=null&&y(e,["raiMediaFilteredCount"],i);const s=g(n,["raiMediaFilteredReasons"]);return s!=null&&y(e,["raiMediaFilteredReasons"],s),e}function h5(n){const e={},t=g(n,["video"]);return t!=null&&y(e,["video"],v5(t)),e}function f5(n){const e={},t=g(n,["_self"]);return t!=null&&y(e,["video"],T5(t)),e}function m5(n){const e={},t=g(n,["operationName"]);return t!=null&&y(e,["_url","operationName"],t),e}function p5(n){const e={},t=g(n,["operationName"]);return t!=null&&y(e,["_url","operationName"],t),e}function g5(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response"]);return l!=null&&y(e,["response"],_5(l)),e}function _5(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["parent"]);i!=null&&y(e,["parent"],i);const s=g(n,["documentName"]);return s!=null&&y(e,["documentName"],s),e}function N1(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response"]);return l!=null&&y(e,["response"],y5(l)),e}function y5(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["parent"]);i!=null&&y(e,["parent"],i);const s=g(n,["documentName"]);return s!=null&&y(e,["documentName"],s),e}function v5(n){const e={},t=g(n,["uri"]);t!=null&&y(e,["uri"],t);const i=g(n,["encodedVideo"]);i!=null&&y(e,["videoBytes"],Q0(i));const s=g(n,["encoding"]);return s!=null&&y(e,["mimeType"],s),e}function T5(n){const e={},t=g(n,["gcsUri"]);t!=null&&y(e,["uri"],t);const i=g(n,["bytesBase64Encoded"]);i!=null&&y(e,["videoBytes"],Q0(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var aC;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(aC||(aC={}));var lC;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(lC||(lC={}));var uC;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(uC||(uC={}));var Qa;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Qa||(Qa={}));var cC;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(cC||(cC={}));var dC;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(dC||(dC={}));var hC;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(hC||(hC={}));var fC;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(fC||(fC={}));var mC;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(mC||(mC={}));var pC;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(pC||(pC={}));var gC;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(gC||(gC={}));var _C;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(_C||(_C={}));var yC;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(yC||(yC={}));var vC;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(vC||(vC={}));var TC;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(TC||(TC={}));var EC;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(EC||(EC={}));var xC;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(xC||(xC={}));var wC;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(wC||(wC={}));var SC;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(SC||(SC={}));var Mp;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(Mp||(Mp={}));var CC;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(CC||(CC={}));var bC;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(bC||(bC={}));var IC;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(IC||(IC={}));var Fv;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Fv||(Fv={}));var AC;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(AC||(AC={}));var NC;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(NC||(NC={}));var RC;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(RC||(RC={}));var MC;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(MC||(MC={}));var PC;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(PC||(PC={}));var kC;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(kC||(kC={}));var DC;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(DC||(DC={}));var LC;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(LC||(LC={}));var VC;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(VC||(VC={}));var OC;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(OC||(OC={}));var UC;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(UC||(UC={}));var FC;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(FC||(FC={}));var BC;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(BC||(BC={}));var zC;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(zC||(zC={}));var qC;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(qC||(qC={}));var GC;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(GC||(GC={}));var HC;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(HC||(HC={}));var jC;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(jC||(jC={}));var KC;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(KC||(KC={}));var WC;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(WC||(WC={}));var YC;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(YC||(YC={}));var JC;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(JC||(JC={}));var ZC;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(ZC||(ZC={}));var QC;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(QC||(QC={}));var $C;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})($C||($C={}));var XC;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(XC||(XC={}));var eb;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(eb||(eb={}));var tb;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(tb||(tb={}));var nb;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(nb||(nb={}));var ib;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(ib||(ib={}));var Bc;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Bc||(Bc={}));class Bv{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class wh{get text(){var e,t,i,s,o,l,d,h;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let p="",T=!1;const x=[];for(const C of(h=(d=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)!==null&&h!==void 0?h:[]){for(const[A,D]of Object.entries(C))A!=="text"&&A!=="thought"&&A!=="thoughtSignature"&&(D!==null||D!==void 0)&&x.push(A);if(typeof C.text=="string"){if(typeof C.thought=="boolean"&&C.thought)continue;T=!0,p+=C.text}}return x.length>0&&console.warn(`there are non-text parts ${x} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),T?p:void 0}get data(){var e,t,i,s,o,l,d,h;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let p="";const T=[];for(const x of(h=(d=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)!==null&&h!==void 0?h:[]){for(const[C,A]of Object.entries(x))C!=="inlineData"&&(A!==null||A!==void 0)&&T.push(C);x.inlineData&&typeof x.inlineData.data=="string"&&(p+=atob(x.inlineData.data))}return T.length>0&&console.warn(`there are non-data parts ${T} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),p.length>0?btoa(p):void 0}get functionCalls(){var e,t,i,s,o,l,d,h;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const p=(h=(d=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||h===void 0?void 0:h.filter(T=>T.functionCall).map(T=>T.functionCall).filter(T=>T!==void 0);if((p==null?void 0:p.length)!==0)return p}get executableCode(){var e,t,i,s,o,l,d,h,p;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const T=(h=(d=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||h===void 0?void 0:h.filter(x=>x.executableCode).map(x=>x.executableCode).filter(x=>x!==void 0);if((T==null?void 0:T.length)!==0)return(p=T==null?void 0:T[0])===null||p===void 0?void 0:p.code}get codeExecutionResult(){var e,t,i,s,o,l,d,h,p;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const T=(h=(d=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||d===void 0?void 0:d.parts)===null||h===void 0?void 0:h.filter(x=>x.codeExecutionResult).map(x=>x.codeExecutionResult).filter(x=>x!==void 0);if((T==null?void 0:T.length)!==0)return(p=T==null?void 0:T[0])===null||p===void 0?void 0:p.output}}class sb{}class rb{}class E5{}class x5{}class w5{}class S5{}class ob{}class ab{}class lb{}class C5{}class Pp{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new Pp;let s;const o=e;return t?s=u5(o):s=l5(o),Object.assign(i,s),i}}class ub{}class cb{}class db{}class b5{}class I5{}class A5{}class $0{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new $0,o=g5(e);return Object.assign(i,o),i}}class N5{}class R5{}class M5{}class hb{}class P5{get text(){var e,t,i;let s="",o=!1;const l=[];for(const d of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[h,p]of Object.entries(d))h!=="text"&&h!=="thought"&&p!==null&&l.push(h);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,s+=d.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?s:void 0}get data(){var e,t,i;let s="";const o=[];for(const l of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[d,h]of Object.entries(l))d!=="inlineData"&&h!==null&&o.push(d);l.inlineData&&typeof l.inlineData.data=="string"&&(s+=atob(l.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class k5{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class X0{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new X0,o=N1(e);return Object.assign(i,o),i}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ht(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function R1(n,e){const t=Ht(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function M1(n){return Array.isArray(n)?n.map(e=>kp(e)):[kp(n)]}function kp(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function P1(n){const e=kp(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function k1(n){const e=kp(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function fb(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function D1(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>fb(e)):[fb(n)]}function zv(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function mb(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function pb(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Vi(n){if(n==null)throw new Error("ContentUnion is required");return zv(n)?n:{role:"user",parts:D1(n)}}function eT(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=Vi(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=Vi(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Vi(t)):[Vi(e)]}function ur(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(mb(n)||pb(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Vi(n)]}const e=[],t=[],i=zv(n[0]);for(const s of n){const o=zv(s);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(s);else{if(mb(s)||pb(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return i||e.push({role:"user",parts:D1(t)}),e}function D5(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Qa).includes(t[0].toUpperCase())?t[0].toUpperCase():Qa.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Qa).includes(i.toUpperCase())?i.toUpperCase():Qa.TYPE_UNSPECIFIED})}}function Gc(n){const e={},t=["items"],i=["anyOf"],s=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&D5(n.type,e);for(const[l,d]of Object.entries(n))if(d!=null)if(l=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(Qa).includes(d.toUpperCase())?d.toUpperCase():Qa.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=Gc(d);else if(i.includes(l)){const h=[];for(const p of d){if(p.type=="null"){e.nullable=!0;continue}h.push(Gc(p))}e[l]=h}else if(s.includes(l)){const h={};for(const[p,T]of Object.entries(d))h[p]=Gc(T);e[l]=h}else{if(l==="additionalProperties")continue;e[l]=d}return e}function tT(n){return Gc(n)}function nT(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function iT(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function xd(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Gc(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Gc(e.response));return n}function wd(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function L5(n,e,t,i=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:s?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function ta(n,e){if(typeof e!="string")throw new Error("name must be a string");return L5(n,e,"cachedContents")}function L1(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function pl(n){return Q0(n)}function V5(n){return n!=null&&typeof n=="object"&&"name"in n}function O5(n){return n!=null&&typeof n=="object"&&"video"in n}function U5(n){return n!=null&&typeof n=="object"&&"uri"in n}function V1(n){var e;let t;if(V5(n)&&(t=n.name),!(U5(n)&&(t=n.uri,t===void 0))&&!(O5(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function O1(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function U1(n){for(const e of["models","tunedModels","publisherModels"])if(F5(n,e))return n[e];return[]}function F5(n,e){return n!==null&&typeof n=="object"&&e in n}function B5(n,e={}){const t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function z5(n,e={}){const t=[],i=new Set;for(const s of n){const o=s.name;if(i.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);i.add(o);const l=B5(s,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function F1(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(s>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function q5(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function B1(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return n;let o=!1;for(const l of s){if(typeof l!="object"||l===null)continue;const h=l.response;if(typeof h!="object"||h===null)continue;if(h.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function Sd(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function z1(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function G5(n){const e={},t=g(n,["responsesFile"]);t!=null&&y(e,["fileName"],t);const i=g(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>wL(l))),y(e,["inlinedResponses"],o)}const s=g(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["inlinedEmbedContentResponses"],o)}return e}function H5(n){const e={},t=g(n,["predictionsFormat"]);t!=null&&y(e,["format"],t);const i=g(n,["gcsDestination","outputUriPrefix"]);i!=null&&y(e,["gcsUri"],i);const s=g(n,["bigqueryDestination","outputUri"]);return s!=null&&y(e,["bigqueryUri"],s),e}function j5(n){const e={},t=g(n,["format"]);t!=null&&y(e,["predictionsFormat"],t);const i=g(n,["gcsUri"]);i!=null&&y(e,["gcsDestination","outputUriPrefix"],i);const s=g(n,["bigqueryUri"]);if(s!=null&&y(e,["bigqueryDestination","outputUri"],s),g(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(g(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function cp(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata","displayName"]);i!=null&&y(e,["displayName"],i);const s=g(n,["metadata","state"]);s!=null&&y(e,["state"],z1(s));const o=g(n,["metadata","createTime"]);o!=null&&y(e,["createTime"],o);const l=g(n,["metadata","endTime"]);l!=null&&y(e,["endTime"],l);const d=g(n,["metadata","updateTime"]);d!=null&&y(e,["updateTime"],d);const h=g(n,["metadata","model"]);h!=null&&y(e,["model"],h);const p=g(n,["metadata","output"]);return p!=null&&y(e,["dest"],G5(B1(p))),e}function qv(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["displayName"]);i!=null&&y(e,["displayName"],i);const s=g(n,["state"]);s!=null&&y(e,["state"],z1(s));const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["createTime"]);l!=null&&y(e,["createTime"],l);const d=g(n,["startTime"]);d!=null&&y(e,["startTime"],d);const h=g(n,["endTime"]);h!=null&&y(e,["endTime"],h);const p=g(n,["updateTime"]);p!=null&&y(e,["updateTime"],p);const T=g(n,["model"]);T!=null&&y(e,["model"],T);const x=g(n,["inputConfig"]);x!=null&&y(e,["src"],K5(x));const C=g(n,["outputConfig"]);C!=null&&y(e,["dest"],H5(B1(C)));const A=g(n,["completionStats"]);return A!=null&&y(e,["completionStats"],A),e}function K5(n){const e={},t=g(n,["instancesFormat"]);t!=null&&y(e,["format"],t);const i=g(n,["gcsSource","uris"]);i!=null&&y(e,["gcsUri"],i);const s=g(n,["bigquerySource","inputUri"]);return s!=null&&y(e,["bigqueryUri"],s),e}function W5(n,e){const t={};if(g(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=g(e,["fileName"]);i!=null&&y(t,["fileName"],i);const s=g(e,["inlinedRequests"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>xL(n,l))),y(t,["requests","requests"],o)}return t}function Y5(n){const e={},t=g(n,["format"]);t!=null&&y(e,["instancesFormat"],t);const i=g(n,["gcsUri"]);i!=null&&y(e,["gcsSource","uris"],i);const s=g(n,["bigqueryUri"]);if(s!=null&&y(e,["bigquerySource","inputUri"],s),g(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function J5(n){const e={},t=g(n,["data"]);if(t!=null&&y(e,["data"],t),g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function Z5(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function Q5(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function $5(n){const e={},t=g(n,["content"]);t!=null&&y(e,["content"],t);const i=g(n,["citationMetadata"]);i!=null&&y(e,["citationMetadata"],X5(i));const s=g(n,["tokenCount"]);s!=null&&y(e,["tokenCount"],s);const o=g(n,["finishReason"]);o!=null&&y(e,["finishReason"],o);const l=g(n,["avgLogprobs"]);l!=null&&y(e,["avgLogprobs"],l);const d=g(n,["groundingMetadata"]);d!=null&&y(e,["groundingMetadata"],d);const h=g(n,["index"]);h!=null&&y(e,["index"],h);const p=g(n,["logprobsResult"]);p!=null&&y(e,["logprobsResult"],p);const T=g(n,["safetyRatings"]);if(T!=null){let C=T;Array.isArray(C)&&(C=C.map(A=>A)),y(e,["safetyRatings"],C)}const x=g(n,["urlContextMetadata"]);return x!=null&&y(e,["urlContextMetadata"],x),e}function X5(n){const e={},t=g(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),y(e,["citations"],i)}return e}function q1(n){const e={},t=g(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>RL(o))),y(e,["parts"],s)}const i=g(n,["role"]);return i!=null&&y(e,["role"],i),e}function eL(n,e){const t={},i=g(n,["displayName"]);if(e!==void 0&&i!=null&&y(e,["batch","displayName"],i),g(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function tL(n,e){const t={},i=g(n,["displayName"]);e!==void 0&&i!=null&&y(e,["displayName"],i);const s=g(n,["dest"]);return e!==void 0&&s!=null&&y(e,["outputConfig"],j5(q5(s))),t}function gb(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["src"]);s!=null&&y(t,["batch","inputConfig"],W5(n,F1(n,s)));const o=g(e,["config"]);return o!=null&&eL(o,t),t}function nL(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["model"],Ht(n,i));const s=g(e,["src"]);s!=null&&y(t,["inputConfig"],Y5(F1(n,s)));const o=g(e,["config"]);return o!=null&&tL(o,t),t}function iL(n,e){const t={},i=g(n,["displayName"]);return e!==void 0&&i!=null&&y(e,["batch","displayName"],i),t}function sL(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["src"]);s!=null&&y(t,["batch","inputConfig"],dL(n,s));const o=g(e,["config"]);return o!=null&&iL(o,t),t}function rL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function oL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function aL(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["name"]);i!=null&&y(e,["name"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);return o!=null&&y(e,["error"],o),e}function lL(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["name"]);i!=null&&y(e,["name"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);return o!=null&&y(e,["error"],o),e}function uL(n,e){const t={},i=g(e,["contents"]);if(i!=null){let o=eT(n,i);Array.isArray(o)&&(o=o.map(l=>l)),y(t,["requests[]","request","content"],o)}const s=g(e,["config"]);return s!=null&&(y(t,["_self"],cL(s,t)),o5(t,{"requests[].*":"requests[].request.*"})),t}function cL(n,e){const t={},i=g(n,["taskType"]);e!==void 0&&i!=null&&y(e,["requests[]","taskType"],i);const s=g(n,["title"]);e!==void 0&&s!=null&&y(e,["requests[]","title"],s);const o=g(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&y(e,["requests[]","outputDimensionality"],o),g(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function dL(n,e){const t={},i=g(e,["fileName"]);i!=null&&y(t,["file_name"],i);const s=g(e,["inlinedRequests"]);return s!=null&&y(t,["requests"],uL(n,s)),t}function hL(n){const e={};if(g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=g(n,["fileUri"]);t!=null&&y(e,["fileUri"],t);const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function fL(n){const e={},t=g(n,["id"]);t!=null&&y(e,["id"],t);const i=g(n,["args"]);i!=null&&y(e,["args"],i);const s=g(n,["name"]);if(s!=null&&y(e,["name"],s),g(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function mL(n){const e={},t=g(n,["mode"]);t!=null&&y(e,["mode"],t);const i=g(n,["allowedFunctionNames"]);if(i!=null&&y(e,["allowedFunctionNames"],i),g(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function pL(n,e,t){const i={},s=g(e,["systemInstruction"]);t!==void 0&&s!=null&&y(t,["systemInstruction"],q1(Vi(s)));const o=g(e,["temperature"]);o!=null&&y(i,["temperature"],o);const l=g(e,["topP"]);l!=null&&y(i,["topP"],l);const d=g(e,["topK"]);d!=null&&y(i,["topK"],d);const h=g(e,["candidateCount"]);h!=null&&y(i,["candidateCount"],h);const p=g(e,["maxOutputTokens"]);p!=null&&y(i,["maxOutputTokens"],p);const T=g(e,["stopSequences"]);T!=null&&y(i,["stopSequences"],T);const x=g(e,["responseLogprobs"]);x!=null&&y(i,["responseLogprobs"],x);const C=g(e,["logprobs"]);C!=null&&y(i,["logprobs"],C);const A=g(e,["presencePenalty"]);A!=null&&y(i,["presencePenalty"],A);const D=g(e,["frequencyPenalty"]);D!=null&&y(i,["frequencyPenalty"],D);const F=g(e,["seed"]);F!=null&&y(i,["seed"],F);const H=g(e,["responseMimeType"]);H!=null&&y(i,["responseMimeType"],H);const X=g(e,["responseSchema"]);X!=null&&y(i,["responseSchema"],tT(X));const re=g(e,["responseJsonSchema"]);if(re!=null&&y(i,["responseJsonSchema"],re),g(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const Q=g(e,["safetySettings"]);if(t!==void 0&&Q!=null){let W=Q;Array.isArray(W)&&(W=W.map(z=>ML(z))),y(t,["safetySettings"],W)}const he=g(e,["tools"]);if(t!==void 0&&he!=null){let W=wd(he);Array.isArray(W)&&(W=W.map(z=>kL(xd(z)))),y(t,["tools"],W)}const fe=g(e,["toolConfig"]);if(t!==void 0&&fe!=null&&y(t,["toolConfig"],PL(fe)),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const Y=g(e,["cachedContent"]);t!==void 0&&Y!=null&&y(t,["cachedContent"],ta(n,Y));const k=g(e,["responseModalities"]);k!=null&&y(i,["responseModalities"],k);const B=g(e,["mediaResolution"]);B!=null&&y(i,["mediaResolution"],B);const O=g(e,["speechConfig"]);if(O!=null&&y(i,["speechConfig"],nT(O)),g(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=g(e,["thinkingConfig"]);q!=null&&y(i,["thinkingConfig"],q);const G=g(e,["imageConfig"]);return G!=null&&y(i,["imageConfig"],EL(G)),i}function gL(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["candidates"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(p=>$5(p))),y(e,["candidates"],h)}const s=g(n,["modelVersion"]);s!=null&&y(e,["modelVersion"],s);const o=g(n,["promptFeedback"]);o!=null&&y(e,["promptFeedback"],o);const l=g(n,["responseId"]);l!=null&&y(e,["responseId"],l);const d=g(n,["usageMetadata"]);return d!=null&&y(e,["usageMetadata"],d),e}function _L(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function yL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],Sd(n,i)),t}function vL(n){const e={};if(g(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=g(n,["enableWidget"]);return t!=null&&y(e,["enableWidget"],t),e}function TL(n){const e={};if(g(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=g(n,["timeRangeFilter"]);return t!=null&&y(e,["timeRangeFilter"],t),e}function EL(n){const e={},t=g(n,["aspectRatio"]);t!=null&&y(e,["aspectRatio"],t);const i=g(n,["imageSize"]);if(i!=null&&y(e,["imageSize"],i),g(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function xL(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["request","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let d=ur(s);Array.isArray(d)&&(d=d.map(h=>q1(h))),y(t,["request","contents"],d)}const o=g(e,["metadata"]);o!=null&&y(t,["metadata"],o);const l=g(e,["config"]);return l!=null&&y(t,["request","generationConfig"],pL(n,l,g(t,["request"],{}))),t}function wL(n){const e={},t=g(n,["response"]);t!=null&&y(e,["response"],gL(t));const i=g(n,["error"]);return i!=null&&y(e,["error"],i),e}function SL(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);if(e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),g(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function CL(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);e!==void 0&&s!=null&&y(e,["_query","pageToken"],s);const o=g(n,["filter"]);return e!==void 0&&o!=null&&y(e,["_query","filter"],o),t}function bL(n){const e={},t=g(n,["config"]);return t!=null&&SL(t,e),e}function IL(n){const e={},t=g(n,["config"]);return t!=null&&CL(t,e),e}function AL(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["operations"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>cp(l))),y(e,["batchJobs"],o)}return e}function NL(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["batchPredictionJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>qv(l))),y(e,["batchJobs"],o)}return e}function RL(n){const e={},t=g(n,["mediaResolution"]);t!=null&&y(e,["mediaResolution"],t);const i=g(n,["codeExecutionResult"]);i!=null&&y(e,["codeExecutionResult"],i);const s=g(n,["executableCode"]);s!=null&&y(e,["executableCode"],s);const o=g(n,["fileData"]);o!=null&&y(e,["fileData"],hL(o));const l=g(n,["functionCall"]);l!=null&&y(e,["functionCall"],fL(l));const d=g(n,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(n,["inlineData"]);h!=null&&y(e,["inlineData"],J5(h));const p=g(n,["text"]);p!=null&&y(e,["text"],p);const T=g(n,["thought"]);T!=null&&y(e,["thought"],T);const x=g(n,["thoughtSignature"]);x!=null&&y(e,["thoughtSignature"],x);const C=g(n,["videoMetadata"]);return C!=null&&y(e,["videoMetadata"],C),e}function ML(n){const e={},t=g(n,["category"]);if(t!=null&&y(e,["category"],t),g(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=g(n,["threshold"]);return i!=null&&y(e,["threshold"],i),e}function PL(n){const e={},t=g(n,["functionCallingConfig"]);t!=null&&y(e,["functionCallingConfig"],mL(t));const i=g(n,["retrievalConfig"]);return i!=null&&y(e,["retrievalConfig"],i),e}function kL(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let T=t;Array.isArray(T)&&(T=T.map(x=>x)),y(e,["functionDeclarations"],T)}if(g(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=g(n,["googleSearchRetrieval"]);i!=null&&y(e,["googleSearchRetrieval"],i);const s=g(n,["computerUse"]);s!=null&&y(e,["computerUse"],s);const o=g(n,["fileSearch"]);o!=null&&y(e,["fileSearch"],o);const l=g(n,["codeExecution"]);if(l!=null&&y(e,["codeExecution"],l),g(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=g(n,["googleMaps"]);d!=null&&y(e,["googleMaps"],vL(d));const h=g(n,["googleSearch"]);h!=null&&y(e,["googleSearch"],TL(h));const p=g(n,["urlContext"]);return p!=null&&y(e,["urlContext"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ko;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(Ko||(Ko={}));class Ou{constructor(e,t,i,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,s)}init(e,t,i){var s,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!i||Object.keys(i).length===0?l={config:{}}:typeof i=="object"?l=Object.assign({},i):l=i,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(o=(s=l.config)===null||s===void 0?void 0:s.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class DL extends ea{constructor(e){super(),this.apiClient=e,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new Ou(Ko.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){const t=gb(this.apiClient,e),i=t._url,s=Oe("{model}:batchGenerateContent",i),d=t.batch.inputConfig.requests,h=d.requests,p=[];for(const T of h){const x=Object.assign({},T);if(x.systemInstruction){const C=x.systemInstruction;delete x.systemInstruction;const A=x.request;A.systemInstruction=C,x.request=A}p.push(x)}return d.requests=p,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const i=t?Object.assign({},t):{},s=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${s}`),i.dest===void 0){const o=this.getGcsUri(e),l=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?i.dest=`${o.slice(0,-6)}/dest`:i.dest=`${o}_dest_${s}`;else if(l)i.dest=`${l}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=nL(this.apiClient,e);return d=Oe("batchPredictionJobs",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>qv(T))}else{const p=gb(this.apiClient,e);return d=Oe("{model}:batchGenerateContent",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>cp(T))}}async createEmbeddingsInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=sL(this.apiClient,e);return o=Oe("{model}:asyncBatchEmbedContent",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>cp(h))}}async get(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=yL(this.apiClient,e);return d=Oe("batchPredictionJobs/{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>qv(T))}else{const p=_L(this.apiClient,e);return d=Oe("batches/{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>cp(T))}}async cancel(e){var t,i,s,o;let l="",d={};if(this.apiClient.isVertexAI()){const h=Q5(this.apiClient,e);l=Oe("batchPredictionJobs/{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,await this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const h=Z5(this.apiClient,e);l=Oe("batches/{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,await this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=IL(e);return d=Oe("batchPredictionJobs",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=NL(T),C=new hb;return Object.assign(C,x),C})}else{const p=bL(e);return d=Oe("batches",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=AL(T),C=new hb;return Object.assign(C,x),C})}}async delete(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=oL(this.apiClient,e);return d=Oe("batchPredictionJobs/{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>lL(T))}else{const p=rL(this.apiClient,e);return d=Oe("batches/{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>aL(T))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LL(n){const e={},t=g(n,["data"]);if(t!=null&&y(e,["data"],t),g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function _b(n){const e={},t=g(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>s4(o))),y(e,["parts"],s)}const i=g(n,["role"]);return i!=null&&y(e,["role"],i),e}function VL(n,e){const t={},i=g(n,["ttl"]);e!==void 0&&i!=null&&y(e,["ttl"],i);const s=g(n,["expireTime"]);e!==void 0&&s!=null&&y(e,["expireTime"],s);const o=g(n,["displayName"]);e!==void 0&&o!=null&&y(e,["displayName"],o);const l=g(n,["contents"]);if(e!==void 0&&l!=null){let T=ur(l);Array.isArray(T)&&(T=T.map(x=>_b(x))),y(e,["contents"],T)}const d=g(n,["systemInstruction"]);e!==void 0&&d!=null&&y(e,["systemInstruction"],_b(Vi(d)));const h=g(n,["tools"]);if(e!==void 0&&h!=null){let T=h;Array.isArray(T)&&(T=T.map(x=>o4(x))),y(e,["tools"],T)}const p=g(n,["toolConfig"]);if(e!==void 0&&p!=null&&y(e,["toolConfig"],r4(p)),g(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function OL(n,e){const t={},i=g(n,["ttl"]);e!==void 0&&i!=null&&y(e,["ttl"],i);const s=g(n,["expireTime"]);e!==void 0&&s!=null&&y(e,["expireTime"],s);const o=g(n,["displayName"]);e!==void 0&&o!=null&&y(e,["displayName"],o);const l=g(n,["contents"]);if(e!==void 0&&l!=null){let x=ur(l);Array.isArray(x)&&(x=x.map(C=>C)),y(e,["contents"],x)}const d=g(n,["systemInstruction"]);e!==void 0&&d!=null&&y(e,["systemInstruction"],Vi(d));const h=g(n,["tools"]);if(e!==void 0&&h!=null){let x=h;Array.isArray(x)&&(x=x.map(C=>a4(C))),y(e,["tools"],x)}const p=g(n,["toolConfig"]);e!==void 0&&p!=null&&y(e,["toolConfig"],p);const T=g(n,["kmsKeyName"]);return e!==void 0&&T!=null&&y(e,["encryption_spec","kmsKeyName"],T),t}function UL(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["model"],R1(n,i));const s=g(e,["config"]);return s!=null&&VL(s,t),t}function FL(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["model"],R1(n,i));const s=g(e,["config"]);return s!=null&&OL(s,t),t}function BL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],ta(n,i)),t}function zL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],ta(n,i)),t}function qL(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function GL(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function HL(n){const e={};if(g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=g(n,["fileUri"]);t!=null&&y(e,["fileUri"],t);const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function jL(n){const e={},t=g(n,["id"]);t!=null&&y(e,["id"],t);const i=g(n,["args"]);i!=null&&y(e,["args"],i);const s=g(n,["name"]);if(s!=null&&y(e,["name"],s),g(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function KL(n){const e={},t=g(n,["mode"]);t!=null&&y(e,["mode"],t);const i=g(n,["allowedFunctionNames"]);if(i!=null&&y(e,["allowedFunctionNames"],i),g(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function WL(n){const e={};if(g(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=g(n,["description"]);t!=null&&y(e,["description"],t);const i=g(n,["name"]);i!=null&&y(e,["name"],i);const s=g(n,["parameters"]);s!=null&&y(e,["parameters"],s);const o=g(n,["parametersJsonSchema"]);o!=null&&y(e,["parametersJsonSchema"],o);const l=g(n,["response"]);l!=null&&y(e,["response"],l);const d=g(n,["responseJsonSchema"]);return d!=null&&y(e,["responseJsonSchema"],d),e}function YL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],ta(n,i)),t}function JL(n,e){const t={},i=g(e,["name"]);return i!=null&&y(t,["_url","name"],ta(n,i)),t}function ZL(n){const e={};if(g(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=g(n,["enableWidget"]);return t!=null&&y(e,["enableWidget"],t),e}function QL(n){const e={};if(g(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=g(n,["timeRangeFilter"]);return t!=null&&y(e,["timeRangeFilter"],t),e}function $L(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);return e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),t}function XL(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);return e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),t}function e4(n){const e={},t=g(n,["config"]);return t!=null&&$L(t,e),e}function t4(n){const e={},t=g(n,["config"]);return t!=null&&XL(t,e),e}function n4(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["cachedContents"],o)}return e}function i4(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["cachedContents"],o)}return e}function s4(n){const e={},t=g(n,["mediaResolution"]);t!=null&&y(e,["mediaResolution"],t);const i=g(n,["codeExecutionResult"]);i!=null&&y(e,["codeExecutionResult"],i);const s=g(n,["executableCode"]);s!=null&&y(e,["executableCode"],s);const o=g(n,["fileData"]);o!=null&&y(e,["fileData"],HL(o));const l=g(n,["functionCall"]);l!=null&&y(e,["functionCall"],jL(l));const d=g(n,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(n,["inlineData"]);h!=null&&y(e,["inlineData"],LL(h));const p=g(n,["text"]);p!=null&&y(e,["text"],p);const T=g(n,["thought"]);T!=null&&y(e,["thought"],T);const x=g(n,["thoughtSignature"]);x!=null&&y(e,["thoughtSignature"],x);const C=g(n,["videoMetadata"]);return C!=null&&y(e,["videoMetadata"],C),e}function r4(n){const e={},t=g(n,["functionCallingConfig"]);t!=null&&y(e,["functionCallingConfig"],KL(t));const i=g(n,["retrievalConfig"]);return i!=null&&y(e,["retrievalConfig"],i),e}function o4(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let T=t;Array.isArray(T)&&(T=T.map(x=>x)),y(e,["functionDeclarations"],T)}if(g(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=g(n,["googleSearchRetrieval"]);i!=null&&y(e,["googleSearchRetrieval"],i);const s=g(n,["computerUse"]);s!=null&&y(e,["computerUse"],s);const o=g(n,["fileSearch"]);o!=null&&y(e,["fileSearch"],o);const l=g(n,["codeExecution"]);if(l!=null&&y(e,["codeExecution"],l),g(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=g(n,["googleMaps"]);d!=null&&y(e,["googleMaps"],ZL(d));const h=g(n,["googleSearch"]);h!=null&&y(e,["googleSearch"],QL(h));const p=g(n,["urlContext"]);return p!=null&&y(e,["urlContext"],p),e}function a4(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let x=t;Array.isArray(x)&&(x=x.map(C=>WL(C))),y(e,["functionDeclarations"],x)}const i=g(n,["retrieval"]);i!=null&&y(e,["retrieval"],i);const s=g(n,["googleSearchRetrieval"]);s!=null&&y(e,["googleSearchRetrieval"],s);const o=g(n,["computerUse"]);if(o!=null&&y(e,["computerUse"],o),g(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=g(n,["codeExecution"]);l!=null&&y(e,["codeExecution"],l);const d=g(n,["enterpriseWebSearch"]);d!=null&&y(e,["enterpriseWebSearch"],d);const h=g(n,["googleMaps"]);h!=null&&y(e,["googleMaps"],h);const p=g(n,["googleSearch"]);p!=null&&y(e,["googleSearch"],p);const T=g(n,["urlContext"]);return T!=null&&y(e,["urlContext"],T),e}function l4(n,e){const t={},i=g(n,["ttl"]);e!==void 0&&i!=null&&y(e,["ttl"],i);const s=g(n,["expireTime"]);return e!==void 0&&s!=null&&y(e,["expireTime"],s),t}function u4(n,e){const t={},i=g(n,["ttl"]);e!==void 0&&i!=null&&y(e,["ttl"],i);const s=g(n,["expireTime"]);return e!==void 0&&s!=null&&y(e,["expireTime"],s),t}function c4(n,e){const t={},i=g(e,["name"]);i!=null&&y(t,["_url","name"],ta(n,i));const s=g(e,["config"]);return s!=null&&l4(s,t),t}function d4(n,e){const t={},i=g(e,["name"]);i!=null&&y(t,["_url","name"],ta(n,i));const s=g(e,["config"]);return s!=null&&u4(s,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class h4 extends ea{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ou(Ko.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=FL(this.apiClient,e);return d=Oe("cachedContents",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>T)}else{const p=UL(this.apiClient,e);return d=Oe("cachedContents",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>T)}}async get(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=JL(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>T)}else{const p=YL(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>T)}}async delete(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=zL(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=GL(T),C=new cb;return Object.assign(C,x),C})}else{const p=BL(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=qL(T),C=new cb;return Object.assign(C,x),C})}}async update(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=d4(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>T)}else{const p=c4(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>T)}}async listInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=t4(e);return d=Oe("cachedContents",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=i4(T),C=new db;return Object.assign(C,x),C})}else{const p=e4(e);return d=Oe("cachedContents",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=n4(T),C=new db;return Object.assign(C,x),C})}}}function yb(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xn(n){return this instanceof xn?(this.v=n,this):new xn(n)}function Hc(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",l),s[Symbol.asyncIterator]=function(){return this},s;function l(A){return function(D){return Promise.resolve(D).then(A,x)}}function d(A,D){i[A]&&(s[A]=function(F){return new Promise(function(H,X){o.push([A,F,H,X])>1||h(A,F)})},D&&(s[A]=D(s[A])))}function h(A,D){try{p(i[A](D))}catch(F){C(o[0][3],F)}}function p(A){A.value instanceof xn?Promise.resolve(A.value.v).then(T,x):C(o[0][2],A)}function T(A){h("next",A)}function x(A){h("throw",A)}function C(A,D){A(D),o.shift(),o.length&&h(o[0][0],o[0][1])}}function qh(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof yb=="function"?yb(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(l){return new Promise(function(d,h){l=n[o](l),s(d,h,l.done,l.value)})}}function s(o,l,d,h){Promise.resolve(h).then(function(p){o({value:p,done:d})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function f4(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:G1(t)}function G1(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function m4(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function vb(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const s=[];let o=!0;for(;i<t&&n[i].role==="model";)s.push(n[i]),o&&!G1(n[i])&&(o=!1),i++;o?e.push(...s):e.pop()}return e}class p4{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new g4(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class g4{constructor(e,t,i,s={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=s,this.history=o,this.sendPromise=Promise.resolve(),m4(o)}async sendMessage(e){var t;await this.sendPromise;const i=Vi(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,l,d;const h=await s,p=(l=(o=h.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content,T=h.automaticFunctionCallingHistory,x=this.getHistory(!0).length;let C=[];T!=null&&(C=(d=T.slice(x))!==null&&d!==void 0?d:[]);const A=p?[p]:[];this.recordHistory(i,A,C)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const i=Vi(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const o=await s;return this.processStreamResponse(o,i)}getHistory(e=!1){const t=e?vb(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,s;return Hc(this,arguments,function*(){var l,d,h,p;const T=[];try{for(var x=!0,C=qh(e),A;A=yield xn(C.next()),l=A.done,!l;x=!0){p=A.value,x=!1;const D=p;if(f4(D)){const F=(s=(i=D.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content;F!==void 0&&T.push(F)}yield yield xn(D)}}catch(D){d={error:D}}finally{try{!x&&!l&&(h=C.return)&&(yield xn(h.call(C)))}finally{if(d)throw d.error}}this.recordHistory(t,T)})}recordHistory(e,t,i){let s=[];t.length>0&&t.every(o=>o.role!==void 0)?s=t:s.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...vb(i)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Cg extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Cg.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _4(n){const e={},t=g(n,["file"]);return t!=null&&y(e,["file"],t),e}function y4(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function v4(n){const e={},t=g(n,["name"]);return t!=null&&y(e,["_url","file"],V1(t)),e}function T4(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function E4(n){const e={},t=g(n,["name"]);return t!=null&&y(e,["_url","file"],V1(t)),e}function x4(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);return e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),t}function w4(n){const e={},t=g(n,["config"]);return t!=null&&x4(t,e),e}function S4(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["files"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["files"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class C4 extends ea{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ou(Ko.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=w4(e);return o=Oe("files",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>{const p=S4(h),T=new N5;return Object.assign(T,p),T})}}async createInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=_4(e);return o=Oe("upload/v1beta/files",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=y4(h),T=new R5;return Object.assign(T,p),T})}}async get(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=E4(e);return o=Oe("files/{file}",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=v4(e);return o=Oe("files/{file}",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>{const p=T4(h),T=new M5;return Object.assign(T,p),T})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dp(n){const e={},t=g(n,["data"]);if(t!=null&&y(e,["data"],t),g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function b4(n){const e={},t=g(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>q4(o))),y(e,["parts"],s)}const i=g(n,["role"]);return i!=null&&y(e,["role"],i),e}function I4(n){const e={};if(g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=g(n,["fileUri"]);t!=null&&y(e,["fileUri"],t);const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function A4(n){const e={},t=g(n,["id"]);t!=null&&y(e,["id"],t);const i=g(n,["args"]);i!=null&&y(e,["args"],i);const s=g(n,["name"]);if(s!=null&&y(e,["name"],s),g(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function N4(n){const e={};if(g(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=g(n,["description"]);t!=null&&y(e,["description"],t);const i=g(n,["name"]);i!=null&&y(e,["name"],i);const s=g(n,["parameters"]);s!=null&&y(e,["parameters"],s);const o=g(n,["parametersJsonSchema"]);o!=null&&y(e,["parametersJsonSchema"],o);const l=g(n,["response"]);l!=null&&y(e,["response"],l);const d=g(n,["responseJsonSchema"]);return d!=null&&y(e,["responseJsonSchema"],d),e}function R4(n){const e={},t=g(n,["modelSelectionConfig"]);t!=null&&y(e,["modelConfig"],t);const i=g(n,["responseJsonSchema"]);i!=null&&y(e,["responseJsonSchema"],i);const s=g(n,["audioTimestamp"]);s!=null&&y(e,["audioTimestamp"],s);const o=g(n,["candidateCount"]);o!=null&&y(e,["candidateCount"],o);const l=g(n,["enableAffectiveDialog"]);l!=null&&y(e,["enableAffectiveDialog"],l);const d=g(n,["frequencyPenalty"]);d!=null&&y(e,["frequencyPenalty"],d);const h=g(n,["logprobs"]);h!=null&&y(e,["logprobs"],h);const p=g(n,["maxOutputTokens"]);p!=null&&y(e,["maxOutputTokens"],p);const T=g(n,["mediaResolution"]);T!=null&&y(e,["mediaResolution"],T);const x=g(n,["presencePenalty"]);x!=null&&y(e,["presencePenalty"],x);const C=g(n,["responseLogprobs"]);C!=null&&y(e,["responseLogprobs"],C);const A=g(n,["responseMimeType"]);A!=null&&y(e,["responseMimeType"],A);const D=g(n,["responseModalities"]);D!=null&&y(e,["responseModalities"],D);const F=g(n,["responseSchema"]);F!=null&&y(e,["responseSchema"],F);const H=g(n,["routingConfig"]);H!=null&&y(e,["routingConfig"],H);const X=g(n,["seed"]);X!=null&&y(e,["seed"],X);const re=g(n,["speechConfig"]);re!=null&&y(e,["speechConfig"],H1(re));const Q=g(n,["stopSequences"]);Q!=null&&y(e,["stopSequences"],Q);const he=g(n,["temperature"]);he!=null&&y(e,["temperature"],he);const fe=g(n,["thinkingConfig"]);fe!=null&&y(e,["thinkingConfig"],fe);const Y=g(n,["topK"]);Y!=null&&y(e,["topK"],Y);const k=g(n,["topP"]);if(k!=null&&y(e,["topP"],k),g(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function M4(n){const e={};if(g(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=g(n,["enableWidget"]);return t!=null&&y(e,["enableWidget"],t),e}function P4(n){const e={};if(g(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=g(n,["timeRangeFilter"]);return t!=null&&y(e,["timeRangeFilter"],t),e}function k4(n,e){const t={},i=g(n,["generationConfig"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig"],i);const s=g(n,["responseModalities"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig","responseModalities"],s);const o=g(n,["temperature"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","temperature"],o);const l=g(n,["topP"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","topP"],l);const d=g(n,["topK"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","topK"],d);const h=g(n,["maxOutputTokens"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","maxOutputTokens"],h);const p=g(n,["mediaResolution"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","mediaResolution"],p);const T=g(n,["seed"]);e!==void 0&&T!=null&&y(e,["setup","generationConfig","seed"],T);const x=g(n,["speechConfig"]);e!==void 0&&x!=null&&y(e,["setup","generationConfig","speechConfig"],iT(x));const C=g(n,["thinkingConfig"]);e!==void 0&&C!=null&&y(e,["setup","generationConfig","thinkingConfig"],C);const A=g(n,["enableAffectiveDialog"]);e!==void 0&&A!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],A);const D=g(n,["systemInstruction"]);e!==void 0&&D!=null&&y(e,["setup","systemInstruction"],b4(Vi(D)));const F=g(n,["tools"]);if(e!==void 0&&F!=null){let Y=wd(F);Array.isArray(Y)&&(Y=Y.map(k=>H4(xd(k)))),y(e,["setup","tools"],Y)}const H=g(n,["sessionResumption"]);e!==void 0&&H!=null&&y(e,["setup","sessionResumption"],G4(H));const X=g(n,["inputAudioTranscription"]);e!==void 0&&X!=null&&y(e,["setup","inputAudioTranscription"],X);const re=g(n,["outputAudioTranscription"]);e!==void 0&&re!=null&&y(e,["setup","outputAudioTranscription"],re);const Q=g(n,["realtimeInputConfig"]);e!==void 0&&Q!=null&&y(e,["setup","realtimeInputConfig"],Q);const he=g(n,["contextWindowCompression"]);e!==void 0&&he!=null&&y(e,["setup","contextWindowCompression"],he);const fe=g(n,["proactivity"]);return e!==void 0&&fe!=null&&y(e,["setup","proactivity"],fe),t}function D4(n,e){const t={},i=g(n,["generationConfig"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig"],R4(i));const s=g(n,["responseModalities"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig","responseModalities"],s);const o=g(n,["temperature"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","temperature"],o);const l=g(n,["topP"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","topP"],l);const d=g(n,["topK"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","topK"],d);const h=g(n,["maxOutputTokens"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","maxOutputTokens"],h);const p=g(n,["mediaResolution"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","mediaResolution"],p);const T=g(n,["seed"]);e!==void 0&&T!=null&&y(e,["setup","generationConfig","seed"],T);const x=g(n,["speechConfig"]);e!==void 0&&x!=null&&y(e,["setup","generationConfig","speechConfig"],H1(iT(x)));const C=g(n,["thinkingConfig"]);e!==void 0&&C!=null&&y(e,["setup","generationConfig","thinkingConfig"],C);const A=g(n,["enableAffectiveDialog"]);e!==void 0&&A!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],A);const D=g(n,["systemInstruction"]);e!==void 0&&D!=null&&y(e,["setup","systemInstruction"],Vi(D));const F=g(n,["tools"]);if(e!==void 0&&F!=null){let Y=wd(F);Array.isArray(Y)&&(Y=Y.map(k=>j4(xd(k)))),y(e,["setup","tools"],Y)}const H=g(n,["sessionResumption"]);e!==void 0&&H!=null&&y(e,["setup","sessionResumption"],H);const X=g(n,["inputAudioTranscription"]);e!==void 0&&X!=null&&y(e,["setup","inputAudioTranscription"],X);const re=g(n,["outputAudioTranscription"]);e!==void 0&&re!=null&&y(e,["setup","outputAudioTranscription"],re);const Q=g(n,["realtimeInputConfig"]);e!==void 0&&Q!=null&&y(e,["setup","realtimeInputConfig"],Q);const he=g(n,["contextWindowCompression"]);e!==void 0&&he!=null&&y(e,["setup","contextWindowCompression"],he);const fe=g(n,["proactivity"]);return e!==void 0&&fe!=null&&y(e,["setup","proactivity"],fe),t}function L4(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["setup","model"],Ht(n,i));const s=g(e,["config"]);return s!=null&&y(t,["config"],k4(s,t)),t}function V4(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["setup","model"],Ht(n,i));const s=g(e,["config"]);return s!=null&&y(t,["config"],D4(s,t)),t}function O4(n){const e={},t=g(n,["musicGenerationConfig"]);return t!=null&&y(e,["musicGenerationConfig"],t),e}function U4(n){const e={},t=g(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),y(e,["weightedPrompts"],i)}return e}function F4(n){const e={},t=g(n,["media"]);if(t!=null){let p=M1(t);Array.isArray(p)&&(p=p.map(T=>dp(T))),y(e,["mediaChunks"],p)}const i=g(n,["audio"]);i!=null&&y(e,["audio"],dp(k1(i)));const s=g(n,["audioStreamEnd"]);s!=null&&y(e,["audioStreamEnd"],s);const o=g(n,["video"]);o!=null&&y(e,["video"],dp(P1(o)));const l=g(n,["text"]);l!=null&&y(e,["text"],l);const d=g(n,["activityStart"]);d!=null&&y(e,["activityStart"],d);const h=g(n,["activityEnd"]);return h!=null&&y(e,["activityEnd"],h),e}function B4(n){const e={},t=g(n,["media"]);if(t!=null){let p=M1(t);Array.isArray(p)&&(p=p.map(T=>T)),y(e,["mediaChunks"],p)}const i=g(n,["audio"]);i!=null&&y(e,["audio"],k1(i));const s=g(n,["audioStreamEnd"]);s!=null&&y(e,["audioStreamEnd"],s);const o=g(n,["video"]);o!=null&&y(e,["video"],P1(o));const l=g(n,["text"]);l!=null&&y(e,["text"],l);const d=g(n,["activityStart"]);d!=null&&y(e,["activityStart"],d);const h=g(n,["activityEnd"]);return h!=null&&y(e,["activityEnd"],h),e}function z4(n){const e={},t=g(n,["setupComplete"]);t!=null&&y(e,["setupComplete"],t);const i=g(n,["serverContent"]);i!=null&&y(e,["serverContent"],i);const s=g(n,["toolCall"]);s!=null&&y(e,["toolCall"],s);const o=g(n,["toolCallCancellation"]);o!=null&&y(e,["toolCallCancellation"],o);const l=g(n,["usageMetadata"]);l!=null&&y(e,["usageMetadata"],K4(l));const d=g(n,["goAway"]);d!=null&&y(e,["goAway"],d);const h=g(n,["sessionResumptionUpdate"]);return h!=null&&y(e,["sessionResumptionUpdate"],h),e}function q4(n){const e={},t=g(n,["mediaResolution"]);t!=null&&y(e,["mediaResolution"],t);const i=g(n,["codeExecutionResult"]);i!=null&&y(e,["codeExecutionResult"],i);const s=g(n,["executableCode"]);s!=null&&y(e,["executableCode"],s);const o=g(n,["fileData"]);o!=null&&y(e,["fileData"],I4(o));const l=g(n,["functionCall"]);l!=null&&y(e,["functionCall"],A4(l));const d=g(n,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(n,["inlineData"]);h!=null&&y(e,["inlineData"],dp(h));const p=g(n,["text"]);p!=null&&y(e,["text"],p);const T=g(n,["thought"]);T!=null&&y(e,["thought"],T);const x=g(n,["thoughtSignature"]);x!=null&&y(e,["thoughtSignature"],x);const C=g(n,["videoMetadata"]);return C!=null&&y(e,["videoMetadata"],C),e}function G4(n){const e={},t=g(n,["handle"]);if(t!=null&&y(e,["handle"],t),g(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function H1(n){const e={},t=g(n,["languageCode"]);t!=null&&y(e,["languageCode"],t);const i=g(n,["voiceConfig"]);if(i!=null&&y(e,["voiceConfig"],i),g(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function H4(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let T=t;Array.isArray(T)&&(T=T.map(x=>x)),y(e,["functionDeclarations"],T)}if(g(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=g(n,["googleSearchRetrieval"]);i!=null&&y(e,["googleSearchRetrieval"],i);const s=g(n,["computerUse"]);s!=null&&y(e,["computerUse"],s);const o=g(n,["fileSearch"]);o!=null&&y(e,["fileSearch"],o);const l=g(n,["codeExecution"]);if(l!=null&&y(e,["codeExecution"],l),g(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=g(n,["googleMaps"]);d!=null&&y(e,["googleMaps"],M4(d));const h=g(n,["googleSearch"]);h!=null&&y(e,["googleSearch"],P4(h));const p=g(n,["urlContext"]);return p!=null&&y(e,["urlContext"],p),e}function j4(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let x=t;Array.isArray(x)&&(x=x.map(C=>N4(C))),y(e,["functionDeclarations"],x)}const i=g(n,["retrieval"]);i!=null&&y(e,["retrieval"],i);const s=g(n,["googleSearchRetrieval"]);s!=null&&y(e,["googleSearchRetrieval"],s);const o=g(n,["computerUse"]);if(o!=null&&y(e,["computerUse"],o),g(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=g(n,["codeExecution"]);l!=null&&y(e,["codeExecution"],l);const d=g(n,["enterpriseWebSearch"]);d!=null&&y(e,["enterpriseWebSearch"],d);const h=g(n,["googleMaps"]);h!=null&&y(e,["googleMaps"],h);const p=g(n,["googleSearch"]);p!=null&&y(e,["googleSearch"],p);const T=g(n,["urlContext"]);return T!=null&&y(e,["urlContext"],T),e}function K4(n){const e={},t=g(n,["promptTokenCount"]);t!=null&&y(e,["promptTokenCount"],t);const i=g(n,["cachedContentTokenCount"]);i!=null&&y(e,["cachedContentTokenCount"],i);const s=g(n,["candidatesTokenCount"]);s!=null&&y(e,["responseTokenCount"],s);const o=g(n,["toolUsePromptTokenCount"]);o!=null&&y(e,["toolUsePromptTokenCount"],o);const l=g(n,["thoughtsTokenCount"]);l!=null&&y(e,["thoughtsTokenCount"],l);const d=g(n,["totalTokenCount"]);d!=null&&y(e,["totalTokenCount"],d);const h=g(n,["promptTokensDetails"]);if(h!=null){let A=h;Array.isArray(A)&&(A=A.map(D=>D)),y(e,["promptTokensDetails"],A)}const p=g(n,["cacheTokensDetails"]);if(p!=null){let A=p;Array.isArray(A)&&(A=A.map(D=>D)),y(e,["cacheTokensDetails"],A)}const T=g(n,["candidatesTokensDetails"]);if(T!=null){let A=T;Array.isArray(A)&&(A=A.map(D=>D)),y(e,["responseTokensDetails"],A)}const x=g(n,["toolUsePromptTokensDetails"]);if(x!=null){let A=x;Array.isArray(A)&&(A=A.map(D=>D)),y(e,["toolUsePromptTokensDetails"],A)}const C=g(n,["trafficType"]);return C!=null&&y(e,["trafficType"],C),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function W4(n){const e={},t=g(n,["data"]);if(t!=null&&y(e,["data"],t),g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function Y4(n){const e={},t=g(n,["content"]);t!=null&&y(e,["content"],t);const i=g(n,["citationMetadata"]);i!=null&&y(e,["citationMetadata"],J4(i));const s=g(n,["tokenCount"]);s!=null&&y(e,["tokenCount"],s);const o=g(n,["finishReason"]);o!=null&&y(e,["finishReason"],o);const l=g(n,["avgLogprobs"]);l!=null&&y(e,["avgLogprobs"],l);const d=g(n,["groundingMetadata"]);d!=null&&y(e,["groundingMetadata"],d);const h=g(n,["index"]);h!=null&&y(e,["index"],h);const p=g(n,["logprobsResult"]);p!=null&&y(e,["logprobsResult"],p);const T=g(n,["safetyRatings"]);if(T!=null){let C=T;Array.isArray(C)&&(C=C.map(A=>A)),y(e,["safetyRatings"],C)}const x=g(n,["urlContextMetadata"]);return x!=null&&y(e,["urlContextMetadata"],x),e}function J4(n){const e={},t=g(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),y(e,["citations"],i)}return e}function Z4(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let o=ur(s);Array.isArray(o)&&(o=o.map(l=>l)),y(t,["contents"],o)}return t}function Q4(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["tokensInfo"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),y(e,["tokensInfo"],s)}return e}function $4(n){const e={},t=g(n,["values"]);t!=null&&y(e,["values"],t);const i=g(n,["statistics"]);return i!=null&&y(e,["statistics"],X4(i)),e}function X4(n){const e={},t=g(n,["truncated"]);t!=null&&y(e,["truncated"],t);const i=g(n,["token_count"]);return i!=null&&y(e,["tokenCount"],i),e}function bg(n){const e={},t=g(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>lV(o))),y(e,["parts"],s)}const i=g(n,["role"]);return i!=null&&y(e,["role"],i),e}function e3(n){const e={},t=g(n,["controlType"]);t!=null&&y(e,["controlType"],t);const i=g(n,["enableControlImageComputation"]);return i!=null&&y(e,["computeControl"],i),e}function t3(n){const e={};if(g(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(g(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(g(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function n3(n,e){const t={},i=g(n,["systemInstruction"]);e!==void 0&&i!=null&&y(e,["systemInstruction"],Vi(i));const s=g(n,["tools"]);if(e!==void 0&&s!=null){let l=s;Array.isArray(l)&&(l=l.map(d=>J1(d))),y(e,["tools"],l)}const o=g(n,["generationConfig"]);return e!==void 0&&o!=null&&y(e,["generationConfig"],W3(o)),t}function i3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let l=ur(s);Array.isArray(l)&&(l=l.map(d=>bg(d))),y(t,["contents"],l)}const o=g(e,["config"]);return o!=null&&t3(o),t}function s3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let l=ur(s);Array.isArray(l)&&(l=l.map(d=>d)),y(t,["contents"],l)}const o=g(e,["config"]);return o!=null&&n3(o,t),t}function r3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["totalTokens"]);i!=null&&y(e,["totalTokens"],i);const s=g(n,["cachedContentTokenCount"]);return s!=null&&y(e,["cachedContentTokenCount"],s),e}function o3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["totalTokens"]);return i!=null&&y(e,["totalTokens"],i),e}function a3(n,e){const t={},i=g(e,["model"]);return i!=null&&y(t,["_url","name"],Ht(n,i)),t}function l3(n,e){const t={},i=g(e,["model"]);return i!=null&&y(t,["_url","name"],Ht(n,i)),t}function u3(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function c3(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}function d3(n,e){const t={},i=g(n,["outputGcsUri"]);e!==void 0&&i!=null&&y(e,["parameters","storageUri"],i);const s=g(n,["negativePrompt"]);e!==void 0&&s!=null&&y(e,["parameters","negativePrompt"],s);const o=g(n,["numberOfImages"]);e!==void 0&&o!=null&&y(e,["parameters","sampleCount"],o);const l=g(n,["aspectRatio"]);e!==void 0&&l!=null&&y(e,["parameters","aspectRatio"],l);const d=g(n,["guidanceScale"]);e!==void 0&&d!=null&&y(e,["parameters","guidanceScale"],d);const h=g(n,["seed"]);e!==void 0&&h!=null&&y(e,["parameters","seed"],h);const p=g(n,["safetyFilterLevel"]);e!==void 0&&p!=null&&y(e,["parameters","safetySetting"],p);const T=g(n,["personGeneration"]);e!==void 0&&T!=null&&y(e,["parameters","personGeneration"],T);const x=g(n,["includeSafetyAttributes"]);e!==void 0&&x!=null&&y(e,["parameters","includeSafetyAttributes"],x);const C=g(n,["includeRaiReason"]);e!==void 0&&C!=null&&y(e,["parameters","includeRaiReason"],C);const A=g(n,["language"]);e!==void 0&&A!=null&&y(e,["parameters","language"],A);const D=g(n,["outputMimeType"]);e!==void 0&&D!=null&&y(e,["parameters","outputOptions","mimeType"],D);const F=g(n,["outputCompressionQuality"]);e!==void 0&&F!=null&&y(e,["parameters","outputOptions","compressionQuality"],F);const H=g(n,["addWatermark"]);e!==void 0&&H!=null&&y(e,["parameters","addWatermark"],H);const X=g(n,["labels"]);e!==void 0&&X!=null&&y(e,["labels"],X);const re=g(n,["editMode"]);e!==void 0&&re!=null&&y(e,["parameters","editMode"],re);const Q=g(n,["baseSteps"]);return e!==void 0&&Q!=null&&y(e,["parameters","editConfig","baseSteps"],Q),t}function h3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["prompt"]);s!=null&&y(t,["instances[0]","prompt"],s);const o=g(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(h=>mV(h))),y(t,["instances[0]","referenceImages"],d)}const l=g(e,["config"]);return l!=null&&d3(l,t),t}function f3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>Ig(o))),y(e,["generatedImages"],s)}return e}function m3(n,e){const t={},i=g(n,["taskType"]);e!==void 0&&i!=null&&y(e,["requests[]","taskType"],i);const s=g(n,["title"]);e!==void 0&&s!=null&&y(e,["requests[]","title"],s);const o=g(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&y(e,["requests[]","outputDimensionality"],o),g(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function p3(n,e){const t={},i=g(n,["taskType"]);e!==void 0&&i!=null&&y(e,["instances[]","task_type"],i);const s=g(n,["title"]);e!==void 0&&s!=null&&y(e,["instances[]","title"],s);const o=g(n,["outputDimensionality"]);e!==void 0&&o!=null&&y(e,["parameters","outputDimensionality"],o);const l=g(n,["mimeType"]);e!==void 0&&l!=null&&y(e,["instances[]","mimeType"],l);const d=g(n,["autoTruncate"]);return e!==void 0&&d!=null&&y(e,["parameters","autoTruncate"],d),t}function g3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let d=eT(n,s);Array.isArray(d)&&(d=d.map(h=>h)),y(t,["requests[]","content"],d)}const o=g(e,["config"]);o!=null&&m3(o,t);const l=g(e,["model"]);return l!==void 0&&y(t,["requests[]","model"],Ht(n,l)),t}function _3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let l=eT(n,s);Array.isArray(l)&&(l=l.map(d=>d)),y(t,["instances[]","content"],l)}const o=g(e,["config"]);return o!=null&&p3(o,t),t}function y3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["embeddings"],o)}const s=g(n,["metadata"]);return s!=null&&y(e,["metadata"],s),e}function v3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["predictions[]","embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>$4(l))),y(e,["embeddings"],o)}const s=g(n,["metadata"]);return s!=null&&y(e,["metadata"],s),e}function T3(n){const e={},t=g(n,["endpoint"]);t!=null&&y(e,["name"],t);const i=g(n,["deployedModelId"]);return i!=null&&y(e,["deployedModelId"],i),e}function E3(n){const e={};if(g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=g(n,["fileUri"]);t!=null&&y(e,["fileUri"],t);const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function x3(n){const e={},t=g(n,["id"]);t!=null&&y(e,["id"],t);const i=g(n,["args"]);i!=null&&y(e,["args"],i);const s=g(n,["name"]);if(s!=null&&y(e,["name"],s),g(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function w3(n){const e={},t=g(n,["mode"]);t!=null&&y(e,["mode"],t);const i=g(n,["allowedFunctionNames"]);if(i!=null&&y(e,["allowedFunctionNames"],i),g(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function S3(n){const e={};if(g(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=g(n,["description"]);t!=null&&y(e,["description"],t);const i=g(n,["name"]);i!=null&&y(e,["name"],i);const s=g(n,["parameters"]);s!=null&&y(e,["parameters"],s);const o=g(n,["parametersJsonSchema"]);o!=null&&y(e,["parametersJsonSchema"],o);const l=g(n,["response"]);l!=null&&y(e,["response"],l);const d=g(n,["responseJsonSchema"]);return d!=null&&y(e,["responseJsonSchema"],d),e}function C3(n,e,t){const i={},s=g(e,["systemInstruction"]);t!==void 0&&s!=null&&y(t,["systemInstruction"],bg(Vi(s)));const o=g(e,["temperature"]);o!=null&&y(i,["temperature"],o);const l=g(e,["topP"]);l!=null&&y(i,["topP"],l);const d=g(e,["topK"]);d!=null&&y(i,["topK"],d);const h=g(e,["candidateCount"]);h!=null&&y(i,["candidateCount"],h);const p=g(e,["maxOutputTokens"]);p!=null&&y(i,["maxOutputTokens"],p);const T=g(e,["stopSequences"]);T!=null&&y(i,["stopSequences"],T);const x=g(e,["responseLogprobs"]);x!=null&&y(i,["responseLogprobs"],x);const C=g(e,["logprobs"]);C!=null&&y(i,["logprobs"],C);const A=g(e,["presencePenalty"]);A!=null&&y(i,["presencePenalty"],A);const D=g(e,["frequencyPenalty"]);D!=null&&y(i,["frequencyPenalty"],D);const F=g(e,["seed"]);F!=null&&y(i,["seed"],F);const H=g(e,["responseMimeType"]);H!=null&&y(i,["responseMimeType"],H);const X=g(e,["responseSchema"]);X!=null&&y(i,["responseSchema"],tT(X));const re=g(e,["responseJsonSchema"]);if(re!=null&&y(i,["responseJsonSchema"],re),g(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const Q=g(e,["safetySettings"]);if(t!==void 0&&Q!=null){let W=Q;Array.isArray(W)&&(W=W.map(z=>pV(z))),y(t,["safetySettings"],W)}const he=g(e,["tools"]);if(t!==void 0&&he!=null){let W=wd(he);Array.isArray(W)&&(W=W.map(z=>xV(xd(z)))),y(t,["tools"],W)}const fe=g(e,["toolConfig"]);if(t!==void 0&&fe!=null&&y(t,["toolConfig"],EV(fe)),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const Y=g(e,["cachedContent"]);t!==void 0&&Y!=null&&y(t,["cachedContent"],ta(n,Y));const k=g(e,["responseModalities"]);k!=null&&y(i,["responseModalities"],k);const B=g(e,["mediaResolution"]);B!=null&&y(i,["mediaResolution"],B);const O=g(e,["speechConfig"]);if(O!=null&&y(i,["speechConfig"],nT(O)),g(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=g(e,["thinkingConfig"]);q!=null&&y(i,["thinkingConfig"],q);const G=g(e,["imageConfig"]);return G!=null&&y(i,["imageConfig"],$3(G)),i}function b3(n,e,t){const i={},s=g(e,["systemInstruction"]);t!==void 0&&s!=null&&y(t,["systemInstruction"],Vi(s));const o=g(e,["temperature"]);o!=null&&y(i,["temperature"],o);const l=g(e,["topP"]);l!=null&&y(i,["topP"],l);const d=g(e,["topK"]);d!=null&&y(i,["topK"],d);const h=g(e,["candidateCount"]);h!=null&&y(i,["candidateCount"],h);const p=g(e,["maxOutputTokens"]);p!=null&&y(i,["maxOutputTokens"],p);const T=g(e,["stopSequences"]);T!=null&&y(i,["stopSequences"],T);const x=g(e,["responseLogprobs"]);x!=null&&y(i,["responseLogprobs"],x);const C=g(e,["logprobs"]);C!=null&&y(i,["logprobs"],C);const A=g(e,["presencePenalty"]);A!=null&&y(i,["presencePenalty"],A);const D=g(e,["frequencyPenalty"]);D!=null&&y(i,["frequencyPenalty"],D);const F=g(e,["seed"]);F!=null&&y(i,["seed"],F);const H=g(e,["responseMimeType"]);H!=null&&y(i,["responseMimeType"],H);const X=g(e,["responseSchema"]);X!=null&&y(i,["responseSchema"],tT(X));const re=g(e,["responseJsonSchema"]);re!=null&&y(i,["responseJsonSchema"],re);const Q=g(e,["routingConfig"]);Q!=null&&y(i,["routingConfig"],Q);const he=g(e,["modelSelectionConfig"]);he!=null&&y(i,["modelConfig"],he);const fe=g(e,["safetySettings"]);if(t!==void 0&&fe!=null){let se=fe;Array.isArray(se)&&(se=se.map(Ce=>Ce)),y(t,["safetySettings"],se)}const Y=g(e,["tools"]);if(t!==void 0&&Y!=null){let se=wd(Y);Array.isArray(se)&&(se=se.map(Ce=>J1(xd(Ce)))),y(t,["tools"],se)}const k=g(e,["toolConfig"]);t!==void 0&&k!=null&&y(t,["toolConfig"],k);const B=g(e,["labels"]);t!==void 0&&B!=null&&y(t,["labels"],B);const O=g(e,["cachedContent"]);t!==void 0&&O!=null&&y(t,["cachedContent"],ta(n,O));const q=g(e,["responseModalities"]);q!=null&&y(i,["responseModalities"],q);const G=g(e,["mediaResolution"]);G!=null&&y(i,["mediaResolution"],G);const W=g(e,["speechConfig"]);W!=null&&y(i,["speechConfig"],Y1(nT(W)));const z=g(e,["audioTimestamp"]);z!=null&&y(i,["audioTimestamp"],z);const Ge=g(e,["thinkingConfig"]);Ge!=null&&y(i,["thinkingConfig"],Ge);const $e=g(e,["imageConfig"]);return $e!=null&&y(i,["imageConfig"],X3($e)),i}function Tb(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let l=ur(s);Array.isArray(l)&&(l=l.map(d=>bg(d))),y(t,["contents"],l)}const o=g(e,["config"]);return o!=null&&y(t,["generationConfig"],C3(n,o,t)),t}function Eb(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["contents"]);if(s!=null){let l=ur(s);Array.isArray(l)&&(l=l.map(d=>d)),y(t,["contents"],l)}const o=g(e,["config"]);return o!=null&&y(t,["generationConfig"],b3(n,o,t)),t}function xb(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["candidates"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(p=>Y4(p))),y(e,["candidates"],h)}const s=g(n,["modelVersion"]);s!=null&&y(e,["modelVersion"],s);const o=g(n,["promptFeedback"]);o!=null&&y(e,["promptFeedback"],o);const l=g(n,["responseId"]);l!=null&&y(e,["responseId"],l);const d=g(n,["usageMetadata"]);return d!=null&&y(e,["usageMetadata"],d),e}function wb(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["candidates"]);if(i!=null){let p=i;Array.isArray(p)&&(p=p.map(T=>T)),y(e,["candidates"],p)}const s=g(n,["createTime"]);s!=null&&y(e,["createTime"],s);const o=g(n,["modelVersion"]);o!=null&&y(e,["modelVersion"],o);const l=g(n,["promptFeedback"]);l!=null&&y(e,["promptFeedback"],l);const d=g(n,["responseId"]);d!=null&&y(e,["responseId"],d);const h=g(n,["usageMetadata"]);return h!=null&&y(e,["usageMetadata"],h),e}function I3(n,e){const t={};if(g(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=g(n,["numberOfImages"]);e!==void 0&&i!=null&&y(e,["parameters","sampleCount"],i);const s=g(n,["aspectRatio"]);e!==void 0&&s!=null&&y(e,["parameters","aspectRatio"],s);const o=g(n,["guidanceScale"]);if(e!==void 0&&o!=null&&y(e,["parameters","guidanceScale"],o),g(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=g(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&y(e,["parameters","safetySetting"],l);const d=g(n,["personGeneration"]);e!==void 0&&d!=null&&y(e,["parameters","personGeneration"],d);const h=g(n,["includeSafetyAttributes"]);e!==void 0&&h!=null&&y(e,["parameters","includeSafetyAttributes"],h);const p=g(n,["includeRaiReason"]);e!==void 0&&p!=null&&y(e,["parameters","includeRaiReason"],p);const T=g(n,["language"]);e!==void 0&&T!=null&&y(e,["parameters","language"],T);const x=g(n,["outputMimeType"]);e!==void 0&&x!=null&&y(e,["parameters","outputOptions","mimeType"],x);const C=g(n,["outputCompressionQuality"]);if(e!==void 0&&C!=null&&y(e,["parameters","outputOptions","compressionQuality"],C),g(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(g(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const A=g(n,["imageSize"]);if(e!==void 0&&A!=null&&y(e,["parameters","sampleImageSize"],A),g(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function A3(n,e){const t={},i=g(n,["outputGcsUri"]);e!==void 0&&i!=null&&y(e,["parameters","storageUri"],i);const s=g(n,["negativePrompt"]);e!==void 0&&s!=null&&y(e,["parameters","negativePrompt"],s);const o=g(n,["numberOfImages"]);e!==void 0&&o!=null&&y(e,["parameters","sampleCount"],o);const l=g(n,["aspectRatio"]);e!==void 0&&l!=null&&y(e,["parameters","aspectRatio"],l);const d=g(n,["guidanceScale"]);e!==void 0&&d!=null&&y(e,["parameters","guidanceScale"],d);const h=g(n,["seed"]);e!==void 0&&h!=null&&y(e,["parameters","seed"],h);const p=g(n,["safetyFilterLevel"]);e!==void 0&&p!=null&&y(e,["parameters","safetySetting"],p);const T=g(n,["personGeneration"]);e!==void 0&&T!=null&&y(e,["parameters","personGeneration"],T);const x=g(n,["includeSafetyAttributes"]);e!==void 0&&x!=null&&y(e,["parameters","includeSafetyAttributes"],x);const C=g(n,["includeRaiReason"]);e!==void 0&&C!=null&&y(e,["parameters","includeRaiReason"],C);const A=g(n,["language"]);e!==void 0&&A!=null&&y(e,["parameters","language"],A);const D=g(n,["outputMimeType"]);e!==void 0&&D!=null&&y(e,["parameters","outputOptions","mimeType"],D);const F=g(n,["outputCompressionQuality"]);e!==void 0&&F!=null&&y(e,["parameters","outputOptions","compressionQuality"],F);const H=g(n,["addWatermark"]);e!==void 0&&H!=null&&y(e,["parameters","addWatermark"],H);const X=g(n,["labels"]);e!==void 0&&X!=null&&y(e,["labels"],X);const re=g(n,["imageSize"]);e!==void 0&&re!=null&&y(e,["parameters","sampleImageSize"],re);const Q=g(n,["enhancePrompt"]);return e!==void 0&&Q!=null&&y(e,["parameters","enhancePrompt"],Q),t}function N3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["prompt"]);s!=null&&y(t,["instances[0]","prompt"],s);const o=g(e,["config"]);return o!=null&&I3(o,t),t}function R3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["prompt"]);s!=null&&y(t,["instances[0]","prompt"],s);const o=g(e,["config"]);return o!=null&&A3(o,t),t}function M3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>G3(l))),y(e,["generatedImages"],o)}const s=g(n,["positivePromptSafetyAttributes"]);return s!=null&&y(e,["positivePromptSafetyAttributes"],K1(s)),e}function P3(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>Ig(l))),y(e,["generatedImages"],o)}const s=g(n,["positivePromptSafetyAttributes"]);return s!=null&&y(e,["positivePromptSafetyAttributes"],W1(s)),e}function k3(n,e){const t={},i=g(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&y(e,["parameters","sampleCount"],i),g(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=g(n,["durationSeconds"]);if(e!==void 0&&s!=null&&y(e,["parameters","durationSeconds"],s),g(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=g(n,["aspectRatio"]);e!==void 0&&o!=null&&y(e,["parameters","aspectRatio"],o);const l=g(n,["resolution"]);e!==void 0&&l!=null&&y(e,["parameters","resolution"],l);const d=g(n,["personGeneration"]);if(e!==void 0&&d!=null&&y(e,["parameters","personGeneration"],d),g(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=g(n,["negativePrompt"]);e!==void 0&&h!=null&&y(e,["parameters","negativePrompt"],h);const p=g(n,["enhancePrompt"]);if(e!==void 0&&p!=null&&y(e,["parameters","enhancePrompt"],p),g(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const T=g(n,["lastFrame"]);e!==void 0&&T!=null&&y(e,["instances[0]","lastFrame"],Ag(T));const x=g(n,["referenceImages"]);if(e!==void 0&&x!=null){let C=x;Array.isArray(C)&&(C=C.map(A=>LV(A))),y(e,["instances[0]","referenceImages"],C)}if(g(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(g(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function D3(n,e){const t={},i=g(n,["numberOfVideos"]);e!==void 0&&i!=null&&y(e,["parameters","sampleCount"],i);const s=g(n,["outputGcsUri"]);e!==void 0&&s!=null&&y(e,["parameters","storageUri"],s);const o=g(n,["fps"]);e!==void 0&&o!=null&&y(e,["parameters","fps"],o);const l=g(n,["durationSeconds"]);e!==void 0&&l!=null&&y(e,["parameters","durationSeconds"],l);const d=g(n,["seed"]);e!==void 0&&d!=null&&y(e,["parameters","seed"],d);const h=g(n,["aspectRatio"]);e!==void 0&&h!=null&&y(e,["parameters","aspectRatio"],h);const p=g(n,["resolution"]);e!==void 0&&p!=null&&y(e,["parameters","resolution"],p);const T=g(n,["personGeneration"]);e!==void 0&&T!=null&&y(e,["parameters","personGeneration"],T);const x=g(n,["pubsubTopic"]);e!==void 0&&x!=null&&y(e,["parameters","pubsubTopic"],x);const C=g(n,["negativePrompt"]);e!==void 0&&C!=null&&y(e,["parameters","negativePrompt"],C);const A=g(n,["enhancePrompt"]);e!==void 0&&A!=null&&y(e,["parameters","enhancePrompt"],A);const D=g(n,["generateAudio"]);e!==void 0&&D!=null&&y(e,["parameters","generateAudio"],D);const F=g(n,["lastFrame"]);e!==void 0&&F!=null&&y(e,["instances[0]","lastFrame"],Pr(F));const H=g(n,["referenceImages"]);if(e!==void 0&&H!=null){let Q=H;Array.isArray(Q)&&(Q=Q.map(he=>VV(he))),y(e,["instances[0]","referenceImages"],Q)}const X=g(n,["mask"]);e!==void 0&&X!=null&&y(e,["instances[0]","mask"],DV(X));const re=g(n,["compressionQuality"]);return e!==void 0&&re!=null&&y(e,["parameters","compressionQuality"],re),t}function L3(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response","generateVideoResponse"]);return l!=null&&y(e,["response"],F3(l)),e}function V3(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response"]);return l!=null&&y(e,["response"],B3(l)),e}function O3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["prompt"]);s!=null&&y(t,["instances[0]","prompt"],s);const o=g(e,["image"]);o!=null&&y(t,["instances[0]","image"],Ag(o));const l=g(e,["video"]);l!=null&&y(t,["instances[0]","video"],Z1(l));const d=g(e,["source"]);d!=null&&z3(d,t);const h=g(e,["config"]);return h!=null&&k3(h,t),t}function U3(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["prompt"]);s!=null&&y(t,["instances[0]","prompt"],s);const o=g(e,["image"]);o!=null&&y(t,["instances[0]","image"],Pr(o));const l=g(e,["video"]);l!=null&&y(t,["instances[0]","video"],Q1(l));const d=g(e,["source"]);d!=null&&q3(d,t);const h=g(e,["config"]);return h!=null&&D3(h,t),t}function F3(n){const e={},t=g(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>j3(l))),y(e,["generatedVideos"],o)}const i=g(n,["raiMediaFilteredCount"]);i!=null&&y(e,["raiMediaFilteredCount"],i);const s=g(n,["raiMediaFilteredReasons"]);return s!=null&&y(e,["raiMediaFilteredReasons"],s),e}function B3(n){const e={},t=g(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>K3(l))),y(e,["generatedVideos"],o)}const i=g(n,["raiMediaFilteredCount"]);i!=null&&y(e,["raiMediaFilteredCount"],i);const s=g(n,["raiMediaFilteredReasons"]);return s!=null&&y(e,["raiMediaFilteredReasons"],s),e}function z3(n,e){const t={},i=g(n,["prompt"]);e!==void 0&&i!=null&&y(e,["instances[0]","prompt"],i);const s=g(n,["image"]);e!==void 0&&s!=null&&y(e,["instances[0]","image"],Ag(s));const o=g(n,["video"]);return e!==void 0&&o!=null&&y(e,["instances[0]","video"],Z1(o)),t}function q3(n,e){const t={},i=g(n,["prompt"]);e!==void 0&&i!=null&&y(e,["instances[0]","prompt"],i);const s=g(n,["image"]);e!==void 0&&s!=null&&y(e,["instances[0]","image"],Pr(s));const o=g(n,["video"]);return e!==void 0&&o!=null&&y(e,["instances[0]","video"],Q1(o)),t}function G3(n){const e={},t=g(n,["_self"]);t!=null&&y(e,["image"],eV(t));const i=g(n,["raiFilteredReason"]);i!=null&&y(e,["raiFilteredReason"],i);const s=g(n,["_self"]);return s!=null&&y(e,["safetyAttributes"],K1(s)),e}function Ig(n){const e={},t=g(n,["_self"]);t!=null&&y(e,["image"],j1(t));const i=g(n,["raiFilteredReason"]);i!=null&&y(e,["raiFilteredReason"],i);const s=g(n,["_self"]);s!=null&&y(e,["safetyAttributes"],W1(s));const o=g(n,["prompt"]);return o!=null&&y(e,["enhancedPrompt"],o),e}function H3(n){const e={},t=g(n,["_self"]);t!=null&&y(e,["mask"],j1(t));const i=g(n,["labels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),y(e,["labels"],s)}return e}function j3(n){const e={},t=g(n,["video"]);return t!=null&&y(e,["video"],PV(t)),e}function K3(n){const e={},t=g(n,["_self"]);return t!=null&&y(e,["video"],kV(t)),e}function W3(n){const e={},t=g(n,["modelSelectionConfig"]);t!=null&&y(e,["modelConfig"],t);const i=g(n,["responseJsonSchema"]);i!=null&&y(e,["responseJsonSchema"],i);const s=g(n,["audioTimestamp"]);s!=null&&y(e,["audioTimestamp"],s);const o=g(n,["candidateCount"]);o!=null&&y(e,["candidateCount"],o);const l=g(n,["enableAffectiveDialog"]);l!=null&&y(e,["enableAffectiveDialog"],l);const d=g(n,["frequencyPenalty"]);d!=null&&y(e,["frequencyPenalty"],d);const h=g(n,["logprobs"]);h!=null&&y(e,["logprobs"],h);const p=g(n,["maxOutputTokens"]);p!=null&&y(e,["maxOutputTokens"],p);const T=g(n,["mediaResolution"]);T!=null&&y(e,["mediaResolution"],T);const x=g(n,["presencePenalty"]);x!=null&&y(e,["presencePenalty"],x);const C=g(n,["responseLogprobs"]);C!=null&&y(e,["responseLogprobs"],C);const A=g(n,["responseMimeType"]);A!=null&&y(e,["responseMimeType"],A);const D=g(n,["responseModalities"]);D!=null&&y(e,["responseModalities"],D);const F=g(n,["responseSchema"]);F!=null&&y(e,["responseSchema"],F);const H=g(n,["routingConfig"]);H!=null&&y(e,["routingConfig"],H);const X=g(n,["seed"]);X!=null&&y(e,["seed"],X);const re=g(n,["speechConfig"]);re!=null&&y(e,["speechConfig"],Y1(re));const Q=g(n,["stopSequences"]);Q!=null&&y(e,["stopSequences"],Q);const he=g(n,["temperature"]);he!=null&&y(e,["temperature"],he);const fe=g(n,["thinkingConfig"]);fe!=null&&y(e,["thinkingConfig"],fe);const Y=g(n,["topK"]);Y!=null&&y(e,["topK"],Y);const k=g(n,["topP"]);if(k!=null&&y(e,["topP"],k),g(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Y3(n,e){const t={},i=g(e,["model"]);return i!=null&&y(t,["_url","name"],Ht(n,i)),t}function J3(n,e){const t={},i=g(e,["model"]);return i!=null&&y(t,["_url","name"],Ht(n,i)),t}function Z3(n){const e={};if(g(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=g(n,["enableWidget"]);return t!=null&&y(e,["enableWidget"],t),e}function Q3(n){const e={};if(g(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=g(n,["timeRangeFilter"]);return t!=null&&y(e,["timeRangeFilter"],t),e}function $3(n){const e={},t=g(n,["aspectRatio"]);t!=null&&y(e,["aspectRatio"],t);const i=g(n,["imageSize"]);if(i!=null&&y(e,["imageSize"],i),g(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(g(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function X3(n){const e={},t=g(n,["aspectRatio"]);t!=null&&y(e,["aspectRatio"],t);const i=g(n,["imageSize"]);i!=null&&y(e,["imageSize"],i);const s=g(n,["outputMimeType"]);s!=null&&y(e,["imageOutputOptions","mimeType"],s);const o=g(n,["outputCompressionQuality"]);return o!=null&&y(e,["imageOutputOptions","compressionQuality"],o),e}function eV(n){const e={},t=g(n,["bytesBase64Encoded"]);t!=null&&y(e,["imageBytes"],pl(t));const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function j1(n){const e={},t=g(n,["gcsUri"]);t!=null&&y(e,["gcsUri"],t);const i=g(n,["bytesBase64Encoded"]);i!=null&&y(e,["imageBytes"],pl(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function Ag(n){const e={};if(g(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=g(n,["imageBytes"]);t!=null&&y(e,["bytesBase64Encoded"],pl(t));const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function Pr(n){const e={},t=g(n,["gcsUri"]);t!=null&&y(e,["gcsUri"],t);const i=g(n,["imageBytes"]);i!=null&&y(e,["bytesBase64Encoded"],pl(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function tV(n,e,t){const i={},s=g(e,["pageSize"]);t!==void 0&&s!=null&&y(t,["_query","pageSize"],s);const o=g(e,["pageToken"]);t!==void 0&&o!=null&&y(t,["_query","pageToken"],o);const l=g(e,["filter"]);t!==void 0&&l!=null&&y(t,["_query","filter"],l);const d=g(e,["queryBase"]);return t!==void 0&&d!=null&&y(t,["_url","models_url"],O1(n,d)),i}function nV(n,e,t){const i={},s=g(e,["pageSize"]);t!==void 0&&s!=null&&y(t,["_query","pageSize"],s);const o=g(e,["pageToken"]);t!==void 0&&o!=null&&y(t,["_query","pageToken"],o);const l=g(e,["filter"]);t!==void 0&&l!=null&&y(t,["_query","filter"],l);const d=g(e,["queryBase"]);return t!==void 0&&d!=null&&y(t,["_url","models_url"],O1(n,d)),i}function iV(n,e){const t={},i=g(e,["config"]);return i!=null&&tV(n,i,t),t}function sV(n,e){const t={},i=g(e,["config"]);return i!=null&&nV(n,i,t),t}function rV(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["_self"]);if(s!=null){let o=U1(s);Array.isArray(o)&&(o=o.map(l=>Gv(l))),y(e,["models"],o)}return e}function oV(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["_self"]);if(s!=null){let o=U1(s);Array.isArray(o)&&(o=o.map(l=>Hv(l))),y(e,["models"],o)}return e}function aV(n){const e={},t=g(n,["maskMode"]);t!=null&&y(e,["maskMode"],t);const i=g(n,["segmentationClasses"]);i!=null&&y(e,["maskClasses"],i);const s=g(n,["maskDilation"]);return s!=null&&y(e,["dilation"],s),e}function Gv(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["displayName"]);i!=null&&y(e,["displayName"],i);const s=g(n,["description"]);s!=null&&y(e,["description"],s);const o=g(n,["version"]);o!=null&&y(e,["version"],o);const l=g(n,["_self"]);l!=null&&y(e,["tunedModelInfo"],wV(l));const d=g(n,["inputTokenLimit"]);d!=null&&y(e,["inputTokenLimit"],d);const h=g(n,["outputTokenLimit"]);h!=null&&y(e,["outputTokenLimit"],h);const p=g(n,["supportedGenerationMethods"]);p!=null&&y(e,["supportedActions"],p);const T=g(n,["temperature"]);T!=null&&y(e,["temperature"],T);const x=g(n,["maxTemperature"]);x!=null&&y(e,["maxTemperature"],x);const C=g(n,["topP"]);C!=null&&y(e,["topP"],C);const A=g(n,["topK"]);A!=null&&y(e,["topK"],A);const D=g(n,["thinking"]);return D!=null&&y(e,["thinking"],D),e}function Hv(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["displayName"]);i!=null&&y(e,["displayName"],i);const s=g(n,["description"]);s!=null&&y(e,["description"],s);const o=g(n,["versionId"]);o!=null&&y(e,["version"],o);const l=g(n,["deployedModels"]);if(l!=null){let x=l;Array.isArray(x)&&(x=x.map(C=>T3(C))),y(e,["endpoints"],x)}const d=g(n,["labels"]);d!=null&&y(e,["labels"],d);const h=g(n,["_self"]);h!=null&&y(e,["tunedModelInfo"],SV(h));const p=g(n,["defaultCheckpointId"]);p!=null&&y(e,["defaultCheckpointId"],p);const T=g(n,["checkpoints"]);if(T!=null){let x=T;Array.isArray(x)&&(x=x.map(C=>C)),y(e,["checkpoints"],x)}return e}function lV(n){const e={},t=g(n,["mediaResolution"]);t!=null&&y(e,["mediaResolution"],t);const i=g(n,["codeExecutionResult"]);i!=null&&y(e,["codeExecutionResult"],i);const s=g(n,["executableCode"]);s!=null&&y(e,["executableCode"],s);const o=g(n,["fileData"]);o!=null&&y(e,["fileData"],E3(o));const l=g(n,["functionCall"]);l!=null&&y(e,["functionCall"],x3(l));const d=g(n,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(n,["inlineData"]);h!=null&&y(e,["inlineData"],W4(h));const p=g(n,["text"]);p!=null&&y(e,["text"],p);const T=g(n,["thought"]);T!=null&&y(e,["thought"],T);const x=g(n,["thoughtSignature"]);x!=null&&y(e,["thoughtSignature"],x);const C=g(n,["videoMetadata"]);return C!=null&&y(e,["videoMetadata"],C),e}function uV(n){const e={},t=g(n,["productImage"]);return t!=null&&y(e,["image"],Pr(t)),e}function cV(n,e){const t={},i=g(n,["numberOfImages"]);e!==void 0&&i!=null&&y(e,["parameters","sampleCount"],i);const s=g(n,["baseSteps"]);e!==void 0&&s!=null&&y(e,["parameters","baseSteps"],s);const o=g(n,["outputGcsUri"]);e!==void 0&&o!=null&&y(e,["parameters","storageUri"],o);const l=g(n,["seed"]);e!==void 0&&l!=null&&y(e,["parameters","seed"],l);const d=g(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&y(e,["parameters","safetySetting"],d);const h=g(n,["personGeneration"]);e!==void 0&&h!=null&&y(e,["parameters","personGeneration"],h);const p=g(n,["addWatermark"]);e!==void 0&&p!=null&&y(e,["parameters","addWatermark"],p);const T=g(n,["outputMimeType"]);e!==void 0&&T!=null&&y(e,["parameters","outputOptions","mimeType"],T);const x=g(n,["outputCompressionQuality"]);e!==void 0&&x!=null&&y(e,["parameters","outputOptions","compressionQuality"],x);const C=g(n,["enhancePrompt"]);e!==void 0&&C!=null&&y(e,["parameters","enhancePrompt"],C);const A=g(n,["labels"]);return e!==void 0&&A!=null&&y(e,["labels"],A),t}function dV(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["source"]);s!=null&&fV(s,t);const o=g(e,["config"]);return o!=null&&cV(o,t),t}function hV(n){const e={},t=g(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>Ig(s))),y(e,["generatedImages"],i)}return e}function fV(n,e){const t={},i=g(n,["prompt"]);e!==void 0&&i!=null&&y(e,["instances[0]","prompt"],i);const s=g(n,["personImage"]);e!==void 0&&s!=null&&y(e,["instances[0]","personImage","image"],Pr(s));const o=g(n,["productImages"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(d=>uV(d))),y(e,["instances[0]","productImages"],l)}return t}function mV(n){const e={},t=g(n,["referenceImage"]);t!=null&&y(e,["referenceImage"],Pr(t));const i=g(n,["referenceId"]);i!=null&&y(e,["referenceId"],i);const s=g(n,["referenceType"]);s!=null&&y(e,["referenceType"],s);const o=g(n,["maskImageConfig"]);o!=null&&y(e,["maskImageConfig"],aV(o));const l=g(n,["controlImageConfig"]);l!=null&&y(e,["controlImageConfig"],e3(l));const d=g(n,["styleImageConfig"]);d!=null&&y(e,["styleImageConfig"],d);const h=g(n,["subjectImageConfig"]);return h!=null&&y(e,["subjectImageConfig"],h),e}function K1(n){const e={},t=g(n,["safetyAttributes","categories"]);t!=null&&y(e,["categories"],t);const i=g(n,["safetyAttributes","scores"]);i!=null&&y(e,["scores"],i);const s=g(n,["contentType"]);return s!=null&&y(e,["contentType"],s),e}function W1(n){const e={},t=g(n,["safetyAttributes","categories"]);t!=null&&y(e,["categories"],t);const i=g(n,["safetyAttributes","scores"]);i!=null&&y(e,["scores"],i);const s=g(n,["contentType"]);return s!=null&&y(e,["contentType"],s),e}function pV(n){const e={},t=g(n,["category"]);if(t!=null&&y(e,["category"],t),g(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=g(n,["threshold"]);return i!=null&&y(e,["threshold"],i),e}function gV(n){const e={},t=g(n,["image"]);return t!=null&&y(e,["image"],Pr(t)),e}function _V(n,e){const t={},i=g(n,["mode"]);e!==void 0&&i!=null&&y(e,["parameters","mode"],i);const s=g(n,["maxPredictions"]);e!==void 0&&s!=null&&y(e,["parameters","maxPredictions"],s);const o=g(n,["confidenceThreshold"]);e!==void 0&&o!=null&&y(e,["parameters","confidenceThreshold"],o);const l=g(n,["maskDilation"]);e!==void 0&&l!=null&&y(e,["parameters","maskDilation"],l);const d=g(n,["binaryColorThreshold"]);e!==void 0&&d!=null&&y(e,["parameters","binaryColorThreshold"],d);const h=g(n,["labels"]);return e!==void 0&&h!=null&&y(e,["labels"],h),t}function yV(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["source"]);s!=null&&TV(s,t);const o=g(e,["config"]);return o!=null&&_V(o,t),t}function vV(n){const e={},t=g(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>H3(s))),y(e,["generatedMasks"],i)}return e}function TV(n,e){const t={},i=g(n,["prompt"]);e!==void 0&&i!=null&&y(e,["instances[0]","prompt"],i);const s=g(n,["image"]);e!==void 0&&s!=null&&y(e,["instances[0]","image"],Pr(s));const o=g(n,["scribbleImage"]);return e!==void 0&&o!=null&&y(e,["instances[0]","scribble"],gV(o)),t}function Y1(n){const e={},t=g(n,["languageCode"]);t!=null&&y(e,["languageCode"],t);const i=g(n,["voiceConfig"]);if(i!=null&&y(e,["voiceConfig"],i),g(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function EV(n){const e={},t=g(n,["functionCallingConfig"]);t!=null&&y(e,["functionCallingConfig"],w3(t));const i=g(n,["retrievalConfig"]);return i!=null&&y(e,["retrievalConfig"],i),e}function xV(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let T=t;Array.isArray(T)&&(T=T.map(x=>x)),y(e,["functionDeclarations"],T)}if(g(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=g(n,["googleSearchRetrieval"]);i!=null&&y(e,["googleSearchRetrieval"],i);const s=g(n,["computerUse"]);s!=null&&y(e,["computerUse"],s);const o=g(n,["fileSearch"]);o!=null&&y(e,["fileSearch"],o);const l=g(n,["codeExecution"]);if(l!=null&&y(e,["codeExecution"],l),g(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=g(n,["googleMaps"]);d!=null&&y(e,["googleMaps"],Z3(d));const h=g(n,["googleSearch"]);h!=null&&y(e,["googleSearch"],Q3(h));const p=g(n,["urlContext"]);return p!=null&&y(e,["urlContext"],p),e}function J1(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let x=t;Array.isArray(x)&&(x=x.map(C=>S3(C))),y(e,["functionDeclarations"],x)}const i=g(n,["retrieval"]);i!=null&&y(e,["retrieval"],i);const s=g(n,["googleSearchRetrieval"]);s!=null&&y(e,["googleSearchRetrieval"],s);const o=g(n,["computerUse"]);if(o!=null&&y(e,["computerUse"],o),g(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=g(n,["codeExecution"]);l!=null&&y(e,["codeExecution"],l);const d=g(n,["enterpriseWebSearch"]);d!=null&&y(e,["enterpriseWebSearch"],d);const h=g(n,["googleMaps"]);h!=null&&y(e,["googleMaps"],h);const p=g(n,["googleSearch"]);p!=null&&y(e,["googleSearch"],p);const T=g(n,["urlContext"]);return T!=null&&y(e,["urlContext"],T),e}function wV(n){const e={},t=g(n,["baseModel"]);t!=null&&y(e,["baseModel"],t);const i=g(n,["createTime"]);i!=null&&y(e,["createTime"],i);const s=g(n,["updateTime"]);return s!=null&&y(e,["updateTime"],s),e}function SV(n){const e={},t=g(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&y(e,["baseModel"],t);const i=g(n,["createTime"]);i!=null&&y(e,["createTime"],i);const s=g(n,["updateTime"]);return s!=null&&y(e,["updateTime"],s),e}function CV(n,e){const t={},i=g(n,["displayName"]);e!==void 0&&i!=null&&y(e,["displayName"],i);const s=g(n,["description"]);e!==void 0&&s!=null&&y(e,["description"],s);const o=g(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&y(e,["defaultCheckpointId"],o),t}function bV(n,e){const t={},i=g(n,["displayName"]);e!==void 0&&i!=null&&y(e,["displayName"],i);const s=g(n,["description"]);e!==void 0&&s!=null&&y(e,["description"],s);const o=g(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&y(e,["defaultCheckpointId"],o),t}function IV(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","name"],Ht(n,i));const s=g(e,["config"]);return s!=null&&CV(s,t),t}function AV(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["config"]);return s!=null&&bV(s,t),t}function NV(n,e){const t={},i=g(n,["outputGcsUri"]);e!==void 0&&i!=null&&y(e,["parameters","storageUri"],i);const s=g(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&y(e,["parameters","safetySetting"],s);const o=g(n,["personGeneration"]);e!==void 0&&o!=null&&y(e,["parameters","personGeneration"],o);const l=g(n,["includeRaiReason"]);e!==void 0&&l!=null&&y(e,["parameters","includeRaiReason"],l);const d=g(n,["outputMimeType"]);e!==void 0&&d!=null&&y(e,["parameters","outputOptions","mimeType"],d);const h=g(n,["outputCompressionQuality"]);e!==void 0&&h!=null&&y(e,["parameters","outputOptions","compressionQuality"],h);const p=g(n,["enhanceInputImage"]);e!==void 0&&p!=null&&y(e,["parameters","upscaleConfig","enhanceInputImage"],p);const T=g(n,["imagePreservationFactor"]);e!==void 0&&T!=null&&y(e,["parameters","upscaleConfig","imagePreservationFactor"],T);const x=g(n,["labels"]);e!==void 0&&x!=null&&y(e,["labels"],x);const C=g(n,["numberOfImages"]);e!==void 0&&C!=null&&y(e,["parameters","sampleCount"],C);const A=g(n,["mode"]);return e!==void 0&&A!=null&&y(e,["parameters","mode"],A),t}function RV(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["_url","model"],Ht(n,i));const s=g(e,["image"]);s!=null&&y(t,["instances[0]","image"],Pr(s));const o=g(e,["upscaleFactor"]);o!=null&&y(t,["parameters","upscaleConfig","upscaleFactor"],o);const l=g(e,["config"]);return l!=null&&NV(l,t),t}function MV(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>Ig(o))),y(e,["generatedImages"],s)}return e}function PV(n){const e={},t=g(n,["uri"]);t!=null&&y(e,["uri"],t);const i=g(n,["encodedVideo"]);i!=null&&y(e,["videoBytes"],pl(i));const s=g(n,["encoding"]);return s!=null&&y(e,["mimeType"],s),e}function kV(n){const e={},t=g(n,["gcsUri"]);t!=null&&y(e,["uri"],t);const i=g(n,["bytesBase64Encoded"]);i!=null&&y(e,["videoBytes"],pl(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function DV(n){const e={},t=g(n,["image"]);t!=null&&y(e,["_self"],Pr(t));const i=g(n,["maskMode"]);return i!=null&&y(e,["maskMode"],i),e}function LV(n){const e={},t=g(n,["image"]);t!=null&&y(e,["image"],Ag(t));const i=g(n,["referenceType"]);return i!=null&&y(e,["referenceType"],i),e}function VV(n){const e={},t=g(n,["image"]);t!=null&&y(e,["image"],Pr(t));const i=g(n,["referenceType"]);return i!=null&&y(e,["referenceType"],i),e}function Z1(n){const e={},t=g(n,["uri"]);t!=null&&y(e,["uri"],t);const i=g(n,["videoBytes"]);i!=null&&y(e,["encodedVideo"],pl(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["encoding"],s),e}function Q1(n){const e={},t=g(n,["uri"]);t!=null&&y(e,["gcsUri"],t);const i=g(n,["videoBytes"]);i!=null&&y(e,["bytesBase64Encoded"],pl(i));const s=g(n,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const OV="Content-Type",UV="X-Server-Timeout",FV="User-Agent",jv="x-goog-api-client",BV="1.30.0",zV=`google-genai-sdk/${BV}`,qV="v1beta1",GV="v1beta",Sb=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class HV{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:qV,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:GV,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const s=[this.getRequestUrlInternal(t)];return i&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[l,d]of Object.entries(e.queryParams))s.searchParams.append(l,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.unaryApiCall(s,o,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[s,o]of Object.entries(t))typeof o=="object"?i[s]=Object.assign(Object.assign({},i[s]),o):o!==void 0&&(i[s]=o);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,i);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.streamApiCall(s,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,s){if(t&&t.timeout||s){const o=new AbortController,l=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const d=setTimeout(()=>o.abort(),t.timeout);d&&typeof d.unref=="function"&&d.unref()}s&&s.addEventListener("abort",()=>{o.abort()}),e.signal=l}return t&&t.extraBody!==null&&jV(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async s=>(await Cb(s),new Bv(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async s=>(await Cb(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){var t;return Hc(this,arguments,function*(){const s=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let l="";for(;;){const{done:d,value:h}=yield xn(s.read());if(d){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=o.decode(h,{stream:!0});try{const x=JSON.parse(p);if("error"in x){const C=JSON.parse(JSON.stringify(x.error)),A=C.status,D=C.code,F=`got status: ${A}. ${JSON.stringify(x)}`;if(D>=400&&D<600)throw new Cg({message:F,status:D})}}catch(x){if(x.name==="ApiError")throw x}l+=p;let T=l.match(Sb);for(;T;){const x=T[1];try{const C=new Response(x,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield xn(new Bv(C)),l=l.slice(T[0].length),T=l.match(Sb)}catch(C){throw new Error(`exception parsing stream chunk ${x}. ${C}`)}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=zV+" "+this.clientOptions.userAgentExtra;return e[FV]=t,e[jv]=t,e[OV]="application/json",e}async getHeadersInternal(e,t){const i=new Headers;if(e&&e.headers){for(const[s,o]of Object.entries(e.headers))i.append(s,o);e.timeout&&e.timeout>0&&i.append(UV,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const o=this.clientOptions.uploader,l=await o.stat(e);s.sizeBytes=String(l.size);const d=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:l.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=d;const h={file:s},p=this.getFileName(e),T=Oe("upload/v1beta/files",h._url),x=await this.fetchUploadUrl(T,s.sizeBytes,s.mimeType,p,h,t==null?void 0:t.httpOptions);return o.upload(e,x,this)}async uploadFileToFileSearchStore(e,t,i){var s;const o=this.clientOptions.uploader,l=await o.stat(t),d=String(l.size),h=(s=i==null?void 0:i.mimeType)!==null&&s!==void 0?s:l.type;if(h===void 0||h==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const p=`upload/v1beta/${e}:uploadToFileSearchStore`,T=this.getFileName(t),x={};i!=null&&i.customMetadata&&(x.customMetadata=i.customMetadata),i!=null&&i.chunkingConfig&&(x.chunkingConfig=i.chunkingConfig);const C=await this.fetchUploadUrl(p,d,h,T,x,i==null?void 0:i.httpOptions);return o.uploadToFileSearchStore(t,C,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,s,o,l){var d;let h={};l?h=l:h={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},s?{"X-Goog-Upload-File-Name":s}:{})};const p=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:h});if(!p||!(p!=null&&p.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const T=(d=p==null?void 0:p.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(T===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return T}}async function Cb(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const s=JSON.stringify(i);throw t>=400&&t<600?new Cg({message:s,status:t}):new Error(s)}}function jV(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(o,l){const d=Object.assign({},o);for(const h in l)if(Object.prototype.hasOwnProperty.call(l,h)){const p=l[h],T=d[h];p&&typeof p=="object"&&!Array.isArray(p)&&T&&typeof T=="object"&&!Array.isArray(T)?d[h]=i(T,p):(T&&p&&typeof T!=typeof p&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${h}". Original type: ${typeof T}, New type: ${typeof p}. Overwriting.`),d[h]=p)}return d}const s=i(t,e);n.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KV="mcp_used/unknown";let WV=!1;function $1(n){for(const e of n)if(YV(e)||typeof e=="object"&&"inputSchema"in e)return!0;return WV}function X1(n){var e;const t=(e=n[jv])!==null&&e!==void 0?e:"";n[jv]=(t+` ${KV}`).trimStart()}function YV(n){return n!==null&&typeof n=="object"&&n instanceof sT}function JV(n,e=100){return Hc(this,arguments,function*(){let i,s=0;for(;s<e;){const o=yield xn(n.listTools({cursor:i}));for(const l of o.tools)yield yield xn(l),s++;if(!o.nextCursor)break;i=o.nextCursor}})}class sT{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new sT(e,t)}async initialize(){var e,t,i,s;if(this.mcpTools.length>0)return;const o={},l=[];for(const T of this.mcpClients)try{for(var d=!0,h=(t=void 0,qh(JV(T))),p;p=await h.next(),e=p.done,!e;d=!0){s=p.value,d=!1;const x=s;l.push(x);const C=x.name;if(o[C])throw new Error(`Duplicate function name ${C} found in MCP tools. Please ensure function names are unique.`);o[C]=T}}catch(x){t={error:x}}finally{try{!d&&!e&&(i=h.return)&&await i.call(h)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),z5(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[i.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const l=await s.callTool({name:i.name,arguments:i.args},void 0,o);t.push({functionResponse:{name:i.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function ZV(n,e,t){const i=new k5;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(i,s),e(i)}class QV{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),l=eO(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),h=`${s}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let p=()=>{};const T=new Promise(Q=>{p=Q}),x=e.callbacks,C=function(){p({})},A=this.apiClient,D={onopen:C,onmessage:Q=>{ZV(A,x.onmessage,Q)},onerror:(t=x==null?void 0:x.onerror)!==null&&t!==void 0?t:function(Q){},onclose:(i=x==null?void 0:x.onclose)!==null&&i!==void 0?i:function(Q){}},F=this.webSocketFactory.create(h,XV(l),D);F.connect(),await T;const re={setup:{model:Ht(this.apiClient,e.model)}};return F.send(JSON.stringify(re)),new $V(F,this.apiClient)}}class $V{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=U4(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=O4(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Bc.PLAY)}pause(){this.sendPlaybackControl(Bc.PAUSE)}stop(){this.sendPlaybackControl(Bc.STOP)}resetContext(){this.sendPlaybackControl(Bc.RESET_CONTEXT)}close(){this.conn.close()}}function XV(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function eO(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tO="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function nO(n,e,t){const i=new P5;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const o=JSON.parse(s);if(n.isVertexAI()){const l=z4(o);Object.assign(i,l)}else Object.assign(i,o);e(i)}class iO{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new QV(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,s,o,l,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const h=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion();let T;const x=this.apiClient.getHeaders();e.config&&e.config.tools&&$1(e.config.tools)&&X1(x);const C=aO(x);if(this.apiClient.isVertexAI())T=`${h}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(C,T);else{const O=this.apiClient.getApiKey();let q="BidiGenerateContent",G="key";O!=null&&O.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),p!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),q="BidiGenerateContentConstrained",G="access_token"),T=`${h}/ws/google.ai.generativelanguage.${p}.GenerativeService.${q}?${G}=${O}`}let A=()=>{};const D=new Promise(O=>{A=O}),F=e.callbacks,H=function(){var O;(O=F==null?void 0:F.onopen)===null||O===void 0||O.call(F),A({})},X=this.apiClient,re={onopen:H,onmessage:O=>{nO(X,F.onmessage,O)},onerror:(t=F==null?void 0:F.onerror)!==null&&t!==void 0?t:function(O){},onclose:(i=F==null?void 0:F.onclose)!==null&&i!==void 0?i:function(O){}},Q=this.webSocketFactory.create(T,oO(C),re);Q.connect(),await D;let he=Ht(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&he.startsWith("publishers/")){const O=this.apiClient.getProject(),q=this.apiClient.getLocation();he=`projects/${O}/locations/${q}/`+he}let fe={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Mp.AUDIO]}:e.config.responseModalities=[Mp.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const Y=(d=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&d!==void 0?d:[],k=[];for(const O of Y)if(this.isCallableTool(O)){const q=O;k.push(await q.tool())}else k.push(O);k.length>0&&(e.config.tools=k);const B={model:he,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?fe=V4(this.apiClient,B):fe=L4(this.apiClient,B),delete fe.config,Q.send(JSON.stringify(fe)),new rO(Q,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const sO={turnComplete:!0};class rO{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=ur(t.turns),e.isVertexAI()||(i=i.map(s=>bg(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const o of i){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(tO)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},sO),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:B4(e)}:t={realtimeInput:F4(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function oO(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function aO(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bb=10;function Ib(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const l of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(jc(l)){s=!0;break}if(!s)return!0;const o=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function jc(n){return"callTool"in n&&typeof n.callTool=="function"}function lO(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>jc(s)))!==null&&i!==void 0?i:!1}function Ab(n){var e;const t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,s)=>{if(jc(i))return;const o=i;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(s)}),t}function Nb(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uO extends ea{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,s,o,l,d;const h=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!lO(t)||Ib(t.config))return await this.generateContentInternal(h);const p=Ab(t);if(p.length>0){const F=p.map(H=>`tools[${H}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${F}.`)}let T,x;const C=ur(h.contents),A=(o=(s=(i=h.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:bb;let D=0;for(;D<A&&(T=await this.generateContentInternal(h),!(!T.functionCalls||T.functionCalls.length===0));){const F=T.candidates[0].content,H=[];for(const X of(d=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&d!==void 0?d:[])if(jc(X)){const Q=await X.callTool(T.functionCalls);H.push(...Q)}D++,x={role:"user",parts:H},h.contents=ur(h.contents),h.contents.push(F),h.contents.push(x),Nb(h.config)&&(C.push(F),C.push(x))}return Nb(h.config)&&(T.automaticFunctionCallingHistory=C),T},this.generateContentStream=async t=>{var i,s,o,l,d;if(this.maybeMoveToResponseJsonSchem(t),Ib(t.config)){const x=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(x)}const h=Ab(t);if(h.length>0){const x=h.map(C=>`tools[${C}]`).join(", ");throw new Error(`Incompatible tools found at ${x}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const p=(o=(s=(i=t==null?void 0:t.config)===null||i===void 0?void 0:i.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,T=(d=(l=t==null?void 0:t.config)===null||l===void 0?void 0:l.automaticFunctionCalling)===null||d===void 0?void 0:d.disable;if(p&&!T)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var s;let o;const l=[];if(i!=null&&i.generatedImages)for(const h of i.generatedImages)h&&(h!=null&&h.safetyAttributes)&&((s=h==null?void 0:h.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?o=h==null?void 0:h.safetyAttributes:l.push(h);let d;return o?d={generatedImages:l,positivePromptSafetyAttributes:o,sdkHttpResponse:i.sdkHttpResponse}:d={generatedImages:l,sdkHttpResponse:i.sdkHttpResponse},d}),this.list=async t=>{var i;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((i=l.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Ou(Ko.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(l),l)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var i,s,o,l,d,h;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((l=(o=t.source)===null||o===void 0?void 0:o.video)===null||l===void 0)&&l.uri&&(!((h=(d=t.source)===null||d===void 0?void 0:d.video)===null||h===void 0)&&h.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,s;const o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;const l=await Promise.all(o.map(async h=>jc(h)?await h.tool():h)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(d.config.tools=l,e.config&&e.config.tools&&$1(e.config.tools)){const h=(s=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&s!==void 0?s:{};let p=Object.assign({},h);Object.keys(p).length===0&&(p=this.apiClient.getDefaultHeaders()),X1(p),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:p})}return d}async initAfcToolsMap(e){var t,i,s;const o=new Map;for(const l of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(jc(l)){const d=l,h=await d.tool();for(const p of(s=h.functionDeclarations)!==null&&s!==void 0?s:[]){if(!p.name)throw new Error("Function declaration name is required.");if(o.has(p.name))throw new Error(`Duplicate tool declaration name: ${p.name}`);o.set(p.name,d)}}return o}async processAfcStream(e){var t,i,s;const o=(s=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:bb;let l=!1,d=0;const h=await this.initAfcToolsMap(e);return(function(p,T,x){var C,A;return Hc(this,arguments,function*(){for(var D,F,H,X;d<o;){l&&(d++,l=!1);const fe=yield xn(p.processParamsMaybeAddMcpUsage(x)),Y=yield xn(p.generateContentStreamInternal(fe)),k=[],B=[];try{for(var re=!0,Q=(F=void 0,qh(Y)),he;he=yield xn(Q.next()),D=he.done,!D;re=!0){X=he.value,re=!1;const O=X;if(yield yield xn(O),O.candidates&&(!((C=O.candidates[0])===null||C===void 0)&&C.content)){B.push(O.candidates[0].content);for(const q of(A=O.candidates[0].content.parts)!==null&&A!==void 0?A:[])if(d<o&&q.functionCall){if(!q.functionCall.name)throw new Error("Function call name was not returned by the model.");if(T.has(q.functionCall.name)){const G=yield xn(T.get(q.functionCall.name).callTool([q.functionCall]));k.push(...G)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${T.keys()}, mising tool: ${q.functionCall.name}`)}}}}catch(O){F={error:O}}finally{try{!re&&!D&&(H=Q.return)&&(yield xn(H.call(Q)))}finally{if(F)throw F.error}}if(k.length>0){l=!0;const O=new wh;O.candidates=[{content:{role:"user",parts:k}}],yield yield xn(O);const q=[];q.push(...B),q.push({role:"user",parts:k});const G=ur(x.contents).concat(q);x.contents=G}else break}})})(this,h,e)}async generateContentInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=Eb(this.apiClient,e);return d=Oe("{model}:generateContent",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=wb(T),C=new wh;return Object.assign(C,x),C})}else{const p=Tb(this.apiClient,e);return d=Oe("{model}:generateContent",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=xb(T),C=new wh;return Object.assign(C,x),C})}}async generateContentStreamInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=Eb(this.apiClient,e);return d=Oe("{model}:streamGenerateContent?alt=sse",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.requestStream({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),l.then(function(x){return Hc(this,arguments,function*(){var C,A,D,F;try{for(var H=!0,X=qh(x),re;re=yield xn(X.next()),C=re.done,!C;H=!0){F=re.value,H=!1;const Q=F,he=wb(yield xn(Q.json()));he.sdkHttpResponse={headers:Q.headers};const fe=new wh;Object.assign(fe,he),yield yield xn(fe)}}catch(Q){A={error:Q}}finally{try{!H&&!C&&(D=X.return)&&(yield xn(D.call(X)))}finally{if(A)throw A.error}}})})}else{const p=Tb(this.apiClient,e);return d=Oe("{model}:streamGenerateContent?alt=sse",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.requestStream({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(x){return Hc(this,arguments,function*(){var C,A,D,F;try{for(var H=!0,X=qh(x),re;re=yield xn(X.next()),C=re.done,!C;H=!0){F=re.value,H=!1;const Q=F,he=xb(yield xn(Q.json()));he.sdkHttpResponse={headers:Q.headers};const fe=new wh;Object.assign(fe,he),yield yield xn(fe)}}catch(Q){A={error:Q}}finally{try{!H&&!C&&(D=X.return)&&(yield xn(D.call(X)))}finally{if(A)throw A.error}}})})}}async embedContent(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=_3(this.apiClient,e);return d=Oe("{model}:predict",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=v3(T),C=new sb;return Object.assign(C,x),C})}else{const p=g3(this.apiClient,e);return d=Oe("{model}:batchEmbedContents",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=y3(T),C=new sb;return Object.assign(C,x),C})}}async generateImagesInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=R3(this.apiClient,e);return d=Oe("{model}:predict",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=P3(T),C=new rb;return Object.assign(C,x),C})}else{const p=N3(this.apiClient,e);return d=Oe("{model}:predict",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=M3(T),C=new rb;return Object.assign(C,x),C})}}async editImageInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=h3(this.apiClient,e);return o=Oe("{model}:predict",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>{const p=f3(h),T=new E5;return Object.assign(T,p),T})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=RV(this.apiClient,e);return o=Oe("{model}:predict",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>{const p=MV(h),T=new x5;return Object.assign(T,p),T})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=dV(this.apiClient,e);return o=Oe("{model}:predict",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=hV(h),T=new w5;return Object.assign(T,p),T})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=yV(this.apiClient,e);return o=Oe("{model}:predict",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=vV(h),T=new S5;return Object.assign(T,p),T})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=J3(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>Hv(T))}else{const p=Y3(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>Gv(T))}}async listInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=sV(this.apiClient,e);return d=Oe("{models_url}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=oV(T),C=new ob;return Object.assign(C,x),C})}else{const p=iV(this.apiClient,e);return d=Oe("{models_url}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=rV(T),C=new ob;return Object.assign(C,x),C})}}async update(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=AV(this.apiClient,e);return d=Oe("{model}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>Hv(T))}else{const p=IV(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>Gv(T))}}async delete(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=l3(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=c3(T),C=new ab;return Object.assign(C,x),C})}else{const p=a3(this.apiClient,e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=u3(T),C=new ab;return Object.assign(C,x),C})}}async countTokens(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=s3(this.apiClient,e);return d=Oe("{model}:countTokens",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=o3(T),C=new lb;return Object.assign(C,x),C})}else{const p=i3(this.apiClient,e);return d=Oe("{model}:countTokens",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=r3(T),C=new lb;return Object.assign(C,x),C})}}async computeTokens(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=Z4(this.apiClient,e);return o=Oe("{model}:computeTokens",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>{const p=Q4(h),T=new C5;return Object.assign(T,p),T})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=U3(this.apiClient,e);return d=Oe("{model}:predictLongRunning",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l.then(T=>{const x=V3(T),C=new Pp;return Object.assign(C,x),C})}else{const p=O3(this.apiClient,e);return d=Oe("{model}:predictLongRunning",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l.then(T=>{const x=L3(T),C=new Pp;return Object.assign(C,x),C})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cO extends ea{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;i&&"httpOptions"in i&&(o=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;i&&"httpOptions"in i&&(o=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=p5(e);return d=Oe("{operationName}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json()),l}else{const p=m5(e);return d=Oe("{operationName}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json()),l}}async fetchPredictVideosOperationInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=a5(e);return o=Oe("{resourceName}:fetchPredictOperation",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dO(n){const e={},t=g(n,["data"]);if(t!=null&&y(e,["data"],t),g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function hO(n){const e={},t=g(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>EO(o))),y(e,["parts"],s)}const i=g(n,["role"]);return i!=null&&y(e,["role"],i),e}function fO(n,e,t){const i={},s=g(e,["expireTime"]);t!==void 0&&s!=null&&y(t,["expireTime"],s);const o=g(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&y(t,["newSessionExpireTime"],o);const l=g(e,["uses"]);t!==void 0&&l!=null&&y(t,["uses"],l);const d=g(e,["liveConnectConstraints"]);t!==void 0&&d!=null&&y(t,["bidiGenerateContentSetup"],TO(n,d));const h=g(e,["lockAdditionalFields"]);return t!==void 0&&h!=null&&y(t,["fieldMask"],h),i}function mO(n,e){const t={},i=g(e,["config"]);return i!=null&&y(t,["config"],fO(n,i,t)),t}function pO(n){const e={};if(g(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=g(n,["fileUri"]);t!=null&&y(e,["fileUri"],t);const i=g(n,["mimeType"]);return i!=null&&y(e,["mimeType"],i),e}function gO(n){const e={},t=g(n,["id"]);t!=null&&y(e,["id"],t);const i=g(n,["args"]);i!=null&&y(e,["args"],i);const s=g(n,["name"]);if(s!=null&&y(e,["name"],s),g(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(g(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function _O(n){const e={};if(g(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=g(n,["enableWidget"]);return t!=null&&y(e,["enableWidget"],t),e}function yO(n){const e={};if(g(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(g(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=g(n,["timeRangeFilter"]);return t!=null&&y(e,["timeRangeFilter"],t),e}function vO(n,e){const t={},i=g(n,["generationConfig"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig"],i);const s=g(n,["responseModalities"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig","responseModalities"],s);const o=g(n,["temperature"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","temperature"],o);const l=g(n,["topP"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","topP"],l);const d=g(n,["topK"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","topK"],d);const h=g(n,["maxOutputTokens"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","maxOutputTokens"],h);const p=g(n,["mediaResolution"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","mediaResolution"],p);const T=g(n,["seed"]);e!==void 0&&T!=null&&y(e,["setup","generationConfig","seed"],T);const x=g(n,["speechConfig"]);e!==void 0&&x!=null&&y(e,["setup","generationConfig","speechConfig"],iT(x));const C=g(n,["thinkingConfig"]);e!==void 0&&C!=null&&y(e,["setup","generationConfig","thinkingConfig"],C);const A=g(n,["enableAffectiveDialog"]);e!==void 0&&A!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],A);const D=g(n,["systemInstruction"]);e!==void 0&&D!=null&&y(e,["setup","systemInstruction"],hO(Vi(D)));const F=g(n,["tools"]);if(e!==void 0&&F!=null){let Y=wd(F);Array.isArray(Y)&&(Y=Y.map(k=>wO(xd(k)))),y(e,["setup","tools"],Y)}const H=g(n,["sessionResumption"]);e!==void 0&&H!=null&&y(e,["setup","sessionResumption"],xO(H));const X=g(n,["inputAudioTranscription"]);e!==void 0&&X!=null&&y(e,["setup","inputAudioTranscription"],X);const re=g(n,["outputAudioTranscription"]);e!==void 0&&re!=null&&y(e,["setup","outputAudioTranscription"],re);const Q=g(n,["realtimeInputConfig"]);e!==void 0&&Q!=null&&y(e,["setup","realtimeInputConfig"],Q);const he=g(n,["contextWindowCompression"]);e!==void 0&&he!=null&&y(e,["setup","contextWindowCompression"],he);const fe=g(n,["proactivity"]);return e!==void 0&&fe!=null&&y(e,["setup","proactivity"],fe),t}function TO(n,e){const t={},i=g(e,["model"]);i!=null&&y(t,["setup","model"],Ht(n,i));const s=g(e,["config"]);return s!=null&&y(t,["config"],vO(s,t)),t}function EO(n){const e={},t=g(n,["mediaResolution"]);t!=null&&y(e,["mediaResolution"],t);const i=g(n,["codeExecutionResult"]);i!=null&&y(e,["codeExecutionResult"],i);const s=g(n,["executableCode"]);s!=null&&y(e,["executableCode"],s);const o=g(n,["fileData"]);o!=null&&y(e,["fileData"],pO(o));const l=g(n,["functionCall"]);l!=null&&y(e,["functionCall"],gO(l));const d=g(n,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(n,["inlineData"]);h!=null&&y(e,["inlineData"],dO(h));const p=g(n,["text"]);p!=null&&y(e,["text"],p);const T=g(n,["thought"]);T!=null&&y(e,["thought"],T);const x=g(n,["thoughtSignature"]);x!=null&&y(e,["thoughtSignature"],x);const C=g(n,["videoMetadata"]);return C!=null&&y(e,["videoMetadata"],C),e}function xO(n){const e={},t=g(n,["handle"]);if(t!=null&&y(e,["handle"],t),g(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function wO(n){const e={},t=g(n,["functionDeclarations"]);if(t!=null){let T=t;Array.isArray(T)&&(T=T.map(x=>x)),y(e,["functionDeclarations"],T)}if(g(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=g(n,["googleSearchRetrieval"]);i!=null&&y(e,["googleSearchRetrieval"],i);const s=g(n,["computerUse"]);s!=null&&y(e,["computerUse"],s);const o=g(n,["fileSearch"]);o!=null&&y(e,["fileSearch"],o);const l=g(n,["codeExecution"]);if(l!=null&&y(e,["codeExecution"],l),g(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=g(n,["googleMaps"]);d!=null&&y(e,["googleMaps"],_O(d));const h=g(n,["googleSearch"]);h!=null&&y(e,["googleSearch"],yO(h));const p=g(n,["urlContext"]);return p!=null&&y(e,["urlContext"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SO(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const s=Object.keys(i).map(o=>`${t}.${o}`);e.push(...s)}else e.push(t)}return e.join(",")}function CO(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const o=i.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const s=n.fieldMask;if(t){const o=SO(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?n.fieldMask=o:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];s.length>0&&(d=s.map(p=>l.includes(p)?`generationConfig.${p}`:p));const h=[];o&&h.push(o),d.length>0&&h.push(...d),h.length>0?n.fieldMask=h.join(","):delete n.fieldMask}else delete n.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?n.fieldMask=s.join(","):delete n.fieldMask;return n}class bO extends ea{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=mO(this.apiClient,e);o=Oe("auth_tokens",d._url),l=d._query,delete d.config,delete d._url,delete d._query;const h=CO(d,e.config);return s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(p=>p.json()),s.then(p=>p)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IO(n,e){const t={},i=g(n,["displayName"]);return e!==void 0&&i!=null&&y(e,["displayName"],i),t}function AO(n){const e={},t=g(n,["config"]);return t!=null&&IO(t,e),e}function NO(n,e){const t={},i=g(n,["force"]);return e!==void 0&&i!=null&&y(e,["_query","force"],i),t}function RO(n){const e={},t=g(n,["name"]);t!=null&&y(e,["_url","name"],t);const i=g(n,["config"]);return i!=null&&NO(i,e),e}function MO(n){const e={},t=g(n,["name"]);return t!=null&&y(e,["_url","name"],t),e}function PO(n,e){const t={},i=g(n,["customMetadata"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["customMetadata"],o)}const s=g(n,["chunkingConfig"]);return e!==void 0&&s!=null&&y(e,["chunkingConfig"],s),t}function kO(n){const e={},t=g(n,["name"]);t!=null&&y(e,["name"],t);const i=g(n,["metadata"]);i!=null&&y(e,["metadata"],i);const s=g(n,["done"]);s!=null&&y(e,["done"],s);const o=g(n,["error"]);o!=null&&y(e,["error"],o);const l=g(n,["response"]);return l!=null&&y(e,["response"],LO(l)),e}function DO(n){const e={},t=g(n,["fileSearchStoreName"]);t!=null&&y(e,["_url","file_search_store_name"],t);const i=g(n,["fileName"]);i!=null&&y(e,["fileName"],i);const s=g(n,["config"]);return s!=null&&PO(s,e),e}function LO(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["parent"]);i!=null&&y(e,["parent"],i);const s=g(n,["documentName"]);return s!=null&&y(e,["documentName"],s),e}function VO(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);return e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),t}function OO(n){const e={},t=g(n,["config"]);return t!=null&&VO(t,e),e}function UO(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["fileSearchStores"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["fileSearchStores"],o)}return e}function FO(n,e){const t={},i=g(n,["mimeType"]);e!==void 0&&i!=null&&y(e,["mimeType"],i);const s=g(n,["displayName"]);e!==void 0&&s!=null&&y(e,["displayName"],s);const o=g(n,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(h=>h)),y(e,["customMetadata"],d)}const l=g(n,["chunkingConfig"]);return e!==void 0&&l!=null&&y(e,["chunkingConfig"],l),t}function BO(n){const e={},t=g(n,["fileSearchStoreName"]);t!=null&&y(e,["_url","file_search_store_name"],t);const i=g(n,["config"]);return i!=null&&FO(i,e),e}function zO(n){const e={},t=g(n,["sdkHttpResponse"]);return t!=null&&y(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qO(n,e){const t={},i=g(n,["force"]);return e!==void 0&&i!=null&&y(e,["_query","force"],i),t}function GO(n){const e={},t=g(n,["name"]);t!=null&&y(e,["_url","name"],t);const i=g(n,["config"]);return i!=null&&qO(i,e),e}function HO(n){const e={},t=g(n,["name"]);return t!=null&&y(e,["_url","name"],t),e}function jO(n,e){const t={},i=g(n,["pageSize"]);e!==void 0&&i!=null&&y(e,["_query","pageSize"],i);const s=g(n,["pageToken"]);return e!==void 0&&s!=null&&y(e,["_query","pageToken"],s),t}function KO(n){const e={},t=g(n,["parent"]);t!=null&&y(e,["_url","parent"],t);const i=g(n,["config"]);return i!=null&&jO(i,e),e}function WO(n){const e={},t=g(n,["sdkHttpResponse"]);t!=null&&y(e,["sdkHttpResponse"],t);const i=g(n,["nextPageToken"]);i!=null&&y(e,["nextPageToken"],i);const s=g(n,["documents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),y(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class YO extends ea{constructor(e){super(),this.apiClient=e,this.list=async t=>new Ou(Ko.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=HO(e);return o=Oe("{name}",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var t,i;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=GO(e);s=Oe("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=KO(e);return o=Oe("{parent}/documents",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=WO(h),T=new b5;return Object.assign(T,p),T})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class JO extends ea{constructor(e,t=new YO(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new Ou(Ko.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=AO(e);return o=Oe("fileSearchStores",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=MO(e);return o=Oe("{name}",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var t,i;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=RO(e);s=Oe("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=OO(e);return o=Oe("fileSearchStores",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=UO(h),T=new I5;return Object.assign(T,p),T})}}async uploadToFileSearchStoreInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=BO(e);return o=Oe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=zO(h),T=new A5;return Object.assign(T,p),T})}}async importFile(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=DO(e);return o=Oe("{file_search_store_name}:importFile",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=kO(h),T=new $0;return Object.assign(T,p),T})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ZO(n,e){const t={},i=g(n,["name"]);return i!=null&&y(t,["_url","name"],i),t}function QO(n,e){const t={},i=g(n,["name"]);return i!=null&&y(t,["_url","name"],i),t}function $O(n,e,t){const i={};if(g(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=g(n,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&y(e,["displayName"],s),g(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=g(n,["epochCount"]);e!==void 0&&o!=null&&y(e,["tuningTask","hyperparameters","epochCount"],o);const l=g(n,["learningRateMultiplier"]);if(l!=null&&y(i,["tuningTask","hyperparameters","learningRateMultiplier"],l),g(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(g(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(g(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=g(n,["batchSize"]);e!==void 0&&d!=null&&y(e,["tuningTask","hyperparameters","batchSize"],d);const h=g(n,["learningRate"]);if(e!==void 0&&h!=null&&y(e,["tuningTask","hyperparameters","learningRate"],h),g(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(g(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function XO(n,e,t){const i={};let s=g(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const A=g(n,["validationDataset"]);e!==void 0&&A!=null&&y(e,["supervisedTuningSpec"],Rb(A))}else if(s==="PREFERENCE_TUNING"){const A=g(n,["validationDataset"]);e!==void 0&&A!=null&&y(e,["preferenceOptimizationSpec"],Rb(A))}const o=g(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&y(e,["tunedModelDisplayName"],o);const l=g(n,["description"]);e!==void 0&&l!=null&&y(e,["description"],l);let d=g(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const A=g(n,["epochCount"]);e!==void 0&&A!=null&&y(e,["supervisedTuningSpec","hyperParameters","epochCount"],A)}else if(d==="PREFERENCE_TUNING"){const A=g(n,["epochCount"]);e!==void 0&&A!=null&&y(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],A)}let h=g(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const A=g(n,["learningRateMultiplier"]);e!==void 0&&A!=null&&y(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],A)}else if(h==="PREFERENCE_TUNING"){const A=g(n,["learningRateMultiplier"]);e!==void 0&&A!=null&&y(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],A)}let p=g(t,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const A=g(n,["exportLastCheckpointOnly"]);e!==void 0&&A!=null&&y(e,["supervisedTuningSpec","exportLastCheckpointOnly"],A)}else if(p==="PREFERENCE_TUNING"){const A=g(n,["exportLastCheckpointOnly"]);e!==void 0&&A!=null&&y(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],A)}let T=g(t,["config","method"]);if(T===void 0&&(T="SUPERVISED_FINE_TUNING"),T==="SUPERVISED_FINE_TUNING"){const A=g(n,["adapterSize"]);e!==void 0&&A!=null&&y(e,["supervisedTuningSpec","hyperParameters","adapterSize"],A)}else if(T==="PREFERENCE_TUNING"){const A=g(n,["adapterSize"]);e!==void 0&&A!=null&&y(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],A)}if(g(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(g(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const x=g(n,["labels"]);e!==void 0&&x!=null&&y(e,["labels"],x);const C=g(n,["beta"]);return e!==void 0&&C!=null&&y(e,["preferenceOptimizationSpec","hyperParameters","beta"],C),i}function e6(n,e){const t={},i=g(n,["baseModel"]);i!=null&&y(t,["baseModel"],i);const s=g(n,["preTunedModel"]);s!=null&&y(t,["preTunedModel"],s);const o=g(n,["trainingDataset"]);o!=null&&d6(o);const l=g(n,["config"]);return l!=null&&$O(l,t),t}function t6(n,e){const t={},i=g(n,["baseModel"]);i!=null&&y(t,["baseModel"],i);const s=g(n,["preTunedModel"]);s!=null&&y(t,["preTunedModel"],s);const o=g(n,["trainingDataset"]);o!=null&&h6(o,t,e);const l=g(n,["config"]);return l!=null&&XO(l,t,e),t}function n6(n,e){const t={},i=g(n,["name"]);return i!=null&&y(t,["_url","name"],i),t}function i6(n,e){const t={},i=g(n,["name"]);return i!=null&&y(t,["_url","name"],i),t}function s6(n,e,t){const i={},s=g(n,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(n,["pageToken"]);e!==void 0&&o!=null&&y(e,["_query","pageToken"],o);const l=g(n,["filter"]);return e!==void 0&&l!=null&&y(e,["_query","filter"],l),i}function r6(n,e,t){const i={},s=g(n,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(n,["pageToken"]);e!==void 0&&o!=null&&y(e,["_query","pageToken"],o);const l=g(n,["filter"]);return e!==void 0&&l!=null&&y(e,["_query","filter"],l),i}function o6(n,e){const t={},i=g(n,["config"]);return i!=null&&s6(i,t),t}function a6(n,e){const t={},i=g(n,["config"]);return i!=null&&r6(i,t),t}function l6(n,e){const t={},i=g(n,["sdkHttpResponse"]);i!=null&&y(t,["sdkHttpResponse"],i);const s=g(n,["nextPageToken"]);s!=null&&y(t,["nextPageToken"],s);const o=g(n,["tunedModels"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(d=>eN(d))),y(t,["tuningJobs"],l)}return t}function u6(n,e){const t={},i=g(n,["sdkHttpResponse"]);i!=null&&y(t,["sdkHttpResponse"],i);const s=g(n,["nextPageToken"]);s!=null&&y(t,["nextPageToken"],s);const o=g(n,["tuningJobs"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(d=>Kv(d))),y(t,["tuningJobs"],l)}return t}function c6(n,e){const t={},i=g(n,["name"]);i!=null&&y(t,["model"],i);const s=g(n,["name"]);return s!=null&&y(t,["endpoint"],s),t}function d6(n,e){const t={};if(g(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const i=g(n,["examples"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>o)),y(t,["examples","examples"],s)}return t}function h6(n,e,t){const i={};let s=g(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const l=g(n,["gcsUri"]);e!==void 0&&l!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(s==="PREFERENCE_TUNING"){const l=g(n,["gcsUri"]);e!==void 0&&l!=null&&y(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}let o=g(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const l=g(n,["vertexDatasetResource"]);e!==void 0&&l!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(o==="PREFERENCE_TUNING"){const l=g(n,["vertexDatasetResource"]);e!==void 0&&l!=null&&y(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}if(g(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function eN(n,e){const t={},i=g(n,["sdkHttpResponse"]);i!=null&&y(t,["sdkHttpResponse"],i);const s=g(n,["name"]);s!=null&&y(t,["name"],s);const o=g(n,["state"]);o!=null&&y(t,["state"],L1(o));const l=g(n,["createTime"]);l!=null&&y(t,["createTime"],l);const d=g(n,["tuningTask","startTime"]);d!=null&&y(t,["startTime"],d);const h=g(n,["tuningTask","completeTime"]);h!=null&&y(t,["endTime"],h);const p=g(n,["updateTime"]);p!=null&&y(t,["updateTime"],p);const T=g(n,["description"]);T!=null&&y(t,["description"],T);const x=g(n,["baseModel"]);x!=null&&y(t,["baseModel"],x);const C=g(n,["_self"]);return C!=null&&y(t,["tunedModel"],c6(C)),t}function Kv(n,e){const t={},i=g(n,["sdkHttpResponse"]);i!=null&&y(t,["sdkHttpResponse"],i);const s=g(n,["name"]);s!=null&&y(t,["name"],s);const o=g(n,["state"]);o!=null&&y(t,["state"],L1(o));const l=g(n,["createTime"]);l!=null&&y(t,["createTime"],l);const d=g(n,["startTime"]);d!=null&&y(t,["startTime"],d);const h=g(n,["endTime"]);h!=null&&y(t,["endTime"],h);const p=g(n,["updateTime"]);p!=null&&y(t,["updateTime"],p);const T=g(n,["error"]);T!=null&&y(t,["error"],T);const x=g(n,["description"]);x!=null&&y(t,["description"],x);const C=g(n,["baseModel"]);C!=null&&y(t,["baseModel"],C);const A=g(n,["tunedModel"]);A!=null&&y(t,["tunedModel"],A);const D=g(n,["preTunedModel"]);D!=null&&y(t,["preTunedModel"],D);const F=g(n,["supervisedTuningSpec"]);F!=null&&y(t,["supervisedTuningSpec"],F);const H=g(n,["preferenceOptimizationSpec"]);H!=null&&y(t,["preferenceOptimizationSpec"],H);const X=g(n,["tuningDataStats"]);X!=null&&y(t,["tuningDataStats"],X);const re=g(n,["encryptionSpec"]);re!=null&&y(t,["encryptionSpec"],re);const Q=g(n,["partnerModelTuningSpec"]);Q!=null&&y(t,["partnerModelTuningSpec"],Q);const he=g(n,["customBaseModel"]);he!=null&&y(t,["customBaseModel"],he);const fe=g(n,["experiment"]);fe!=null&&y(t,["experiment"],fe);const Y=g(n,["labels"]);Y!=null&&y(t,["labels"],Y);const k=g(n,["outputUri"]);k!=null&&y(t,["outputUri"],k);const B=g(n,["pipelineJob"]);B!=null&&y(t,["pipelineJob"],B);const O=g(n,["serviceAccount"]);O!=null&&y(t,["serviceAccount"],O);const q=g(n,["tunedModelDisplayName"]);q!=null&&y(t,["tunedModelDisplayName"],q);const G=g(n,["veoTuningSpec"]);return G!=null&&y(t,["veoTuningSpec"],G),t}function f6(n,e){const t={},i=g(n,["sdkHttpResponse"]);i!=null&&y(t,["sdkHttpResponse"],i);const s=g(n,["name"]);s!=null&&y(t,["name"],s);const o=g(n,["metadata"]);o!=null&&y(t,["metadata"],o);const l=g(n,["done"]);l!=null&&y(t,["done"],l);const d=g(n,["error"]);return d!=null&&y(t,["error"],d),t}function Rb(n,e){const t={},i=g(n,["gcsUri"]);i!=null&&y(t,["validationDatasetUri"],i);const s=g(n,["vertexDatasetResource"]);return s!=null&&y(t,["validationDatasetUri"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class m6 extends ea{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Ou(Ko.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},t),{preTunedModel:s});return o.baseModel=void 0,await this.tuneInternal(o)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),o=await this.tuneMldevInternal(s);let l="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?l=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(l=o.name.split("/operations/")[0]),{name:l,state:Fv.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=i6(e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>Kv(T))}else{const p=n6(e);return d=Oe("{name}",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>eN(T))}}async listInternal(e){var t,i,s,o;let l,d="",h={};if(this.apiClient.isVertexAI()){const p=a6(e);return d=Oe("tuningJobs",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=u6(T),C=new ub;return Object.assign(C,x),C})}else{const p=o6(e);return d=Oe("tunedModels",p._url),h=p._query,delete p._url,delete p._query,l=this.apiClient.request({path:d,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(T=>T.json().then(x=>{const C=x;return C.sdkHttpResponse={headers:T.headers},C})),l.then(T=>{const x=l6(T),C=new ub;return Object.assign(C,x),C})}}async cancel(e){var t,i,s,o;let l="",d={};if(this.apiClient.isVertexAI()){const h=QO(e);l=Oe("{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,await this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const h=ZO(e);l=Oe("{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,await this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI()){const d=t6(e,e);return o=Oe("tuningJobs",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>Kv(h))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=e6(e);return o=Oe("tunedModels",d._url),l=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const T=p;return T.sdkHttpResponse={headers:h.headers},T})),s.then(h=>f6(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class p6{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const g6=1024*1024*8,_6=3,y6=1e3,v6=2,Dp="x-goog-upload-status";async function T6(n,e,t){var i;const s=await tN(n,e,t),o=await(s==null?void 0:s.json());if(((i=s==null?void 0:s.headers)===null||i===void 0?void 0:i[Dp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function E6(n,e,t){var i;const s=await tN(n,e,t),o=await(s==null?void 0:s.json());if(((i=s==null?void 0:s.headers)===null||i===void 0?void 0:i[Dp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const l=N1(o),d=new X0;return Object.assign(d,l),d}async function tN(n,e,t){var i,s;let o=0,l=0,d=new Bv(new Response),h="upload";for(o=n.size;l<o;){const p=Math.min(g6,o-l),T=n.slice(l,l+p);l+p>=o&&(h+=", finalize");let x=0,C=y6;for(;x<_6&&(d=await t.request({path:"",body:T,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":h,"X-Goog-Upload-Offset":String(l),"Content-Length":String(p)}}}),!(!((i=d==null?void 0:d.headers)===null||i===void 0)&&i[Dp]));)x++,await w6(C),C=C*v6;if(l+=p,((s=d==null?void 0:d.headers)===null||s===void 0?void 0:s[Dp])!=="active")break;if(o<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function x6(n){return{size:n.size,type:n.type}}function w6(n){return new Promise(e=>setTimeout(e,n))}class S6{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await T6(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await E6(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await x6(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class C6{create(e,t,i){return new b6(e,t,i)}}class b6{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mb="x-goog-api-key";class I6{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Mb)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Mb,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A6="gl-node/";class nN{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=r5(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const s=new I6(this.apiKey);this.apiClient=new HV({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:A6+"web",uploader:new S6,downloader:new p6}),this.models=new uO(this.apiClient),this.live=new iO(this.apiClient,s,new C6),this.batches=new DL(this.apiClient),this.chats=new p4(this.models,this.apiClient),this.caches=new h4(this.apiClient),this.files=new C4(this.apiClient),this.operations=new cO(this.apiClient),this.authTokens=new bO(this.apiClient),this.tunings=new m6(this.apiClient),this.fileSearchStores=new JO(this.apiClient)}}const N6={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var Pb={};const R6=()=>{try{if(typeof window<"u"&&window.localStorage){const n=localStorage.getItem("nomad_user_api_key");if(n)return n}if(typeof import.meta<"u"&&N6)return"";if(typeof process<"u"&&Pb)return Pb.VITE_API_KEY||""}catch(n){console.warn("Failed to access API key",n)}return""},kr=async n=>{var i;const e=R6();let t=null;if(e)try{const s=new nN({apiKey:e});return await n(s)}catch(s){if(console.warn("Primary API Key failed",s),t=s,(i=s.message)!=null&&i.includes("403")||s.toString().includes("403"))throw new Error("Invalid API Key (403). Please check your key in Settings.")}else throw new Error("API key is missing. Please provide a valid API key in Settings.");throw new Error(`AI Service Failed. ${(t==null?void 0:t.message)||t||"Unknown error"}`)},Fi={"zh-TW":"Traditional Chinese (Taiwan) ()","en-US":"English","ja-JP":"Japanese"},Dr=n=>{if(typeof n.text=="string")return n.text;if(typeof n.text=="function")return n.text();if(n.candidates&&n.candidates[0]&&n.candidates[0].content&&n.candidates[0].content.parts&&n.candidates[0].content.parts[0].text)return n.candidates[0].content.parts[0].text;throw new Error("No text found in AI response")},Lr="gemini-flash-latest",iN=async(n,e)=>(console.warn("Image editing is not supported. Returning original image."),n),rT=async n=>{try{const e=`Cinematic travel photography of ${n}, 4k, high quality, sunny day, vibrant colors, wide angle`,t=encodeURIComponent(e),i=Math.floor(Math.random()*1e6);return`https://image.pollinations.ai/prompt/${t}?width=1600&height=900&nologo=true&seed=${i}&model=flux`}catch(e){return console.error("Failed to generate cover image:",e),`https://via.placeholder.com/1600x900/D4A574/FFFFFF?text=${encodeURIComponent(n)}`}},sN=async(n,e="zh-TW")=>{const t=Fi[e]||Fi["zh-TW"];return kr(async i=>{const s=await i.models.generateContent({model:Lr,contents:`Help me plan a trip. ${n}`,config:{systemInstruction:`You are a professional travel agent AI. 
                Create a detailed itinerary based on the user's request. 
                
                CRITICAL PLANNING RULES:
                1. **Distance & Logic**: Group attractions that are geographically close to each other on the same day.
                2. **Feasibility**: Ensure the schedule is realistic.
                3. **Language**: All content MUST be in ${t}.
                4. **Travel Info**: You MUST estimate the travel mode and duration to the NEXT activity. This is mandatory for all items except the last one of the day.
                5. **Completeness**: You MUST generate a FULL itinerary with at least 3 activities per day. Do not leave the itinerary empty.
                
                FORMAT REQUIREMENTS:
                Return response in valid JSON format. Do not use Markdown code blocks.
                The JSON must strictly follow this structure:
                {
                    "title": "Trip Title",
                    "startDate": "YYYY-MM-DD",
                    "endDate": "YYYY-MM-DD",
                    "itinerary": [
                        {
                            "id": "unique_id",
                            "day": 1,
                            "time": "09:00",
                            "activity": "Activity Name",
                            "location": "Location Address",
                            "notes": "Tips",
                            "travelToNext": {
                                "mode": "WALK/TRAIN/BUS/CAR",
                                "duration": "15 min",
                                "details": "Route details"
                            }
                        }
                    ],
                    "budget": {
                        "total": 10000,
                        "currency": "TWD",
                        "expenses": []
                    },
                    "packingList": [],
                    "weather": [
                        {
                            "date": "YYYY-MM-DD",
                            "condition": "Sunny",
                            "tempLow": 20,
                            "tempHigh": 30,
                            "icon": ""
                        }
                    ]
                }
                `,responseMimeType:"application/json"}}),o=Dr(s);if(o){const l=o.replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(l)}throw new Error("Empty response from AI")})},rN=async(n,e,t="zh-TW")=>{const i=Fi[t]||Fi["zh-TW"];return kr(async s=>{const o=await s.models.generateContent({model:Lr,contents:`Help me modify an existing trip plan.
            
            Current Trip JSON:
            ${JSON.stringify(n)}
            
            User Request: "${e}"
            
            INSTRUCTIONS:
            1. Modify the "Current Trip JSON" based on the "User Request".
            2. Keep the same structure and fields.
            3. Update the "itinerary", "bookings", "budget", etc. as needed.
            4. Ensure the response is valid JSON matching the Trip structure.
            5. All content MUST be in ${i}.
            6. Return ONLY the updated JSON.
            `,config:{responseMimeType:"application/json"}}),l=Dr(o);if(l){const d=l.replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(d)}throw new Error("Empty response from AI")})},oN=async(n,e,t="zh-TW")=>{const i=Fi[t]||Fi["zh-TW"];return kr(async s=>{try{const o=await s.models.generateContent({model:Lr,contents:`I hold a ${n} passport and want to travel to ${e}. 
                Provide visa requirements in STRICT JSON format.
                
                Required JSON Structure:
                {
                  "difficulty": "Easy / Moderate / Hard",
                  "summary": "One sentence summary",
                  "requirements": ["Requirement 1", "Requirement 2"]
                }
                
                Translate all content to ${i}.
                Return ONLY valid JSON.`,config:{responseMimeType:"application/json"}}),l=Dr(o);return JSON.parse(l)}catch(o){return console.error(o),null}})},aN=async(n,e="zh-TW")=>{const t=Fi[e]||Fi["zh-TW"];return kr(async i=>{try{const s=await i.models.generateContent({model:Lr,contents:`I am currently in (or planning to go to) ${n}. 
                Provide cultural etiquette guide in STRICT JSON format.
                
                Required JSON Structure:
                {
                  "tipping": "Tipping advice",
                  "dos": ["Do 1", "Do 2"],
                  "donts": ["Don't 1", "Don't 2"],
                  "dressCode": "Dress code advice"
                }
                
                Translate all content to ${t}.
                Return ONLY valid JSON.`,config:{responseMimeType:"application/json"}}),o=Dr(s);return JSON.parse(o)}catch(s){return console.error(s),null}})},lN=async(n,e,t="zh-TW")=>{const i=Fi[t]||Fi["zh-TW"];return kr(async s=>{try{const o=await s.models.generateContent({model:Lr,contents:`Tell me about "${e}" at "${n}". 
                Provide a very short fun fact, the best photo spot, and one "pro tip" for visiting.
                Format as simple Markdown (bold keys). Keep it under 100 words.
                Response MUST be in ${i}.`});return Dr(o)}catch(o){return console.error("Error fetching attraction guide:",o),""}})},uN=async(n,e="zh-TW")=>{const t=Fi[e]||Fi["zh-TW"];return kr(async i=>{try{const s=await i.models.generateContent({model:Lr,contents:`I am travelling in ${n}. 
                Provide emergency contact info in STRICT JSON format.
                
                Required JSON Structure:
                {
                  "numbers": [
                    {"label": "Title (e.g. Police)", "number": "110"}
                  ],
                  "hospital": {
                    "name": "Name of nearest major hospital in capital",
                    "address": "Address",
                    "phone": "Phone number"
                  }
                }
                
                Translate all labels and values to ${t}.
                Return ONLY valid JSON. Do not include markdown formatting.`}),o=Dr(s);if(!o)throw new Error("Empty response");const l=o.replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(l)}catch(s){return console.error("Emergency Info Error:",s),null}})},cN=async(n,e="zh-TW")=>{const t=Fi[e]||Fi["zh-TW"];return kr(async i=>{try{const s=await i.models.generateContent({model:Lr,contents:`I am travelling to ${n}. 
                Provide credit card advice in STRICT JSON format.
                
                Required JSON Structure:
                {
                  "bestCards": ["Visa", "Mastercard"],
                  "cashInfo": "Advice on cash usage",
                  "tips": ["Tip 1", "Tip 2"]
                }
                
                Translate all content to ${t}.
                Return ONLY valid JSON.`,config:{responseMimeType:"application/json"}}),o=Dr(s);return JSON.parse(o)}catch(s){return console.error(s),null}})},dN=async(n,e="zh-TW")=>kr(async t=>{const i=n.map(l=>({id:l.id,activity:l.activity,location:l.location,time:l.time})),s=await t.models.generateContent({model:Lr,contents:`I have a list of activities for one day. Reorder them to create the most efficient geographical route.
            
            Current Items: ${JSON.stringify(i)}
            
            Return ONLY a JSON array of strings, where each string is the 'id' of the activity in the new order.
            Do not change the time, just the order of visiting.
            Example response: ["id1", "id3", "id2"]`,config:{responseMimeType:"application/json"}}),o=Dr(s);if(o)return JSON.parse(o);throw new Error("Empty response")}),hN=async(n,e,t="zh-TW")=>kr(async i=>{try{const s=await i.models.generateContent({model:Lr,contents:`Translate the following text to ${e}.
                Text: "${n}"
                
                Only provide the translated text.`});return Dr(s)}catch(s){return console.error("Translation Error:",s),null}}),fN=async(n,e,t="zh-TW")=>{const i=Fi[t]||Fi["zh-TW"];return kr(async s=>{try{const o=n.map(d=>`${d.date}: ${d.condition}, ${d.tempLow}C - ${d.tempHigh}C`).join(`
`),l=await s.models.generateContent({model:Lr,contents:`I am travelling to ${e}. Here is the weather forecast:
                ${o}
                
                Based on this weather, give me a VERY SHORT, ONE-LINE clothing advice summary.
                Example: "It's rainy and cold, so bring a heavy coat and umbrella."
                Keep it under 20 words.
                Response MUST be in ${i}.`});return Dr(l)}catch(o){return console.error("Clothing Advice Error:",o),""}})},oT=async(n,e)=>{try{return await kr(async t=>{try{const i=await t.models.generateContent({model:Lr,contents:`What is the current exchange rate from ${n} to ${e}?
                    Return ONLY the number. Example: 0.23
                    If you are unsure, return "null".`}),s=Dr(i),o=parseFloat(s);return isNaN(o)?null:o.toString()}catch(i){return console.error("Exchange Rate Error:",i),null}})}catch(t){return console.warn("Call AI failed for exchange rate:",t),null}},M6=Object.freeze(Object.defineProperty({__proto__:null,editTravelPhoto:iN,generateCoverImage:rT,generateTripPlan:sN,getAttractionGuide:lN,getClothingAdvice:fN,getCreditCardAdvice:cN,getCulturalEtiquette:aN,getEmergencyInfo:uN,getExchangeRate:oT,getTranslation:hN,getVisaRequirements:oN,optimizeRoute:dN,updateTripPlan:rN},Symbol.toStringTag,{value:"Module"})),P6=({onSave:n,onCancel:e,settings:t,currentUser:i})=>{const s=nn[t.language]||nn["zh-TW"],[o,l]=Z.useState(""),[d,h]=Z.useState(""),[p,T]=Z.useState(""),[x,C]=Z.useState(null),[A,D]=Z.useState(!1),F=Z.useRef(null),H=Q=>{var fe;const he=(fe=Q.target.files)==null?void 0:fe[0];if(he){const Y=new FileReader;Y.onloadend=()=>{C(Y.result)},Y.readAsDataURL(he)}},X=async()=>{if(!o){alert("Please enter title");return}D(!0);try{const Q=await rT(o);C(Q)}catch(Q){console.error(Q),alert("Error")}finally{D(!1)}},re=async Q=>{if(Q.preventDefault(),!o||!d)return;let he=x;if(!he)try{const Y=`Cinematic travel photography of ${o}, 4k, high quality, sunny day`,k=encodeURIComponent(Y),B=Math.floor(Math.random()*1e6);he=`https://image.pollinations.ai/prompt/${k}?width=1600&height=900&nologo=true&seed=${B}&model=flux`}catch(Y){console.error("Failed to generate default cover",Y),he=`https://via.placeholder.com/1600x900/D4A574/FFFFFF?text=${encodeURIComponent(o)}`}const fe={id:Date.now().toString(),title:o,startDate:d,endDate:p,itinerary:[],coverImage:he,ownerId:i.id,userIds:[i.id],collaborators:[]};n(fe)};return _.jsxs("div",{className:"flex flex-col h-full bg-paper pt-safe pt-12",children:[_.jsxs("div",{className:"px-4 py-3 flex items-center gap-2 bg-paper sticky top-0 z-10 border-b border-sand/50",children:[_.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-white text-gray-500 active:scale-90 transition-transform",children:_.jsx(vs,{className:"w-6 h-6"})}),_.jsx("h2",{className:"text-lg font-bold text-ink",children:s.new_trip})]}),_.jsxs("form",{onSubmit:re,className:"p-6 space-y-8 flex-1 overflow-y-auto no-scrollbar pb-32",children:[_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1 uppercase",children:s.trip_destination_title}),_.jsx("div",{className:"relative",children:_.jsx("input",{type:"text",required:!0,value:o,onChange:Q=>l(Q.target.value),placeholder:"...",className:"w-full p-5 bg-white rounded-3xl border border-sand focus:border-coral focus:ring-1 focus:ring-coral/50 transition-all text-lg font-bold text-ink outline-none placeholder:text-gray-300 shadow-sm"})})]}),_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1 uppercase",children:s.cover_photo}),_.jsxs("div",{className:"w-full aspect-video rounded-3xl overflow-hidden bg-white border-2 border-dashed border-sand relative shadow-inner",children:[x?_.jsx("img",{src:x,alt:"Cover",className:"w-full h-full object-cover"}):_.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-300",children:[_.jsx(Xc,{className:"w-10 h-10 mb-2 opacity-50"}),_.jsx("span",{className:"text-xs font-bold",children:"Preview"})]}),x&&_.jsx("button",{type:"button",onClick:()=>C(null),className:"absolute top-2 right-2 bg-black/50 text-white p-1.5 rounded-full backdrop-blur-sm",children:_.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),_.jsxs("div",{className:"flex gap-3 mt-2",children:[_.jsxs("button",{type:"button",onClick:()=>{var Q;return(Q=F.current)==null?void 0:Q.click()},className:"flex-1 py-3 bg-white text-gray-600 rounded-2xl font-bold text-sm border border-sand hover:border-coral hover:text-coral transition-colors flex items-center justify-center gap-1.5 shadow-sm",children:[_.jsx(Xc,{className:"w-4 h-4"})," ",s.upload_photo]}),_.jsx("input",{type:"file",ref:F,className:"hidden",accept:"image/*",onChange:H}),_.jsx("button",{type:"button",onClick:X,disabled:A||!o,className:"flex-1 py-3 bg-purple-50 text-purple-600 rounded-2xl font-bold text-sm hover:bg-purple-100 transition-colors flex items-center justify-center gap-1.5 disabled:opacity-50 disabled:cursor-not-allowed border border-purple-100",children:A?_.jsx("span",{className:"animate-pulse",children:"..."}):_.jsxs(_.Fragment,{children:[_.jsx(Xa,{className:"w-4 h-4"})," ",s.ai_generate_cover]})})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-3",children:[_.jsxs("label",{className:"text-xs font-bold text-gray-400 ml-1 uppercase flex items-center gap-1",children:[_.jsx(Vv,{className:"w-3 h-3 text-coral"})," ",s.start_date]}),_.jsx("input",{type:"date",required:!0,value:d,onChange:Q=>h(Q.target.value),className:"w-full p-4 bg-white rounded-2xl border border-sand focus:border-coral outline-none text-sm font-bold text-ink shadow-sm"})]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("label",{className:"text-xs font-bold text-gray-400 ml-1 uppercase flex items-center gap-1",children:[_.jsx(Vv,{className:"w-3 h-3 text-gray-400"})," ",s.end_date]}),_.jsx("input",{type:"date",value:p,onChange:Q=>T(Q.target.value),className:"w-full p-4 bg-white rounded-2xl border border-sand focus:border-coral outline-none text-sm font-bold text-ink shadow-sm"})]})]}),_.jsxs("div",{className:"pt-4",children:[_.jsxs("button",{type:"submit",className:"w-full py-4 bg-coral text-white rounded-2xl font-bold text-lg shadow-float active:scale-[0.98] transition-all flex items-center justify-center gap-2 hover:bg-coralDark ring-4 ring-white",children:[_.jsx("span",{children:s.create_trip}),_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5 text-white/70",children:_.jsx("path",{fillRule:"evenodd",d:"M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z",clipRule:"evenodd"})})]}),_.jsx("p",{className:"text-center text-xs text-gray-400 mt-6 font-medium",children:s.add_trip_hint})]})]})]})},k6=({settings:n,onBack:e})=>{const t=(n==null?void 0:n.language)||"zh-TW",i=nn[t]||nn["zh-TW"],[s,o]=Z.useState(null),[l,d]=Z.useState(null),[h,p]=Z.useState(""),[T,x]=Z.useState(!1),[C,A]=Z.useState(null),D=Z.useRef(null),F=X=>{var Q;const re=(Q=X.target.files)==null?void 0:Q[0];if(re){const he=new FileReader;he.onloadend=()=>{const fe=he.result;o(fe),d(null),A(null)},he.readAsDataURL(re)}},H=async()=>{if(!(!s||!h)){x(!0),A(null);try{const X=await iN(s,h);d(X)}catch(X){A("Error"),console.error(X)}finally{x(!1)}}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper pt-safe",children:[_.jsxs("div",{className:"px-5 py-4 pt-9 bg-paper sticky top-0 z-10 flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:e,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsxs("h2",{className:"text-xl font-extrabold text-ink flex items-center gap-2",children:[_.jsx(Xa,{className:"w-6 h-6 text-coral"}),i.magic_editor_title]})]}),_.jsx("span",{className:"text-[10px] font-bold bg-white text-coral border border-coral/20 px-2 py-1 rounded-lg uppercase tracking-wider shadow-sm",children:"Beta"})]}),_.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 pb-32 no-scrollbar",children:s?_.jsxs("div",{className:"space-y-6 animate-fade-in",children:[_.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-6 snap-x no-scrollbar px-2",children:[_.jsxs("div",{className:"snap-center shrink-0 w-full bg-white p-3 pb-12 rounded-sm shadow-polaroid rotate-1 relative transition-transform hover:rotate-0 duration-300",children:[_.jsx("div",{className:"aspect-square bg-gray-100 overflow-hidden mb-2",children:_.jsx("img",{src:s,alt:"Original",className:"w-full h-full object-cover"})}),_.jsx("div",{className:"absolute bottom-4 left-4 font-handwriting text-gray-500 text-sm font-bold",children:"#Original"}),_.jsx("button",{onClick:()=>{o(null),d(null),p("")},className:"absolute -top-2 -right-2 bg-white text-ink p-2 rounded-full shadow-lg border border-sand hover:text-coral",children:_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:_.jsx("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})})})]}),l&&_.jsxs("div",{className:"snap-center shrink-0 w-full bg-white p-3 pb-12 rounded-sm shadow-polaroid -rotate-1 relative transition-transform hover:rotate-0 duration-300 ring-2 ring-coral/20",children:[_.jsx("div",{className:"aspect-square bg-gray-100 overflow-hidden mb-2",children:_.jsx("img",{src:l,alt:"Magic Result",className:"w-full h-full object-cover"})}),_.jsxs("div",{className:"absolute bottom-4 left-4 font-handwriting text-coral font-bold flex items-center gap-1",children:[_.jsx(Xa,{className:"w-4 h-4"})," #MagicEdit"]})]})]}),_.jsxs("div",{className:"bg-white p-2 rounded-3xl shadow-card border border-sand",children:[_.jsxs("div",{className:"p-4",children:[_.jsx("label",{className:"block text-sm font-bold text-gray-400 mb-2 uppercase tracking-wider",children:"Prompt"}),_.jsx("textarea",{value:h,onChange:X=>p(X.target.value),placeholder:i.magic_prompt_placeholder,className:"w-full p-4 rounded-2xl bg-paper border-0 focus:ring-2 focus:ring-coral/50 outline-none text-base resize-none h-24 placeholder:text-gray-300 font-medium text-ink"})]}),C&&_.jsxs("div",{className:"mx-4 mb-2 text-red-500 text-xs bg-red-50 p-3 rounded-xl flex items-center gap-2 font-bold",children:[_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:_.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),C]}),_.jsx("div",{className:"p-2",children:_.jsx("button",{onClick:H,disabled:T||!h.trim(),className:`w-full py-4 rounded-2xl font-bold text-white shadow-lg flex items-center justify-center gap-2 transition-all ${T||!h.trim()?"bg-gray-300 cursor-not-allowed text-gray-500 shadow-none":"bg-coral hover:bg-coralDark hover:shadow-coral/30 active:scale-[0.98]"}`,children:T?_.jsxs(_.Fragment,{children:[_.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[_.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),_.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i.generating]}):_.jsxs(_.Fragment,{children:[_.jsx(Xa,{className:"w-5 h-5 stroke-[2]"}),i.start_magic]})})})]})]}):_.jsxs("div",{onClick:()=>{var X;return(X=D.current)==null?void 0:X.click()},className:"border-2 border-dashed border-sand rounded-3xl h-80 flex flex-col items-center justify-center bg-white cursor-pointer active:scale-[0.98] transition-all hover:border-coral hover:bg-white/80 group shadow-card",children:[_.jsx("div",{className:"w-20 h-20 bg-paper rounded-full shadow-inner flex items-center justify-center mb-5 group-hover:scale-110 transition-transform",children:_.jsx(Xc,{className:"w-10 h-10 text-coral"})}),_.jsx("span",{className:"text-ink font-bold text-lg",children:i.upload_hint}),_.jsx("input",{type:"file",ref:D,onChange:F,className:"hidden",accept:"image/*"})]})})]})},D6="modulepreload",L6=function(n){return"/"+n},kb={},Ng=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let l=function(p){return Promise.all(p.map(T=>Promise.resolve(T).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=l(t.map(p=>{if(p=L6(p),p in kb)return;kb[p]=!0;const T=p.endsWith(".css"),x=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${x}`))return;const C=document.createElement("link");if(C.rel=T?"stylesheet":D6,T||(C.as="script"),C.crossOrigin="",C.href=p,h&&C.setAttribute("nonce",h),document.head.appendChild(C),T)return new Promise((A,D)=>{C.addEventListener("load",A),C.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return s.then(l=>{for(const d of l||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},V6=({items:n,onUpdateItems:e,settings:t})=>{const i=nn[t.language]||nn["zh-TW"],[s,o]=Z.useState(""),[l,d]=Z.useState(""),[h,p]=Z.useState(!1),T=()=>{if(!s.trim())return;const A={id:Date.now().toString(),item:s,bought:!1,notes:l},D=[...n,A];e(D),o(""),d(""),p(!1)},x=A=>{const D=n.map(F=>F.id===A?{...F,bought:!F.bought}:F);e(D)},C=A=>{if(confirm(i.delete_trip_confirm.replace("{title}",i.shopping_list))){const D=n.filter(F=>F.id!==A);e(D)}};return _.jsxs("div",{className:"pb-40",children:[_.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-soft text-center mt-2 border border-sand relative overflow-hidden mb-6",children:[_.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-coral"}),_.jsx("h3",{className:"text-gray-400 text-sm font-bold uppercase tracking-widest mb-2",children:i.shopping_list}),_.jsxs("div",{className:"text-5xl font-black text-ink mb-2 tracking-tight",children:[(n==null?void 0:n.filter(A=>A.bought).length)||0,_.jsx("span",{className:"text-2xl text-gray-300 mx-2",children:"/"}),_.jsx("span",{className:"text-3xl text-gray-400",children:(n==null?void 0:n.length)||0})]})]}),(n==null?void 0:n.length)>0?_.jsx("div",{className:"space-y-3",children:n==null?void 0:n.map(A=>_.jsxs("div",{className:`bg-white p-4 rounded-2xl border ${A.bought?"border-green-200 bg-green-50/30":"border-sand"} shadow-card flex items-center justify-between group transition-all`,children:[_.jsxs("div",{className:"flex items-center gap-4 flex-1",onClick:()=>x(A.id),children:[_.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center cursor-pointer transition-colors ${A.bought?"bg-green-500 border-green-500":"border-gray-300 hover:border-coral"}`,children:A.bought&&_.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),_.jsxs("div",{children:[_.jsx("div",{className:`font-bold text-lg ${A.bought?"text-gray-400 line-through":"text-ink"}`,children:A.item}),A.notes&&_.jsx("div",{className:"text-xs text-gray-400 font-medium mt-0.5",children:A.notes})]})]}),_.jsx("button",{onClick:()=>C(A.id),className:"p-2 text-gray-300 hover:text-red-500 transition-colors",children:_.jsx(al,{className:"w-5 h-5"})})]},A.id))}):_.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-4",children:[_.jsx("div",{className:"w-16 h-16 bg-sand/30 rounded-full flex items-center justify-center text-gray-400",children:_.jsx(A1,{className:"w-8 h-8"})}),_.jsxs("p",{className:"text-gray-400 font-medium",children:[i.no_itinerary,_.jsx("br",{}),_.jsx("span",{className:"text-xs",children:i.click_add})]})]}),h&&_.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>p(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up",onClick:A=>A.stopPropagation(),children:[_.jsx("h3",{className:"text-xl font-bold text-ink mb-6 text-center",children:i.add_activity}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.activity_name}),_.jsx("input",{value:s,onChange:A=>o(A.target.value),placeholder:i.shopping_list,className:"w-full bg-white p-4 rounded-xl text-base font-bold border-none shadow-sm outline-none placeholder:font-normal",autoFocus:!0})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.notes}),_.jsx("input",{value:l,onChange:A=>d(A.target.value),placeholder:"...",className:"w-full bg-white p-4 rounded-xl text-base font-medium border-none shadow-sm outline-none placeholder:font-normal"})]}),_.jsx("button",{onClick:T,disabled:!s.trim(),className:"w-full bg-coral text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-coral/30 mt-4 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",children:i.confirm})]})]})}),_.jsx("button",{onClick:()=>p(!0),className:"fixed bottom-24 right-6 w-14 h-14 bg-coral text-white rounded-full shadow-xl shadow-coral/40 flex items-center justify-center z-30 hover:bg-coralDark active:scale-90 transition-all",children:_.jsx(Sg,{className:"w-8 h-8 stroke-[2]"})})]})},O6=({trip:n,settings:e,onUpdateTrip:t,onOpenQuickExpense:i})=>{var Qe;const s=nn[e.language]||nn["zh-TW"],[o,l]=Z.useState(null),[d,h]=Z.useState(""),[p,T]=Z.useState(!1),[x,C]=Z.useState(!1),A=Z.useRef(null),[D,F]=Z.useState(!1),[H,X]=Z.useState(null),[re,Q]=Z.useState(1),[he,fe]=Z.useState("09:00"),[Y,k]=Z.useState(""),[B,O]=Z.useState(""),[q,G]=Z.useState(""),[W,z]=Z.useState(null),[Ge,$e]=Z.useState("TRAIN"),[se,Ce]=Z.useState(""),[be,it]=Z.useState(""),[Pe,K]=Z.useState(null),[me,Ie]=Z.useState(!1),le=Z.useMemo(()=>{const _e=n.itinerary||[],ke={};return[..._e].sort((mt,lt)=>mt.time.localeCompare(lt.time)).forEach(mt=>{const lt=mt.day||1;ke[lt]||(ke[lt]=[]),ke[lt].push(mt)}),ke},[n.itinerary]),ge=Z.useMemo(()=>Object.keys(le).map(Number).sort((_e,ke)=>_e-ke),[le]);Z.useEffect(()=>{o||Nt()},[o]),Z.useEffect(()=>()=>{window.speechSynthesis.cancel()},[]);const we=async()=>{const _e=[`${n.title} (${n.startDate} - ${n.endDate})`];ge.forEach(He=>{_e.push(`
Day ${He}:`),le[He].forEach(mt=>{_e.push(`${mt.time} ${mt.activity}`),mt.travelToNext&&_e.push(`   ${mt.travelToNext.mode} (${mt.travelToNext.duration})`)})});const ke=_e.join(`
`);try{navigator.share?await navigator.share({title:n.title,text:ke}):(await navigator.clipboard.writeText(ke),alert(s.share_success))}catch(He){console.error("Error sharing:",He)}},Ke=async()=>{if(!(!n.weather||n.weather.length===0)){Ie(!0);try{const _e=await fN(n.weather,n.title,e.language);K(_e)}catch{K("")}finally{Ie(!1)}}},Fe=async(_e,ke)=>{l({name:_e,location:ke}),h(""),T(!0);try{const He=await lN(ke,_e);h(He||"")}catch{h("")}finally{T(!1)}},Ye=()=>{if(x){Nt();return}if(!d)return;const _e=new SpeechSynthesisUtterance(d);_e.lang=e.language==="en-US"?"en-US":"zh-TW",_e.rate=1,_e.onend=()=>C(!1),A.current=_e,window.speechSynthesis.speak(_e),C(!0)},Nt=()=>{window.speechSynthesis.cancel(),C(!1)},Jt=async _e=>{const ke=le[_e];if(!ke||(ke==null?void 0:ke.length)<3){alert(s.optimize_route_min_items||"Need at least 3 items to optimize.");return}z(_e);try{const mt=(await dN(ke,e.language)).map(pn=>ke.find(Ts=>Ts.id===pn)).filter(Boolean),lt=ke.map(pn=>pn.time).sort(),un=mt.map((pn,Ts)=>({...pn,time:lt[Ts]})),Ji=[...(n.itinerary||[]).filter(pn=>pn.day!==_e),...un];t==null||t({...n,itinerary:Ji})}catch(He){console.error("Optimization failed",He),alert("Route optimization failed.")}finally{z(null)}},ct=_e=>{X(_e.id),Q(_e.day),fe(_e.time),k(_e.activity),O(_e.location),G(_e.notes||""),_e.travelToNext?($e(_e.travelToNext.mode),Ce(_e.travelToNext.duration),it(_e.travelToNext.details||"")):(Ce(""),it("")),F(!0)},mn=async()=>{var lt;if(!Y)return;let _e=null;if(B)try{const{geocodeAddress:un}=await Ng(async()=>{const{geocodeAddress:pn}=await Promise.resolve().then(()=>lU);return{geocodeAddress:pn}},void 0),ri=un(B),Ji=new Promise((pn,Ts)=>setTimeout(()=>Ts(new Error("Geocoding timeout")),5e3));_e=await Promise.race([ri,Ji])}catch(un){console.error("Auto-geocoding failed or timed out",un)}const ke=H?(lt=n.itinerary)==null?void 0:lt.find(un=>un.id===H):null,He={id:H||Date.now().toString(),day:Number(re),time:he,activity:Y,location:B,notes:q,coordinates:_e||(ke==null?void 0:ke.coordinates)||null,lat:(_e==null?void 0:_e.lat)??(ke==null?void 0:ke.lat)??null,lng:(_e==null?void 0:_e.lng)??(ke==null?void 0:ke.lng)??null,attachments:(ke==null?void 0:ke.attachments)||[],...se?{travelToNext:{mode:Ge,duration:se,details:be}}:{}};let mt;H?mt=(n.itinerary||[]).map(un=>un.id===H?He:un):mt=[...n.itinerary||[],He],t==null||t({...n,itinerary:mt}),X(null),k(""),O(""),G(""),Ce(""),it(""),F(!1)},Rn=_e=>{if(confirm(s.delete_trip_confirm.replace("{title}",s.itinerary))){const ke=(n.itinerary||[]).filter(He=>He.id!==_e);t==null||t({...n,itinerary:ke})}},Yt=_e=>{_e&&window.open(_e,"_blank")},Rt=_e=>{switch(_e){case"WALK":return _.jsx(ZD,{className:"w-4 h-4"});case"TRAIN":return _.jsx(oC,{className:"w-4 h-4"});case"BUS":return _.jsx(JD,{className:"w-4 h-4"});case"CAR":return _.jsx(UD,{className:"w-4 h-4"});case"FLIGHT":return _.jsx(E1,{className:"w-4 h-4"});default:return _.jsx(oC,{className:"w-4 h-4"})}},Mt=()=>{var _e,ke;return!n.weather||((_e=n.weather)==null?void 0:_e.length)===0?null:_.jsxs("div",{className:"mb-6",children:[_.jsxs("div",{className:"flex items-center justify-between mb-3",children:[_.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider ml-1",children:s.weather}),_.jsxs("button",{onClick:Ke,disabled:me,className:"text-xs font-bold text-coral flex items-center gap-1 hover:bg-coral/10 px-2 py-1 rounded-lg transition-colors",children:[_.jsx(Ov,{className:"w-3 h-3"}),me?"...":""]})]}),_.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:(ke=n.weather)==null?void 0:ke.map((He,mt)=>_.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center justify-center gap-1 bg-white border border-sand p-3 rounded-2xl min-w-[70px] shadow-sm",children:[_.jsx("span",{className:"text-[10px] font-bold text-gray-400",children:He.date}),_.jsx("span",{className:"text-2xl drop-shadow-sm",children:He.icon}),_.jsxs("span",{className:"text-xs font-bold text-ink",children:[He.tempHigh,""]})]},mt))}),Pe&&_.jsxs("div",{className:"mt-4 bg-white p-5 rounded-3xl shadow-card border border-sand animate-fade-in relative",children:[_.jsx("button",{onClick:()=>K(null),className:"absolute top-3 right-3 text-gray-300 hover:text-gray-500",children:_.jsx(al,{className:"w-4 h-4"})}),_.jsxs("div",{className:"flex items-start gap-3",children:[_.jsx("div",{className:"bg-orange-100 p-2 rounded-full text-orange-500 shrink-0",children:_.jsx(Ov,{className:"w-5 h-5"})}),_.jsxs("div",{children:[_.jsx("h5",{className:"font-bold text-ink mb-2",children:"AI "}),_.jsx("div",{className:"prose prose-sm text-gray-600 leading-relaxed whitespace-pre-line",children:Pe})]})]})]})]})},Se=e==null?void 0:e.minimalistMode;return _.jsxs("div",{className:"pb-40 relative min-h-full",children:[_.jsxs("div",{className:"sticky top-0 z-20 bg-paper/95 backdrop-blur-md border-b border-sand/50 py-3 mb-6 -mx-5 px-5 flex items-center justify-between shadow-sm",children:[_.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto no-scrollbar flex-1 mr-2",children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 shrink-0 mr-1",children:s.nav_quick_jump}),ge.map(_e=>_.jsxs("button",{onClick:()=>{const ke=document.getElementById(`day-header-${_e}`);ke&&ke.scrollIntoView({behavior:"smooth",block:"start"})},className:"flex-shrink-0 px-4 py-1.5 bg-white border border-sand rounded-full font-bold text-ink text-xs hover:border-coral hover:text-coral hover:shadow-md active:bg-coral active:text-white transition-all whitespace-nowrap",children:[s.day," ",_e]},`nav-${_e}`))]}),_.jsx("button",{onClick:we,className:"p-2 bg-white rounded-full border border-sand text-coral hover:bg-coral hover:text-white transition-colors shadow-sm shrink-0",children:_.jsx(YD,{className:"w-5 h-5"})})]}),!Se&&Mt(),((Qe=n.itinerary)==null?void 0:Qe.length)>0?_.jsxs("div",{children:[!Se&&_.jsx("h4",{className:"text-xs font-bold text-gray-400 mb-4 uppercase tracking-wider ml-1",children:s.itinerary}),ge.map(_e=>{var ke;return _.jsxs("div",{className:"mb-8 scroll-mt-48",id:`day-header-${_e}`,children:[_.jsxs("div",{className:"flex items-center gap-3 mb-4 sticky top-[60px] bg-paper py-2 z-10 border-b border-sand/50 shadow-sm",children:[_.jsxs("div",{className:"bg-coral text-white px-3 py-1 rounded-lg text-sm font-bold shadow-sm",children:[s.day," ",_e]}),_.jsx("div",{className:"h-px bg-sand flex-1"}),_.jsxs("button",{onClick:()=>Jt(_e),disabled:W===_e,className:"flex items-center gap-1 text-xs font-bold text-coral bg-white border border-coral px-2 py-1 rounded-lg hover:bg-coral hover:text-white transition-colors disabled:opacity-50",children:[W===_e?_.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}):_.jsx(Xa,{className:"w-3 h-3"}),s.optimize_route||"AI Route"]})]}),_.jsx("div",{className:`space-y-0 relative ${Se?"":"border-l-2 border-sand ml-4"}`,children:(ke=le[_e])==null?void 0:ke.map((He,mt)=>_.jsxs("div",{className:"relative group",children:[_.jsxs("div",{className:`relative ${Se?"mb-4 border-b border-sand pb-4":"pl-8 pb-10 last:pb-0"}`,children:[!Se&&_.jsx("div",{className:"absolute -left-[7px] top-1.5 w-3.5 h-3.5 rounded-full border-2 border-paper shadow-sm bg-gray-300 group-hover:bg-coral transition-colors"}),_.jsxs("div",{className:"transition-all opacity-90 group-hover:opacity-100",children:[_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsx("div",{className:"flex items-center gap-2",children:_.jsx("span",{className:"text-xs font-bold font-mono text-coral bg-coral/10 px-2 py-1 rounded-lg",children:He.time})}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("button",{onClick:lt=>{lt.stopPropagation(),i(He)},className:"p-1.5 bg-white text-gray-400 rounded-full border border-sand hover:text-green-600 hover:border-green-600 shadow-sm",title:"",children:_.jsx(x1,{className:"w-3 h-3"})}),_.jsx("button",{onClick:lt=>{lt.stopPropagation(),ct(He)},className:"p-1.5 bg-white text-gray-400 rounded-full border border-sand hover:text-coral hover:border-coral shadow-sm",title:"",children:_.jsx(I1,{className:"w-3 h-3"})}),_.jsx("button",{onClick:lt=>{lt.stopPropagation(),Rn(He.id)},className:"p-1.5 bg-white text-red-400 rounded-full border border-red-200 hover:bg-red-50 hover:text-red-600 hover:border-red-500 shadow-sm transition-colors",title:"",children:_.jsx(al,{className:"w-3 h-3"})})]})]}),_.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-card border border-transparent hover:border-sand transition-all relative",children:[_.jsx("button",{onClick:lt=>{lt.stopPropagation(),Fe(He.activity,He.location)},className:"absolute top-4 right-4 text-gray-300 hover:text-coral transition-colors",children:_.jsx(FD,{className:"w-5 h-5"})}),_.jsx("h4",{className:`font-bold text-ink ${Se?"text-base":"text-lg"} mb-1 pr-6`,children:He.activity}),_.jsxs("div",{onClick:()=>Yt(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(He.location)}`),className:"flex items-center gap-1.5 text-sm text-gray-500 cursor-pointer hover:text-coral truncate mt-1",children:[_.jsx(Lv,{className:"w-3.5 h-3.5 shrink-0 text-coral"}),He.location]}),He.notes&&!Se&&_.jsx("p",{className:"text-sm text-gray-600 mt-3 pt-3 border-t border-gray-50 leading-relaxed",children:He.notes})]})]})]}),He.travelToNext&&!Se&&_.jsxs("div",{className:"pl-8 pb-10 relative",children:[_.jsx("div",{className:"absolute left-[0px] top-0 bottom-0 w-0.5 border-l-2 border-dotted border-gray-300 -ml-[1px]"}),_.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 border border-sand rounded-xl p-3 w-fit max-w-[80%]",children:[_.jsx("div",{className:"w-8 h-8 rounded-full bg-white border border-sand flex items-center justify-center text-gray-500 shadow-sm shrink-0",children:Rt(He.travelToNext.mode)}),_.jsx("div",{children:_.jsxs("div",{className:"text-xs font-bold text-gray-500 flex items-center gap-1",children:[He.travelToNext.duration,He.travelToNext.details&&_.jsxs("span",{className:"font-normal text-gray-400",children:[" ",He.travelToNext.details]})]})})]})]})]},He.id||mt))})]},_e)})]}):_.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-4",children:[_.jsx("div",{className:"w-16 h-16 bg-sand/30 rounded-full flex items-center justify-center text-gray-400",children:_.jsx(b1,{className:"w-8 h-8"})}),_.jsxs("p",{className:"text-gray-400 font-medium",children:[s.no_itinerary,_.jsx("br",{}),_.jsx("span",{className:"text-xs",children:s.click_add})]})]}),o&&_.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>l(null),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up max-h-[80vh] overflow-y-auto",onClick:_e=>_e.stopPropagation(),children:[_.jsxs("div",{className:"flex items-center justify-between mb-4",children:[_.jsx("h3",{className:"text-xl font-bold text-ink",children:o.name}),_.jsx("button",{onClick:Ye,className:`p-2 rounded-full ${x?"bg-coral text-white":"bg-gray-100 text-gray-500"}`,children:_.jsx(U6,{className:"w-5 h-5"})})]}),p?_.jsx("div",{className:"flex justify-center py-10",children:_.jsx("div",{className:"w-8 h-8 border-4 border-coral border-t-transparent rounded-full animate-spin"})}):_.jsx("div",{className:"prose prose-sm text-gray-600 leading-relaxed whitespace-pre-line",children:d})]})}),D&&_.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>F(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto",onClick:_e=>_e.stopPropagation(),children:[_.jsx("h3",{className:"text-xl font-bold text-ink mb-6 text-center",children:H?s.edit_activity:s.add_activity}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.day}),_.jsxs("div",{className:"flex items-center bg-white rounded-xl border border-sand px-3",children:[_.jsx("span",{className:"text-sm font-bold text-gray-400 mr-2",children:s.day}),_.jsx("input",{type:"number",min:"1",value:re,onChange:_e=>Q(parseInt(_e.target.value)||1),className:"w-full bg-transparent p-3 text-lg font-bold border-none outline-none text-ink"})]})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.time}),_.jsxs("div",{className:"flex items-center bg-white rounded-xl border border-sand px-3",children:[_.jsx(OD,{className:"w-5 h-5 text-gray-400 mr-2"}),_.jsx("input",{type:"time",value:he,onChange:_e=>fe(_e.target.value),className:"w-full bg-transparent p-3 text-lg font-bold border-none outline-none text-ink"})]})]})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.activity_name}),_.jsx("input",{value:Y,onChange:_e=>k(_e.target.value),placeholder:"...",className:"w-full bg-white p-4 rounded-xl text-base font-bold border-none shadow-sm outline-none placeholder:font-normal placeholder:text-gray-300",autoFocus:!0})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.location}),_.jsx("input",{value:B,onChange:_e=>O(_e.target.value),placeholder:"...",className:"w-full bg-white p-4 rounded-xl text-base font-bold border-none shadow-sm outline-none placeholder:font-normal placeholder:text-gray-300"})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.notes}),_.jsx("textarea",{value:q,onChange:_e=>G(_e.target.value),placeholder:"...",className:"w-full bg-white p-4 rounded-xl text-base font-medium border-none shadow-sm outline-none placeholder:font-normal placeholder:text-gray-300 min-h-[80px]"})]}),_.jsxs("div",{className:"pt-4 border-t border-sand",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1 mb-2 block",children:s.travel_to_next}),_.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto no-scrollbar",children:["WALK","TRAIN","BUS","CAR","FLIGHT"].map(_e=>_.jsx("button",{onClick:()=>$e(_e),className:`p-2 rounded-lg border ${Ge===_e?"bg-ink text-white border-ink":"bg-white text-gray-400 border-sand"}`,children:Rt(_e)},_e))}),_.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[_.jsx("input",{value:se,onChange:_e=>Ce(_e.target.value),placeholder:"1h 30m",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none"}),_.jsx("input",{value:be,onChange:_e=>it(_e.target.value),placeholder:"...",className:"w-full bg-white p-3 rounded-xl text-sm font-medium border-none shadow-sm outline-none"})]})]}),_.jsx("div",{className:"sticky bottom-0 bg-paper pt-4 mt-4 border-t border-sand z-10 pb-20",children:_.jsx("button",{onClick:mn,disabled:!Y,className:"w-full bg-coral text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-coral/30 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",children:H?s.confirm:s.add_activity})})]})]})}),_.jsx("button",{onClick:()=>{X(null),Q(1),fe("09:00"),k(""),O(""),G(""),Ce(""),it(""),F(!0)},className:"fixed bottom-24 right-6 w-14 h-14 bg-coral text-white rounded-full shadow-xl shadow-coral/40 flex items-center justify-center z-30 hover:bg-coralDark active:scale-90 transition-all",children:_.jsx("span",{className:"text-3xl font-light mb-1",children:"+"})})]})},U6=({className:n})=>_.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:n,children:[_.jsx("path",{d:"M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318.664-2.66 1.905A9.76 9.76 0 001.5 12c0 .898.121 1.768.35 2.595.341 1.24 1.518 1.905 2.659 1.905h1.93l4.5 4.5c.945.945 2.561.276 2.561-1.06V4.06zM18.584 5.106a.75.75 0 011.06 0c3.808 3.807 3.808 9.98 0 13.788a.75.75 0 11-1.06-1.06 8.25 8.25 0 000-11.668.75.75 0 010-1.06z"}),_.jsx("path",{d:"M15.932 7.757a.75.75 0 011.061 0 6 6 0 010 8.486.75.75 0 01-1.06-1.061 4.5 4.5 0 000-6.364.75.75 0 010-1.06z"})]}),aT=[{code:"TWD",symbol:"NT$",name:""},{code:"JPY",symbol:"",name:""},{code:"USD",symbol:"$",name:""},{code:"EUR",symbol:"",name:""},{code:"KRW",symbol:"",name:""},{code:"CNY",symbol:"",name:""},{code:"HKD",symbol:"HK$",name:""},{code:"GBP",symbol:"",name:""},{code:"THB",symbol:"",name:""},{code:"SGD",symbol:"S$",name:""}],hu=n=>{const e=aT.find(t=>t.code===n);return e?e.symbol:n},F6=(n,e,t)=>{const i={};e.forEach(p=>i[p]=0),n.forEach(p=>{i[p.payer]===void 0&&(i[p.payer]=0),(p.participants&&p.participants.length>0?p.participants:e).forEach(x=>{i[x]===void 0&&(i[x]=0)})}),n.forEach(p=>{const T=p.amount,x=p.payer,C=p.participants&&p.participants.length>0?p.participants:e.filter(D=>D!=="ME"&&D!==t).length>0?e:[x];i[x]+=T;const A=T/C.length;C.forEach(D=>{i[D]-=A})});const s=[],o=[];Object.entries(i).forEach(([p,T])=>{const x=Math.round(T*100)/100;x<-.01?s.push({id:p,amount:x}):x>.01&&o.push({id:p,amount:x})}),s.sort((p,T)=>p.amount-T.amount),o.sort((p,T)=>T.amount-p.amount);const l=[];let d=0,h=0;for(;d<s.length&&h<o.length;){const p=s[d],T=o[h],x=Math.min(Math.abs(p.amount),T.amount);x>0&&l.push({from:p.id,to:T.id,amount:Math.round(x)}),p.amount+=x,T.amount-=x,Math.abs(p.amount)<.01&&d++,T.amount<.01&&h++}return l},Sh=(n,e,t)=>n?n===e||n==="ME"?" (You)":(t==null?void 0:t[n])||(typeof n=="string"&&n.length>4?n.substring(0,4)+"...":n):"Unknown",B6=({trip:n,settings:e,onUpdateTrip:t,currentUserId:i})=>{var Fe,Ye,Nt,Jt,ct,mn,Rn,Yt,Rt,Mt;const s=nn[e.language]||nn["zh-TW"],[o,l]=Z.useState("EXPENSES"),[d,h]=Z.useState(!1),[p,T]=Z.useState(""),[x,C]=Z.useState(""),[A,D]=Z.useState(i),[F,H]=Z.useState([]),[X,re]=Z.useState("Cash"),[Q,he]=Z.useState(((Fe=n.budget)==null?void 0:Fe.currency)||"TWD"),[fe,Y]=Z.useState(""),[k,B]=Z.useState(0),[O,q]=Z.useState(!1),[G,W]=Z.useState(null),[z,Ge]=Z.useState(!1),[$e,se]=Z.useState(""),Ce=Z.useMemo(()=>{const Se=[...n.userIds||[]];return Se.includes(i)||Se.push(i),Array.from(new Set(Se))},[n.userIds,i]),be=()=>{var Qe,_e;const Se=parseInt($e);if(!isNaN(Se)&&Se>=0){const ke={...n,budget:{...n.budget,total:Se,currency:((Qe=n.budget)==null?void 0:Qe.currency)||"TWD",expenses:((_e=n.budget)==null?void 0:_e.expenses)||[]}};t==null||t(ke)}Ge(!1)};Z.useEffect(()=>{var Se;d&&(he(((Se=n.budget)==null?void 0:Se.currency)||"TWD"),Y(""),D(i),H(Ce))},[d,(Ye=n.budget)==null?void 0:Ye.currency,i,n.userIds]),Z.useEffect(()=>{(async()=>{var _e;const Qe=((_e=n.budget)==null?void 0:_e.currency)||"TWD";if(W(null),Q!==Qe&&(e.apiKey||void 0||typeof window<"u"&&localStorage.getItem("nomad_user_api_key"))){q(!0);try{const He=await oT(Q,Qe);He?Y(He):W(" (API Key )")}catch(He){console.error(He),W("")}q(!1)}})()},[Q,(Nt=n.budget)==null?void 0:Nt.currency,e.apiKey]),Z.useEffect(()=>{const Se=parseFloat(x)||0,Qe=parseFloat(fe)||1;B(Math.round(Se*Qe))},[x,fe]);const it=()=>{var lt,un,ri;if(!p||!x)return;const Se=parseFloat(x);if(Se<=0){alert(s.amount_invalid||"Amount must be greater than 0");return}const Qe=parseFloat(fe)||1,_e=Math.round(Se*Qe),ke={id:Date.now().toString(),title:p,amount:_e,category:"Other",date:new Date().toISOString().split("T")[0],payer:A,paymentMethod:X,participants:F,originalCurrency:Q,originalAmount:Se,exchangeRate:Qe},He=((lt=n.budget)==null?void 0:lt.expenses)||[],mt={...n,budget:{...n.budget,total:((un=n.budget)==null?void 0:un.total)||0,currency:((ri=n.budget)==null?void 0:ri.currency)||"TWD",expenses:[ke,...He]}};t==null||t(mt),h(!1),T(""),C("")},Pe=Se=>{var Qe,_e,ke;if(confirm(s.delete_trip_confirm.replace("{title}",s.expense_item))){const mt=(((Qe=n.budget)==null?void 0:Qe.expenses)||[]).filter(un=>un.id!==Se),lt={...n,budget:{...n.budget,total:((_e=n.budget)==null?void 0:_e.total)||0,currency:((ke=n.budget)==null?void 0:ke.currency)||"TWD",expenses:mt}};t==null||t(lt)}},K=Se=>{F.includes(Se)?F.length>1&&H(F.filter(Qe=>Qe!==Se)):H([...F,Se])},me=(((Jt=n.budget)==null?void 0:Jt.expenses)||[]).reduce((Se,Qe)=>Se+Qe.amount,0),Ie=((ct=n.budget)==null?void 0:ct.total)||0,le=Ie>0?Math.min(me/Ie*100,100):0,ge=((mn=n.budget)==null?void 0:mn.currency)||"TWD",we=hu(ge),Ke=F6(((Rn=n.budget)==null?void 0:Rn.expenses)||[],Ce,i);return _.jsxs("div",{className:"pb-32",children:[_.jsxs("div",{className:"flex gap-2 mb-6 bg-white p-1 rounded-2xl border border-sand",children:[_.jsxs("button",{onClick:()=>l("EXPENSES"),className:`flex-1 py-3 text-sm font-bold rounded-xl transition-all flex items-center justify-center gap-2 ${o==="EXPENSES"?"bg-ink text-white shadow-md":"text-gray-400 hover:bg-sand/30"}`,children:[_.jsx(C1,{className:"w-4 h-4"}),s.expense_list||""]}),_.jsxs("button",{onClick:()=>l("SETTLEMENT"),className:`flex-1 py-3 text-sm font-bold rounded-xl transition-all flex items-center justify-center gap-2 ${o==="SETTLEMENT"?"bg-ink text-white shadow-md":"text-gray-400 hover:bg-sand/30"}`,children:[_.jsx(rC,{className:"w-4 h-4"}),s.settlement||""]})]}),o==="EXPENSES"&&_.jsxs("div",{className:"bg-ink text-white p-6 rounded-3xl shadow-xl mb-8 relative overflow-hidden",children:[_.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10 blur-2xl"}),_.jsxs("div",{className:"relative z-10",children:[_.jsx("p",{className:"text-gray-400 text-xs font-bold uppercase tracking-widest mb-1",children:s.budget_total}),_.jsx("div",{className:"flex items-center gap-2 mb-6 group",children:z?_.jsxs("div",{className:"flex items-center",children:[_.jsx("span",{className:"text-2xl mr-1 font-black",children:we}),_.jsx("input",{type:"number",value:$e,onChange:Se=>se(Se.target.value),onBlur:be,onKeyDown:Se=>Se.key==="Enter"&&be(),className:"bg-transparent text-4xl font-black text-white border-b-2 border-white/20 outline-none w-48",autoFocus:!0})]}):_.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[_.jsxs("h2",{className:"text-4xl font-black cursor-pointer hover:opacity-80 transition-opacity flex items-center",onClick:()=>{se(Ie.toString()),Ge(!0)},children:[_.jsx("span",{className:"text-2xl mr-1",children:we}),Ie.toLocaleString()]}),_.jsx("button",{onClick:()=>{se(Ie.toString()),Ge(!0)},className:"p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors flex-shrink-0",children:_.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})}),_.jsxs("div",{className:"mb-2 flex justify-between text-sm font-bold",children:[_.jsx("span",{className:"text-gray-300",children:s.budget_spent}),_.jsxs("span",{children:[we,me.toLocaleString()]})]}),_.jsx("div",{className:"h-3 bg-gray-700 rounded-full overflow-hidden mb-4",children:_.jsx("div",{className:`h-full rounded-full ${le>90?"bg-red-500":"bg-coral"}`,style:{width:`${le}%`}})}),_.jsxs("div",{className:"flex justify-between text-xs text-gray-400 font-medium",children:[_.jsxs("span",{children:[le.toFixed(1),"%"]}),_.jsxs("span",{children:[": ",we,me.toLocaleString()]})]})]})]}),o==="EXPENSES"&&_.jsxs("div",{className:"space-y-4",children:[_.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider ml-1 mb-2",children:s.expense_list}),(Rt=(Yt=n.budget)==null?void 0:Yt.expenses)==null?void 0:Rt.map(Se=>{var Qe,_e,ke;return _.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-sand flex items-center justify-between group",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold border-2 ${Se.payer===i?"bg-coral/10 text-coral border-coral":"bg-gray-100 text-gray-500 border-gray-200"}`,children:Sh(Se.payer,i).slice(0,1)}),_.jsxs("div",{children:[_.jsx("h4",{className:"font-bold text-ink",children:Se.title}),_.jsxs("p",{className:"text-xs text-gray-400",children:[Se.date,"  ",Se.paymentMethod," ",((Qe=Se.participants)==null?void 0:Qe.length)===Ce.length?" Everyone":` ${(_e=Se.participants)==null?void 0:_e.length} ppl`]}),Se.originalCurrency&&Se.originalCurrency!==ge&&_.jsxs("p",{className:"text-xs text-coral font-medium mt-0.5",children:[hu(Se.originalCurrency),(ke=Se.originalAmount)==null?void 0:ke.toLocaleString(),_.jsx("span",{className:"text-gray-400 mx-1",children:""}),we,Se.amount.toLocaleString()]})]})]}),_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsxs("span",{className:"font-bold text-ink text-lg",children:[we,Se.amount.toLocaleString()]}),_.jsx("button",{onClick:()=>Pe(Se.id),className:"text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",children:_.jsx(al,{className:"w-5 h-5"})})]})]},Se.id)}),(!((Mt=n.budget)!=null&&Mt.expenses)||n.budget.expenses.length===0)&&_.jsx("div",{className:"text-center py-10 text-gray-400 text-sm font-medium",children:s.no_expenses})]}),o==="SETTLEMENT"&&_.jsx("div",{className:"space-y-6",children:_.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-sm border border-sand",children:[_.jsxs("h3",{className:"text-lg font-bold text-ink mb-4 flex items-center gap-2",children:[_.jsx(rC,{className:"w-5 h-5 text-coral"}),""]}),Ke.length>0?_.jsx("div",{className:"space-y-4",children:Ke.map((Se,Qe)=>_.jsxs("div",{className:"flex items-center justify-between p-4 bg-sand/20 rounded-xl relative overflow-hidden",children:[_.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 opacity-10 pointer-events-none",children:_.jsx("svg",{className:"w-24 h-24 text-ink",fill:"currentColor",viewBox:"0 0 24 24",children:_.jsx("path",{d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})})}),_.jsxs("div",{className:"flex flex-col items-start z-10",children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"FROM"}),_.jsx("span",{className:"font-bold text-ink text-lg",children:Sh(Se.from,i)})]}),_.jsxs("div",{className:"flex flex-col items-center z-10",children:[_.jsx("span",{className:"text-xs font-bold text-coral bg-coral/10 px-2 py-1 rounded-full mb-1",children:"PAY"}),_.jsxs("span",{className:"font-black text-2xl text-ink",children:[we,Se.amount.toLocaleString()]})]}),_.jsxs("div",{className:"flex flex-col items-end z-10",children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"TO"}),_.jsx("span",{className:"font-bold text-ink text-lg",children:Sh(Se.to,i)})]})]},Qe))}):_.jsxs("div",{className:"text-center py-10 text-gray-400 text-sm font-medium",children:[_.jsx("p",{children:" "}),_.jsx("p",{className:"text-xs opacity-70 mt-1",children:""})]})]})}),d&&_.jsx("div",{className:"fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>h(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-md rounded-3xl shadow-2xl p-6 animate-slide-up relative max-h-[90vh] overflow-y-auto no-scrollbar",onClick:Se=>Se.stopPropagation(),children:[_.jsx("button",{onClick:()=>h(!1),className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:_.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),_.jsx("h3",{className:"text-xl font-bold text-ink mb-6 text-center",children:s.add_expense}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.expense_item}),_.jsx("input",{value:p,onChange:Se=>T(Se.target.value),placeholder:": ",className:"w-full bg-white p-4 rounded-xl text-base font-bold border-none shadow-sm outline-none placeholder:font-normal",autoFocus:!0})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:s.amount}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("select",{value:Q,onChange:Se=>he(Se.target.value),className:"bg-white rounded-xl border-none shadow-sm px-3 font-bold text-ink outline-none",children:aT.map(Se=>_.jsx("option",{value:Se.code,children:Se.code},Se.code))}),_.jsxs("div",{className:"flex-1 flex items-center bg-white rounded-xl border-none shadow-sm px-4",children:[_.jsx("span",{className:"text-gray-400 font-bold mr-2",children:hu(Q)}),_.jsx("input",{value:x,onChange:Se=>C(Se.target.value),type:"number",placeholder:"0",className:"w-full bg-transparent py-4 text-xl font-bold border-none outline-none placeholder:font-normal"})]})]})]}),Q!==ge&&_.jsxs("div",{className:"space-y-1 bg-sand/30 p-3 rounded-xl",children:[_.jsxs("div",{className:"flex justify-between items-center mb-2",children:[_.jsxs("label",{className:"text-xs font-bold text-gray-500",children:[" (",Q,"  ",ge,")"]}),_.jsxs("span",{className:"text-xs font-bold text-coral",children:[" ",we,k.toLocaleString()]})]}),_.jsx("div",{className:"relative",children:_.jsx("input",{value:fe,onChange:Se=>Y(Se.target.value),type:"number",step:"0.01",placeholder:O?"...":"Exchange Rate",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none",disabled:O})})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:" (Payer)"}),_.jsx("div",{className:"flex flex-wrap gap-2",children:Ce.map(Se=>_.jsx("button",{onClick:()=>D(Se),className:`px-4 py-2 rounded-full text-sm font-bold transition-all border-2 ${A===Se?"bg-ink text-white border-ink":"bg-white text-gray-400 border-transparent hover:border-gray-200"}`,children:Sh(Se,i)},Se))})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:" (Split)"}),_.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ce.map(Se=>_.jsxs("button",{onClick:()=>K(Se),className:`p-3 rounded-xl flex items-center gap-2 transition-all border-2 ${F.includes(Se)?"bg-coral/5 border-coral text-ink":"bg-white border-transparent grayscale opacity-60 hover:opacity-100"}`,children:[_.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold ${F.includes(Se)?"bg-coral text-white":"bg-gray-200 text-gray-500"}`,children:Se===i?"Me":Se.slice(0,1)}),_.jsx("span",{className:"text-sm font-bold truncate",children:Sh(Se,i)})]},Se))})]}),_.jsx("div",{className:"space-y-3 pt-4",children:_.jsx("button",{onClick:it,disabled:!p||!x,className:"w-full bg-coral text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-coral/30 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",children:"+ "})})]})]})}),_.jsx("button",{onClick:()=>h(!0),className:"fixed bottom-24 right-6 w-14 h-14 bg-ink text-white rounded-full shadow-xl shadow-ink/40 flex items-center justify-center z-30 hover:scale-105 active:scale-95 transition-all",children:_.jsx("span",{className:"text-3xl font-light mb-1",children:"+"})})]})},z6=({trip:n,settings:e,onUpdateTrip:t})=>{var Y;const i=nn[e.language]||nn["zh-TW"],[s,o]=Z.useState(!1),[l,d]=Z.useState("FLIGHT"),[h,p]=Z.useState(""),[T,x]=Z.useState(""),[C,A]=Z.useState(""),[D,F]=Z.useState(""),[H,X]=Z.useState(""),[re,Q]=Z.useState(""),he=()=>{if(!h)return;const B=[{id:Date.now().toString(),type:l,airline:h,number:T||"N/A",origin:C||"-",destination:D||"-",departureTime:H?`${H} ${re}`:re||"00:00",arrivalTime:"-",status:"Confirmed",bookingUrl:""},...n.bookings||[]];t==null||t({...n,bookings:B}),p(""),x(""),A(""),F(""),X(""),Q(""),o(!1)},fe=k=>{if(confirm(i.delete_trip_confirm.replace("{title}",i.bookings))){const O=(n.bookings||[]).filter(q=>q.id!==k);t==null||t({...n,bookings:O})}};return _.jsxs("div",{className:"pb-32",children:[_.jsxs("div",{className:"space-y-4",children:[(Y=n.bookings)==null?void 0:Y.map(k=>_.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-sand relative group",children:[_.jsxs("div",{className:"flex justify-between items-start mb-4",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-10 h-10 bg-blue-50 text-blue-500 rounded-xl flex items-center justify-center",children:k.type==="FLIGHT"?_.jsx(E1,{className:"w-5 h-5"}):_.jsx(w1,{className:"w-5 h-5"})}),_.jsxs("div",{children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:k.type}),_.jsx("h4",{className:"font-bold text-ink text-lg",children:k.airline})]})]}),_.jsx("div",{className:"text-right",children:_.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-bold ${k.status==="Confirmed"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-500"}`,children:k.status})})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-xs text-gray-400 font-bold mb-1",children:"DEPARTURE"}),_.jsx("p",{className:"text-ink font-bold text-lg",children:k.origin}),_.jsx("p",{className:"text-sm text-gray-500",children:k.departureTime})]}),_.jsxs("div",{className:"text-right",children:[_.jsx("p",{className:"text-xs text-gray-400 font-bold mb-1",children:"ARRIVAL"}),_.jsx("p",{className:"text-ink font-bold text-lg",children:k.destination}),_.jsx("p",{className:"text-sm text-gray-500",children:k.arrivalTime})]})]}),_.jsxs("div",{className:"pt-4 border-t border-sand flex justify-between items-center",children:[_.jsxs("div",{className:"text-xs text-gray-400 font-mono",children:["REF: ",_.jsx("span",{className:"text-ink font-bold",children:k.number})]}),_.jsx("button",{onClick:()=>fe(k.id),className:"text-gray-300 hover:text-red-500 transition-colors",children:_.jsx(al,{className:"w-4 h-4"})})]})]},k.id)),(!n.bookings||n.bookings.length===0)&&_.jsx("div",{className:"text-center py-10 text-gray-400 text-sm font-medium",children:i.no_bookings})]}),s&&_.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>o(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto",onClick:k=>k.stopPropagation(),children:[_.jsx("h3",{className:"text-xl font-bold text-ink mb-6 text-center",children:i.add_booking}),_.jsxs("div",{className:"space-y-4",children:[_.jsx("div",{className:"flex bg-white rounded-xl p-1 shadow-sm mb-4",children:["FLIGHT","HOTEL","TRAIN"].map(k=>_.jsx("button",{onClick:()=>d(k),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-all ${l===k?"bg-ink text-white shadow-sm":"text-gray-400 hover:text-ink"}`,children:k},k))}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.provider}),_.jsx("input",{value:h,onChange:k=>p(k.target.value),placeholder:"Airline / Hotel Name...",className:"w-full bg-white p-4 rounded-xl text-base font-bold border-none shadow-sm outline-none",autoFocus:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.ref_number}),_.jsx("input",{value:T,onChange:k=>x(k.target.value),placeholder:"PNR...",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none"})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.date}),_.jsx("input",{type:"date",value:H,onChange:k=>X(k.target.value),className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none"})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.origin}),_.jsx("input",{value:C,onChange:k=>A(k.target.value),placeholder:"TPE...",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none"})]}),_.jsxs("div",{className:"space-y-1",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 ml-1",children:i.label_destination}),_.jsx("input",{value:D,onChange:k=>F(k.target.value),placeholder:"NRT...",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none"})]})]}),_.jsx("button",{onClick:he,disabled:!h,className:"w-full bg-coral text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-coral/30 mt-4 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",children:i.confirm})]})]})}),_.jsx("button",{onClick:()=>o(!0),className:"fixed bottom-24 right-6 w-14 h-14 bg-blue-500 text-white rounded-full shadow-xl shadow-blue-500/40 flex items-center justify-center z-30 hover:scale-105 active:scale-95 transition-all",children:_.jsx("span",{className:"text-3xl font-light mb-1",children:"+"})})]})};function mN(n,e){const t=Z.useRef(e);Z.useEffect(function(){e!==t.current&&n.attributionControl!=null&&(t.current!=null&&n.attributionControl.removeAttribution(t.current),e!=null&&n.attributionControl.addAttribution(e)),t.current=e},[n,e])}var pN=T1();const q6=1;function G6(n){return Object.freeze({__version:q6,map:n})}function gN(n,e){return Object.freeze({...n,...e})}const lT=Z.createContext(null);function Rg(){const n=Z.use(lT);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function _N(n){function e(t,i){const{instance:s,context:o}=n(t).current;Z.useImperativeHandle(i,()=>s);const{children:l}=t;return l==null?null:lf.createElement(lT,{value:o},l)}return Z.forwardRef(e)}function H6(n){function e(t,i){const[s,o]=Z.useState(!1),{instance:l}=n(t,o).current;Z.useImperativeHandle(i,()=>l),Z.useEffect(function(){s&&l.update()},[l,s,t.children]);const d=l._contentNode;return d?pN.createPortal(t.children,d):null}return Z.forwardRef(e)}function j6(n){function e(t,i){const{instance:s}=n(t).current;return Z.useImperativeHandle(i,()=>s),null}return Z.forwardRef(e)}function uT(n,e){const t=Z.useRef(void 0);Z.useEffect(function(){return e!=null&&n.instance.on(e),t.current=e,function(){t.current!=null&&n.instance.off(t.current),t.current=null}},[n,e])}function Mg(n,e){const t=n.pane??e.pane;return t?{...n,pane:t}:n}function K6(n,e){return function(i,s){const o=Rg(),l=n(Mg(i,o),o);return mN(o.map,i.attribution),uT(l.current,i.eventHandlers),e(l.current,o,i,s),l}}var Vh={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var W6=Vh.exports,Db;function Y6(){return Db||(Db=1,(function(n,e){(function(t,i){i(e)})(W6,(function(t){var i="1.9.4";function s(u){var f,E,b,N;for(E=1,b=arguments.length;E<b;E++){N=arguments[E];for(f in N)u[f]=N[f]}return u}var o=Object.create||(function(){function u(){}return function(f){return u.prototype=f,new u}})();function l(u,f){var E=Array.prototype.slice;if(u.bind)return u.bind.apply(u,E.call(arguments,1));var b=E.call(arguments,2);return function(){return u.apply(f,b.length?b.concat(E.call(arguments)):arguments)}}var d=0;function h(u){return"_leaflet_id"in u||(u._leaflet_id=++d),u._leaflet_id}function p(u,f,E){var b,N,P,j;return j=function(){b=!1,N&&(P.apply(E,N),N=!1)},P=function(){b?N=arguments:(u.apply(E,arguments),setTimeout(j,f),b=!0)},P}function T(u,f,E){var b=f[1],N=f[0],P=b-N;return u===b&&E?u:((u-N)%P+P)%P+N}function x(){return!1}function C(u,f){if(f===!1)return u;var E=Math.pow(10,f===void 0?6:f);return Math.round(u*E)/E}function A(u){return u.trim?u.trim():u.replace(/^\s+|\s+$/g,"")}function D(u){return A(u).split(/\s+/)}function F(u,f){Object.prototype.hasOwnProperty.call(u,"options")||(u.options=u.options?o(u.options):{});for(var E in f)u.options[E]=f[E];return u.options}function H(u,f,E){var b=[];for(var N in u)b.push(encodeURIComponent(E?N.toUpperCase():N)+"="+encodeURIComponent(u[N]));return(!f||f.indexOf("?")===-1?"?":"&")+b.join("&")}var X=/\{ *([\w_ -]+) *\}/g;function re(u,f){return u.replace(X,function(E,b){var N=f[b];if(N===void 0)throw new Error("No value provided for variable "+E);return typeof N=="function"&&(N=N(f)),N})}var Q=Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"};function he(u,f){for(var E=0;E<u.length;E++)if(u[E]===f)return E;return-1}var fe="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Y(u){return window["webkit"+u]||window["moz"+u]||window["ms"+u]}var k=0;function B(u){var f=+new Date,E=Math.max(0,16-(f-k));return k=f+E,window.setTimeout(u,E)}var O=window.requestAnimationFrame||Y("RequestAnimationFrame")||B,q=window.cancelAnimationFrame||Y("CancelAnimationFrame")||Y("CancelRequestAnimationFrame")||function(u){window.clearTimeout(u)};function G(u,f,E){if(E&&O===B)u.call(f);else return O.call(window,l(u,f))}function W(u){u&&q.call(window,u)}var z={__proto__:null,extend:s,create:o,bind:l,get lastId(){return d},stamp:h,throttle:p,wrapNum:T,falseFn:x,formatNum:C,trim:A,splitWords:D,setOptions:F,getParamString:H,template:re,isArray:Q,indexOf:he,emptyImageUrl:fe,requestFn:O,cancelFn:q,requestAnimFrame:G,cancelAnimFrame:W};function Ge(){}Ge.extend=function(u){var f=function(){F(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},E=f.__super__=this.prototype,b=o(E);b.constructor=f,f.prototype=b;for(var N in this)Object.prototype.hasOwnProperty.call(this,N)&&N!=="prototype"&&N!=="__super__"&&(f[N]=this[N]);return u.statics&&s(f,u.statics),u.includes&&($e(u.includes),s.apply(null,[b].concat(u.includes))),s(b,u),delete b.statics,delete b.includes,b.options&&(b.options=E.options?o(E.options):{},s(b.options,u.options)),b._initHooks=[],b.callInitHooks=function(){if(!this._initHooksCalled){E.callInitHooks&&E.callInitHooks.call(this),this._initHooksCalled=!0;for(var P=0,j=b._initHooks.length;P<j;P++)b._initHooks[P].call(this)}},f},Ge.include=function(u){var f=this.prototype.options;return s(this.prototype,u),u.options&&(this.prototype.options=f,this.mergeOptions(u.options)),this},Ge.mergeOptions=function(u){return s(this.prototype.options,u),this},Ge.addInitHook=function(u){var f=Array.prototype.slice.call(arguments,1),E=typeof u=="function"?u:function(){this[u].apply(this,f)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(E),this};function $e(u){if(!(typeof L>"u"||!L||!L.Mixin)){u=Q(u)?u:[u];for(var f=0;f<u.length;f++)u[f]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var se={on:function(u,f,E){if(typeof u=="object")for(var b in u)this._on(b,u[b],f);else{u=D(u);for(var N=0,P=u.length;N<P;N++)this._on(u[N],f,E)}return this},off:function(u,f,E){if(!arguments.length)delete this._events;else if(typeof u=="object")for(var b in u)this._off(b,u[b],f);else{u=D(u);for(var N=arguments.length===1,P=0,j=u.length;P<j;P++)N?this._off(u[P]):this._off(u[P],f,E)}return this},_on:function(u,f,E,b){if(typeof f!="function"){console.warn("wrong listener type: "+typeof f);return}if(this._listens(u,f,E)===!1){E===this&&(E=void 0);var N={fn:f,ctx:E};b&&(N.once=!0),this._events=this._events||{},this._events[u]=this._events[u]||[],this._events[u].push(N)}},_off:function(u,f,E){var b,N,P;if(this._events&&(b=this._events[u],!!b)){if(arguments.length===1){if(this._firingCount)for(N=0,P=b.length;N<P;N++)b[N].fn=x;delete this._events[u];return}if(typeof f!="function"){console.warn("wrong listener type: "+typeof f);return}var j=this._listens(u,f,E);if(j!==!1){var te=b[j];this._firingCount&&(te.fn=x,this._events[u]=b=b.slice()),b.splice(j,1)}}},fire:function(u,f,E){if(!this.listens(u,E))return this;var b=s({},f,{type:u,target:this,sourceTarget:f&&f.sourceTarget||this});if(this._events){var N=this._events[u];if(N){this._firingCount=this._firingCount+1||1;for(var P=0,j=N.length;P<j;P++){var te=N[P],ue=te.fn;te.once&&this.off(u,ue,te.ctx),ue.call(te.ctx||this,b)}this._firingCount--}}return E&&this._propagateEvent(b),this},listens:function(u,f,E,b){typeof u!="string"&&console.warn('"string" type argument expected');var N=f;typeof f!="function"&&(b=!!f,N=void 0,E=void 0);var P=this._events&&this._events[u];if(P&&P.length&&this._listens(u,N,E)!==!1)return!0;if(b){for(var j in this._eventParents)if(this._eventParents[j].listens(u,f,E,b))return!0}return!1},_listens:function(u,f,E){if(!this._events)return!1;var b=this._events[u]||[];if(!f)return!!b.length;E===this&&(E=void 0);for(var N=0,P=b.length;N<P;N++)if(b[N].fn===f&&b[N].ctx===E)return N;return!1},once:function(u,f,E){if(typeof u=="object")for(var b in u)this._on(b,u[b],f,!0);else{u=D(u);for(var N=0,P=u.length;N<P;N++)this._on(u[N],f,E,!0)}return this},addEventParent:function(u){return this._eventParents=this._eventParents||{},this._eventParents[h(u)]=u,this},removeEventParent:function(u){return this._eventParents&&delete this._eventParents[h(u)],this},_propagateEvent:function(u){for(var f in this._eventParents)this._eventParents[f].fire(u.type,s({layer:u.target,propagatedFrom:u.target},u),!0)}};se.addEventListener=se.on,se.removeEventListener=se.clearAllEventListeners=se.off,se.addOneTimeEventListener=se.once,se.fireEvent=se.fire,se.hasEventListeners=se.listens;var Ce=Ge.extend(se);function be(u,f,E){this.x=E?Math.round(u):u,this.y=E?Math.round(f):f}var it=Math.trunc||function(u){return u>0?Math.floor(u):Math.ceil(u)};be.prototype={clone:function(){return new be(this.x,this.y)},add:function(u){return this.clone()._add(Pe(u))},_add:function(u){return this.x+=u.x,this.y+=u.y,this},subtract:function(u){return this.clone()._subtract(Pe(u))},_subtract:function(u){return this.x-=u.x,this.y-=u.y,this},divideBy:function(u){return this.clone()._divideBy(u)},_divideBy:function(u){return this.x/=u,this.y/=u,this},multiplyBy:function(u){return this.clone()._multiplyBy(u)},_multiplyBy:function(u){return this.x*=u,this.y*=u,this},scaleBy:function(u){return new be(this.x*u.x,this.y*u.y)},unscaleBy:function(u){return new be(this.x/u.x,this.y/u.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=it(this.x),this.y=it(this.y),this},distanceTo:function(u){u=Pe(u);var f=u.x-this.x,E=u.y-this.y;return Math.sqrt(f*f+E*E)},equals:function(u){return u=Pe(u),u.x===this.x&&u.y===this.y},contains:function(u){return u=Pe(u),Math.abs(u.x)<=Math.abs(this.x)&&Math.abs(u.y)<=Math.abs(this.y)},toString:function(){return"Point("+C(this.x)+", "+C(this.y)+")"}};function Pe(u,f,E){return u instanceof be?u:Q(u)?new be(u[0],u[1]):u==null?u:typeof u=="object"&&"x"in u&&"y"in u?new be(u.x,u.y):new be(u,f,E)}function K(u,f){if(u)for(var E=f?[u,f]:u,b=0,N=E.length;b<N;b++)this.extend(E[b])}K.prototype={extend:function(u){var f,E;if(!u)return this;if(u instanceof be||typeof u[0]=="number"||"x"in u)f=E=Pe(u);else if(u=me(u),f=u.min,E=u.max,!f||!E)return this;return!this.min&&!this.max?(this.min=f.clone(),this.max=E.clone()):(this.min.x=Math.min(f.x,this.min.x),this.max.x=Math.max(E.x,this.max.x),this.min.y=Math.min(f.y,this.min.y),this.max.y=Math.max(E.y,this.max.y)),this},getCenter:function(u){return Pe((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,u)},getBottomLeft:function(){return Pe(this.min.x,this.max.y)},getTopRight:function(){return Pe(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(u){var f,E;return typeof u[0]=="number"||u instanceof be?u=Pe(u):u=me(u),u instanceof K?(f=u.min,E=u.max):f=E=u,f.x>=this.min.x&&E.x<=this.max.x&&f.y>=this.min.y&&E.y<=this.max.y},intersects:function(u){u=me(u);var f=this.min,E=this.max,b=u.min,N=u.max,P=N.x>=f.x&&b.x<=E.x,j=N.y>=f.y&&b.y<=E.y;return P&&j},overlaps:function(u){u=me(u);var f=this.min,E=this.max,b=u.min,N=u.max,P=N.x>f.x&&b.x<E.x,j=N.y>f.y&&b.y<E.y;return P&&j},isValid:function(){return!!(this.min&&this.max)},pad:function(u){var f=this.min,E=this.max,b=Math.abs(f.x-E.x)*u,N=Math.abs(f.y-E.y)*u;return me(Pe(f.x-b,f.y-N),Pe(E.x+b,E.y+N))},equals:function(u){return u?(u=me(u),this.min.equals(u.getTopLeft())&&this.max.equals(u.getBottomRight())):!1}};function me(u,f){return!u||u instanceof K?u:new K(u,f)}function Ie(u,f){if(u)for(var E=f?[u,f]:u,b=0,N=E.length;b<N;b++)this.extend(E[b])}Ie.prototype={extend:function(u){var f=this._southWest,E=this._northEast,b,N;if(u instanceof ge)b=u,N=u;else if(u instanceof Ie){if(b=u._southWest,N=u._northEast,!b||!N)return this}else return u?this.extend(we(u)||le(u)):this;return!f&&!E?(this._southWest=new ge(b.lat,b.lng),this._northEast=new ge(N.lat,N.lng)):(f.lat=Math.min(b.lat,f.lat),f.lng=Math.min(b.lng,f.lng),E.lat=Math.max(N.lat,E.lat),E.lng=Math.max(N.lng,E.lng)),this},pad:function(u){var f=this._southWest,E=this._northEast,b=Math.abs(f.lat-E.lat)*u,N=Math.abs(f.lng-E.lng)*u;return new Ie(new ge(f.lat-b,f.lng-N),new ge(E.lat+b,E.lng+N))},getCenter:function(){return new ge((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ge(this.getNorth(),this.getWest())},getSouthEast:function(){return new ge(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(u){typeof u[0]=="number"||u instanceof ge||"lat"in u?u=we(u):u=le(u);var f=this._southWest,E=this._northEast,b,N;return u instanceof Ie?(b=u.getSouthWest(),N=u.getNorthEast()):b=N=u,b.lat>=f.lat&&N.lat<=E.lat&&b.lng>=f.lng&&N.lng<=E.lng},intersects:function(u){u=le(u);var f=this._southWest,E=this._northEast,b=u.getSouthWest(),N=u.getNorthEast(),P=N.lat>=f.lat&&b.lat<=E.lat,j=N.lng>=f.lng&&b.lng<=E.lng;return P&&j},overlaps:function(u){u=le(u);var f=this._southWest,E=this._northEast,b=u.getSouthWest(),N=u.getNorthEast(),P=N.lat>f.lat&&b.lat<E.lat,j=N.lng>f.lng&&b.lng<E.lng;return P&&j},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(u,f){return u?(u=le(u),this._southWest.equals(u.getSouthWest(),f)&&this._northEast.equals(u.getNorthEast(),f)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function le(u,f){return u instanceof Ie?u:new Ie(u,f)}function ge(u,f,E){if(isNaN(u)||isNaN(f))throw new Error("Invalid LatLng object: ("+u+", "+f+")");this.lat=+u,this.lng=+f,E!==void 0&&(this.alt=+E)}ge.prototype={equals:function(u,f){if(!u)return!1;u=we(u);var E=Math.max(Math.abs(this.lat-u.lat),Math.abs(this.lng-u.lng));return E<=(f===void 0?1e-9:f)},toString:function(u){return"LatLng("+C(this.lat,u)+", "+C(this.lng,u)+")"},distanceTo:function(u){return Fe.distance(this,we(u))},wrap:function(){return Fe.wrapLatLng(this)},toBounds:function(u){var f=180*u/40075017,E=f/Math.cos(Math.PI/180*this.lat);return le([this.lat-f,this.lng-E],[this.lat+f,this.lng+E])},clone:function(){return new ge(this.lat,this.lng,this.alt)}};function we(u,f,E){return u instanceof ge?u:Q(u)&&typeof u[0]!="object"?u.length===3?new ge(u[0],u[1],u[2]):u.length===2?new ge(u[0],u[1]):null:u==null?u:typeof u=="object"&&"lat"in u?new ge(u.lat,"lng"in u?u.lng:u.lon,u.alt):f===void 0?null:new ge(u,f,E)}var Ke={latLngToPoint:function(u,f){var E=this.projection.project(u),b=this.scale(f);return this.transformation._transform(E,b)},pointToLatLng:function(u,f){var E=this.scale(f),b=this.transformation.untransform(u,E);return this.projection.unproject(b)},project:function(u){return this.projection.project(u)},unproject:function(u){return this.projection.unproject(u)},scale:function(u){return 256*Math.pow(2,u)},zoom:function(u){return Math.log(u/256)/Math.LN2},getProjectedBounds:function(u){if(this.infinite)return null;var f=this.projection.bounds,E=this.scale(u),b=this.transformation.transform(f.min,E),N=this.transformation.transform(f.max,E);return new K(b,N)},infinite:!1,wrapLatLng:function(u){var f=this.wrapLng?T(u.lng,this.wrapLng,!0):u.lng,E=this.wrapLat?T(u.lat,this.wrapLat,!0):u.lat,b=u.alt;return new ge(E,f,b)},wrapLatLngBounds:function(u){var f=u.getCenter(),E=this.wrapLatLng(f),b=f.lat-E.lat,N=f.lng-E.lng;if(b===0&&N===0)return u;var P=u.getSouthWest(),j=u.getNorthEast(),te=new ge(P.lat-b,P.lng-N),ue=new ge(j.lat-b,j.lng-N);return new Ie(te,ue)}},Fe=s({},Ke,{wrapLng:[-180,180],R:6371e3,distance:function(u,f){var E=Math.PI/180,b=u.lat*E,N=f.lat*E,P=Math.sin((f.lat-u.lat)*E/2),j=Math.sin((f.lng-u.lng)*E/2),te=P*P+Math.cos(b)*Math.cos(N)*j*j,ue=2*Math.atan2(Math.sqrt(te),Math.sqrt(1-te));return this.R*ue}}),Ye=6378137,Nt={R:Ye,MAX_LATITUDE:85.0511287798,project:function(u){var f=Math.PI/180,E=this.MAX_LATITUDE,b=Math.max(Math.min(E,u.lat),-E),N=Math.sin(b*f);return new be(this.R*u.lng*f,this.R*Math.log((1+N)/(1-N))/2)},unproject:function(u){var f=180/Math.PI;return new ge((2*Math.atan(Math.exp(u.y/this.R))-Math.PI/2)*f,u.x*f/this.R)},bounds:(function(){var u=Ye*Math.PI;return new K([-u,-u],[u,u])})()};function Jt(u,f,E,b){if(Q(u)){this._a=u[0],this._b=u[1],this._c=u[2],this._d=u[3];return}this._a=u,this._b=f,this._c=E,this._d=b}Jt.prototype={transform:function(u,f){return this._transform(u.clone(),f)},_transform:function(u,f){return f=f||1,u.x=f*(this._a*u.x+this._b),u.y=f*(this._c*u.y+this._d),u},untransform:function(u,f){return f=f||1,new be((u.x/f-this._b)/this._a,(u.y/f-this._d)/this._c)}};function ct(u,f,E,b){return new Jt(u,f,E,b)}var mn=s({},Fe,{code:"EPSG:3857",projection:Nt,transformation:(function(){var u=.5/(Math.PI*Nt.R);return ct(u,.5,-u,.5)})()}),Rn=s({},mn,{code:"EPSG:900913"});function Yt(u){return document.createElementNS("http://www.w3.org/2000/svg",u)}function Rt(u,f){var E="",b,N,P,j,te,ue;for(b=0,P=u.length;b<P;b++){for(te=u[b],N=0,j=te.length;N<j;N++)ue=te[N],E+=(N?"L":"M")+ue.x+" "+ue.y;E+=f?Be.svg?"z":"x":""}return E||"M0 0"}var Mt=document.documentElement.style,Se="ActiveXObject"in window,Qe=Se&&!document.addEventListener,_e="msLaunchUri"in navigator&&!("documentMode"in document),ke=oi("webkit"),He=oi("android"),mt=oi("android 2")||oi("android 3"),lt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),un=He&&oi("Google")&&lt<537&&!("AudioNode"in window),ri=!!window.opera,Ji=!_e&&oi("chrome"),pn=oi("gecko")&&!ke&&!ri&&!Se,Ts=!Ji&&oi("safari"),Vr=oi("phantom"),Or="OTransition"in Mt,ho=navigator.platform.indexOf("Win")===0,vi=Se&&"transition"in Mt,Ne="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!mt,ht="MozPerspective"in Mt,dt=!window.L_DISABLE_3D&&(vi||Ne||ht)&&!Or&&!Vr,rn=typeof orientation<"u"||oi("mobile"),wi=rn&&ke,Es=rn&&Ne,Fn=!window.PointerEvent&&window.MSPointerEvent,Zi=!!(window.PointerEvent||Fn),gn="ontouchstart"in window||!!window.TouchEvent,Bi=!window.L_NO_TOUCH&&(gn||Zi),zi=rn&&ri,Xn=rn&&pn,Od=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Hu=(function(){var u=!1;try{var f=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("testPassiveEventSupport",x,f),window.removeEventListener("testPassiveEventSupport",x,f)}catch{}return u})(),Hs=(function(){return!!document.createElement("canvas").getContext})(),cr=!!(document.createElementNS&&Yt("svg").createSVGRect),Ud=!!cr&&(function(){var u=document.createElement("div");return u.innerHTML="<svg/>",(u.firstChild&&u.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),fo=!cr&&(function(){try{var u=document.createElement("div");u.innerHTML='<v:shape adj="1"/>';var f=u.firstChild;return f.style.behavior="url(#default#VML)",f&&typeof f.adj=="object"}catch{return!1}})(),xl=navigator.platform.indexOf("Mac")===0,wl=navigator.platform.indexOf("Linux")===0;function oi(u){return navigator.userAgent.toLowerCase().indexOf(u)>=0}var Be={ie:Se,ielt9:Qe,edge:_e,webkit:ke,android:He,android23:mt,androidStock:un,opera:ri,chrome:Ji,gecko:pn,safari:Ts,phantom:Vr,opera12:Or,win:ho,ie3d:vi,webkit3d:Ne,gecko3d:ht,any3d:dt,mobile:rn,mobileWebkit:wi,mobileWebkit3d:Es,msPointer:Fn,pointer:Zi,touch:Bi,touchNative:gn,mobileOpera:zi,mobileGecko:Xn,retina:Od,passiveEvents:Hu,canvas:Hs,svg:cr,vml:fo,inlineSvg:Ud,mac:xl,linux:wl},Sl=Be.msPointer?"MSPointerDown":"pointerdown",Qi=Be.msPointer?"MSPointerMove":"pointermove",$i=Be.msPointer?"MSPointerUp":"pointerup",bn=Be.msPointer?"MSPointerCancel":"pointercancel",Mn={touchstart:Sl,touchmove:Qi,touchend:$i,touchcancel:bn},xs={touchstart:Ks,touchmove:ai,touchend:ai,touchcancel:ai},ws={},ju=!1;function Ku(u,f,E){return f==="touchstart"&&Xi(),xs[f]?(E=xs[f].bind(this,E),u.addEventListener(Mn[f],E,!1),E):(console.warn("wrong event specified:",f),x)}function Wu(u,f,E){if(!Mn[f]){console.warn("wrong event specified:",f);return}u.removeEventListener(Mn[f],E,!1)}function js(u){ws[u.pointerId]=u}function oa(u){ws[u.pointerId]&&(ws[u.pointerId]=u)}function Ss(u){delete ws[u.pointerId]}function Xi(){ju||(document.addEventListener(Sl,js,!0),document.addEventListener(Qi,oa,!0),document.addEventListener($i,Ss,!0),document.addEventListener(bn,Ss,!0),ju=!0)}function ai(u,f){if(f.pointerType!==(f.MSPOINTER_TYPE_MOUSE||"mouse")){f.touches=[];for(var E in ws)f.touches.push(ws[E]);f.changedTouches=[f],u(f)}}function Ks(u,f){f.MSPOINTER_TYPE_TOUCH&&f.pointerType===f.MSPOINTER_TYPE_TOUCH&&Tn(f),ai(u,f)}function Pn(u){var f={},E,b;for(b in u)E=u[b],f[b]=E&&E.bind?E.bind(u):E;return u=f,f.type="dblclick",f.detail=2,f.isTrusted=!1,f._simulated=!0,f}var Cl=200;function bl(u,f){u.addEventListener("dblclick",f);var E=0,b;function N(P){if(P.detail!==1){b=P.detail;return}if(!(P.pointerType==="mouse"||P.sourceCapabilities&&!P.sourceCapabilities.firesTouchEvents)){var j=qr(P);if(!(j.some(function(ue){return ue instanceof HTMLLabelElement&&ue.attributes.for})&&!j.some(function(ue){return ue instanceof HTMLInputElement||ue instanceof HTMLSelectElement}))){var te=Date.now();te-E<=Cl?(b++,b===2&&f(Pn(P))):b=1,E=te}}}return u.addEventListener("click",N),{dblclick:f,simDblclick:N}}function Ws(u,f){u.removeEventListener("dblclick",f.dblclick),u.removeEventListener("click",f.simDblclick)}var es=po(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),dr=po(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),aa=dr==="webkitTransition"||dr==="OTransition"?dr+"End":"transitionend";function la(u){return typeof u=="string"?document.getElementById(u):u}function Ur(u,f){var E=u.style[f]||u.currentStyle&&u.currentStyle[f];if((!E||E==="auto")&&document.defaultView){var b=document.defaultView.getComputedStyle(u,null);E=b?b[f]:null}return E==="auto"?null:E}function vt(u,f,E){var b=document.createElement(u);return b.className=f||"",E&&E.appendChild(b),b}function xt(u){var f=u.parentNode;f&&f.removeChild(u)}function yn(u){for(;u.firstChild;)u.removeChild(u.firstChild)}function vn(u){var f=u.parentNode;f&&f.lastChild!==u&&f.appendChild(u)}function qi(u){var f=u.parentNode;f&&f.firstChild!==u&&f.insertBefore(u,f.firstChild)}function mo(u,f){if(u.classList!==void 0)return u.classList.contains(f);var E=Ys(u);return E.length>0&&new RegExp("(^|\\s)"+f+"(\\s|$)").test(E)}function Ue(u,f){if(u.classList!==void 0)for(var E=D(f),b=0,N=E.length;b<N;b++)u.classList.add(E[b]);else if(!mo(u,f)){var P=Ys(u);ts(u,(P?P+" ":"")+f)}}function Zt(u,f){u.classList!==void 0?u.classList.remove(f):ts(u,A((" "+Ys(u)+" ").replace(" "+f+" "," ")))}function ts(u,f){u.className.baseVal===void 0?u.className=f:u.className.baseVal=f}function Ys(u){return u.correspondingElement&&(u=u.correspondingElement),u.className.baseVal===void 0?u.className:u.className.baseVal}function cn(u,f){"opacity"in u.style?u.style.opacity=f:"filter"in u.style&&ua(u,f)}function ua(u,f){var E=!1,b="DXImageTransform.Microsoft.Alpha";try{E=u.filters.item(b)}catch{if(f===1)return}f=Math.round(f*100),E?(E.Enabled=f!==100,E.Opacity=f):u.style.filter+=" progid:"+b+"(opacity="+f+")"}function po(u){for(var f=document.documentElement.style,E=0;E<u.length;E++)if(u[E]in f)return u[E];return!1}function Cs(u,f,E){var b=f||new be(0,0);u.style[es]=(Be.ie3d?"translate("+b.x+"px,"+b.y+"px)":"translate3d("+b.x+"px,"+b.y+"px,0)")+(E?" scale("+E+")":"")}function Qt(u,f){u._leaflet_pos=f,Be.any3d?Cs(u,f):(u.style.left=f.x+"px",u.style.top=f.y+"px")}function Js(u){return u._leaflet_pos||new be(0,0)}var ns,jn,ca;if("onselectstart"in document)ns=function(){tt(window,"selectstart",Tn)},jn=function(){Ft(window,"selectstart",Tn)};else{var hr=po(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ns=function(){if(hr){var u=document.documentElement.style;ca=u[hr],u[hr]="none"}},jn=function(){hr&&(document.documentElement.style[hr]=ca,ca=void 0)}}function go(){tt(window,"dragstart",Tn)}function Fr(){Ft(window,"dragstart",Tn)}var _o,Zs;function Br(u){for(;u.tabIndex===-1;)u=u.parentNode;u.style&&(Si(),_o=u,Zs=u.style.outlineStyle,u.style.outlineStyle="none",tt(window,"keydown",Si))}function Si(){_o&&(_o.style.outlineStyle=Zs,_o=void 0,Zs=void 0,Ft(window,"keydown",Si))}function da(u){do u=u.parentNode;while((!u.offsetWidth||!u.offsetHeight)&&u!==document.body);return u}function Ci(u){var f=u.getBoundingClientRect();return{x:f.width/u.offsetWidth||1,y:f.height/u.offsetHeight||1,boundingClientRect:f}}var zr={__proto__:null,TRANSFORM:es,TRANSITION:dr,TRANSITION_END:aa,get:la,getStyle:Ur,create:vt,remove:xt,empty:yn,toFront:vn,toBack:qi,hasClass:mo,addClass:Ue,removeClass:Zt,setClass:ts,getClass:Ys,setOpacity:cn,testProp:po,setTransform:Cs,setPosition:Qt,getPosition:Js,get disableTextSelection(){return ns},get enableTextSelection(){return jn},disableImageDrag:go,enableImageDrag:Fr,preventOutline:Br,restoreOutline:Si,getSizedParentNode:da,getScale:Ci};function tt(u,f,E,b){if(f&&typeof f=="object")for(var N in f)bi(u,N,f[N],E);else{f=D(f);for(var P=0,j=f.length;P<j;P++)bi(u,f[P],E,b)}return this}var li="_leaflet_events";function Ft(u,f,E,b){if(arguments.length===1)fr(u),delete u[li];else if(f&&typeof f=="object")for(var N in f)mr(u,N,f[N],E);else if(f=D(f),arguments.length===2)fr(u,function(te){return he(f,te)!==-1});else for(var P=0,j=f.length;P<j;P++)mr(u,f[P],E,b);return this}function fr(u,f){for(var E in u[li]){var b=E.split(/\d/)[0];(!f||f(b))&&mr(u,b,null,null,E)}}var Gi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function bi(u,f,E,b){var N=f+h(E)+(b?"_"+h(b):"");if(u[li]&&u[li][N])return this;var P=function(te){return E.call(b||u,te||window.event)},j=P;!Be.touchNative&&Be.pointer&&f.indexOf("touch")===0?P=Ku(u,f,P):Be.touch&&f==="dblclick"?P=bl(u,P):"addEventListener"in u?f==="touchstart"||f==="touchmove"||f==="wheel"||f==="mousewheel"?u.addEventListener(Gi[f]||f,P,Be.passiveEvents?{passive:!1}:!1):f==="mouseenter"||f==="mouseleave"?(P=function(te){te=te||window.event,As(u,te)&&j(te)},u.addEventListener(Gi[f],P,!1)):u.addEventListener(f,j,!1):u.attachEvent("on"+f,P),u[li]=u[li]||{},u[li][N]=P}function mr(u,f,E,b,N){N=N||f+h(E)+(b?"_"+h(b):"");var P=u[li]&&u[li][N];if(!P)return this;!Be.touchNative&&Be.pointer&&f.indexOf("touch")===0?Wu(u,f,P):Be.touch&&f==="dblclick"?Ws(u,P):"removeEventListener"in u?u.removeEventListener(Gi[f]||f,P,!1):u.detachEvent("on"+f,P),u[li][N]=null}function Pt(u){return u.stopPropagation?u.stopPropagation():u.originalEvent?u.originalEvent._stopped=!0:u.cancelBubble=!0,this}function is(u){return bi(u,"wheel",Pt),this}function pr(u){return tt(u,"mousedown touchstart dblclick contextmenu",Pt),u._leaflet_disable_click=!0,this}function Tn(u){return u.preventDefault?u.preventDefault():u.returnValue=!1,this}function bs(u){return Tn(u),Pt(u),this}function qr(u){if(u.composedPath)return u.composedPath();for(var f=[],E=u.target;E;)f.push(E),E=E.parentNode;return f}function Qs(u,f){if(!f)return new be(u.clientX,u.clientY);var E=Ci(f),b=E.boundingClientRect;return new be((u.clientX-b.left)/E.x-f.clientLeft,(u.clientY-b.top)/E.y-f.clientTop)}var Is=Be.linux&&Be.chrome?window.devicePixelRatio:Be.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Kn(u){return Be.edge?u.wheelDeltaY/2:u.deltaY&&u.deltaMode===0?-u.deltaY/Is:u.deltaY&&u.deltaMode===1?-u.deltaY*20:u.deltaY&&u.deltaMode===2?-u.deltaY*60:u.deltaX||u.deltaZ?0:u.wheelDelta?(u.wheelDeltaY||u.wheelDelta)/2:u.detail&&Math.abs(u.detail)<32765?-u.detail*20:u.detail?u.detail/-32765*60:0}function As(u,f){var E=f.relatedTarget;if(!E)return!0;try{for(;E&&E!==u;)E=E.parentNode}catch{return!1}return E!==u}var $s={__proto__:null,on:tt,off:Ft,stopPropagation:Pt,disableScrollPropagation:is,disableClickPropagation:pr,preventDefault:Tn,stop:bs,getPropagationPath:qr,getMousePosition:Qs,getWheelDelta:Kn,isExternalTarget:As,addListener:tt,removeListener:Ft},gr=Ce.extend({run:function(u,f,E,b){this.stop(),this._el=u,this._inProgress=!0,this._duration=E||.25,this._easeOutPower=1/Math.max(b||.5,.2),this._startPos=Js(u),this._offset=f.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=G(this._animate,this),this._step()},_step:function(u){var f=+new Date-this._startTime,E=this._duration*1e3;f<E?this._runFrame(this._easeOut(f/E),u):(this._runFrame(1),this._complete())},_runFrame:function(u,f){var E=this._startPos.add(this._offset.multiplyBy(u));f&&E._round(),Qt(this._el,E),this.fire("step")},_complete:function(){W(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(u){return 1-Math.pow(1-u,this._easeOutPower)}}),yt=Ce.extend({options:{crs:mn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(u,f){f=F(this,f),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(u),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),f.maxBounds&&this.setMaxBounds(f.maxBounds),f.zoom!==void 0&&(this._zoom=this._limitZoom(f.zoom)),f.center&&f.zoom!==void 0&&this.setView(we(f.center),f.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=dr&&Be.any3d&&!Be.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),tt(this._proxy,aa,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(u,f,E){if(f=f===void 0?this._zoom:this._limitZoom(f),u=this._limitCenter(we(u),f,this.options.maxBounds),E=E||{},this._stop(),this._loaded&&!E.reset&&E!==!0){E.animate!==void 0&&(E.zoom=s({animate:E.animate},E.zoom),E.pan=s({animate:E.animate,duration:E.duration},E.pan));var b=this._zoom!==f?this._tryAnimatedZoom&&this._tryAnimatedZoom(u,f,E.zoom):this._tryAnimatedPan(u,E.pan);if(b)return clearTimeout(this._sizeTimer),this}return this._resetView(u,f,E.pan&&E.pan.noMoveStart),this},setZoom:function(u,f){return this._loaded?this.setView(this.getCenter(),u,{zoom:f}):(this._zoom=u,this)},zoomIn:function(u,f){return u=u||(Be.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+u,f)},zoomOut:function(u,f){return u=u||(Be.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-u,f)},setZoomAround:function(u,f,E){var b=this.getZoomScale(f),N=this.getSize().divideBy(2),P=u instanceof be?u:this.latLngToContainerPoint(u),j=P.subtract(N).multiplyBy(1-1/b),te=this.containerPointToLatLng(N.add(j));return this.setView(te,f,{zoom:E})},_getBoundsCenterZoom:function(u,f){f=f||{},u=u.getBounds?u.getBounds():le(u);var E=Pe(f.paddingTopLeft||f.padding||[0,0]),b=Pe(f.paddingBottomRight||f.padding||[0,0]),N=this.getBoundsZoom(u,!1,E.add(b));if(N=typeof f.maxZoom=="number"?Math.min(f.maxZoom,N):N,N===1/0)return{center:u.getCenter(),zoom:N};var P=b.subtract(E).divideBy(2),j=this.project(u.getSouthWest(),N),te=this.project(u.getNorthEast(),N),ue=this.unproject(j.add(te).divideBy(2).add(P),N);return{center:ue,zoom:N}},fitBounds:function(u,f){if(u=le(u),!u.isValid())throw new Error("Bounds are not valid.");var E=this._getBoundsCenterZoom(u,f);return this.setView(E.center,E.zoom,f)},fitWorld:function(u){return this.fitBounds([[-90,-180],[90,180]],u)},panTo:function(u,f){return this.setView(u,this._zoom,{pan:f})},panBy:function(u,f){if(u=Pe(u).round(),f=f||{},!u.x&&!u.y)return this.fire("moveend");if(f.animate!==!0&&!this.getSize().contains(u))return this._resetView(this.unproject(this.project(this.getCenter()).add(u)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new gr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),f.noMoveStart||this.fire("movestart"),f.animate!==!1){Ue(this._mapPane,"leaflet-pan-anim");var E=this._getMapPanePos().subtract(u).round();this._panAnim.run(this._mapPane,E,f.duration||.25,f.easeLinearity)}else this._rawPanBy(u),this.fire("move").fire("moveend");return this},flyTo:function(u,f,E){if(E=E||{},E.animate===!1||!Be.any3d)return this.setView(u,f,E);this._stop();var b=this.project(this.getCenter()),N=this.project(u),P=this.getSize(),j=this._zoom;u=we(u),f=f===void 0?j:f;var te=Math.max(P.x,P.y),ue=te*this.getZoomScale(j,f),Ee=N.distanceTo(b)||1,Le=1.42,Je=Le*Le;function gt(In){var Er=In?-1:1,So=In?ue:te,Hd=ue*ue-te*te+Er*Je*Je*Ee*Ee,Kl=2*So*Je*Ee,Wl=Hd/Kl,$r=Math.sqrt(Wl*Wl+1)-Wl,xr=$r<1e-9?-18:Math.log($r);return xr}function ei(In){return(Math.exp(In)-Math.exp(-In))/2}function kn(In){return(Math.exp(In)+Math.exp(-In))/2}function Ki(In){return ei(In)/kn(In)}var Bt=gt(0);function zt(In){return te*(kn(Bt)/kn(Bt+Le*In))}function wt(In){return te*(kn(Bt)*Ki(Bt+Le*In)-ei(Bt))/Je}function Zr(In){return 1-Math.pow(1-In,1.5)}var ls=Date.now(),oc=(gt(1)-Bt)/Le,Qr=E.duration?1e3*E.duration:1e3*oc*.8;function Gd(){var In=(Date.now()-ls)/Qr,Er=Zr(In)*oc;In<=1?(this._flyToFrame=G(Gd,this),this._move(this.unproject(b.add(N.subtract(b).multiplyBy(wt(Er)/Ee)),j),this.getScaleZoom(te/zt(Er),j),{flyTo:!0})):this._move(u,f)._moveEnd(!0)}return this._moveStart(!0,E.noMoveStart),Gd.call(this),this},flyToBounds:function(u,f){var E=this._getBoundsCenterZoom(u,f);return this.flyTo(E.center,E.zoom,f)},setMaxBounds:function(u){return u=le(u),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),u.isValid()?(this.options.maxBounds=u,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(u){var f=this.options.minZoom;return this.options.minZoom=u,this._loaded&&f!==u&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(u):this},setMaxZoom:function(u){var f=this.options.maxZoom;return this.options.maxZoom=u,this._loaded&&f!==u&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(u):this},panInsideBounds:function(u,f){this._enforcingBounds=!0;var E=this.getCenter(),b=this._limitCenter(E,this._zoom,le(u));return E.equals(b)||this.panTo(b,f),this._enforcingBounds=!1,this},panInside:function(u,f){f=f||{};var E=Pe(f.paddingTopLeft||f.padding||[0,0]),b=Pe(f.paddingBottomRight||f.padding||[0,0]),N=this.project(this.getCenter()),P=this.project(u),j=this.getPixelBounds(),te=me([j.min.add(E),j.max.subtract(b)]),ue=te.getSize();if(!te.contains(P)){this._enforcingBounds=!0;var Ee=P.subtract(te.getCenter()),Le=te.extend(P).getSize().subtract(ue);N.x+=Ee.x<0?-Le.x:Le.x,N.y+=Ee.y<0?-Le.y:Le.y,this.panTo(this.unproject(N),f),this._enforcingBounds=!1}return this},invalidateSize:function(u){if(!this._loaded)return this;u=s({animate:!1,pan:!0},u===!0?{animate:!0}:u);var f=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var E=this.getSize(),b=f.divideBy(2).round(),N=E.divideBy(2).round(),P=b.subtract(N);return!P.x&&!P.y?this:(u.animate&&u.pan?this.panBy(P):(u.pan&&this._rawPanBy(P),this.fire("move"),u.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:f,newSize:E}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(u){if(u=this._locateOptions=s({timeout:1e4,watch:!1},u),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var f=l(this._handleGeolocationResponse,this),E=l(this._handleGeolocationError,this);return u.watch?this._locationWatchId=navigator.geolocation.watchPosition(f,E,u):navigator.geolocation.getCurrentPosition(f,E,u),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(u){if(this._container._leaflet_id){var f=u.code,E=u.message||(f===1?"permission denied":f===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:f,message:"Geolocation error: "+E+"."})}},_handleGeolocationResponse:function(u){if(this._container._leaflet_id){var f=u.coords.latitude,E=u.coords.longitude,b=new ge(f,E),N=b.toBounds(u.coords.accuracy*2),P=this._locateOptions;if(P.setView){var j=this.getBoundsZoom(N);this.setView(b,P.maxZoom?Math.min(j,P.maxZoom):j)}var te={latlng:b,bounds:N,timestamp:u.timestamp};for(var ue in u.coords)typeof u.coords[ue]=="number"&&(te[ue]=u.coords[ue]);this.fire("locationfound",te)}},addHandler:function(u,f){if(!f)return this;var E=this[u]=new f(this);return this._handlers.push(E),this.options[u]&&E.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),xt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(W(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var u;for(u in this._layers)this._layers[u].remove();for(u in this._panes)xt(this._panes[u]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(u,f){var E="leaflet-pane"+(u?" leaflet-"+u.replace("Pane","")+"-pane":""),b=vt("div",E,f||this._mapPane);return u&&(this._panes[u]=b),b},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var u=this.getPixelBounds(),f=this.unproject(u.getBottomLeft()),E=this.unproject(u.getTopRight());return new Ie(f,E)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(u,f,E){u=le(u),E=Pe(E||[0,0]);var b=this.getZoom()||0,N=this.getMinZoom(),P=this.getMaxZoom(),j=u.getNorthWest(),te=u.getSouthEast(),ue=this.getSize().subtract(E),Ee=me(this.project(te,b),this.project(j,b)).getSize(),Le=Be.any3d?this.options.zoomSnap:1,Je=ue.x/Ee.x,gt=ue.y/Ee.y,ei=f?Math.max(Je,gt):Math.min(Je,gt);return b=this.getScaleZoom(ei,b),Le&&(b=Math.round(b/(Le/100))*(Le/100),b=f?Math.ceil(b/Le)*Le:Math.floor(b/Le)*Le),Math.max(N,Math.min(P,b))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new be(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(u,f){var E=this._getTopLeftPoint(u,f);return new K(E,E.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(u){return this.options.crs.getProjectedBounds(u===void 0?this.getZoom():u)},getPane:function(u){return typeof u=="string"?this._panes[u]:u},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(u,f){var E=this.options.crs;return f=f===void 0?this._zoom:f,E.scale(u)/E.scale(f)},getScaleZoom:function(u,f){var E=this.options.crs;f=f===void 0?this._zoom:f;var b=E.zoom(u*E.scale(f));return isNaN(b)?1/0:b},project:function(u,f){return f=f===void 0?this._zoom:f,this.options.crs.latLngToPoint(we(u),f)},unproject:function(u,f){return f=f===void 0?this._zoom:f,this.options.crs.pointToLatLng(Pe(u),f)},layerPointToLatLng:function(u){var f=Pe(u).add(this.getPixelOrigin());return this.unproject(f)},latLngToLayerPoint:function(u){var f=this.project(we(u))._round();return f._subtract(this.getPixelOrigin())},wrapLatLng:function(u){return this.options.crs.wrapLatLng(we(u))},wrapLatLngBounds:function(u){return this.options.crs.wrapLatLngBounds(le(u))},distance:function(u,f){return this.options.crs.distance(we(u),we(f))},containerPointToLayerPoint:function(u){return Pe(u).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(u){return Pe(u).add(this._getMapPanePos())},containerPointToLatLng:function(u){var f=this.containerPointToLayerPoint(Pe(u));return this.layerPointToLatLng(f)},latLngToContainerPoint:function(u){return this.layerPointToContainerPoint(this.latLngToLayerPoint(we(u)))},mouseEventToContainerPoint:function(u){return Qs(u,this._container)},mouseEventToLayerPoint:function(u){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(u))},mouseEventToLatLng:function(u){return this.layerPointToLatLng(this.mouseEventToLayerPoint(u))},_initContainer:function(u){var f=this._container=la(u);if(f){if(f._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");tt(f,"scroll",this._onScroll,this),this._containerId=h(f)},_initLayout:function(){var u=this._container;this._fadeAnimated=this.options.fadeAnimation&&Be.any3d,Ue(u,"leaflet-container"+(Be.touch?" leaflet-touch":"")+(Be.retina?" leaflet-retina":"")+(Be.ielt9?" leaflet-oldie":"")+(Be.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var f=Ur(u,"position");f!=="absolute"&&f!=="relative"&&f!=="fixed"&&f!=="sticky"&&(u.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var u=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Qt(this._mapPane,new be(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ue(u.markerPane,"leaflet-zoom-hide"),Ue(u.shadowPane,"leaflet-zoom-hide"))},_resetView:function(u,f,E){Qt(this._mapPane,new be(0,0));var b=!this._loaded;this._loaded=!0,f=this._limitZoom(f),this.fire("viewprereset");var N=this._zoom!==f;this._moveStart(N,E)._move(u,f)._moveEnd(N),this.fire("viewreset"),b&&this.fire("load")},_moveStart:function(u,f){return u&&this.fire("zoomstart"),f||this.fire("movestart"),this},_move:function(u,f,E,b){f===void 0&&(f=this._zoom);var N=this._zoom!==f;return this._zoom=f,this._lastCenter=u,this._pixelOrigin=this._getNewPixelOrigin(u),b?E&&E.pinch&&this.fire("zoom",E):((N||E&&E.pinch)&&this.fire("zoom",E),this.fire("move",E)),this},_moveEnd:function(u){return u&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return W(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(u){Qt(this._mapPane,this._getMapPanePos().subtract(u))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(u){this._targets={},this._targets[h(this._container)]=this;var f=u?Ft:tt;f(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&f(window,"resize",this._onResize,this),Be.any3d&&this.options.transform3DLimit&&(u?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){W(this._resizeRequest),this._resizeRequest=G(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var u=this._getMapPanePos();Math.max(Math.abs(u.x),Math.abs(u.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(u,f){for(var E=[],b,N=f==="mouseout"||f==="mouseover",P=u.target||u.srcElement,j=!1;P;){if(b=this._targets[h(P)],b&&(f==="click"||f==="preclick")&&this._draggableMoved(b)){j=!0;break}if(b&&b.listens(f,!0)&&(N&&!As(P,u)||(E.push(b),N))||P===this._container)break;P=P.parentNode}return!E.length&&!j&&!N&&this.listens(f,!0)&&(E=[this]),E},_isClickDisabled:function(u){for(;u&&u!==this._container;){if(u._leaflet_disable_click)return!0;u=u.parentNode}},_handleDOMEvent:function(u){var f=u.target||u.srcElement;if(!(!this._loaded||f._leaflet_disable_events||u.type==="click"&&this._isClickDisabled(f))){var E=u.type;E==="mousedown"&&Br(f),this._fireDOMEvent(u,E)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(u,f,E){if(u.type==="click"){var b=s({},u);b.type="preclick",this._fireDOMEvent(b,b.type,E)}var N=this._findEventTargets(u,f);if(E){for(var P=[],j=0;j<E.length;j++)E[j].listens(f,!0)&&P.push(E[j]);N=P.concat(N)}if(N.length){f==="contextmenu"&&Tn(u);var te=N[0],ue={originalEvent:u};if(u.type!=="keypress"&&u.type!=="keydown"&&u.type!=="keyup"){var Ee=te.getLatLng&&(!te._radius||te._radius<=10);ue.containerPoint=Ee?this.latLngToContainerPoint(te.getLatLng()):this.mouseEventToContainerPoint(u),ue.layerPoint=this.containerPointToLayerPoint(ue.containerPoint),ue.latlng=Ee?te.getLatLng():this.layerPointToLatLng(ue.layerPoint)}for(j=0;j<N.length;j++)if(N[j].fire(f,ue,!0),ue.originalEvent._stopped||N[j].options.bubblingMouseEvents===!1&&he(this._mouseEvents,f)!==-1)return}},_draggableMoved:function(u){return u=u.dragging&&u.dragging.enabled()?u:this,u.dragging&&u.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var u=0,f=this._handlers.length;u<f;u++)this._handlers[u].disable()},whenReady:function(u,f){return this._loaded?u.call(f||this,{target:this}):this.on("load",u,f),this},_getMapPanePos:function(){return Js(this._mapPane)||new be(0,0)},_moved:function(){var u=this._getMapPanePos();return u&&!u.equals([0,0])},_getTopLeftPoint:function(u,f){var E=u&&f!==void 0?this._getNewPixelOrigin(u,f):this.getPixelOrigin();return E.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(u,f){var E=this.getSize()._divideBy(2);return this.project(u,f)._subtract(E)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(u,f,E){var b=this._getNewPixelOrigin(E,f);return this.project(u,f)._subtract(b)},_latLngBoundsToNewLayerBounds:function(u,f,E){var b=this._getNewPixelOrigin(E,f);return me([this.project(u.getSouthWest(),f)._subtract(b),this.project(u.getNorthWest(),f)._subtract(b),this.project(u.getSouthEast(),f)._subtract(b),this.project(u.getNorthEast(),f)._subtract(b)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(u){return this.latLngToLayerPoint(u).subtract(this._getCenterLayerPoint())},_limitCenter:function(u,f,E){if(!E)return u;var b=this.project(u,f),N=this.getSize().divideBy(2),P=new K(b.subtract(N),b.add(N)),j=this._getBoundsOffset(P,E,f);return Math.abs(j.x)<=1&&Math.abs(j.y)<=1?u:this.unproject(b.add(j),f)},_limitOffset:function(u,f){if(!f)return u;var E=this.getPixelBounds(),b=new K(E.min.add(u),E.max.add(u));return u.add(this._getBoundsOffset(b,f))},_getBoundsOffset:function(u,f,E){var b=me(this.project(f.getNorthEast(),E),this.project(f.getSouthWest(),E)),N=b.min.subtract(u.min),P=b.max.subtract(u.max),j=this._rebound(N.x,-P.x),te=this._rebound(N.y,-P.y);return new be(j,te)},_rebound:function(u,f){return u+f>0?Math.round(u-f)/2:Math.max(0,Math.ceil(u))-Math.max(0,Math.floor(f))},_limitZoom:function(u){var f=this.getMinZoom(),E=this.getMaxZoom(),b=Be.any3d?this.options.zoomSnap:1;return b&&(u=Math.round(u/b)*b),Math.max(f,Math.min(E,u))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Zt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(u,f){var E=this._getCenterOffset(u)._trunc();return(f&&f.animate)!==!0&&!this.getSize().contains(E)?!1:(this.panBy(E,f),!0)},_createAnimProxy:function(){var u=this._proxy=vt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(u),this.on("zoomanim",function(f){var E=es,b=this._proxy.style[E];Cs(this._proxy,this.project(f.center,f.zoom),this.getZoomScale(f.zoom,1)),b===this._proxy.style[E]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){xt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var u=this.getCenter(),f=this.getZoom();Cs(this._proxy,this.project(u,f),this.getZoomScale(f,1))},_catchTransitionEnd:function(u){this._animatingZoom&&u.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(u,f,E){if(this._animatingZoom)return!0;if(E=E||{},!this._zoomAnimated||E.animate===!1||this._nothingToAnimate()||Math.abs(f-this._zoom)>this.options.zoomAnimationThreshold)return!1;var b=this.getZoomScale(f),N=this._getCenterOffset(u)._divideBy(1-1/b);return E.animate!==!0&&!this.getSize().contains(N)?!1:(G(function(){this._moveStart(!0,E.noMoveStart||!1)._animateZoom(u,f,!0)},this),!0)},_animateZoom:function(u,f,E,b){this._mapPane&&(E&&(this._animatingZoom=!0,this._animateToCenter=u,this._animateToZoom=f,Ue(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:u,zoom:f,noUpdate:b}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Zt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Gr(u,f){return new yt(u,f)}var ui=Ge.extend({options:{position:"topright"},initialize:function(u){F(this,u)},getPosition:function(){return this.options.position},setPosition:function(u){var f=this._map;return f&&f.removeControl(this),this.options.position=u,f&&f.addControl(this),this},getContainer:function(){return this._container},addTo:function(u){this.remove(),this._map=u;var f=this._container=this.onAdd(u),E=this.getPosition(),b=u._controlCorners[E];return Ue(f,"leaflet-control"),E.indexOf("bottom")!==-1?b.insertBefore(f,b.firstChild):b.appendChild(f),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(xt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(u){this._map&&u&&u.screenX>0&&u.screenY>0&&this._map.getContainer().focus()}}),Ii=function(u){return new ui(u)};yt.include({addControl:function(u){return u.addTo(this),this},removeControl:function(u){return u.remove(),this},_initControlPos:function(){var u=this._controlCorners={},f="leaflet-",E=this._controlContainer=vt("div",f+"control-container",this._container);function b(N,P){var j=f+N+" "+f+P;u[N+P]=vt("div",j,E)}b("top","left"),b("top","right"),b("bottom","left"),b("bottom","right")},_clearControlPos:function(){for(var u in this._controlCorners)xt(this._controlCorners[u]);xt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var yo=ui.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(u,f,E,b){return E<b?-1:b<E?1:0}},initialize:function(u,f,E){F(this,E),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var b in u)this._addLayer(u[b],b);for(b in f)this._addLayer(f[b],b,!0)},onAdd:function(u){this._initLayout(),this._update(),this._map=u,u.on("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(u){return ui.prototype.addTo.call(this,u),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(u,f){return this._addLayer(u,f),this._map?this._update():this},addOverlay:function(u,f){return this._addLayer(u,f,!0),this._map?this._update():this},removeLayer:function(u){u.off("add remove",this._onLayerChange,this);var f=this._getLayer(h(u));return f&&this._layers.splice(this._layers.indexOf(f),1),this._map?this._update():this},expand:function(){Ue(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var u=this._map.getSize().y-(this._container.offsetTop+50);return u<this._section.clientHeight?(Ue(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=u+"px"):Zt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Zt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var u="leaflet-control-layers",f=this._container=vt("div",u),E=this.options.collapsed;f.setAttribute("aria-haspopup",!0),pr(f),is(f);var b=this._section=vt("section",u+"-list");E&&(this._map.on("click",this.collapse,this),tt(f,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var N=this._layersLink=vt("a",u+"-toggle",f);N.href="#",N.title="Layers",N.setAttribute("role","button"),tt(N,{keydown:function(P){P.keyCode===13&&this._expandSafely()},click:function(P){Tn(P),this._expandSafely()}},this),E||this.expand(),this._baseLayersList=vt("div",u+"-base",b),this._separator=vt("div",u+"-separator",b),this._overlaysList=vt("div",u+"-overlays",b),f.appendChild(b)},_getLayer:function(u){for(var f=0;f<this._layers.length;f++)if(this._layers[f]&&h(this._layers[f].layer)===u)return this._layers[f]},_addLayer:function(u,f,E){this._map&&u.on("add remove",this._onLayerChange,this),this._layers.push({layer:u,name:f,overlay:E}),this.options.sortLayers&&this._layers.sort(l(function(b,N){return this.options.sortFunction(b.layer,N.layer,b.name,N.name)},this)),this.options.autoZIndex&&u.setZIndex&&(this._lastZIndex++,u.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;yn(this._baseLayersList),yn(this._overlaysList),this._layerControlInputs=[];var u,f,E,b,N=0;for(E=0;E<this._layers.length;E++)b=this._layers[E],this._addItem(b),f=f||b.overlay,u=u||!b.overlay,N+=b.overlay?0:1;return this.options.hideSingleBase&&(u=u&&N>1,this._baseLayersList.style.display=u?"":"none"),this._separator.style.display=f&&u?"":"none",this},_onLayerChange:function(u){this._handlingClick||this._update();var f=this._getLayer(h(u.target)),E=f.overlay?u.type==="add"?"overlayadd":"overlayremove":u.type==="add"?"baselayerchange":null;E&&this._map.fire(E,f)},_createRadioElement:function(u,f){var E='<input type="radio" class="leaflet-control-layers-selector" name="'+u+'"'+(f?' checked="checked"':"")+"/>",b=document.createElement("div");return b.innerHTML=E,b.firstChild},_addItem:function(u){var f=document.createElement("label"),E=this._map.hasLayer(u.layer),b;u.overlay?(b=document.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=E):b=this._createRadioElement("leaflet-base-layers_"+h(this),E),this._layerControlInputs.push(b),b.layerId=h(u.layer),tt(b,"click",this._onInputClick,this);var N=document.createElement("span");N.innerHTML=" "+u.name;var P=document.createElement("span");f.appendChild(P),P.appendChild(b),P.appendChild(N);var j=u.overlay?this._overlaysList:this._baseLayersList;return j.appendChild(f),this._checkDisabledLayers(),f},_onInputClick:function(){if(!this._preventClick){var u=this._layerControlInputs,f,E,b=[],N=[];this._handlingClick=!0;for(var P=u.length-1;P>=0;P--)f=u[P],E=this._getLayer(f.layerId).layer,f.checked?b.push(E):f.checked||N.push(E);for(P=0;P<N.length;P++)this._map.hasLayer(N[P])&&this._map.removeLayer(N[P]);for(P=0;P<b.length;P++)this._map.hasLayer(b[P])||this._map.addLayer(b[P]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var u=this._layerControlInputs,f,E,b=this._map.getZoom(),N=u.length-1;N>=0;N--)f=u[N],E=this._getLayer(f.layerId).layer,f.disabled=E.options.minZoom!==void 0&&b<E.options.minZoom||E.options.maxZoom!==void 0&&b>E.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var u=this._section;this._preventClick=!0,tt(u,"click",Tn),this.expand();var f=this;setTimeout(function(){Ft(u,"click",Tn),f._preventClick=!1})}}),Il=function(u,f,E){return new yo(u,f,E)},_r=ui.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(u){var f="leaflet-control-zoom",E=vt("div",f+" leaflet-bar"),b=this.options;return this._zoomInButton=this._createButton(b.zoomInText,b.zoomInTitle,f+"-in",E,this._zoomIn),this._zoomOutButton=this._createButton(b.zoomOutText,b.zoomOutTitle,f+"-out",E,this._zoomOut),this._updateDisabled(),u.on("zoomend zoomlevelschange",this._updateDisabled,this),E},onRemove:function(u){u.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(u){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(u.shiftKey?3:1))},_zoomOut:function(u){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(u.shiftKey?3:1))},_createButton:function(u,f,E,b,N){var P=vt("a",E,b);return P.innerHTML=u,P.href="#",P.title=f,P.setAttribute("role","button"),P.setAttribute("aria-label",f),pr(P),tt(P,"click",bs),tt(P,"click",N,this),tt(P,"click",this._refocusOnMap,this),P},_updateDisabled:function(){var u=this._map,f="leaflet-disabled";Zt(this._zoomInButton,f),Zt(this._zoomOutButton,f),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||u._zoom===u.getMinZoom())&&(Ue(this._zoomOutButton,f),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||u._zoom===u.getMaxZoom())&&(Ue(this._zoomInButton,f),this._zoomInButton.setAttribute("aria-disabled","true"))}});yt.mergeOptions({zoomControl:!0}),yt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new _r,this.addControl(this.zoomControl))});var Yu=function(u){return new _r(u)},Al=ui.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(u){var f="leaflet-control-scale",E=vt("div",f),b=this.options;return this._addScales(b,f+"-line",E),u.on(b.updateWhenIdle?"moveend":"move",this._update,this),u.whenReady(this._update,this),E},onRemove:function(u){u.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(u,f,E){u.metric&&(this._mScale=vt("div",f,E)),u.imperial&&(this._iScale=vt("div",f,E))},_update:function(){var u=this._map,f=u.getSize().y/2,E=u.distance(u.containerPointToLatLng([0,f]),u.containerPointToLatLng([this.options.maxWidth,f]));this._updateScales(E)},_updateScales:function(u){this.options.metric&&u&&this._updateMetric(u),this.options.imperial&&u&&this._updateImperial(u)},_updateMetric:function(u){var f=this._getRoundNum(u),E=f<1e3?f+" m":f/1e3+" km";this._updateScale(this._mScale,E,f/u)},_updateImperial:function(u){var f=u*3.2808399,E,b,N;f>5280?(E=f/5280,b=this._getRoundNum(E),this._updateScale(this._iScale,b+" mi",b/E)):(N=this._getRoundNum(f),this._updateScale(this._iScale,N+" ft",N/f))},_updateScale:function(u,f,E){u.style.width=Math.round(this.options.maxWidth*E)+"px",u.innerHTML=f},_getRoundNum:function(u){var f=Math.pow(10,(Math.floor(u)+"").length-1),E=u/f;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:1,f*E}}),vo=function(u){return new Al(u)},Nl='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ha=ui.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Be.inlineSvg?Nl+" ":"")+"Leaflet</a>"},initialize:function(u){F(this,u),this._attributions={}},onAdd:function(u){u.attributionControl=this,this._container=vt("div","leaflet-control-attribution"),pr(this._container);for(var f in u._layers)u._layers[f].getAttribution&&this.addAttribution(u._layers[f].getAttribution());return this._update(),u.on("layeradd",this._addAttribution,this),this._container},onRemove:function(u){u.off("layeradd",this._addAttribution,this)},_addAttribution:function(u){u.layer.getAttribution&&(this.addAttribution(u.layer.getAttribution()),u.layer.once("remove",function(){this.removeAttribution(u.layer.getAttribution())},this))},setPrefix:function(u){return this.options.prefix=u,this._update(),this},addAttribution:function(u){return u?(this._attributions[u]||(this._attributions[u]=0),this._attributions[u]++,this._update(),this):this},removeAttribution:function(u){return u?(this._attributions[u]&&(this._attributions[u]--,this._update()),this):this},_update:function(){if(this._map){var u=[];for(var f in this._attributions)this._attributions[f]&&u.push(f);var E=[];this.options.prefix&&E.push(this.options.prefix),u.length&&E.push(u.join(", ")),this._container.innerHTML=E.join(' <span aria-hidden="true">|</span> ')}}});yt.mergeOptions({attributionControl:!0}),yt.addInitHook(function(){this.options.attributionControl&&new ha().addTo(this)});var fa=function(u){return new ha(u)};ui.Layers=yo,ui.Zoom=_r,ui.Scale=Al,ui.Attribution=ha,Ii.layers=Il,Ii.zoom=Yu,Ii.scale=vo,Ii.attribution=fa;var Hi=Ge.extend({initialize:function(u){this._map=u},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Hi.addTo=function(u,f){return u.addHandler(f,this),this};var Ju={Events:se},Ns=Be.touch?"touchstart mousedown":"mousedown",Rs=Ce.extend({options:{clickTolerance:3},initialize:function(u,f,E,b){F(this,b),this._element=u,this._dragStartTarget=f||u,this._preventOutline=E},enable:function(){this._enabled||(tt(this._dragStartTarget,Ns,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Rs._dragging===this&&this.finishDrag(!0),Ft(this._dragStartTarget,Ns,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(u){if(this._enabled&&(this._moved=!1,!mo(this._element,"leaflet-zoom-anim"))){if(u.touches&&u.touches.length!==1){Rs._dragging===this&&this.finishDrag();return}if(!(Rs._dragging||u.shiftKey||u.which!==1&&u.button!==1&&!u.touches)&&(Rs._dragging=this,this._preventOutline&&Br(this._element),go(),ns(),!this._moving)){this.fire("down");var f=u.touches?u.touches[0]:u,E=da(this._element);this._startPoint=new be(f.clientX,f.clientY),this._startPos=Js(this._element),this._parentScale=Ci(E);var b=u.type==="mousedown";tt(document,b?"mousemove":"touchmove",this._onMove,this),tt(document,b?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(u){if(this._enabled){if(u.touches&&u.touches.length>1){this._moved=!0;return}var f=u.touches&&u.touches.length===1?u.touches[0]:u,E=new be(f.clientX,f.clientY)._subtract(this._startPoint);!E.x&&!E.y||Math.abs(E.x)+Math.abs(E.y)<this.options.clickTolerance||(E.x/=this._parentScale.x,E.y/=this._parentScale.y,Tn(u),this._moved||(this.fire("dragstart"),this._moved=!0,Ue(document.body,"leaflet-dragging"),this._lastTarget=u.target||u.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ue(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(E),this._moving=!0,this._lastEvent=u,this._updatePosition())}},_updatePosition:function(){var u={originalEvent:this._lastEvent};this.fire("predrag",u),Qt(this._element,this._newPos),this.fire("drag",u)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(u){Zt(document.body,"leaflet-dragging"),this._lastTarget&&(Zt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ft(document,"mousemove touchmove",this._onMove,this),Ft(document,"mouseup touchend touchcancel",this._onUp,this),Fr(),jn();var f=this._moved&&this._moving;this._moving=!1,Rs._dragging=!1,f&&this.fire("dragend",{noInertia:u,distance:this._newPos.distanceTo(this._startPos)})}});function Rl(u,f,E){var b,N=[1,4,2,8],P,j,te,ue,Ee,Le,Je,gt;for(P=0,Le=u.length;P<Le;P++)u[P]._code=de(u[P],f);for(te=0;te<4;te++){for(Je=N[te],b=[],P=0,Le=u.length,j=Le-1;P<Le;j=P++)ue=u[P],Ee=u[j],ue._code&Je?Ee._code&Je||(gt=ne(Ee,ue,Je,f,E),gt._code=de(gt,f),b.push(gt)):(Ee._code&Je&&(gt=ne(Ee,ue,Je,f,E),gt._code=de(gt,f),b.push(gt)),b.push(ue));u=b}return u}function Ml(u,f){var E,b,N,P,j,te,ue,Ee,Le;if(!u||u.length===0)throw new Error("latlngs not passed");Vt(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Je=we([0,0]),gt=le(u),ei=gt.getNorthWest().distanceTo(gt.getSouthWest())*gt.getNorthEast().distanceTo(gt.getNorthWest());ei<1700&&(Je=ma(u));var kn=u.length,Ki=[];for(E=0;E<kn;E++){var Bt=we(u[E]);Ki.push(f.project(we([Bt.lat-Je.lat,Bt.lng-Je.lng])))}for(te=ue=Ee=0,E=0,b=kn-1;E<kn;b=E++)N=Ki[E],P=Ki[b],j=N.y*P.x-P.y*N.x,ue+=(N.x+P.x)*j,Ee+=(N.y+P.y)*j,te+=j*3;te===0?Le=Ki[0]:Le=[ue/te,Ee/te];var zt=f.unproject(Pe(Le));return we([zt.lat+Je.lat,zt.lng+Je.lng])}function ma(u){for(var f=0,E=0,b=0,N=0;N<u.length;N++){var P=we(u[N]);f+=P.lat,E+=P.lng,b++}return we([f/b,E/b])}var Hr={__proto__:null,clipPolygon:Rl,polygonCenter:Ml,centroid:ma};function ci(u,f){if(!f||!u.length)return u.slice();var E=f*f;return u=I(u,E),u=yr(u,E),u}function Pl(u,f,E){return Math.sqrt(st(u,f,E,!0))}function Zu(u,f,E){return st(u,f,E)}function yr(u,f){var E=u.length,b=typeof Uint8Array<"u"?Uint8Array:Array,N=new b(E);N[0]=N[E-1]=1,v(u,N,f,0,E-1);var P,j=[];for(P=0;P<E;P++)N[P]&&j.push(u[P]);return j}function v(u,f,E,b,N){var P=0,j,te,ue;for(te=b+1;te<=N-1;te++)ue=st(u[te],u[b],u[N],!0),ue>P&&(j=te,P=ue);P>E&&(f[j]=1,v(u,f,E,b,j),v(u,f,E,j,N))}function I(u,f){for(var E=[u[0]],b=1,N=0,P=u.length;b<P;b++)Re(u[b],u[N])>f&&(E.push(u[b]),N=b);return N<P-1&&E.push(u[P-1]),E}var M;function U(u,f,E,b,N){var P=b?M:de(u,E),j=de(f,E),te,ue,Ee;for(M=j;;){if(!(P|j))return[u,f];if(P&j)return!1;te=P||j,ue=ne(u,f,te,E,N),Ee=de(ue,E),te===P?(u=ue,P=Ee):(f=ue,j=Ee)}}function ne(u,f,E,b,N){var P=f.x-u.x,j=f.y-u.y,te=b.min,ue=b.max,Ee,Le;return E&8?(Ee=u.x+P*(ue.y-u.y)/j,Le=ue.y):E&4?(Ee=u.x+P*(te.y-u.y)/j,Le=te.y):E&2?(Ee=ue.x,Le=u.y+j*(ue.x-u.x)/P):E&1&&(Ee=te.x,Le=u.y+j*(te.x-u.x)/P),new be(Ee,Le,N)}function de(u,f){var E=0;return u.x<f.min.x?E|=1:u.x>f.max.x&&(E|=2),u.y<f.min.y?E|=4:u.y>f.max.y&&(E|=8),E}function Re(u,f){var E=f.x-u.x,b=f.y-u.y;return E*E+b*b}function st(u,f,E,b){var N=f.x,P=f.y,j=E.x-N,te=E.y-P,ue=j*j+te*te,Ee;return ue>0&&(Ee=((u.x-N)*j+(u.y-P)*te)/ue,Ee>1?(N=E.x,P=E.y):Ee>0&&(N+=j*Ee,P+=te*Ee)),j=u.x-N,te=u.y-P,b?j*j+te*te:new be(N,P)}function Vt(u){return!Q(u[0])||typeof u[0][0]!="object"&&typeof u[0][0]<"u"}function Ot(u){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Vt(u)}function dn(u,f){var E,b,N,P,j,te,ue,Ee;if(!u||u.length===0)throw new Error("latlngs not passed");Vt(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var Le=we([0,0]),Je=le(u),gt=Je.getNorthWest().distanceTo(Je.getSouthWest())*Je.getNorthEast().distanceTo(Je.getNorthWest());gt<1700&&(Le=ma(u));var ei=u.length,kn=[];for(E=0;E<ei;E++){var Ki=we(u[E]);kn.push(f.project(we([Ki.lat-Le.lat,Ki.lng-Le.lng])))}for(E=0,b=0;E<ei-1;E++)b+=kn[E].distanceTo(kn[E+1])/2;if(b===0)Ee=kn[0];else for(E=0,P=0;E<ei-1;E++)if(j=kn[E],te=kn[E+1],N=j.distanceTo(te),P+=N,P>b){ue=(P-b)/N,Ee=[te.x-ue*(te.x-j.x),te.y-ue*(te.y-j.y)];break}var Bt=f.unproject(Pe(Ee));return we([Bt.lat+Le.lat,Bt.lng+Le.lng])}var ss={__proto__:null,simplify:ci,pointToSegmentDistance:Pl,closestPointOnSegment:Zu,clipSegment:U,_getEdgeIntersection:ne,_getBitCode:de,_sqClosestPointOnSegment:st,isFlat:Vt,_flat:Ot,polylineCenter:dn},rs={project:function(u){return new be(u.lng,u.lat)},unproject:function(u){return new ge(u.y,u.x)},bounds:new K([-180,-90],[180,90])},ji={R:6378137,R_MINOR:6356752314245179e-9,bounds:new K([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(u){var f=Math.PI/180,E=this.R,b=u.lat*f,N=this.R_MINOR/E,P=Math.sqrt(1-N*N),j=P*Math.sin(b),te=Math.tan(Math.PI/4-b/2)/Math.pow((1-j)/(1+j),P/2);return b=-E*Math.log(Math.max(te,1e-10)),new be(u.lng*f*E,b)},unproject:function(u){for(var f=180/Math.PI,E=this.R,b=this.R_MINOR/E,N=Math.sqrt(1-b*b),P=Math.exp(-u.y/E),j=Math.PI/2-2*Math.atan(P),te=0,ue=.1,Ee;te<15&&Math.abs(ue)>1e-7;te++)Ee=N*Math.sin(j),Ee=Math.pow((1-Ee)/(1+Ee),N/2),ue=Math.PI/2-2*Math.atan(P*Ee)-j,j+=ue;return new ge(j*f,u.x*f/E)}},Ms={__proto__:null,LonLat:rs,Mercator:ji,SphericalMercator:Nt},To=s({},Fe,{code:"EPSG:3395",projection:ji,transformation:(function(){var u=.5/(Math.PI*ji.R);return ct(u,.5,-u,.5)})()}),Eo=s({},Fe,{code:"EPSG:4326",projection:rs,transformation:ct(1/180,1,-1/180,.5)}),pa=s({},Ke,{projection:rs,transformation:ct(1,0,-1,0),scale:function(u){return Math.pow(2,u)},zoom:function(u){return Math.log(u)/Math.LN2},distance:function(u,f){var E=f.lng-u.lng,b=f.lat-u.lat;return Math.sqrt(E*E+b*b)},infinite:!0});Ke.Earth=Fe,Ke.EPSG3395=To,Ke.EPSG3857=mn,Ke.EPSG900913=Rn,Ke.EPSG4326=Eo,Ke.Simple=pa;var Ps=Ce.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(u){return u.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(u){return u&&u.removeLayer(this),this},getPane:function(u){return this._map.getPane(u?this.options[u]||u:this.options.pane)},addInteractiveTarget:function(u){return this._map._targets[h(u)]=this,this},removeInteractiveTarget:function(u){return delete this._map._targets[h(u)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(u){var f=u.target;if(f.hasLayer(this)){if(this._map=f,this._zoomAnimated=f._zoomAnimated,this.getEvents){var E=this.getEvents();f.on(E,this),this.once("remove",function(){f.off(E,this)},this)}this.onAdd(f),this.fire("add"),f.fire("layeradd",{layer:this})}}});yt.include({addLayer:function(u){if(!u._layerAdd)throw new Error("The provided object is not a Layer.");var f=h(u);return this._layers[f]?this:(this._layers[f]=u,u._mapToAdd=this,u.beforeAdd&&u.beforeAdd(this),this.whenReady(u._layerAdd,u),this)},removeLayer:function(u){var f=h(u);return this._layers[f]?(this._loaded&&u.onRemove(this),delete this._layers[f],this._loaded&&(this.fire("layerremove",{layer:u}),u.fire("remove")),u._map=u._mapToAdd=null,this):this},hasLayer:function(u){return h(u)in this._layers},eachLayer:function(u,f){for(var E in this._layers)u.call(f,this._layers[E]);return this},_addLayers:function(u){u=u?Q(u)?u:[u]:[];for(var f=0,E=u.length;f<E;f++)this.addLayer(u[f])},_addZoomLimit:function(u){(!isNaN(u.options.maxZoom)||!isNaN(u.options.minZoom))&&(this._zoomBoundLayers[h(u)]=u,this._updateZoomLevels())},_removeZoomLimit:function(u){var f=h(u);this._zoomBoundLayers[f]&&(delete this._zoomBoundLayers[f],this._updateZoomLevels())},_updateZoomLevels:function(){var u=1/0,f=-1/0,E=this._getZoomSpan();for(var b in this._zoomBoundLayers){var N=this._zoomBoundLayers[b].options;u=N.minZoom===void 0?u:Math.min(u,N.minZoom),f=N.maxZoom===void 0?f:Math.max(f,N.maxZoom)}this._layersMaxZoom=f===-1/0?void 0:f,this._layersMinZoom=u===1/0?void 0:u,E!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ga=Ps.extend({initialize:function(u,f){F(this,f),this._layers={};var E,b;if(u)for(E=0,b=u.length;E<b;E++)this.addLayer(u[E])},addLayer:function(u){var f=this.getLayerId(u);return this._layers[f]=u,this._map&&this._map.addLayer(u),this},removeLayer:function(u){var f=u in this._layers?u:this.getLayerId(u);return this._map&&this._layers[f]&&this._map.removeLayer(this._layers[f]),delete this._layers[f],this},hasLayer:function(u){var f=typeof u=="number"?u:this.getLayerId(u);return f in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(u){var f=Array.prototype.slice.call(arguments,1),E,b;for(E in this._layers)b=this._layers[E],b[u]&&b[u].apply(b,f);return this},onAdd:function(u){this.eachLayer(u.addLayer,u)},onRemove:function(u){this.eachLayer(u.removeLayer,u)},eachLayer:function(u,f){for(var E in this._layers)u.call(f,this._layers[E]);return this},getLayer:function(u){return this._layers[u]},getLayers:function(){var u=[];return this.eachLayer(u.push,u),u},setZIndex:function(u){return this.invoke("setZIndex",u)},getLayerId:function(u){return h(u)}}),w_=function(u,f){return new ga(u,f)},Xs=ga.extend({addLayer:function(u){return this.hasLayer(u)?this:(u.addEventParent(this),ga.prototype.addLayer.call(this,u),this.fire("layeradd",{layer:u}))},removeLayer:function(u){return this.hasLayer(u)?(u in this._layers&&(u=this._layers[u]),u.removeEventParent(this),ga.prototype.removeLayer.call(this,u),this.fire("layerremove",{layer:u})):this},setStyle:function(u){return this.invoke("setStyle",u)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var u=new Ie;for(var f in this._layers){var E=this._layers[f];u.extend(E.getBounds?E.getBounds():E.getLatLng())}return u}}),Yf=function(u,f){return new Xs(u,f)},er=Ge.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(u){F(this,u)},createIcon:function(u){return this._createIcon("icon",u)},createShadow:function(u){return this._createIcon("shadow",u)},_createIcon:function(u,f){var E=this._getIconUrl(u);if(!E){if(u==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var b=this._createImg(E,f&&f.tagName==="IMG"?f:null);return this._setIconStyles(b,u),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),b},_setIconStyles:function(u,f){var E=this.options,b=E[f+"Size"];typeof b=="number"&&(b=[b,b]);var N=Pe(b),P=Pe(f==="shadow"&&E.shadowAnchor||E.iconAnchor||N&&N.divideBy(2,!0));u.className="leaflet-marker-"+f+" "+(E.className||""),P&&(u.style.marginLeft=-P.x+"px",u.style.marginTop=-P.y+"px"),N&&(u.style.width=N.x+"px",u.style.height=N.y+"px")},_createImg:function(u,f){return f=f||document.createElement("img"),f.src=u,f},_getIconUrl:function(u){return Be.retina&&this.options[u+"RetinaUrl"]||this.options[u+"Url"]}});function kl(u){return new er(u)}var Dl=er.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(u){return typeof Dl.imagePath!="string"&&(Dl.imagePath=this._detectIconPath()),(this.options.imagePath||Dl.imagePath)+er.prototype._getIconUrl.call(this,u)},_stripUrl:function(u){var f=function(E,b,N){var P=b.exec(E);return P&&P[N]};return u=f(u,/^url\((['"])?(.+)\1\)$/,2),u&&f(u,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var u=vt("div","leaflet-default-icon-path",document.body),f=Ur(u,"background-image")||Ur(u,"backgroundImage");if(document.body.removeChild(u),f=this._stripUrl(f),f)return f;var E=document.querySelector('link[href$="leaflet.css"]');return E?E.href.substring(0,E.href.length-11-1):""}}),Ll=Hi.extend({initialize:function(u){this._marker=u},addHooks:function(){var u=this._marker._icon;this._draggable||(this._draggable=new Rs(u,u,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ue(u,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Zt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(u){var f=this._marker,E=f._map,b=this._marker.options.autoPanSpeed,N=this._marker.options.autoPanPadding,P=Js(f._icon),j=E.getPixelBounds(),te=E.getPixelOrigin(),ue=me(j.min._subtract(te).add(N),j.max._subtract(te).subtract(N));if(!ue.contains(P)){var Ee=Pe((Math.max(ue.max.x,P.x)-ue.max.x)/(j.max.x-ue.max.x)-(Math.min(ue.min.x,P.x)-ue.min.x)/(j.min.x-ue.min.x),(Math.max(ue.max.y,P.y)-ue.max.y)/(j.max.y-ue.max.y)-(Math.min(ue.min.y,P.y)-ue.min.y)/(j.min.y-ue.min.y)).multiplyBy(b);E.panBy(Ee,{animate:!1}),this._draggable._newPos._add(Ee),this._draggable._startPos._add(Ee),Qt(f._icon,this._draggable._newPos),this._onDrag(u),this._panRequest=G(this._adjustPan.bind(this,u))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(u){this._marker.options.autoPan&&(W(this._panRequest),this._panRequest=G(this._adjustPan.bind(this,u)))},_onDrag:function(u){var f=this._marker,E=f._shadow,b=Js(f._icon),N=f._map.layerPointToLatLng(b);E&&Qt(E,b),f._latlng=N,u.latlng=N,u.oldLatLng=this._oldLatLng,f.fire("move",u).fire("drag",u)},_onDragEnd:function(u){W(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",u)}}),Vl=Ps.extend({options:{icon:new Dl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(u,f){F(this,f),this._latlng=we(u)},onAdd:function(u){this._zoomAnimated=this._zoomAnimated&&u.options.markerZoomAnimation,this._zoomAnimated&&u.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(u){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&u.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(u){var f=this._latlng;return this._latlng=we(u),this.update(),this.fire("move",{oldLatLng:f,latlng:this._latlng})},setZIndexOffset:function(u){return this.options.zIndexOffset=u,this.update()},getIcon:function(){return this.options.icon},setIcon:function(u){return this.options.icon=u,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var u=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(u)}return this},_initIcon:function(){var u=this.options,f="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),E=u.icon.createIcon(this._icon),b=!1;E!==this._icon&&(this._icon&&this._removeIcon(),b=!0,u.title&&(E.title=u.title),E.tagName==="IMG"&&(E.alt=u.alt||"")),Ue(E,f),u.keyboard&&(E.tabIndex="0",E.setAttribute("role","button")),this._icon=E,u.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&tt(E,"focus",this._panOnFocus,this);var N=u.icon.createShadow(this._shadow),P=!1;N!==this._shadow&&(this._removeShadow(),P=!0),N&&(Ue(N,f),N.alt=""),this._shadow=N,u.opacity<1&&this._updateOpacity(),b&&this.getPane().appendChild(this._icon),this._initInteraction(),N&&P&&this.getPane(u.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ft(this._icon,"focus",this._panOnFocus,this),xt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&xt(this._shadow),this._shadow=null},_setPos:function(u){this._icon&&Qt(this._icon,u),this._shadow&&Qt(this._shadow,u),this._zIndex=u.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(u){this._icon&&(this._icon.style.zIndex=this._zIndex+u)},_animateZoom:function(u){var f=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center).round();this._setPos(f)},_initInteraction:function(){if(this.options.interactive&&(Ue(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ll)){var u=this.options.draggable;this.dragging&&(u=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ll(this),u&&this.dragging.enable()}},setOpacity:function(u){return this.options.opacity=u,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var u=this.options.opacity;this._icon&&cn(this._icon,u),this._shadow&&cn(this._shadow,u)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var u=this._map;if(u){var f=this.options.icon.options,E=f.iconSize?Pe(f.iconSize):Pe(0,0),b=f.iconAnchor?Pe(f.iconAnchor):Pe(0,0);u.panInside(this._latlng,{paddingTopLeft:b,paddingBottomRight:E.subtract(b)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Jf(u,f){return new Vl(u,f)}var tr=Ps.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(u){this._renderer=u.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(u){return F(this,u),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&u&&Object.prototype.hasOwnProperty.call(u,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),_a=tr.extend({options:{fill:!0,radius:10},initialize:function(u,f){F(this,f),this._latlng=we(u),this._radius=this.options.radius},setLatLng:function(u){var f=this._latlng;return this._latlng=we(u),this.redraw(),this.fire("move",{oldLatLng:f,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(u){return this.options.radius=this._radius=u,this.redraw()},getRadius:function(){return this._radius},setStyle:function(u){var f=u&&u.radius||this._radius;return tr.prototype.setStyle.call(this,u),this.setRadius(f),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var u=this._radius,f=this._radiusY||u,E=this._clickTolerance(),b=[u+E,f+E];this._pxBounds=new K(this._point.subtract(b),this._point.add(b))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(u){return u.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Zf(u,f){return new _a(u,f)}var Qu=_a.extend({initialize:function(u,f,E){if(typeof f=="number"&&(f=s({},E,{radius:f})),F(this,f),this._latlng=we(u),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(u){return this._mRadius=u,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var u=[this._radius,this._radiusY||this._radius];return new Ie(this._map.layerPointToLatLng(this._point.subtract(u)),this._map.layerPointToLatLng(this._point.add(u)))},setStyle:tr.prototype.setStyle,_project:function(){var u=this._latlng.lng,f=this._latlng.lat,E=this._map,b=E.options.crs;if(b.distance===Fe.distance){var N=Math.PI/180,P=this._mRadius/Fe.R/N,j=E.project([f+P,u]),te=E.project([f-P,u]),ue=j.add(te).divideBy(2),Ee=E.unproject(ue).lat,Le=Math.acos((Math.cos(P*N)-Math.sin(f*N)*Math.sin(Ee*N))/(Math.cos(f*N)*Math.cos(Ee*N)))/N;(isNaN(Le)||Le===0)&&(Le=P/Math.cos(Math.PI/180*f)),this._point=ue.subtract(E.getPixelOrigin()),this._radius=isNaN(Le)?0:ue.x-E.project([Ee,u-Le]).x,this._radiusY=ue.y-j.y}else{var Je=b.unproject(b.project(this._latlng).subtract([this._mRadius,0]));this._point=E.latLngToLayerPoint(this._latlng),this._radius=this._point.x-E.latLngToLayerPoint(Je).x}this._updateBounds()}});function Qf(u,f,E){return new Qu(u,f,E)}var vr=tr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(u,f){F(this,f),this._setLatLngs(u)},getLatLngs:function(){return this._latlngs},setLatLngs:function(u){return this._setLatLngs(u),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(u){for(var f=1/0,E=null,b=st,N,P,j=0,te=this._parts.length;j<te;j++)for(var ue=this._parts[j],Ee=1,Le=ue.length;Ee<Le;Ee++){N=ue[Ee-1],P=ue[Ee];var Je=b(u,N,P,!0);Je<f&&(f=Je,E=b(u,N,P))}return E&&(E.distance=Math.sqrt(f)),E},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return dn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(u,f){return f=f||this._defaultShape(),u=we(u),f.push(u),this._bounds.extend(u),this.redraw()},_setLatLngs:function(u){this._bounds=new Ie,this._latlngs=this._convertLatLngs(u)},_defaultShape:function(){return Vt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(u){for(var f=[],E=Vt(u),b=0,N=u.length;b<N;b++)E?(f[b]=we(u[b]),this._bounds.extend(f[b])):f[b]=this._convertLatLngs(u[b]);return f},_project:function(){var u=new K;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,u),this._bounds.isValid()&&u.isValid()&&(this._rawPxBounds=u,this._updateBounds())},_updateBounds:function(){var u=this._clickTolerance(),f=new be(u,u);this._rawPxBounds&&(this._pxBounds=new K([this._rawPxBounds.min.subtract(f),this._rawPxBounds.max.add(f)]))},_projectLatlngs:function(u,f,E){var b=u[0]instanceof ge,N=u.length,P,j;if(b){for(j=[],P=0;P<N;P++)j[P]=this._map.latLngToLayerPoint(u[P]),E.extend(j[P]);f.push(j)}else for(P=0;P<N;P++)this._projectLatlngs(u[P],f,E)},_clipPoints:function(){var u=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}var f=this._parts,E,b,N,P,j,te,ue;for(E=0,N=0,P=this._rings.length;E<P;E++)for(ue=this._rings[E],b=0,j=ue.length;b<j-1;b++)te=U(ue[b],ue[b+1],u,b,!0),te&&(f[N]=f[N]||[],f[N].push(te[0]),(te[1]!==ue[b+1]||b===j-2)&&(f[N].push(te[1]),N++))}},_simplifyPoints:function(){for(var u=this._parts,f=this.options.smoothFactor,E=0,b=u.length;E<b;E++)u[E]=ci(u[E],f)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(u,f){var E,b,N,P,j,te,ue=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(E=0,P=this._parts.length;E<P;E++)for(te=this._parts[E],b=0,j=te.length,N=j-1;b<j;N=b++)if(!(!f&&b===0)&&Pl(u,te[N],te[b])<=ue)return!0;return!1}});function S_(u,f){return new vr(u,f)}vr._flat=Ot;var ya=vr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ml(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(u){var f=vr.prototype._convertLatLngs.call(this,u),E=f.length;return E>=2&&f[0]instanceof ge&&f[0].equals(f[E-1])&&f.pop(),f},_setLatLngs:function(u){vr.prototype._setLatLngs.call(this,u),Vt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Vt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var u=this._renderer._bounds,f=this.options.weight,E=new be(f,f);if(u=new K(u.min.subtract(E),u.max.add(E)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}for(var b=0,N=this._rings.length,P;b<N;b++)P=Rl(this._rings[b],u,!0),P.length&&this._parts.push(P)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(u){var f=!1,E,b,N,P,j,te,ue,Ee;if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(P=0,ue=this._parts.length;P<ue;P++)for(E=this._parts[P],j=0,Ee=E.length,te=Ee-1;j<Ee;te=j++)b=E[j],N=E[te],b.y>u.y!=N.y>u.y&&u.x<(N.x-b.x)*(u.y-b.y)/(N.y-b.y)+b.x&&(f=!f);return f||vr.prototype._containsPoint.call(this,u,!0)}});function C_(u,f){return new ya(u,f)}var Tr=Xs.extend({initialize:function(u,f){F(this,f),this._layers={},u&&this.addData(u)},addData:function(u){var f=Q(u)?u:u.features,E,b,N;if(f){for(E=0,b=f.length;E<b;E++)N=f[E],(N.geometries||N.geometry||N.features||N.coordinates)&&this.addData(N);return this}var P=this.options;if(P.filter&&!P.filter(u))return this;var j=di(u,P);return j?(j.feature=ec(u),j.defaultOptions=j.options,this.resetStyle(j),P.onEachFeature&&P.onEachFeature(u,j),this.addLayer(j)):this},resetStyle:function(u){return u===void 0?this.eachLayer(this.resetStyle,this):(u.options=s({},u.defaultOptions),this._setLayerStyle(u,this.options.style),this)},setStyle:function(u){return this.eachLayer(function(f){this._setLayerStyle(f,u)},this)},_setLayerStyle:function(u,f){u.setStyle&&(typeof f=="function"&&(f=f(u.feature)),u.setStyle(f))}});function di(u,f){var E=u.type==="Feature"?u.geometry:u,b=E?E.coordinates:null,N=[],P=f&&f.pointToLayer,j=f&&f.coordsToLatLng||$u,te,ue,Ee,Le;if(!b&&!E)return null;switch(E.type){case"Point":return te=j(b),va(P,u,te,f);case"MultiPoint":for(Ee=0,Le=b.length;Ee<Le;Ee++)te=j(b[Ee]),N.push(va(P,u,te,f));return new Xs(N);case"LineString":case"MultiLineString":return ue=Ol(b,E.type==="LineString"?0:1,j),new vr(ue,f);case"Polygon":case"MultiPolygon":return ue=Ol(b,E.type==="Polygon"?1:2,j),new ya(ue,f);case"GeometryCollection":for(Ee=0,Le=E.geometries.length;Ee<Le;Ee++){var Je=di({geometry:E.geometries[Ee],type:"Feature",properties:u.properties},f);Je&&N.push(Je)}return new Xs(N);case"FeatureCollection":for(Ee=0,Le=E.features.length;Ee<Le;Ee++){var gt=di(E.features[Ee],f);gt&&N.push(gt)}return new Xs(N);default:throw new Error("Invalid GeoJSON object.")}}function va(u,f,E,b){return u?u(f,E):new Vl(E,b&&b.markersInheritOptions&&b)}function $u(u){return new ge(u[1],u[0],u[2])}function Ol(u,f,E){for(var b=[],N=0,P=u.length,j;N<P;N++)j=f?Ol(u[N],f-1,E):(E||$u)(u[N]),b.push(j);return b}function Xu(u,f){return u=we(u),u.alt!==void 0?[C(u.lng,f),C(u.lat,f),C(u.alt,f)]:[C(u.lng,f),C(u.lat,f)]}function Ul(u,f,E,b){for(var N=[],P=0,j=u.length;P<j;P++)N.push(f?Ul(u[P],Vt(u[P])?0:f-1,E,b):Xu(u[P],b));return!f&&E&&N.length>0&&N.push(N[0].slice()),N}function jr(u,f){return u.feature?s({},u.feature,{geometry:f}):ec(f)}function ec(u){return u.type==="Feature"||u.type==="FeatureCollection"?u:{type:"Feature",properties:{},geometry:u}}var Kr={toGeoJSON:function(u){return jr(this,{type:"Point",coordinates:Xu(this.getLatLng(),u)})}};Vl.include(Kr),Qu.include(Kr),_a.include(Kr),vr.include({toGeoJSON:function(u){var f=!Vt(this._latlngs),E=Ul(this._latlngs,f?1:0,!1,u);return jr(this,{type:(f?"Multi":"")+"LineString",coordinates:E})}}),ya.include({toGeoJSON:function(u){var f=!Vt(this._latlngs),E=f&&!Vt(this._latlngs[0]),b=Ul(this._latlngs,E?2:f?1:0,!0,u);return f||(b=[b]),jr(this,{type:(E?"Multi":"")+"Polygon",coordinates:b})}}),ga.include({toMultiPoint:function(u){var f=[];return this.eachLayer(function(E){f.push(E.toGeoJSON(u).geometry.coordinates)}),jr(this,{type:"MultiPoint",coordinates:f})},toGeoJSON:function(u){var f=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(f==="MultiPoint")return this.toMultiPoint(u);var E=f==="GeometryCollection",b=[];return this.eachLayer(function(N){if(N.toGeoJSON){var P=N.toGeoJSON(u);if(E)b.push(P.geometry);else{var j=ec(P);j.type==="FeatureCollection"?b.push.apply(b,j.features):b.push(j)}}}),E?jr(this,{geometries:b,type:"GeometryCollection"}):{type:"FeatureCollection",features:b}}});function tc(u,f){return new Tr(u,f)}var Fl=tc,Ta=Ps.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(u,f,E){this._url=u,this._bounds=le(f),F(this,E)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ue(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){xt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(u){return this.options.opacity=u,this._image&&this._updateOpacity(),this},setStyle:function(u){return u.opacity&&this.setOpacity(u.opacity),this},bringToFront:function(){return this._map&&vn(this._image),this},bringToBack:function(){return this._map&&qi(this._image),this},setUrl:function(u){return this._url=u,this._image&&(this._image.src=u),this},setBounds:function(u){return this._bounds=le(u),this._map&&this._reset(),this},getEvents:function(){var u={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var u=this._url.tagName==="IMG",f=this._image=u?this._url:vt("img");if(Ue(f,"leaflet-image-layer"),this._zoomAnimated&&Ue(f,"leaflet-zoom-animated"),this.options.className&&Ue(f,this.options.className),f.onselectstart=x,f.onmousemove=x,f.onload=l(this.fire,this,"load"),f.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(f.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),u){this._url=f.src;return}f.src=this._url,f.alt=this.options.alt},_animateZoom:function(u){var f=this._map.getZoomScale(u.zoom),E=this._map._latLngBoundsToNewLayerBounds(this._bounds,u.zoom,u.center).min;Cs(this._image,E,f)},_reset:function(){var u=this._image,f=new K(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),E=f.getSize();Qt(u,f.min),u.style.width=E.x+"px",u.style.height=E.y+"px"},_updateOpacity:function(){cn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var u=this.options.errorOverlayUrl;u&&this._url!==u&&(this._url=u,this._image.src=u)},getCenter:function(){return this._bounds.getCenter()}}),$f=function(u,f,E){return new Ta(u,f,E)},Wr=Ta.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var u=this._url.tagName==="VIDEO",f=this._image=u?this._url:vt("video");if(Ue(f,"leaflet-image-layer"),this._zoomAnimated&&Ue(f,"leaflet-zoom-animated"),this.options.className&&Ue(f,this.options.className),f.onselectstart=x,f.onmousemove=x,f.onloadeddata=l(this.fire,this,"load"),u){for(var E=f.getElementsByTagName("source"),b=[],N=0;N<E.length;N++)b.push(E[N].src);this._url=E.length>0?b:[f.src];return}Q(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(f.style,"objectFit")&&(f.style.objectFit="fill"),f.autoplay=!!this.options.autoplay,f.loop=!!this.options.loop,f.muted=!!this.options.muted,f.playsInline=!!this.options.playsInline;for(var P=0;P<this._url.length;P++){var j=vt("source");j.src=this._url[P],f.appendChild(j)}}});function Ea(u,f,E){return new Wr(u,f,E)}var nc=Ta.extend({_initImage:function(){var u=this._image=this._url;Ue(u,"leaflet-image-layer"),this._zoomAnimated&&Ue(u,"leaflet-zoom-animated"),this.options.className&&Ue(u,this.options.className),u.onselectstart=x,u.onmousemove=x}});function Xf(u,f,E){return new nc(u,f,E)}var hi=Ps.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(u,f){u&&(u instanceof ge||Q(u))?(this._latlng=we(u),F(this,f)):(F(this,u),this._source=f),this.options.content&&(this._content=this.options.content)},openOn:function(u){return u=arguments.length?u:this._source._map,u.hasLayer(this)||u.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(u){return this._map?this.close():(arguments.length?this._source=u:u=this._source,this._prepareOpen(),this.openOn(u._map)),this},onAdd:function(u){this._zoomAnimated=u._zoomAnimated,this._container||this._initLayout(),u._fadeAnimated&&cn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),u._fadeAnimated&&cn(this._container,1),this.bringToFront(),this.options.interactive&&(Ue(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(u){u._fadeAnimated?(cn(this._container,0),this._removeTimeout=setTimeout(l(xt,void 0,this._container),200)):xt(this._container),this.options.interactive&&(Zt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(u){return this._latlng=we(u),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(u){return this._content=u,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var u={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&vn(this._container),this},bringToBack:function(){return this._map&&qi(this._container),this},_prepareOpen:function(u){var f=this._source;if(!f._map)return!1;if(f instanceof Xs){f=null;var E=this._source._layers;for(var b in E)if(E[b]._map){f=E[b];break}if(!f)return!1;this._source=f}if(!u)if(f.getCenter)u=f.getCenter();else if(f.getLatLng)u=f.getLatLng();else if(f.getBounds)u=f.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(u),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var u=this._contentNode,f=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof f=="string")u.innerHTML=f;else{for(;u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(f)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var u=this._map.latLngToLayerPoint(this._latlng),f=Pe(this.options.offset),E=this._getAnchor();this._zoomAnimated?Qt(this._container,u.add(E)):f=f.add(u).add(E);var b=this._containerBottom=-f.y,N=this._containerLeft=-Math.round(this._containerWidth/2)+f.x;this._container.style.bottom=b+"px",this._container.style.left=N+"px"}},_getAnchor:function(){return[0,0]}});yt.include({_initOverlay:function(u,f,E,b){var N=f;return N instanceof u||(N=new u(b).setContent(f)),E&&N.setLatLng(E),N}}),Ps.include({_initOverlay:function(u,f,E,b){var N=E;return N instanceof u?(F(N,b),N._source=this):(N=f&&!b?f:new u(b,this),N.setContent(E)),N}});var Bl=hi.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(u){return u=arguments.length?u:this._source._map,!u.hasLayer(this)&&u._popup&&u._popup.options.autoClose&&u.removeLayer(u._popup),u._popup=this,hi.prototype.openOn.call(this,u)},onAdd:function(u){hi.prototype.onAdd.call(this,u),u.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof tr||this._source.on("preclick",Pt))},onRemove:function(u){hi.prototype.onRemove.call(this,u),u.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof tr||this._source.off("preclick",Pt))},getEvents:function(){var u=hi.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(u.preclick=this.close),this.options.keepInView&&(u.moveend=this._adjustPan),u},_initLayout:function(){var u="leaflet-popup",f=this._container=vt("div",u+" "+(this.options.className||"")+" leaflet-zoom-animated"),E=this._wrapper=vt("div",u+"-content-wrapper",f);if(this._contentNode=vt("div",u+"-content",E),pr(f),is(this._contentNode),tt(f,"contextmenu",Pt),this._tipContainer=vt("div",u+"-tip-container",f),this._tip=vt("div",u+"-tip",this._tipContainer),this.options.closeButton){var b=this._closeButton=vt("a",u+"-close-button",f);b.setAttribute("role","button"),b.setAttribute("aria-label","Close popup"),b.href="#close",b.innerHTML='<span aria-hidden="true">&#215;</span>',tt(b,"click",function(N){Tn(N),this.close()},this)}},_updateLayout:function(){var u=this._contentNode,f=u.style;f.width="",f.whiteSpace="nowrap";var E=u.offsetWidth;E=Math.min(E,this.options.maxWidth),E=Math.max(E,this.options.minWidth),f.width=E+1+"px",f.whiteSpace="",f.height="";var b=u.offsetHeight,N=this.options.maxHeight,P="leaflet-popup-scrolled";N&&b>N?(f.height=N+"px",Ue(u,P)):Zt(u,P),this._containerWidth=this._container.offsetWidth},_animateZoom:function(u){var f=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center),E=this._getAnchor();Qt(this._container,f.add(E))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var u=this._map,f=parseInt(Ur(this._container,"marginBottom"),10)||0,E=this._container.offsetHeight+f,b=this._containerWidth,N=new be(this._containerLeft,-E-this._containerBottom);N._add(Js(this._container));var P=u.layerPointToContainerPoint(N),j=Pe(this.options.autoPanPadding),te=Pe(this.options.autoPanPaddingTopLeft||j),ue=Pe(this.options.autoPanPaddingBottomRight||j),Ee=u.getSize(),Le=0,Je=0;P.x+b+ue.x>Ee.x&&(Le=P.x+b-Ee.x+ue.x),P.x-Le-te.x<0&&(Le=P.x-te.x),P.y+E+ue.y>Ee.y&&(Je=P.y+E-Ee.y+ue.y),P.y-Je-te.y<0&&(Je=P.y-te.y),(Le||Je)&&(this.options.keepInView&&(this._autopanning=!0),u.fire("autopanstart").panBy([Le,Je]))}},_getAnchor:function(){return Pe(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),em=function(u,f){return new Bl(u,f)};yt.mergeOptions({closePopupOnClick:!0}),yt.include({openPopup:function(u,f,E){return this._initOverlay(Bl,u,f,E).openOn(this),this},closePopup:function(u){return u=arguments.length?u:this._popup,u&&u.close(),this}}),Ps.include({bindPopup:function(u,f){return this._popup=this._initOverlay(Bl,this._popup,u,f),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(u){return this._popup&&(this instanceof Xs||(this._popup._source=this),this._popup._prepareOpen(u||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(u){return this._popup&&this._popup.setContent(u),this},getPopup:function(){return this._popup},_openPopup:function(u){if(!(!this._popup||!this._map)){bs(u);var f=u.layer||u.target;if(this._popup._source===f&&!(f instanceof tr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(u.latlng);return}this._popup._source=f,this.openPopup(u.latlng)}},_movePopup:function(u){this._popup.setLatLng(u.latlng)},_onKeyPress:function(u){u.originalEvent.keyCode===13&&this._openPopup(u)}});var zl=hi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(u){hi.prototype.onAdd.call(this,u),this.setOpacity(this.options.opacity),u.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(u){hi.prototype.onRemove.call(this,u),u.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var u=hi.prototype.getEvents.call(this);return this.options.permanent||(u.preclick=this.close),u},_initLayout:function(){var u="leaflet-tooltip",f=u+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=vt("div",f),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+h(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(u){var f,E,b=this._map,N=this._container,P=b.latLngToContainerPoint(b.getCenter()),j=b.layerPointToContainerPoint(u),te=this.options.direction,ue=N.offsetWidth,Ee=N.offsetHeight,Le=Pe(this.options.offset),Je=this._getAnchor();te==="top"?(f=ue/2,E=Ee):te==="bottom"?(f=ue/2,E=0):te==="center"?(f=ue/2,E=Ee/2):te==="right"?(f=0,E=Ee/2):te==="left"?(f=ue,E=Ee/2):j.x<P.x?(te="right",f=0,E=Ee/2):(te="left",f=ue+(Le.x+Je.x)*2,E=Ee/2),u=u.subtract(Pe(f,E,!0)).add(Le).add(Je),Zt(N,"leaflet-tooltip-right"),Zt(N,"leaflet-tooltip-left"),Zt(N,"leaflet-tooltip-top"),Zt(N,"leaflet-tooltip-bottom"),Ue(N,"leaflet-tooltip-"+te),Qt(N,u)},_updatePosition:function(){var u=this._map.latLngToLayerPoint(this._latlng);this._setPosition(u)},setOpacity:function(u){this.options.opacity=u,this._container&&cn(this._container,u)},_animateZoom:function(u){var f=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center);this._setPosition(f)},_getAnchor:function(){return Pe(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),b_=function(u,f){return new zl(u,f)};yt.include({openTooltip:function(u,f,E){return this._initOverlay(zl,u,f,E).openOn(this),this},closeTooltip:function(u){return u.close(),this}}),Ps.include({bindTooltip:function(u,f){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(zl,this._tooltip,u,f),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(u){if(!(!u&&this._tooltipHandlersAdded)){var f=u?"off":"on",E={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?E.add=this._openTooltip:(E.mouseover=this._openTooltip,E.mouseout=this.closeTooltip,E.click=this._openTooltip,this._map?this._addFocusListeners():E.add=this._addFocusListeners),this._tooltip.options.sticky&&(E.mousemove=this._moveTooltip),this[f](E),this._tooltipHandlersAdded=!u}},openTooltip:function(u){return this._tooltip&&(this instanceof Xs||(this._tooltip._source=this),this._tooltip._prepareOpen(u)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(u){return this._tooltip&&this._tooltip.setContent(u),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(u){var f=typeof u.getElement=="function"&&u.getElement();f&&(tt(f,"focus",function(){this._tooltip._source=u,this.openTooltip()},this),tt(f,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(u){var f=typeof u.getElement=="function"&&u.getElement();f&&f.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(u){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var f=this;this._map.once("moveend",function(){f._openOnceFlag=!1,f._openTooltip(u)});return}this._tooltip._source=u.layer||u.target,this.openTooltip(this._tooltip.options.sticky?u.latlng:void 0)}},_moveTooltip:function(u){var f=u.latlng,E,b;this._tooltip.options.sticky&&u.originalEvent&&(E=this._map.mouseEventToContainerPoint(u.originalEvent),b=this._map.containerPointToLayerPoint(E),f=this._map.layerPointToLatLng(b)),this._tooltip.setLatLng(f)}});var tm=er.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(u){var f=u&&u.tagName==="DIV"?u:document.createElement("div"),E=this.options;if(E.html instanceof Element?(yn(f),f.appendChild(E.html)):f.innerHTML=E.html!==!1?E.html:"",E.bgPos){var b=Pe(E.bgPos);f.style.backgroundPosition=-b.x+"px "+-b.y+"px"}return this._setIconStyles(f,"icon"),f},createShadow:function(){return null}});function I_(u){return new tm(u)}er.Default=Dl;var xa=Ps.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Be.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(u){F(this,u)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(u){u._addZoomLimit(this)},onRemove:function(u){this._removeAllTiles(),xt(this._container),u._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(vn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(qi(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(u){return this.options.opacity=u,this._updateOpacity(),this},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var u=this._clampZoom(this._map.getZoom());u!==this._tileZoom&&(this._tileZoom=u,this._updateLevels()),this._update()}return this},getEvents:function(){var u={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p(this._onMoveEnd,this.options.updateInterval,this)),u.move=this._onMove),this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},createTile:function(){return document.createElement("div")},getTileSize:function(){var u=this.options.tileSize;return u instanceof be?u:new be(u,u)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(u){for(var f=this.getPane().children,E=-u(-1/0,1/0),b=0,N=f.length,P;b<N;b++)P=f[b].style.zIndex,f[b]!==this._container&&P&&(E=u(E,+P));isFinite(E)&&(this.options.zIndex=E+u(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Be.ielt9){cn(this._container,this.options.opacity);var u=+new Date,f=!1,E=!1;for(var b in this._tiles){var N=this._tiles[b];if(!(!N.current||!N.loaded)){var P=Math.min(1,(u-N.loaded)/200);cn(N.el,P),P<1?f=!0:(N.active?E=!0:this._onOpaqueTile(N),N.active=!0)}}E&&!this._noPrune&&this._pruneTiles(),f&&(W(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this))}},_onOpaqueTile:x,_initContainer:function(){this._container||(this._container=vt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var u=this._tileZoom,f=this.options.maxZoom;if(u!==void 0){for(var E in this._levels)E=Number(E),this._levels[E].el.children.length||E===u?(this._levels[E].el.style.zIndex=f-Math.abs(u-E),this._onUpdateLevel(E)):(xt(this._levels[E].el),this._removeTilesAtZoom(E),this._onRemoveLevel(E),delete this._levels[E]);var b=this._levels[u],N=this._map;return b||(b=this._levels[u]={},b.el=vt("div","leaflet-tile-container leaflet-zoom-animated",this._container),b.el.style.zIndex=f,b.origin=N.project(N.unproject(N.getPixelOrigin()),u).round(),b.zoom=u,this._setZoomTransform(b,N.getCenter(),N.getZoom()),x(b.el.offsetWidth),this._onCreateLevel(b)),this._level=b,b}},_onUpdateLevel:x,_onRemoveLevel:x,_onCreateLevel:x,_pruneTiles:function(){if(this._map){var u,f,E=this._map.getZoom();if(E>this.options.maxZoom||E<this.options.minZoom){this._removeAllTiles();return}for(u in this._tiles)f=this._tiles[u],f.retain=f.current;for(u in this._tiles)if(f=this._tiles[u],f.current&&!f.active){var b=f.coords;this._retainParent(b.x,b.y,b.z,b.z-5)||this._retainChildren(b.x,b.y,b.z,b.z+2)}for(u in this._tiles)this._tiles[u].retain||this._removeTile(u)}},_removeTilesAtZoom:function(u){for(var f in this._tiles)this._tiles[f].coords.z===u&&this._removeTile(f)},_removeAllTiles:function(){for(var u in this._tiles)this._removeTile(u)},_invalidateAll:function(){for(var u in this._levels)xt(this._levels[u].el),this._onRemoveLevel(Number(u)),delete this._levels[u];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(u,f,E,b){var N=Math.floor(u/2),P=Math.floor(f/2),j=E-1,te=new be(+N,+P);te.z=+j;var ue=this._tileCoordsToKey(te),Ee=this._tiles[ue];return Ee&&Ee.active?(Ee.retain=!0,!0):(Ee&&Ee.loaded&&(Ee.retain=!0),j>b?this._retainParent(N,P,j,b):!1)},_retainChildren:function(u,f,E,b){for(var N=2*u;N<2*u+2;N++)for(var P=2*f;P<2*f+2;P++){var j=new be(N,P);j.z=E+1;var te=this._tileCoordsToKey(j),ue=this._tiles[te];if(ue&&ue.active){ue.retain=!0;continue}else ue&&ue.loaded&&(ue.retain=!0);E+1<b&&this._retainChildren(N,P,E+1,b)}},_resetView:function(u){var f=u&&(u.pinch||u.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),f,f)},_animateZoom:function(u){this._setView(u.center,u.zoom,!0,u.noUpdate)},_clampZoom:function(u){var f=this.options;return f.minNativeZoom!==void 0&&u<f.minNativeZoom?f.minNativeZoom:f.maxNativeZoom!==void 0&&f.maxNativeZoom<u?f.maxNativeZoom:u},_setView:function(u,f,E,b){var N=Math.round(f);this.options.maxZoom!==void 0&&N>this.options.maxZoom||this.options.minZoom!==void 0&&N<this.options.minZoom?N=void 0:N=this._clampZoom(N);var P=this.options.updateWhenZooming&&N!==this._tileZoom;(!b||P)&&(this._tileZoom=N,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),N!==void 0&&this._update(u),E||this._pruneTiles(),this._noPrune=!!E),this._setZoomTransforms(u,f)},_setZoomTransforms:function(u,f){for(var E in this._levels)this._setZoomTransform(this._levels[E],u,f)},_setZoomTransform:function(u,f,E){var b=this._map.getZoomScale(E,u.zoom),N=u.origin.multiplyBy(b).subtract(this._map._getNewPixelOrigin(f,E)).round();Be.any3d?Cs(u.el,N,b):Qt(u.el,N)},_resetGrid:function(){var u=this._map,f=u.options.crs,E=this._tileSize=this.getTileSize(),b=this._tileZoom,N=this._map.getPixelWorldBounds(this._tileZoom);N&&(this._globalTileRange=this._pxBoundsToTileRange(N)),this._wrapX=f.wrapLng&&!this.options.noWrap&&[Math.floor(u.project([0,f.wrapLng[0]],b).x/E.x),Math.ceil(u.project([0,f.wrapLng[1]],b).x/E.y)],this._wrapY=f.wrapLat&&!this.options.noWrap&&[Math.floor(u.project([f.wrapLat[0],0],b).y/E.x),Math.ceil(u.project([f.wrapLat[1],0],b).y/E.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(u){var f=this._map,E=f._animatingZoom?Math.max(f._animateToZoom,f.getZoom()):f.getZoom(),b=f.getZoomScale(E,this._tileZoom),N=f.project(u,this._tileZoom).floor(),P=f.getSize().divideBy(b*2);return new K(N.subtract(P),N.add(P))},_update:function(u){var f=this._map;if(f){var E=this._clampZoom(f.getZoom());if(u===void 0&&(u=f.getCenter()),this._tileZoom!==void 0){var b=this._getTiledPixelBounds(u),N=this._pxBoundsToTileRange(b),P=N.getCenter(),j=[],te=this.options.keepBuffer,ue=new K(N.getBottomLeft().subtract([te,-te]),N.getTopRight().add([te,-te]));if(!(isFinite(N.min.x)&&isFinite(N.min.y)&&isFinite(N.max.x)&&isFinite(N.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ee in this._tiles){var Le=this._tiles[Ee].coords;(Le.z!==this._tileZoom||!ue.contains(new be(Le.x,Le.y)))&&(this._tiles[Ee].current=!1)}if(Math.abs(E-this._tileZoom)>1){this._setView(u,E);return}for(var Je=N.min.y;Je<=N.max.y;Je++)for(var gt=N.min.x;gt<=N.max.x;gt++){var ei=new be(gt,Je);if(ei.z=this._tileZoom,!!this._isValidTile(ei)){var kn=this._tiles[this._tileCoordsToKey(ei)];kn?kn.current=!0:j.push(ei)}}if(j.sort(function(Bt,zt){return Bt.distanceTo(P)-zt.distanceTo(P)}),j.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ki=document.createDocumentFragment();for(gt=0;gt<j.length;gt++)this._addTile(j[gt],Ki);this._level.el.appendChild(Ki)}}}},_isValidTile:function(u){var f=this._map.options.crs;if(!f.infinite){var E=this._globalTileRange;if(!f.wrapLng&&(u.x<E.min.x||u.x>E.max.x)||!f.wrapLat&&(u.y<E.min.y||u.y>E.max.y))return!1}if(!this.options.bounds)return!0;var b=this._tileCoordsToBounds(u);return le(this.options.bounds).overlaps(b)},_keyToBounds:function(u){return this._tileCoordsToBounds(this._keyToTileCoords(u))},_tileCoordsToNwSe:function(u){var f=this._map,E=this.getTileSize(),b=u.scaleBy(E),N=b.add(E),P=f.unproject(b,u.z),j=f.unproject(N,u.z);return[P,j]},_tileCoordsToBounds:function(u){var f=this._tileCoordsToNwSe(u),E=new Ie(f[0],f[1]);return this.options.noWrap||(E=this._map.wrapLatLngBounds(E)),E},_tileCoordsToKey:function(u){return u.x+":"+u.y+":"+u.z},_keyToTileCoords:function(u){var f=u.split(":"),E=new be(+f[0],+f[1]);return E.z=+f[2],E},_removeTile:function(u){var f=this._tiles[u];f&&(xt(f.el),delete this._tiles[u],this.fire("tileunload",{tile:f.el,coords:this._keyToTileCoords(u)}))},_initTile:function(u){Ue(u,"leaflet-tile");var f=this.getTileSize();u.style.width=f.x+"px",u.style.height=f.y+"px",u.onselectstart=x,u.onmousemove=x,Be.ielt9&&this.options.opacity<1&&cn(u,this.options.opacity)},_addTile:function(u,f){var E=this._getTilePos(u),b=this._tileCoordsToKey(u),N=this.createTile(this._wrapCoords(u),l(this._tileReady,this,u));this._initTile(N),this.createTile.length<2&&G(l(this._tileReady,this,u,null,N)),Qt(N,E),this._tiles[b]={el:N,coords:u,current:!0},f.appendChild(N),this.fire("tileloadstart",{tile:N,coords:u})},_tileReady:function(u,f,E){f&&this.fire("tileerror",{error:f,tile:E,coords:u});var b=this._tileCoordsToKey(u);E=this._tiles[b],E&&(E.loaded=+new Date,this._map._fadeAnimated?(cn(E.el,0),W(this._fadeFrame),this._fadeFrame=G(this._updateOpacity,this)):(E.active=!0,this._pruneTiles()),f||(Ue(E.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:E.el,coords:u})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Be.ielt9||!this._map._fadeAnimated?G(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(u){return u.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(u){var f=new be(this._wrapX?T(u.x,this._wrapX):u.x,this._wrapY?T(u.y,this._wrapY):u.y);return f.z=u.z,f},_pxBoundsToTileRange:function(u){var f=this.getTileSize();return new K(u.min.unscaleBy(f).floor(),u.max.unscaleBy(f).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var u in this._tiles)if(!this._tiles[u].loaded)return!1;return!0}});function nm(u){return new xa(u)}var Yr=xa.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(u,f){this._url=u,f=F(this,f),f.detectRetina&&Be.retina&&f.maxZoom>0?(f.tileSize=Math.floor(f.tileSize/2),f.zoomReverse?(f.zoomOffset--,f.minZoom=Math.min(f.maxZoom,f.minZoom+1)):(f.zoomOffset++,f.maxZoom=Math.max(f.minZoom,f.maxZoom-1)),f.minZoom=Math.max(0,f.minZoom)):f.zoomReverse?f.minZoom=Math.min(f.maxZoom,f.minZoom):f.maxZoom=Math.max(f.minZoom,f.maxZoom),typeof f.subdomains=="string"&&(f.subdomains=f.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(u,f){return this._url===u&&f===void 0&&(f=!0),this._url=u,f||this.redraw(),this},createTile:function(u,f){var E=document.createElement("img");return tt(E,"load",l(this._tileOnLoad,this,f,E)),tt(E,"error",l(this._tileOnError,this,f,E)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(E.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(E.referrerPolicy=this.options.referrerPolicy),E.alt="",E.src=this.getTileUrl(u),E},getTileUrl:function(u){var f={r:Be.retina?"@2x":"",s:this._getSubdomain(u),x:u.x,y:u.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var E=this._globalTileRange.max.y-u.y;this.options.tms&&(f.y=E),f["-y"]=E}return re(this._url,s(f,this.options))},_tileOnLoad:function(u,f){Be.ielt9?setTimeout(l(u,this,null,f),0):u(null,f)},_tileOnError:function(u,f,E){var b=this.options.errorTileUrl;b&&f.getAttribute("src")!==b&&(f.src=b),u(E,f)},_onTileRemove:function(u){u.tile.onload=null},_getZoomForUrl:function(){var u=this._tileZoom,f=this.options.maxZoom,E=this.options.zoomReverse,b=this.options.zoomOffset;return E&&(u=f-u),u+b},_getSubdomain:function(u){var f=Math.abs(u.x+u.y)%this.options.subdomains.length;return this.options.subdomains[f]},_abortLoading:function(){var u,f;for(u in this._tiles)if(this._tiles[u].coords.z!==this._tileZoom&&(f=this._tiles[u].el,f.onload=x,f.onerror=x,!f.complete)){f.src=fe;var E=this._tiles[u].coords;xt(f),delete this._tiles[u],this.fire("tileabort",{tile:f,coords:E})}},_removeTile:function(u){var f=this._tiles[u];if(f)return f.el.setAttribute("src",fe),xa.prototype._removeTile.call(this,u)},_tileReady:function(u,f,E){if(!(!this._map||E&&E.getAttribute("src")===fe))return xa.prototype._tileReady.call(this,u,f,E)}});function os(u,f){return new Yr(u,f)}var ql=Yr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(u,f){this._url=u;var E=s({},this.defaultWmsParams);for(var b in f)b in this.options||(E[b]=f[b]);f=F(this,f);var N=f.detectRetina&&Be.retina?2:1,P=this.getTileSize();E.width=P.x*N,E.height=P.y*N,this.wmsParams=E},onAdd:function(u){this._crs=this.options.crs||u.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var f=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[f]=this._crs.code,Yr.prototype.onAdd.call(this,u)},getTileUrl:function(u){var f=this._tileCoordsToNwSe(u),E=this._crs,b=me(E.project(f[0]),E.project(f[1])),N=b.min,P=b.max,j=(this._wmsVersion>=1.3&&this._crs===Eo?[N.y,N.x,P.y,P.x]:[N.x,N.y,P.x,P.y]).join(","),te=Yr.prototype.getTileUrl.call(this,u);return te+H(this.wmsParams,te,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+j},setParams:function(u,f){return s(this.wmsParams,u),f||this.redraw(),this}});function as(u,f){return new ql(u,f)}Yr.WMS=ql,os.wms=as;var Ai=Ps.extend({options:{padding:.1},initialize:function(u){F(this,u),h(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ue(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var u={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(u.zoomanim=this._onAnimZoom),u},_onAnimZoom:function(u){this._updateTransform(u.center,u.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(u,f){var E=this._map.getZoomScale(f,this._zoom),b=this._map.getSize().multiplyBy(.5+this.options.padding),N=this._map.project(this._center,f),P=b.multiplyBy(-E).add(N).subtract(this._map._getNewPixelOrigin(u,f));Be.any3d?Cs(this._container,P,E):Qt(this._container,P)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var u in this._layers)this._layers[u]._reset()},_onZoomEnd:function(){for(var u in this._layers)this._layers[u]._project()},_updatePaths:function(){for(var u in this._layers)this._layers[u]._update()},_update:function(){var u=this.options.padding,f=this._map.getSize(),E=this._map.containerPointToLayerPoint(f.multiplyBy(-u)).round();this._bounds=new K(E,E.add(f.multiplyBy(1+u*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ic=Ai.extend({options:{tolerance:0},getEvents:function(){var u=Ai.prototype.getEvents.call(this);return u.viewprereset=this._onViewPreReset,u},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ai.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var u=this._container=document.createElement("canvas");tt(u,"mousemove",this._onMouseMove,this),tt(u,"click dblclick mousedown mouseup contextmenu",this._onClick,this),tt(u,"mouseout",this._handleMouseOut,this),u._leaflet_disable_events=!0,this._ctx=u.getContext("2d")},_destroyContainer:function(){W(this._redrawRequest),delete this._ctx,xt(this._container),Ft(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var u;this._redrawBounds=null;for(var f in this._layers)u=this._layers[f],u._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ai.prototype._update.call(this);var u=this._bounds,f=this._container,E=u.getSize(),b=Be.retina?2:1;Qt(f,u.min),f.width=b*E.x,f.height=b*E.y,f.style.width=E.x+"px",f.style.height=E.y+"px",Be.retina&&this._ctx.scale(2,2),this._ctx.translate(-u.min.x,-u.min.y),this.fire("update")}},_reset:function(){Ai.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(u){this._updateDashArray(u),this._layers[h(u)]=u;var f=u._order={layer:u,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=f),this._drawLast=f,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(u){this._requestRedraw(u)},_removePath:function(u){var f=u._order,E=f.next,b=f.prev;E?E.prev=b:this._drawLast=b,b?b.next=E:this._drawFirst=E,delete u._order,delete this._layers[h(u)],this._requestRedraw(u)},_updatePath:function(u){this._extendRedrawBounds(u),u._project(),u._update(),this._requestRedraw(u)},_updateStyle:function(u){this._updateDashArray(u),this._requestRedraw(u)},_updateDashArray:function(u){if(typeof u.options.dashArray=="string"){var f=u.options.dashArray.split(/[, ]+/),E=[],b,N;for(N=0;N<f.length;N++){if(b=Number(f[N]),isNaN(b))return;E.push(b)}u.options._dashArray=E}else u.options._dashArray=u.options.dashArray},_requestRedraw:function(u){this._map&&(this._extendRedrawBounds(u),this._redrawRequest=this._redrawRequest||G(this._redraw,this))},_extendRedrawBounds:function(u){if(u._pxBounds){var f=(u.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new K,this._redrawBounds.extend(u._pxBounds.min.subtract([f,f])),this._redrawBounds.extend(u._pxBounds.max.add([f,f]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var u=this._redrawBounds;if(u){var f=u.getSize();this._ctx.clearRect(u.min.x,u.min.y,f.x,f.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var u,f=this._redrawBounds;if(this._ctx.save(),f){var E=f.getSize();this._ctx.beginPath(),this._ctx.rect(f.min.x,f.min.y,E.x,E.y),this._ctx.clip()}this._drawing=!0;for(var b=this._drawFirst;b;b=b.next)u=b.layer,(!f||u._pxBounds&&u._pxBounds.intersects(f))&&u._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(u,f){if(this._drawing){var E,b,N,P,j=u._parts,te=j.length,ue=this._ctx;if(te){for(ue.beginPath(),E=0;E<te;E++){for(b=0,N=j[E].length;b<N;b++)P=j[E][b],ue[b?"lineTo":"moveTo"](P.x,P.y);f&&ue.closePath()}this._fillStroke(ue,u)}}},_updateCircle:function(u){if(!(!this._drawing||u._empty())){var f=u._point,E=this._ctx,b=Math.max(Math.round(u._radius),1),N=(Math.max(Math.round(u._radiusY),1)||b)/b;N!==1&&(E.save(),E.scale(1,N)),E.beginPath(),E.arc(f.x,f.y/N,b,0,Math.PI*2,!1),N!==1&&E.restore(),this._fillStroke(E,u)}},_fillStroke:function(u,f){var E=f.options;E.fill&&(u.globalAlpha=E.fillOpacity,u.fillStyle=E.fillColor||E.color,u.fill(E.fillRule||"evenodd")),E.stroke&&E.weight!==0&&(u.setLineDash&&u.setLineDash(f.options&&f.options._dashArray||[]),u.globalAlpha=E.opacity,u.lineWidth=E.weight,u.strokeStyle=E.color,u.lineCap=E.lineCap,u.lineJoin=E.lineJoin,u.stroke())},_onClick:function(u){for(var f=this._map.mouseEventToLayerPoint(u),E,b,N=this._drawFirst;N;N=N.next)E=N.layer,E.options.interactive&&E._containsPoint(f)&&(!(u.type==="click"||u.type==="preclick")||!this._map._draggableMoved(E))&&(b=E);this._fireEvent(b?[b]:!1,u)},_onMouseMove:function(u){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var f=this._map.mouseEventToLayerPoint(u);this._handleMouseHover(u,f)}},_handleMouseOut:function(u){var f=this._hoveredLayer;f&&(Zt(this._container,"leaflet-interactive"),this._fireEvent([f],u,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(u,f){if(!this._mouseHoverThrottled){for(var E,b,N=this._drawFirst;N;N=N.next)E=N.layer,E.options.interactive&&E._containsPoint(f)&&(b=E);b!==this._hoveredLayer&&(this._handleMouseOut(u),b&&(Ue(this._container,"leaflet-interactive"),this._fireEvent([b],u,"mouseover"),this._hoveredLayer=b)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,u),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(u,f,E){this._map._fireDOMEvent(f,E||f.type,u)},_bringToFront:function(u){var f=u._order;if(f){var E=f.next,b=f.prev;if(E)E.prev=b;else return;b?b.next=E:E&&(this._drawFirst=E),f.prev=this._drawLast,this._drawLast.next=f,f.next=null,this._drawLast=f,this._requestRedraw(u)}},_bringToBack:function(u){var f=u._order;if(f){var E=f.next,b=f.prev;if(b)b.next=E;else return;E?E.prev=b:b&&(this._drawLast=b),f.prev=null,f.next=this._drawFirst,this._drawFirst.prev=f,this._drawFirst=f,this._requestRedraw(u)}}});function Gl(u){return Be.canvas?new ic(u):null}var Jr=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(u){return document.createElement("<lvml:"+u+' class="lvml">')}}catch{}return function(u){return document.createElement("<"+u+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Fd={_initContainer:function(){this._container=vt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ai.prototype._update.call(this),this.fire("update"))},_initPath:function(u){var f=u._container=Jr("shape");Ue(f,"leaflet-vml-shape "+(this.options.className||"")),f.coordsize="1 1",u._path=Jr("path"),f.appendChild(u._path),this._updateStyle(u),this._layers[h(u)]=u},_addPath:function(u){var f=u._container;this._container.appendChild(f),u.options.interactive&&u.addInteractiveTarget(f)},_removePath:function(u){var f=u._container;xt(f),u.removeInteractiveTarget(f),delete this._layers[h(u)]},_updateStyle:function(u){var f=u._stroke,E=u._fill,b=u.options,N=u._container;N.stroked=!!b.stroke,N.filled=!!b.fill,b.stroke?(f||(f=u._stroke=Jr("stroke")),N.appendChild(f),f.weight=b.weight+"px",f.color=b.color,f.opacity=b.opacity,b.dashArray?f.dashStyle=Q(b.dashArray)?b.dashArray.join(" "):b.dashArray.replace(/( *, *)/g," "):f.dashStyle="",f.endcap=b.lineCap.replace("butt","flat"),f.joinstyle=b.lineJoin):f&&(N.removeChild(f),u._stroke=null),b.fill?(E||(E=u._fill=Jr("fill")),N.appendChild(E),E.color=b.fillColor||b.color,E.opacity=b.fillOpacity):E&&(N.removeChild(E),u._fill=null)},_updateCircle:function(u){var f=u._point.round(),E=Math.round(u._radius),b=Math.round(u._radiusY||E);this._setPath(u,u._empty()?"M0 0":"AL "+f.x+","+f.y+" "+E+","+b+" 0,"+65535*360)},_setPath:function(u,f){u._path.v=f},_bringToFront:function(u){vn(u._container)},_bringToBack:function(u){qi(u._container)}},nr=Be.vml?Jr:Yt,wa=Ai.extend({_initContainer:function(){this._container=nr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=nr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){xt(this._container),Ft(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ai.prototype._update.call(this);var u=this._bounds,f=u.getSize(),E=this._container;(!this._svgSize||!this._svgSize.equals(f))&&(this._svgSize=f,E.setAttribute("width",f.x),E.setAttribute("height",f.y)),Qt(E,u.min),E.setAttribute("viewBox",[u.min.x,u.min.y,f.x,f.y].join(" ")),this.fire("update")}},_initPath:function(u){var f=u._path=nr("path");u.options.className&&Ue(f,u.options.className),u.options.interactive&&Ue(f,"leaflet-interactive"),this._updateStyle(u),this._layers[h(u)]=u},_addPath:function(u){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(u._path),u.addInteractiveTarget(u._path)},_removePath:function(u){xt(u._path),u.removeInteractiveTarget(u._path),delete this._layers[h(u)]},_updatePath:function(u){u._project(),u._update()},_updateStyle:function(u){var f=u._path,E=u.options;f&&(E.stroke?(f.setAttribute("stroke",E.color),f.setAttribute("stroke-opacity",E.opacity),f.setAttribute("stroke-width",E.weight),f.setAttribute("stroke-linecap",E.lineCap),f.setAttribute("stroke-linejoin",E.lineJoin),E.dashArray?f.setAttribute("stroke-dasharray",E.dashArray):f.removeAttribute("stroke-dasharray"),E.dashOffset?f.setAttribute("stroke-dashoffset",E.dashOffset):f.removeAttribute("stroke-dashoffset")):f.setAttribute("stroke","none"),E.fill?(f.setAttribute("fill",E.fillColor||E.color),f.setAttribute("fill-opacity",E.fillOpacity),f.setAttribute("fill-rule",E.fillRule||"evenodd")):f.setAttribute("fill","none"))},_updatePoly:function(u,f){this._setPath(u,Rt(u._parts,f))},_updateCircle:function(u){var f=u._point,E=Math.max(Math.round(u._radius),1),b=Math.max(Math.round(u._radiusY),1)||E,N="a"+E+","+b+" 0 1,0 ",P=u._empty()?"M0 0":"M"+(f.x-E)+","+f.y+N+E*2+",0 "+N+-E*2+",0 ";this._setPath(u,P)},_setPath:function(u,f){u._path.setAttribute("d",f)},_bringToFront:function(u){vn(u._path)},_bringToBack:function(u){qi(u._path)}});Be.vml&&wa.include(Fd);function Hl(u){return Be.svg||Be.vml?new wa(u):null}yt.include({getRenderer:function(u){var f=u.options.renderer||this._getPaneRenderer(u.options.pane)||this.options.renderer||this._renderer;return f||(f=this._renderer=this._createRenderer()),this.hasLayer(f)||this.addLayer(f),f},_getPaneRenderer:function(u){if(u==="overlayPane"||u===void 0)return!1;var f=this._paneRenderers[u];return f===void 0&&(f=this._createRenderer({pane:u}),this._paneRenderers[u]=f),f},_createRenderer:function(u){return this.options.preferCanvas&&Gl(u)||Hl(u)}});var xo=ya.extend({initialize:function(u,f){ya.prototype.initialize.call(this,this._boundsToLatLngs(u),f)},setBounds:function(u){return this.setLatLngs(this._boundsToLatLngs(u))},_boundsToLatLngs:function(u){return u=le(u),[u.getSouthWest(),u.getNorthWest(),u.getNorthEast(),u.getSouthEast()]}});function A_(u,f){return new xo(u,f)}wa.create=nr,wa.pointsToPath=Rt,Tr.geometryToLayer=di,Tr.coordsToLatLng=$u,Tr.coordsToLatLngs=Ol,Tr.latLngToCoords=Xu,Tr.latLngsToCoords=Ul,Tr.getFeature=jr,Tr.asFeature=ec,yt.mergeOptions({boxZoom:!0});var Ni=Hi.extend({initialize:function(u){this._map=u,this._container=u._container,this._pane=u._panes.overlayPane,this._resetStateTimeout=0,u.on("unload",this._destroy,this)},addHooks:function(){tt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ft(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){xt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(u){if(!u.shiftKey||u.which!==1&&u.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ns(),go(),this._startPoint=this._map.mouseEventToContainerPoint(u),tt(document,{contextmenu:bs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(u){this._moved||(this._moved=!0,this._box=vt("div","leaflet-zoom-box",this._container),Ue(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(u);var f=new K(this._point,this._startPoint),E=f.getSize();Qt(this._box,f.min),this._box.style.width=E.x+"px",this._box.style.height=E.y+"px"},_finish:function(){this._moved&&(xt(this._box),Zt(this._container,"leaflet-crosshair")),jn(),Fr(),Ft(document,{contextmenu:bs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(u){if(!(u.which!==1&&u.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var f=new Ie(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(f).fire("boxzoomend",{boxZoomBounds:f})}},_onKeyDown:function(u){u.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});yt.addInitHook("addHandler","boxZoom",Ni),yt.mergeOptions({doubleClickZoom:!0});var sc=Hi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(u){var f=this._map,E=f.getZoom(),b=f.options.zoomDelta,N=u.originalEvent.shiftKey?E-b:E+b;f.options.doubleClickZoom==="center"?f.setZoom(N):f.setZoomAround(u.containerPoint,N)}});yt.addInitHook("addHandler","doubleClickZoom",sc),yt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ir=Hi.extend({addHooks:function(){if(!this._draggable){var u=this._map;this._draggable=new Rs(u._mapPane,u._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),u.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),u.on("zoomend",this._onZoomEnd,this),u.whenReady(this._onZoomEnd,this))}Ue(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Zt(this._map._container,"leaflet-grab"),Zt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var u=this._map;if(u._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var f=le(this._map.options.maxBounds);this._offsetLimit=me(this._map.latLngToContainerPoint(f.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(f.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;u.fire("movestart").fire("dragstart"),u.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(u){if(this._map.options.inertia){var f=this._lastTime=+new Date,E=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(E),this._times.push(f),this._prunePositions(f)}this._map.fire("move",u).fire("drag",u)},_prunePositions:function(u){for(;this._positions.length>1&&u-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var u=this._map.getSize().divideBy(2),f=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=f.subtract(u).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(u,f){return u-(u-f)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var u=this._draggable._newPos.subtract(this._draggable._startPos),f=this._offsetLimit;u.x<f.min.x&&(u.x=this._viscousLimit(u.x,f.min.x)),u.y<f.min.y&&(u.y=this._viscousLimit(u.y,f.min.y)),u.x>f.max.x&&(u.x=this._viscousLimit(u.x,f.max.x)),u.y>f.max.y&&(u.y=this._viscousLimit(u.y,f.max.y)),this._draggable._newPos=this._draggable._startPos.add(u)}},_onPreDragWrap:function(){var u=this._worldWidth,f=Math.round(u/2),E=this._initialWorldOffset,b=this._draggable._newPos.x,N=(b-f+E)%u+f-E,P=(b+f+E)%u-f-E,j=Math.abs(N+E)<Math.abs(P+E)?N:P;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=j},_onDragEnd:function(u){var f=this._map,E=f.options,b=!E.inertia||u.noInertia||this._times.length<2;if(f.fire("dragend",u),b)f.fire("moveend");else{this._prunePositions(+new Date);var N=this._lastPos.subtract(this._positions[0]),P=(this._lastTime-this._times[0])/1e3,j=E.easeLinearity,te=N.multiplyBy(j/P),ue=te.distanceTo([0,0]),Ee=Math.min(E.inertiaMaxSpeed,ue),Le=te.multiplyBy(Ee/ue),Je=Ee/(E.inertiaDeceleration*j),gt=Le.multiplyBy(-Je/2).round();!gt.x&&!gt.y?f.fire("moveend"):(gt=f._limitOffset(gt,f.options.maxBounds),G(function(){f.panBy(gt,{duration:Je,easeLinearity:j,noMoveStart:!0,animate:!0})}))}}});yt.addInitHook("addHandler","dragging",ir),yt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Bd=Hi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(u){this._map=u,this._setPanDelta(u.options.keyboardPanDelta),this._setZoomDelta(u.options.zoomDelta)},addHooks:function(){var u=this._map._container;u.tabIndex<=0&&(u.tabIndex="0"),tt(u,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ft(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var u=document.body,f=document.documentElement,E=u.scrollTop||f.scrollTop,b=u.scrollLeft||f.scrollLeft;this._map._container.focus(),window.scrollTo(b,E)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(u){var f=this._panKeys={},E=this.keyCodes,b,N;for(b=0,N=E.left.length;b<N;b++)f[E.left[b]]=[-1*u,0];for(b=0,N=E.right.length;b<N;b++)f[E.right[b]]=[u,0];for(b=0,N=E.down.length;b<N;b++)f[E.down[b]]=[0,u];for(b=0,N=E.up.length;b<N;b++)f[E.up[b]]=[0,-1*u]},_setZoomDelta:function(u){var f=this._zoomKeys={},E=this.keyCodes,b,N;for(b=0,N=E.zoomIn.length;b<N;b++)f[E.zoomIn[b]]=u;for(b=0,N=E.zoomOut.length;b<N;b++)f[E.zoomOut[b]]=-u},_addHooks:function(){tt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ft(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(u){if(!(u.altKey||u.ctrlKey||u.metaKey)){var f=u.keyCode,E=this._map,b;if(f in this._panKeys){if(!E._panAnim||!E._panAnim._inProgress)if(b=this._panKeys[f],u.shiftKey&&(b=Pe(b).multiplyBy(3)),E.options.maxBounds&&(b=E._limitOffset(Pe(b),E.options.maxBounds)),E.options.worldCopyJump){var N=E.wrapLatLng(E.unproject(E.project(E.getCenter()).add(b)));E.panTo(N)}else E.panBy(b)}else if(f in this._zoomKeys)E.setZoom(E.getZoom()+(u.shiftKey?3:1)*this._zoomKeys[f]);else if(f===27&&E._popup&&E._popup.options.closeOnEscapeKey)E.closePopup();else return;bs(u)}}});yt.addInitHook("addHandler","keyboard",Bd),yt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var jl=Hi.extend({addHooks:function(){tt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ft(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(u){var f=Kn(u),E=this._map.options.wheelDebounceTime;this._delta+=f,this._lastMousePos=this._map.mouseEventToContainerPoint(u),this._startTime||(this._startTime=+new Date);var b=Math.max(E-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),b),bs(u)},_performZoom:function(){var u=this._map,f=u.getZoom(),E=this._map.options.zoomSnap||0;u._stop();var b=this._delta/(this._map.options.wheelPxPerZoomLevel*4),N=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,P=E?Math.ceil(N/E)*E:N,j=u._limitZoom(f+(this._delta>0?P:-P))-f;this._delta=0,this._startTime=null,j&&(u.options.scrollWheelZoom==="center"?u.setZoom(f+j):u.setZoomAround(this._lastMousePos,f+j))}});yt.addInitHook("addHandler","scrollWheelZoom",jl);var wo=600;yt.mergeOptions({tapHold:Be.touchNative&&Be.safari&&Be.mobile,tapTolerance:15});var rc=Hi.extend({addHooks:function(){tt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ft(this._map._container,"touchstart",this._onDown,this)},_onDown:function(u){if(clearTimeout(this._holdTimeout),u.touches.length===1){var f=u.touches[0];this._startPos=this._newPos=new be(f.clientX,f.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(tt(document,"touchend",Tn),tt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",f))},this),wo),tt(document,"touchend touchcancel contextmenu",this._cancel,this),tt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function u(){Ft(document,"touchend",Tn),Ft(document,"touchend touchcancel",u)},_cancel:function(){clearTimeout(this._holdTimeout),Ft(document,"touchend touchcancel contextmenu",this._cancel,this),Ft(document,"touchmove",this._onMove,this)},_onMove:function(u){var f=u.touches[0];this._newPos=new be(f.clientX,f.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(u,f){var E=new MouseEvent(u,{bubbles:!0,cancelable:!0,view:window,screenX:f.screenX,screenY:f.screenY,clientX:f.clientX,clientY:f.clientY});E._simulated=!0,f.target.dispatchEvent(E)}});yt.addInitHook("addHandler","tapHold",rc),yt.mergeOptions({touchZoom:Be.touch,bounceAtZoomLimits:!0});var zd=Hi.extend({addHooks:function(){Ue(this._map._container,"leaflet-touch-zoom"),tt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Zt(this._map._container,"leaflet-touch-zoom"),Ft(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(u){var f=this._map;if(!(!u.touches||u.touches.length!==2||f._animatingZoom||this._zooming)){var E=f.mouseEventToContainerPoint(u.touches[0]),b=f.mouseEventToContainerPoint(u.touches[1]);this._centerPoint=f.getSize()._divideBy(2),this._startLatLng=f.containerPointToLatLng(this._centerPoint),f.options.touchZoom!=="center"&&(this._pinchStartLatLng=f.containerPointToLatLng(E.add(b)._divideBy(2))),this._startDist=E.distanceTo(b),this._startZoom=f.getZoom(),this._moved=!1,this._zooming=!0,f._stop(),tt(document,"touchmove",this._onTouchMove,this),tt(document,"touchend touchcancel",this._onTouchEnd,this),Tn(u)}},_onTouchMove:function(u){if(!(!u.touches||u.touches.length!==2||!this._zooming)){var f=this._map,E=f.mouseEventToContainerPoint(u.touches[0]),b=f.mouseEventToContainerPoint(u.touches[1]),N=E.distanceTo(b)/this._startDist;if(this._zoom=f.getScaleZoom(N,this._startZoom),!f.options.bounceAtZoomLimits&&(this._zoom<f.getMinZoom()&&N<1||this._zoom>f.getMaxZoom()&&N>1)&&(this._zoom=f._limitZoom(this._zoom)),f.options.touchZoom==="center"){if(this._center=this._startLatLng,N===1)return}else{var P=E._add(b)._divideBy(2)._subtract(this._centerPoint);if(N===1&&P.x===0&&P.y===0)return;this._center=f.unproject(f.project(this._pinchStartLatLng,this._zoom).subtract(P),this._zoom)}this._moved||(f._moveStart(!0,!1),this._moved=!0),W(this._animRequest);var j=l(f._move,f,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=G(j,this,!0),Tn(u)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,W(this._animRequest),Ft(document,"touchmove",this._onTouchMove,this),Ft(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});yt.addInitHook("addHandler","touchZoom",zd),yt.BoxZoom=Ni,yt.DoubleClickZoom=sc,yt.Drag=ir,yt.Keyboard=Bd,yt.ScrollWheelZoom=jl,yt.TapHold=rc,yt.TouchZoom=zd,t.Bounds=K,t.Browser=Be,t.CRS=Ke,t.Canvas=ic,t.Circle=Qu,t.CircleMarker=_a,t.Class=Ge,t.Control=ui,t.DivIcon=tm,t.DivOverlay=hi,t.DomEvent=$s,t.DomUtil=zr,t.Draggable=Rs,t.Evented=Ce,t.FeatureGroup=Xs,t.GeoJSON=Tr,t.GridLayer=xa,t.Handler=Hi,t.Icon=er,t.ImageOverlay=Ta,t.LatLng=ge,t.LatLngBounds=Ie,t.Layer=Ps,t.LayerGroup=ga,t.LineUtil=ss,t.Map=yt,t.Marker=Vl,t.Mixin=Ju,t.Path=tr,t.Point=be,t.PolyUtil=Hr,t.Polygon=ya,t.Polyline=vr,t.Popup=Bl,t.PosAnimation=gr,t.Projection=Ms,t.Rectangle=xo,t.Renderer=Ai,t.SVG=wa,t.SVGOverlay=nc,t.TileLayer=Yr,t.Tooltip=zl,t.Transformation=Jt,t.Util=z,t.VideoOverlay=Wr,t.bind=l,t.bounds=me,t.canvas=Gl,t.circle=Qf,t.circleMarker=Zf,t.control=Ii,t.divIcon=I_,t.extend=s,t.featureGroup=Yf,t.geoJSON=tc,t.geoJson=Fl,t.gridLayer=nm,t.icon=kl,t.imageOverlay=$f,t.latLng=we,t.latLngBounds=le,t.layerGroup=w_,t.map=Gr,t.marker=Jf,t.point=Pe,t.polygon=C_,t.polyline=S_,t.popup=em,t.rectangle=A_,t.setOptions=F,t.stamp=h,t.svg=Hl,t.svgOverlay=Xf,t.tileLayer=os,t.tooltip=b_,t.transformation=ct,t.version=i,t.videoOverlay=Ea;var qd=window.L;t.noConflict=function(){return window.L=qd,this},window.L=t}))})(Vh,Vh.exports)),Vh.exports}var Cd=Y6();const Uu=Y0(Cd);function Pg(n,e,t){return Object.freeze({instance:n,context:e,container:t})}function kg(n,e){return e==null?function(i,s){const o=Z.useRef(void 0);return o.current||(o.current=n(i,s)),o}:function(i,s){const o=Z.useRef(void 0);o.current||(o.current=n(i,s));const l=Z.useRef(i),{instance:d}=o.current;return Z.useEffect(function(){l.current!==i&&(e(d,i,l.current),l.current=i)},[d,i,e]),o}}function yN(n,e){Z.useEffect(function(){return(e.layerContainer??e.map).addLayer(n.instance),function(){var o;(o=e.layerContainer)==null||o.removeLayer(n.instance),e.map.removeLayer(n.instance)}},[e,n])}function vN(n){return function(t){const i=Rg(),s=n(Mg(t,i),i);return mN(i.map,t.attribution),uT(s.current,t.eventHandlers),yN(s.current,i),s}}function J6(n,e){const t=Z.useRef(void 0);Z.useEffect(function(){if(e.pathOptions!==t.current){const s=e.pathOptions??{};n.instance.setStyle(s),t.current=s}},[n,e])}function Z6(n){return function(t){const i=Rg(),s=n(Mg(t,i),i);return uT(s.current,t.eventHandlers),yN(s.current,i),J6(s.current,t),s}}function Q6(n,e){const t=kg(n,e),i=vN(t);return _N(i)}function $6(n,e){const t=kg(n),i=K6(t,e);return H6(i)}function X6(n,e){const t=kg(n,e),i=Z6(t);return _N(i)}function eU(n,e){const t=kg(n,e),i=vN(t);return j6(i)}function tU(n,e,t){const{opacity:i,zIndex:s}=e;i!=null&&i!==t.opacity&&n.setOpacity(i),s!=null&&s!==t.zIndex&&n.setZIndex(s)}function Dg(){return Rg().map}function nU({bounds:n,boundsOptions:e,center:t,children:i,className:s,id:o,placeholder:l,style:d,whenReady:h,zoom:p,...T},x){const[C]=Z.useState({className:s,id:o,style:d}),[A,D]=Z.useState(null),F=Z.useRef(void 0);Z.useImperativeHandle(x,()=>(A==null?void 0:A.map)??null,[A]);const H=Z.useCallback(re=>{if(re!==null&&!F.current){const Q=new Cd.Map(re,T);F.current=Q,t!=null&&p!=null?Q.setView(t,p):n!=null&&Q.fitBounds(n,e),h!=null&&Q.whenReady(h),D(G6(Q))}},[]);Z.useEffect(()=>()=>{A==null||A.map.remove()},[A]);const X=A?lf.createElement(lT,{value:A},i):l??null;return lf.createElement("div",{...C,ref:H},X)}const TN=Z.forwardRef(nU),cT=Q6(function({position:e,...t},i){const s=new Cd.Marker(e,t);return Pg(s,gN(i,{overlayContainer:s}))},function(e,t,i){t.position!==i.position&&e.setLatLng(t.position),t.icon!=null&&t.icon!==i.icon&&e.setIcon(t.icon),t.zIndexOffset!=null&&t.zIndexOffset!==i.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),t.opacity!=null&&t.opacity!==i.opacity&&e.setOpacity(t.opacity),e.dragging!=null&&t.draggable!==i.draggable&&(t.draggable===!0?e.dragging.enable():e.dragging.disable())}),iU=X6(function({positions:e,...t},i){const s=new Cd.Polyline(e,t);return Pg(s,gN(i,{overlayContainer:s}))},function(e,t,i){t.positions!==i.positions&&e.setLatLngs(t.positions)}),dT=$6(function(e,t){const i=new Cd.Popup(e,t.overlayContainer);return Pg(i,t)},function(e,t,{position:i},s){Z.useEffect(function(){const{instance:l}=e;function d(p){p.popup===l&&(l.update(),s(!0))}function h(p){p.popup===l&&s(!1)}return t.map.on({popupopen:d,popupclose:h}),t.overlayContainer==null?(i!=null&&l.setLatLng(i),l.openOn(t.map)):t.overlayContainer.bindPopup(l),function(){var T;t.map.off({popupopen:d,popupclose:h}),(T=t.overlayContainer)==null||T.unbindPopup(),t.map.removeLayer(l)}},[e,t,s,i])}),EN=eU(function({url:e,...t},i){const s=new Cd.TileLayer(e,Mg(t,i));return Pg(s,i)},function(e,t,i){tU(e,t,i);const{url:s}=t;s!=null&&s!==i.url&&e.setUrl(s)}),sU={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var Lb={};const rU=()=>{try{if(typeof import.meta<"u"&&sU)return"";if(typeof process<"u"&&Lb)return Lb.VITE_API_KEY||""}catch(n){console.warn("Failed to access API key",n)}return""},dv=rU(),oU="AIzaSyC2SRWVViygm5tBgGQeGgFEq9_jK_PdT_0",aU=n=>{var e,t,i,s;if(typeof n.text=="string")return n.text;if(typeof n.text=="function")return n.text();if(n.candidates&&((s=(i=(t=(e=n.candidates[0])==null?void 0:e.content)==null?void 0:t.parts)==null?void 0:i[0])!=null&&s.text))return n.candidates[0].content.parts[0].text;throw new Error("No text found in AI response")},Vb={1:{lat:25.033,lng:121.5654},"taipei 101":{lat:25.033,lng:121.5654},2:{lat:25.0421,lng:121.5082},3:{lat:25.1024,lng:121.5486},test:{lat:25.033,lng:121.5654},kyoto:{lat:35.0116,lng:135.7681},osaka:{lat:34.6937,lng:135.5023},tokyo:{lat:35.6762,lng:139.6503},:{lat:26.2048,lng:127.6458}," () check in":{lat:26.2048,lng:127.6458},:{lat:26.2048,lng:127.6458},"  ":{lat:26.196,lng:127.665},:{lat:26.196,lng:127.665},:{lat:26.196,lng:127.665},:{lat:26.2206,lng:127.6711},:{lat:26.1308,lng:127.7739},:{lat:26.3164,lng:127.7577},:{lat:26.695,lng:128.022},:{lat:26.6942,lng:127.8779},:{lat:26.505,lng:127.8512},:{lat:26.215,lng:127.685},"tokyo tower":{lat:35.6586,lng:139.7454},:{lat:35.6586,lng:139.7454}},Gh=async(n,e)=>{const t=n.toLowerCase().trim();if(Vb[t])return console.log(`Using Test Location for: ${n}`),Vb[t];const i=async x=>{if(!x)return null;try{const A=await new nN({apiKey:x}).models.generateContent({model:"gemini-2.5-flash-lite",contents:`Convert this address to latitude and longitude coordinates: "${n}". 
                
                IMPORTANT: Return ONLY a JSON object in this exact format:
                {"lat": 25.0330, "lng": 121.5654}
                
                Do not include any explanations, just the JSON object.`,config:{responseMimeType:"application/json"}}),D=aU(A),F=JSON.parse(D);if(F.lat&&F.lng)return{lat:parseFloat(F.lat),lng:parseFloat(F.lng)}}catch(C){return console.warn(`Geocoding failed with key ${x.substring(0,5)}...`,C),null}return null},s=async x=>{if(!x)return null;try{console.log(`Trying Google Maps Geocoding API with key ${x.substring(0,5)}...`);const C=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(n)}&key=${x}`,D=await(await fetch(C)).json();if(D.status==="OK"&&D.results&&D.results.length>0){const F=D.results[0].geometry.location;return{lat:F.lat,lng:F.lng}}else console.warn("Google Maps Geocoding API error:",D.status,D.error_message),typeof window<"u"&&window.localStorage.setItem("last_geocode_error",`${D.status}: ${D.error_message||"Unknown error"}`)}catch(C){console.warn("Google Maps Geocoding API request failed:",C),typeof window<"u"&&window.localStorage.setItem("last_geocode_error",`Network Error: ${C}`)}return null},o=x=>x.split(/|\/|\|/).map(A=>A.trim()).filter(A=>A).map(A=>A.replace(/\(.*\)|.*/g,"").trim()).filter(A=>A.length>0),l=async(x,C={},A=5e3)=>{const D=new AbortController,F=setTimeout(()=>D.abort(),A);try{const H=await fetch(x,{...C,signal:D.signal});return clearTimeout(F),H}catch(H){throw clearTimeout(F),H}},d=async x=>{try{console.log(`[Geocoding] Trying Nominatim for: ${x}`);const C=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(x)}&limit=1`,{headers:{"User-Agent":"NomadAI-Travel-Journal/1.0"}});if(!C.ok)return console.warn(`[Geocoding] Nominatim request failed: ${C.status}`),null;const A=await C.json();if(console.log("[Geocoding] Nominatim response:",A),A&&A.length>0){const D=parseFloat(A[0].lat),F=parseFloat(A[0].lon);return console.log("[Geocoding] Nominatim success:",{lat:D,lng:F}),{lat:D,lng:F}}return null}catch(C){return console.error("Nominatim geocoding error:",C),null}},h=async x=>{try{console.log(`Trying Open-Meteo Geocoding for: "${x}"...`);const C=`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(x)}&count=1&language=zh&format=json`,A=await l(C);if(!A.ok)throw new Error(`Open-Meteo status: ${A.status}`);const D=await A.json();if(D&&D.results&&D.results.length>0){const F=D.results[0];return{lat:F.latitude,lng:F.longitude}}}catch(C){console.warn(`Open-Meteo failed for "${x}":`,C)}return null},p=[n,...o(n)],T=Array.from(new Set(p));console.log("Geocoding candidates:",T);for(const x of T){if(e){let D=await i(e);if(D||(D=await s(e),D))return D}if(dv){let D=await i(dv);if(D||(D=await s(dv),D))return D}{const D=await i(oU);if(D)return D}const C=await d(x);if(C)return C;const A=await h(x);if(A)return A}return null},lU=Object.freeze(Object.defineProperty({__proto__:null,geocodeAddress:Gh},Symbol.toStringTag,{value:"Module"})),xN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",wN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";let uU=Uu.icon({iconUrl:xN,shadowUrl:wN,iconSize:[25,41],iconAnchor:[12,41]});Uu.Marker.prototype.options.icon=uU;const cU=({bounds:n,isMapReady:e})=>{const t=Dg();return Z.useEffect(()=>{e&&n&&n.length>0&&setTimeout(()=>{t.fitBounds(n,{padding:[80,80]})},100)},[n,t,e]),null},dU=({onReady:n})=>{const e=Dg();return Z.useEffect(()=>{const t=setTimeout(()=>{e.invalidateSize(),n()},250);return()=>clearTimeout(t)},[e,n]),null},hU=({selectedLocation:n,searchedLocation:e,isMapReady:t})=>{const i=Dg();return Z.useEffect(()=>{t&&(e?i.flyTo([e.lat,e.lng],16,{animate:!0,duration:1.5}):n&&i.flyTo([n.lat,n.lng],16,{animate:!0,duration:1.5}))},[n,e,i,t]),null},fU=({item:n,index:e,isSelected:t,color:i,onClick:s})=>{var h,p;const o=lf.useRef(null);Z.useEffect(()=>{t&&o.current&&o.current.openPopup()},[t]);const l=((h=n.coordinates)==null?void 0:h.lat)||n.lat,d=((p=n.coordinates)==null?void 0:p.lng)||n.lng;return!l||!d?null:_.jsx(cT,{ref:o,position:[l,d],icon:Uu.divIcon({className:"custom-div-icon",html:`<div style="background-color: ${t?"#C5A059":i}; width: ${t?"32px":"24px"}; height: ${t?"32px":"24px"}; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: ${t?"14px":"12px"}; transition: all 0.3s ease;">${e+1}</div>`,iconSize:[t?32:24,t?32:24],iconAnchor:[t?16:12,t?16:12]}),eventHandlers:{click:s},children:_.jsx(dT,{children:_.jsxs("div",{className:"text-center",children:[_.jsxs("div",{className:"font-bold text-ink",children:[e+1,". ",n.activity]}),_.jsx("div",{className:"text-xs text-gray-500",children:n.time}),_.jsxs("div",{className:"text-xs text-coral mt-1",children:["Day ",n.day]})]})})})},mU=({trip:n,settings:e,onUpdateTrip:t,searchedLocation:i,onItemClick:s,mapSearchQuery:o})=>{nn[e.language]||nn["zh-TW"];const[l,d]=Z.useState(null),[h,p]=Z.useState(new Set),[T,x]=Z.useState("ALL"),[C,A]=Z.useState(null),[D,F]=Z.useState(!1),H=Z.useMemo(()=>{const Y=n.itinerary||[];return T==="ALL"?Y:Y.filter(k=>k.day===T)},[n.itinerary,T]),X=Z.useMemo(()=>{const Y={};return(n.itinerary||[]).forEach(k=>{Y[k.day]||(Y[k.day]=[]),Y[k.day].push(k)}),Object.keys(Y).forEach(k=>{Y[Number(k)].sort((B,O)=>B.time.localeCompare(O.time))}),Y},[n.itinerary]),re=Z.useMemo(()=>Object.keys(X).map(Number).sort((Y,k)=>Y-k),[X]),Q=["#FF5733","#33FF57","#3357FF","#FF33F5","#33FFF5","#F5FF33"],he=Z.useMemo(()=>{const Y=H.filter(k=>k.coordinates||k.lat&&k.lng).map(k=>{var B,O;return[((B=k.coordinates)==null?void 0:B.lat)||k.lat,((O=k.coordinates)==null?void 0:O.lng)||k.lng]});return Y.length===0?null:Y},[H]),fe=Z.useMemo(()=>{var k,B,O;if(!C)return null;const Y=(k=n.itinerary)==null?void 0:k.find(q=>q.id===C);return Y&&(Y.coordinates||Y.lat&&Y.lng)?{lat:((B=Y.coordinates)==null?void 0:B.lat)||Y.lat,lng:((O=Y.coordinates)==null?void 0:O.lng)||Y.lng}:null},[C,n.itinerary]);return Z.useEffect(()=>{if(n.itinerary&&n.itinerary.length>0){const Y=Array.from(new Set(n.itinerary.map(k=>Number(k.day)))).sort((k,B)=>k-B);if(Y.length>0){const k=Y[0],B=n.itinerary.filter(O=>O.day===k).sort((O,q)=>O.time.localeCompare(q.time));if(B.length>0){const O=B[0];if(A(O.id),x(k),s){const q=O.location||O.activity;q&&setTimeout(()=>s(q),500)}}}}},[n.id]),Z.useEffect(()=>{window.localStorage.removeItem("last_geocode_error")},[n.id]),_.jsxs("div",{className:"h-full flex flex-col pb-24",children:[_.jsxs("div",{className:"mb-4 flex gap-2 overflow-x-auto no-scrollbar py-1 shrink-0",children:[_.jsx("button",{onClick:()=>{x("ALL"),A(null)},className:`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors ${T==="ALL"?"bg-ink text-white":"bg-white text-gray-500 border border-sand"}`,children:"ALL"}),re.map(Y=>_.jsxs("button",{onClick:()=>{x(Y),A(null)},className:`px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors ${T===Y?"bg-coral text-white":"bg-white text-gray-500 border border-sand"}`,children:["Day ",Y]},Y))]}),_.jsx("div",{className:"h-[35vh] shrink-0 bg-gray-100 rounded-3xl overflow-hidden shadow-inner border border-sand relative z-0 mb-4",children:_.jsxs(TN,{center:[25.033,121.5654],zoom:13,style:{height:"100%",width:"100%"},children:[_.jsx(EN,{attribution:' <a href="https://www.google.com/maps">Google Maps</a>',url:"https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"}),_.jsx(dU,{onReady:()=>F(!0)}),he&&!fe&&!i&&_.jsx(cU,{bounds:he,isMapReady:D}),_.jsx(hU,{selectedLocation:fe,searchedLocation:i,isMapReady:D}),i&&(()=>{const Y=H.findIndex(q=>{var G,W;return((G=q.coordinates)==null?void 0:G.lat)===i.lat&&((W=q.coordinates)==null?void 0:W.lng)===i.lng||q.location===o||q.activity===o}),k=Y!==-1?H[Y]:null;if(k&&k.coordinates)return null;const B=Y!==-1?Y+1:"?",O=k?Q[(k.day-1)%Q.length]:"#FF0000";return _.jsx(cT,{position:[i.lat,i.lng],icon:Uu.divIcon({className:"custom-div-icon",html:`<div style="background-color: ${O}; width: 32px; height: 32px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px;">${B}</div>`,iconSize:[32,32],iconAnchor:[16,16]}),children:_.jsx(dT,{children:_.jsx("div",{className:"text-center font-bold",children:"Searched Location"})})})})(),H.map((Y,k)=>_.jsx(fU,{item:Y,index:k,isSelected:C===Y.id,color:Q[(Y.day-1)%Q.length],onClick:()=>A(Y.id)},Y.id||k)),re.map((Y,k)=>{if(T!=="ALL"&&T!==Y)return null;const O=X[Y].filter(q=>{var G,W;return(((G=q.coordinates)==null?void 0:G.lat)||q.lat)&&(((W=q.coordinates)==null?void 0:W.lng)||q.lng)}).map(q=>{var G,W;return[((G=q.coordinates)==null?void 0:G.lat)||q.lat,((W=q.coordinates)==null?void 0:W.lng)||q.lng]});return O.length<2?null:_.jsx(iU,{positions:O,color:Q[k%Q.length],weight:4,opacity:.7,dashArray:"10, 10"},Y)})]})}),_.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 space-y-3 px-1",children:H.map((Y,k)=>{var G,W;const B=(((G=Y.coordinates)==null?void 0:G.lat)||Y.lat)&&(((W=Y.coordinates)==null?void 0:W.lng)||Y.lng),O=l===Y.id||l==="BATCH"&&!B,q=h.has(Y.id);return _.jsxs("div",{onClick:async()=>{if(A(Y.id),x(Y.day),s){const z=Y.location||Y.activity;z&&s(z)}if(!B&&!l){if(d(Y.id),h.has(Y.id)){const z=new Set(h);z.delete(Y.id),p(z)}console.log(`[TripMap] Starting geocode for item: ${Y.activity}`);try{let z=Y.location,Ge=null;if(z&&(console.log(`[TripMap] Trying location: ${z}`),Ge=await Gh(z,e.apiKey)),Ge||(console.log(`[TripMap] Location failed or empty, trying activity: ${Y.activity}`),Ge=await Gh(Y.activity,e.apiKey)),!Ge){const $e=Y.activity.split(/[\(]/)[0].split(/|\/|\|/)[0].trim();$e&&$e!==Y.activity&&(console.log(`[TripMap] Activity failed, trying simplified: ${$e}`),Ge=await Gh($e,e.apiKey))}if(console.log("[TripMap] Final geocode result:",Ge),Ge&&t){const $e=[...n.itinerary||[]],se=$e.findIndex(Ce=>Ce.id===Y.id);se!==-1&&(console.log(`[TripMap] Updating item ${se} with coords`,Ge),$e[se]={...$e[se],coordinates:Ge,lat:Ge.lat,lng:Ge.lng},t({...n,itinerary:$e}),console.log("[TripMap] onUpdateTrip called"))}else console.warn(`[TripMap] No coords found for item ${Y.id}`),p($e=>new Set($e).add(Y.id))}catch(z){console.error("On-demand geocoding failed",z),p(Ge=>new Set(Ge).add(Y.id))}finally{d(null)}}},className:`p-4 rounded-2xl border transition-all cursor-pointer flex items-center gap-4 ${C===Y.id?"bg-coral/10 border-coral shadow-md":"bg-white border-sand hover:border-coral/50"}`,children:[_.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shrink-0 relative",style:{backgroundColor:Q[(Y.day-1)%Q.length]},children:O&&!B?_.jsx("div",{className:"absolute inset-0 border-2 border-white border-t-transparent rounded-full animate-spin"}):k+1}),_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsxs("div",{className:"flex justify-between items-start",children:[_.jsx("h3",{className:"font-bold text-ink truncate",children:Y.activity}),_.jsxs("span",{className:"text-xs font-bold text-coral bg-coral/10 px-2 py-0.5 rounded-full whitespace-nowrap",children:["Day ",Y.day]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[_.jsx("span",{className:"font-mono bg-gray-100 px-1.5 py-0.5 rounded",children:Y.time}),_.jsxs("span",{className:"truncate flex-1",children:[Y.location,O&&!B&&_.jsx("span",{className:"text-coral ml-1 text-[10px] animate-pulse",children:"..."}),q&&!B&&!O&&!(i&&(Y.location===o||Y.activity===o))&&_.jsx("span",{className:"text-red-500 ml-1 text-[10px]",children:""})]})]})]})]},Y.id||k)})})]})},pU=()=>{};var Ob={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Me=function(n,e){if(!n)throw bd(e)},bd=function(n){return new Error("Firebase Database ("+SN.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},gU=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],l=n[t++],d=n[t++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[i++]=String.fromCharCode(55296+(h>>10)),e[i++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],l=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return e.join("")},hT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const o=n[s],l=s+1<n.length,d=l?n[s+1]:0,h=s+2<n.length,p=h?n[s+2]:0,T=o>>2,x=(o&3)<<4|d>>4;let C=(d&15)<<2|p>>6,A=p&63;h||(A=64,l||(C=64)),i.push(t[T],t[x],t[C],t[A])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(CN(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gU(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],d=s<n.length?t[n.charAt(s)]:0;++s;const p=s<n.length?t[n.charAt(s)]:64;++s;const x=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||d==null||p==null||x==null)throw new _U;const C=o<<2|d>>4;if(i.push(C),p!==64){const A=d<<4&240|p>>2;if(i.push(A),x!==64){const D=p<<6&192|x;i.push(D)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class _U extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bN=function(n){const e=CN(n);return hT.encodeByteArray(e,!0)},Lp=function(n){return bN(n).replace(/\./g,"")},Vp=function(n){try{return hT.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yU(n){return IN(void 0,n)}function IN(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!vU(t)||(n[t]=IN(n[t],e[t]));return n}function vU(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AN(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TU=()=>AN().__FIREBASE_DEFAULTS__,EU=()=>{if(typeof process>"u"||typeof Ob>"u")return;const n=Ob.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},xU=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Vp(n[1]);return e&&JSON.parse(e)},Lg=()=>{try{return pU()||TU()||EU()||xU()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},NN=n=>{var e,t;return(t=(e=Lg())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},RN=n=>{const e=NN(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},MN=()=>{var n;return(n=Lg())==null?void 0:n.config},PN=n=>{var e;return(e=Lg())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gl(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function mT(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kN(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Lp(JSON.stringify(t)),Lp(JSON.stringify(l)),""].join(".")}const Hh={};function wU(){const n={prod:[],emulator:[]};for(const e of Object.keys(Hh))Hh[e]?n.emulator.push(e):n.prod.push(e);return n}function SU(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ub=!1;function pT(n,e){if(typeof window>"u"||typeof document>"u"||!gl(window.location.host)||Hh[n]===e||Hh[n]||Ub)return;Hh[n]=e;function t(C){return`__firebase__banner__${C}`}const i="__firebase__banner",o=wU().prod.length>0;function l(){const C=document.getElementById(i);C&&C.remove()}function d(C){C.style.display="flex",C.style.background="#7faaf0",C.style.position="fixed",C.style.bottom="5px",C.style.left="5px",C.style.padding=".5em",C.style.borderRadius="5px",C.style.alignItems="center"}function h(C,A){C.setAttribute("width","24"),C.setAttribute("id",A),C.setAttribute("height","24"),C.setAttribute("viewBox","0 0 24 24"),C.setAttribute("fill","none"),C.style.marginLeft="-6px"}function p(){const C=document.createElement("span");return C.style.cursor="pointer",C.style.marginLeft="16px",C.style.fontSize="24px",C.innerHTML=" &times;",C.onclick=()=>{Ub=!0,l()},C}function T(C,A){C.setAttribute("id",A),C.innerText="Learn more",C.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",C.setAttribute("target","__blank"),C.style.paddingLeft="5px",C.style.textDecoration="underline"}function x(){const C=SU(i),A=t("text"),D=document.getElementById(A)||document.createElement("span"),F=t("learnmore"),H=document.getElementById(F)||document.createElement("a"),X=t("preprendIcon"),re=document.getElementById(X)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(C.created){const Q=C.element;d(Q),T(H,F);const he=p();h(re,X),Q.append(re,D,H,he),document.body.appendChild(Q)}o?(D.innerText="Preview backend disconnected.",re.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(re.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",x):x()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ii(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ii())}function DN(){var e;const n=(e=Lg())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function CU(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bU(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function LN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function IU(){const n=ii();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function AU(){return SN.NODE_ADMIN===!0}function VN(){return!DN()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ON(){return!DN()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function UN(){try{return typeof indexedDB=="object"}catch{return!1}}function NU(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU="FirebaseError";class na extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=RU,Object.setPrototypeOf(this,na.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nf.prototype.create)}}class Nf{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],l=o?MU(o,i):"Error",d=`${this.serviceName}: ${l} (${s}).`;return new na(s,d,i)}}function MU(n,e){return n.replace(PU,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const PU=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uf(n){return JSON.parse(n)}function yi(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=function(n){let e={},t={},i={},s="";try{const o=n.split(".");e=uf(Vp(o[0])||""),t=uf(Vp(o[1])||""),s=o[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}},kU=function(n){const e=FN(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},DU=function(n){const e=FN(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ed(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Wv(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Op(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function Wo(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const o=n[s],l=e[s];if(Fb(o)&&Fb(l)){if(!Wo(o,l))return!1}else if(o!==l)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function Fb(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let x=0;x<16;x++)i[x]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let x=0;x<16;x++)i[x]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let x=16;x<80;x++){const C=i[x-3]^i[x-8]^i[x-14]^i[x-16];i[x]=(C<<1|C>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],l=this.chain_[2],d=this.chain_[3],h=this.chain_[4],p,T;for(let x=0;x<80;x++){x<40?x<20?(p=d^o&(l^d),T=1518500249):(p=o^l^d,T=1859775393):x<60?(p=o&l|d&(o|l),T=2400959708):(p=o^l^d,T=3395469782);const C=(s<<5|s>>>27)+p+h+T+i[x]&4294967295;h=d,d=l,l=(o<<30|o>>>2)&4294967295,o=s,s=C}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+d&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let s=0;const o=this.buf_;let l=this.inbuf_;for(;s<t;){if(l===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(o[l]=e.charCodeAt(s),++l,++s,l===this.blockSize){this.compress_(o),l=0;break}}else for(;s<t;)if(o[l]=e[s],++l,++s,l===this.blockSize){this.compress_(o),l=0;break}}this.inbuf_=l,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let o=24;o>=0;o-=8)e[i]=this.chain_[s]>>o&255,++i;return e}}function VU(n,e){const t=new OU(n,e);return t.subscribe.bind(t)}class OU{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");UU(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=hv),s.error===void 0&&(s.error=hv),s.complete===void 0&&(s.complete=hv);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function UU(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function hv(){}function BN(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FU=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const o=s-55296;i++,Me(i<n.length,"Surrogate pair missing trail surrogate.");const l=n.charCodeAt(i)-56320;s=65536+(o<<10)+l}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Vg=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n){return n&&n._delegate?n._delegate:n}class ll{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new fT;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(qU(e))try{this.getOrInitializeService({instanceIdentifier:su})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(e=su){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=su){return this.instances.has(e)}getOptions(e=su){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);i===d&&l.resolve(s)}return s}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:zU(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=su){return this.component?this.component.multipleInstances?e:su:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zU(n){return n===su?void 0:n}function qU(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new BU(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(bt||(bt={}));const HU={debug:bt.DEBUG,verbose:bt.VERBOSE,info:bt.INFO,warn:bt.WARN,error:bt.ERROR,silent:bt.SILENT},jU=bt.INFO,KU={[bt.DEBUG]:"log",[bt.VERBOSE]:"log",[bt.INFO]:"info",[bt.WARN]:"warn",[bt.ERROR]:"error"},WU=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=KU[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Og{constructor(e){this.name=e,this._logLevel=jU,this._logHandler=WU,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in bt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?HU[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,bt.DEBUG,...e),this._logHandler(this,bt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,bt.VERBOSE,...e),this._logHandler(this,bt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,bt.INFO,...e),this._logHandler(this,bt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,bt.WARN,...e),this._logHandler(this,bt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,bt.ERROR,...e),this._logHandler(this,bt.ERROR,...e)}}const YU=(n,e)=>e.some(t=>n instanceof t);let Bb,zb;function JU(){return Bb||(Bb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ZU(){return zb||(zb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zN=new WeakMap,Yv=new WeakMap,qN=new WeakMap,fv=new WeakMap,_T=new WeakMap;function QU(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",l)},o=()=>{t(el(n.result)),s()},l=()=>{i(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&zN.set(t,n)}).catch(()=>{}),_T.set(e,n),e}function $U(n){if(Yv.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",l),n.removeEventListener("abort",l)},o=()=>{t(),s()},l=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",l),n.addEventListener("abort",l)});Yv.set(n,e)}let Jv={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Yv.get(n);if(e==="objectStoreNames")return n.objectStoreNames||qN.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return el(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function XU(n){Jv=n(Jv)}function eF(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(mv(this),e,...t);return qN.set(i,e.sort?e.sort():[e]),el(i)}:ZU().includes(n)?function(...e){return n.apply(mv(this),e),el(zN.get(this))}:function(...e){return el(n.apply(mv(this),e))}}function tF(n){return typeof n=="function"?eF(n):(n instanceof IDBTransaction&&$U(n),YU(n,JU())?new Proxy(n,Jv):n)}function el(n){if(n instanceof IDBRequest)return QU(n);if(fv.has(n))return fv.get(n);const e=tF(n);return e!==n&&(fv.set(n,e),_T.set(e,n)),e}const mv=n=>_T.get(n);function nF(n,e,{blocked:t,upgrade:i,blocking:s,terminated:o}={}){const l=indexedDB.open(n,e),d=el(l);return i&&l.addEventListener("upgradeneeded",h=>{i(el(l.result),h.oldVersion,h.newVersion,el(l.transaction),h)}),t&&l.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",p=>s(p.oldVersion,p.newVersion,p))}).catch(()=>{}),d}const iF=["get","getKey","getAll","getAllKeys","count"],sF=["put","add","delete","clear"],pv=new Map;function qb(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(pv.get(e))return pv.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=sF.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||iF.includes(t)))return;const o=async function(l,...d){const h=this.transaction(l,s?"readwrite":"readonly");let p=h.store;return i&&(p=p.index(d.shift())),(await Promise.all([p[t](...d),s&&h.done]))[0]};return pv.set(e,o),o}XU(n=>({...n,get:(e,t,i)=>qb(e,t)||n.get(e,t,i),has:(e,t)=>!!qb(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(oF(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function oF(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Zv="@firebase/app",Gb="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo=new Og("@firebase/app"),aF="@firebase/app-compat",lF="@firebase/analytics-compat",uF="@firebase/analytics",cF="@firebase/app-check-compat",dF="@firebase/app-check",hF="@firebase/auth",fF="@firebase/auth-compat",mF="@firebase/database",pF="@firebase/data-connect",gF="@firebase/database-compat",_F="@firebase/functions",yF="@firebase/functions-compat",vF="@firebase/installations",TF="@firebase/installations-compat",EF="@firebase/messaging",xF="@firebase/messaging-compat",wF="@firebase/performance",SF="@firebase/performance-compat",CF="@firebase/remote-config",bF="@firebase/remote-config-compat",IF="@firebase/storage",AF="@firebase/storage-compat",NF="@firebase/firestore",RF="@firebase/ai",MF="@firebase/firestore-compat",PF="firebase",kF="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv="[DEFAULT]",DF={[Zv]:"fire-core",[aF]:"fire-core-compat",[uF]:"fire-analytics",[lF]:"fire-analytics-compat",[dF]:"fire-app-check",[cF]:"fire-app-check-compat",[hF]:"fire-auth",[fF]:"fire-auth-compat",[mF]:"fire-rtdb",[pF]:"fire-data-connect",[gF]:"fire-rtdb-compat",[_F]:"fire-fn",[yF]:"fire-fn-compat",[vF]:"fire-iid",[TF]:"fire-iid-compat",[EF]:"fire-fcm",[xF]:"fire-fcm-compat",[wF]:"fire-perf",[SF]:"fire-perf-compat",[CF]:"fire-rc",[bF]:"fire-rc-compat",[IF]:"fire-gcs",[AF]:"fire-gcs-compat",[NF]:"fire-fst",[MF]:"fire-fst-compat",[RF]:"fire-vertex","fire-js":"fire-js",[PF]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up=new Map,LF=new Map,$v=new Map;function Hb(n,e){try{n.container.addComponent(e)}catch(t){Yo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function xu(n){const e=n.name;if($v.has(e))return Yo.debug(`There were multiple attempts to register component ${e}.`),!1;$v.set(e,n);for(const t of Up.values())Hb(t,n);for(const t of LF.values())Hb(t,n);return!0}function Ug(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ar(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VF={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},tl=new Nf("app","Firebase",VF);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OF{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ll("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu=kF;function GN(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:Qv,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw tl.create("bad-app-name",{appName:String(s)});if(t||(t=MN()),!t)throw tl.create("no-options");const o=Up.get(s);if(o){if(Wo(t,o.options)&&Wo(i,o.config))return o;throw tl.create("duplicate-app",{appName:s})}const l=new GU(s);for(const h of $v.values())l.addComponent(h);const d=new OF(t,i,l);return Up.set(s,d),d}function yT(n=Qv){const e=Up.get(n);if(!e&&n===Qv&&MN())return GN();if(!e)throw tl.create("no-app",{appName:n});return e}function ro(n,e,t){let i=DF[n]??n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yo.warn(l.join(" "));return}xu(new ll(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF="firebase-heartbeat-database",FF=1,cf="firebase-heartbeat-store";let gv=null;function HN(){return gv||(gv=nF(UF,FF,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(cf)}catch(t){console.warn(t)}}}}).catch(n=>{throw tl.create("idb-open",{originalErrorMessage:n.message})})),gv}async function BF(n){try{const t=(await HN()).transaction(cf),i=await t.objectStore(cf).get(jN(n));return await t.done,i}catch(e){if(e instanceof na)Yo.warn(e.message);else{const t=tl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Yo.warn(t.message)}}}async function jb(n,e){try{const i=(await HN()).transaction(cf,"readwrite");await i.objectStore(cf).put(e,jN(n)),await i.done}catch(t){if(t instanceof na)Yo.warn(t.message);else{const i=tl.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Yo.warn(i.message)}}}function jN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zF=1024,qF=30;class GF{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new jF(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Kb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(l=>l.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>qF){const l=KF(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Yo.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Kb(),{heartbeatsToSend:i,unsentEntries:s}=HF(this._heartbeatsCache.heartbeats),o=Lp(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Yo.warn(t),""}}}function Kb(){return new Date().toISOString().substring(0,10)}function HF(n,e=zF){const t=[];let i=n.slice();for(const s of n){const o=t.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Wb(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Wb(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class jF{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return UN()?NU().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await BF(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return jb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return jb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Wb(n){return Lp(JSON.stringify({version:2,heartbeats:n})).length}function KF(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WF(n){xu(new ll("platform-logger",e=>new rF(e),"PRIVATE")),xu(new ll("heartbeat",e=>new GF(e),"PRIVATE")),ro(Zv,Gb,n),ro(Zv,Gb,"esm2020"),ro("fire-js","")}WF("");var YF="firebase",JF="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ro(YF,JF,"app");function KN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ZF=KN,WN=new Nf("auth","Firebase",KN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp=new Og("@firebase/auth");function QF(n,...e){Fp.logLevel<=bt.WARN&&Fp.warn(`Auth (${Fu}): ${n}`,...e)}function hp(n,...e){Fp.logLevel<=bt.ERROR&&Fp.error(`Auth (${Fu}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uo(n,...e){throw TT(n,...e)}function Rr(n,...e){return TT(n,...e)}function vT(n,e,t){const i={...ZF(),[e]:t};return new Nf("auth","Firebase",i).create(e,{appName:n.name})}function gu(n){return vT(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $F(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&uo(n,"argument-error"),vT(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function TT(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return WN.create(n,...e)}function at(n,e,...t){if(!n)throw TT(e,...t)}function Bo(n){const e="INTERNAL ASSERTION FAILED: "+n;throw hp(e),new Error(e)}function Jo(n,e){n||Bo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function XF(){return Yb()==="http:"||Yb()==="https:"}function Yb(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e9(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(XF()||bU()||"connection"in navigator)?navigator.onLine:!0}function t9(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,t){this.shortDelay=e,this.longDelay=t,Jo(t>e,"Short delay should be less than long delay!"),this.isMobile=gT()||LN()}get(){return e9()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ET(n,e){Jo(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Bo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Bo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Bo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i9=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],s9=new Rf(3e4,6e4);function xT(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Ad(n,e,t,i,s={}){return JN(n,s,async()=>{let o={},l={};i&&(e==="GET"?l=i:o={body:JSON.stringify(i)});const d=Id({key:n.config.apiKey,...l}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const p={method:e,headers:h,...o};return CU()||(p.referrerPolicy="no-referrer"),n.emulatorConfig&&gl(n.emulatorConfig.host)&&(p.credentials="include"),YN.fetch()(await ZN(n,n.config.apiHost,t,d),p)})}async function JN(n,e,t){n._canInitEmulator=!1;const i={...n9,...e};try{const s=new o9(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Xm(n,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,p]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xm(n,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Xm(n,"email-already-in-use",l);if(h==="USER_DISABLED")throw Xm(n,"user-disabled",l);const T=i[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw vT(n,T,p);uo(n,T)}}catch(s){if(s instanceof na)throw s;uo(n,"network-request-failed",{message:String(s)})}}async function r9(n,e,t,i,s={}){const o=await Ad(n,e,t,i,s);return"mfaPendingCredential"in o&&uo(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function ZN(n,e,t,i){const s=`${e}${t}?${i}`,o=n,l=o.config.emulator?ET(n.config,s):`${n.config.apiScheme}://${s}`;return i9.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}class o9{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Rr(this.auth,"network-request-failed")),s9.get())})}}function Xm(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=Rr(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a9(n,e){return Ad(n,"POST","/v1/accounts:delete",e)}async function Bp(n,e){return Ad(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function l9(n,e=!1){const t=Un(n),i=await t.getIdToken(e),s=wT(i);at(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,l=o==null?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:jh(_v(s.auth_time)),issuedAtTime:jh(_v(s.iat)),expirationTime:jh(_v(s.exp)),signInProvider:l||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function _v(n){return Number(n)*1e3}function wT(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return hp("JWT malformed, contained fewer than 3 sections"),null;try{const s=Vp(t);return s?JSON.parse(s):(hp("Failed to decode base64 JWT payload"),null)}catch(s){return hp("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Jb(n){const e=wT(n);return at(e,"internal-error"),at(typeof e.exp<"u","internal-error"),at(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function df(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof na&&u9(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function u9({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=jh(this.lastLoginAt),this.creationTime=jh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zp(n){var x;const e=n.auth,t=await n.getIdToken(),i=await df(n,Bp(e,{idToken:t}));at(i==null?void 0:i.users.length,e,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=(x=s.providerUserInfo)!=null&&x.length?QN(s.providerUserInfo):[],l=h9(n.providerData,o),d=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!(l!=null&&l.length),p=d?h:!1,T={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new e0(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,T)}async function d9(n){const e=Un(n);await zp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function h9(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function QN(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f9(n,e){const t=await JN(n,{},async()=>{const i=Id({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,l=await ZN(n,s,"/v1/token",`key=${o}`),d=await n._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:i};return n.emulatorConfig&&gl(n.emulatorConfig.host)&&(h.credentials="include"),YN.fetch()(l,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function m9(n,e){return Ad(n,"POST","/v2/accounts:revokeToken",xT(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){at(e.idToken,"internal-error"),at(typeof e.idToken<"u","internal-error"),at(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Jb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){at(e.length!==0,"internal-error");const t=Jb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(at(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:o}=await f9(e,t);this.updateTokensAndExpiration(i,s,Number(o))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:o}=t,l=new Kc;return i&&(at(typeof i=="string","internal-error",{appName:e}),l.refreshToken=i),s&&(at(typeof s=="string","internal-error",{appName:e}),l.accessToken=s),o&&(at(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Kc,this.toJSON())}_performRefresh(){return Bo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(n,e){at(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ir{constructor({uid:e,auth:t,stsTokenManager:i,...s}){this.providerId="firebase",this.proactiveRefresh=new c9(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new e0(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await df(this,this.stsTokenManager.getToken(this.auth,e));return at(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return l9(this,e)}reload(){return d9(this)}_assign(e){this!==e&&(at(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ir({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){at(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await zp(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ar(this.auth.app))return Promise.reject(gu(this.auth));const e=await this.getIdToken();return await df(this,a9(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,l=t.photoURL??void 0,d=t.tenantId??void 0,h=t._redirectEventId??void 0,p=t.createdAt??void 0,T=t.lastLoginAt??void 0,{uid:x,emailVerified:C,isAnonymous:A,providerData:D,stsTokenManager:F}=t;at(x&&F,e,"internal-error");const H=Kc.fromJSON(this.name,F);at(typeof x=="string",e,"internal-error"),Ga(i,e.name),Ga(s,e.name),at(typeof C=="boolean",e,"internal-error"),at(typeof A=="boolean",e,"internal-error"),Ga(o,e.name),Ga(l,e.name),Ga(d,e.name),Ga(h,e.name),Ga(p,e.name),Ga(T,e.name);const X=new Ir({uid:x,auth:e,email:s,emailVerified:C,displayName:i,isAnonymous:A,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:H,createdAt:p,lastLoginAt:T});return D&&Array.isArray(D)&&(X.providerData=D.map(re=>({...re}))),h&&(X._redirectEventId=h),X}static async _fromIdTokenResponse(e,t,i=!1){const s=new Kc;s.updateFromServerResponse(t);const o=new Ir({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await zp(o),o}static async _fromGetAccountInfoResponse(e,t,i){const s=t.users[0];at(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?QN(s.providerUserInfo):[],l=!(s.email&&s.passwordHash)&&!(o!=null&&o.length),d=new Kc;d.updateFromIdToken(i);const h=new Ir({uid:s.localId,auth:e,stsTokenManager:d,isAnonymous:l}),p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new e0(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(o!=null&&o.length)};return Object.assign(h,p),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zb=new Map;function zo(n){Jo(n instanceof Function,"Expected a class definition");let e=Zb.get(n);return e?(Jo(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Zb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$N.type="NONE";const Qb=$N;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(n,e,t){return`firebase:${n}:${e}:${t}`}class Wc{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:o}=this.auth;this.fullUserKey=fp(this.userKey,s.apiKey,o),this.fullPersistenceKey=fp("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Bp(this.auth,{idToken:e}).catch(()=>{});return t?Ir._fromGetAccountInfoResponse(this.auth,t,e):null}return Ir._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Wc(zo(Qb),e,i);const s=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let o=s[0]||zo(Qb);const l=fp(i,e.config.apiKey,e.name);let d=null;for(const p of t)try{const T=await p._get(l);if(T){let x;if(typeof T=="string"){const C=await Bp(e,{idToken:T}).catch(()=>{});if(!C)break;x=await Ir._fromGetAccountInfoResponse(e,C,T)}else x=Ir._fromJSON(e,T);p!==o&&(d=x),o=p;break}}catch{}const h=s.filter(p=>p._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Wc(o,e,i):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(t.map(async p=>{if(p!==o)try{await p._remove(l)}catch{}})),new Wc(o,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $b(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nR(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(XN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sR(e))return"Blackberry";if(rR(e))return"Webos";if(eR(e))return"Safari";if((e.includes("chrome/")||tR(e))&&!e.includes("edge/"))return"Chrome";if(iR(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function XN(n=ii()){return/firefox\//i.test(n)}function eR(n=ii()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tR(n=ii()){return/crios\//i.test(n)}function nR(n=ii()){return/iemobile/i.test(n)}function iR(n=ii()){return/android/i.test(n)}function sR(n=ii()){return/blackberry/i.test(n)}function rR(n=ii()){return/webos/i.test(n)}function ST(n=ii()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function p9(n=ii()){var e;return ST(n)&&!!((e=window.navigator)!=null&&e.standalone)}function g9(){return IU()&&document.documentMode===10}function oR(n=ii()){return ST(n)||iR(n)||rR(n)||sR(n)||/windows phone/i.test(n)||nR(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(n,e=[]){let t;switch(n){case"Browser":t=$b(ii());break;case"Worker":t=`${$b(ii())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Fu}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _9{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y9(n,e={}){return Ad(n,"GET","/v2/passwordPolicy",xT(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v9=6;class T9{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??v9,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xb(this),this.idTokenSubscription=new Xb(this),this.beforeStateQueue=new _9(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=WN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zo(t)),this._initializationPromise=this.queue(async()=>{var i,s,o;if(!this._deleted&&(this.persistenceManager=await Wc.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)==null?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Bp(this,{idToken:e}),i=await Ir._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var o;if(ar(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(d=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(d,d))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=(o=this.redirectUser)==null?void 0:o._redirectEventId,d=i==null?void 0:i._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===d)&&(h!=null&&h.user)&&(i=h.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(l){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return at(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await zp(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=t9()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ar(this.app))return Promise.reject(gu(this));const t=e?Un(e):null;return t&&at(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&at(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ar(this.app)?Promise.reject(gu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ar(this.app)?Promise.reject(gu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await y9(this),t=new T9(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Nf("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await m9(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&zo(e)||this._popupRedirectResolver;at(t,this,"argument-error"),this.redirectPersistenceManager=await Wc.create(this,[zo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(at(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,i,s);return()=>{l=!0,h()}}else{const h=e.addObserver(t);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return at(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=aR(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(ar(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&QF(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Fg(n){return Un(n)}class Xb{constructor(e){this.auth=e,this.observer=null,this.addObserver=VU(t=>this.observer=t)}get next(){return at(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let CT={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function x9(n){CT=n}function w9(n){return CT.loadJS(n)}function S9(){return CT.gapiScript}function C9(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b9(n,e){const t=Ug(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(Wo(o,e??{}))return s;uo(s,"already-initialized")}return t.initialize({options:e})}function I9(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(zo);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function A9(n,e,t){const i=Fg(n);at(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!1,o=lR(e),{host:l,port:d}=N9(e),h=d===null?"":`:${d}`,p={url:`${o}//${l}${h}/`},T=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator){at(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),at(Wo(p,i.config.emulator)&&Wo(T,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=p,i.emulatorConfig=T,i.settings.appVerificationDisabledForTesting=!0,gl(l)?(mT(`${o}//${l}${h}`),pT("Auth",!0)):R9()}function lR(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function N9(n){const e=lR(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const o=s[1];return{host:o,port:eI(i.substr(o.length+1))}}else{const[o,l]=i.split(":");return{host:o,port:eI(l)}}}function eI(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function R9(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Bo("not implemented")}_getIdTokenResponse(e){return Bo("not implemented")}_linkToIdToken(e,t){return Bo("not implemented")}_getReauthenticationResolver(e){return Bo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yc(n,e){return r9(n,"POST","/v1/accounts:signInWithIdp",xT(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M9="http://localhost";class wu extends uR{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new wu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):uo("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s,...o}=t;if(!i||!s)return null;const l=new wu(i,s);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const t=this.buildRequest();return Yc(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Yc(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Yc(e,t)}buildRequest(){const e={requestUri:M9,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Id(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends bT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa extends Mf{constructor(){super("facebook.com")}static credential(e){return wu._fromParams({providerId:Wa.PROVIDER_ID,signInMethod:Wa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wa.credentialFromTaggedObject(e)}static credentialFromError(e){return Wa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wa.credential(e.oauthAccessToken)}catch{return null}}}Wa.FACEBOOK_SIGN_IN_METHOD="facebook.com";Wa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo extends Mf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return wu._fromParams({providerId:Fo.PROVIDER_ID,signInMethod:Fo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Fo.credentialFromTaggedObject(e)}static credentialFromError(e){return Fo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Fo.credential(t,i)}catch{return null}}}Fo.GOOGLE_SIGN_IN_METHOD="google.com";Fo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya extends Mf{constructor(){super("github.com")}static credential(e){return wu._fromParams({providerId:Ya.PROVIDER_ID,signInMethod:Ya.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ya.credentialFromTaggedObject(e)}static credentialFromError(e){return Ya.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ya.credential(e.oauthAccessToken)}catch{return null}}}Ya.GITHUB_SIGN_IN_METHOD="github.com";Ya.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja extends Mf{constructor(){super("twitter.com")}static credential(e,t){return wu._fromParams({providerId:Ja.PROVIDER_ID,signInMethod:Ja.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ja.credentialFromTaggedObject(e)}static credentialFromError(e){return Ja.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Ja.credential(t,i)}catch{return null}}}Ja.TWITTER_SIGN_IN_METHOD="twitter.com";Ja.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const o=await Ir._fromIdTokenResponse(e,i,s),l=tI(i);return new td({user:o,providerId:l,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=tI(i);return new td({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function tI(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp extends na{constructor(e,t,i,s){super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,qp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new qp(e,t,i,s)}}function cR(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?qp._fromErrorAndOperation(n,o,e,i):o})}async function P9(n,e,t=!1){const i=await df(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return td._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k9(n,e,t=!1){const{auth:i}=n;if(ar(i.app))return Promise.reject(gu(i));const s="reauthenticate";try{const o=await df(n,cR(i,s,e,n),t);at(o.idToken,i,"internal-error");const l=wT(o.idToken);at(l,i,"internal-error");const{sub:d}=l;return at(n.uid===d,i,"user-mismatch"),td._forOperation(n,s,o)}catch(o){throw(o==null?void 0:o.code)==="auth/user-not-found"&&uo(i,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D9(n,e,t=!1){if(ar(n.app))return Promise.reject(gu(n));const i="signIn",s=await cR(n,i,e),o=await td._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(o.user),o}function L9(n,e,t,i){return Un(n).onIdTokenChanged(e,t,i)}function V9(n,e,t){return Un(n).beforeAuthStateChanged(e,t)}function O9(n,e,t,i){return Un(n).onAuthStateChanged(e,t,i)}function U9(n){return Un(n).signOut()}const Gp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gp,"1"),this.storage.removeItem(Gp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F9=1e3,B9=10;class hR extends dR{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oR(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const i=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const l=this.storage.getItem(i);!t&&this.localCache[i]===l||this.notifyListeners(i,l)},o=this.storage.getItem(i);g9()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,B9):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},F9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}hR.type="LOCAL";const z9=hR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR extends dR{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}fR.type="SESSION";const mR=fR;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q9(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Bg(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:o}=t.data,l=this.handlersMap[s];if(!(l!=null&&l.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const d=Array.from(l).map(async p=>p(t.origin,o)),h=await q9(d);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Bg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IT(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G9{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const p=IT("",20);s.port1.start();const T=setTimeout(()=>{h(new Error("unsupported_event"))},i);l={messageChannel:s,onMessage(x){const C=x;if(C.data.eventId===p)switch(C.data.status){case"ack":clearTimeout(T),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(C.data.response);break;default:clearTimeout(T),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),s.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[s.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oo(){return window}function H9(n){oo().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pR(){return typeof oo().WorkerGlobalScope<"u"&&typeof oo().importScripts=="function"}async function j9(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function K9(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function W9(){return pR()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gR="firebaseLocalStorageDb",Y9=1,Hp="firebaseLocalStorage",_R="fbase_key";class Pf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zg(n,e){return n.transaction([Hp],e?"readwrite":"readonly").objectStore(Hp)}function J9(){const n=indexedDB.deleteDatabase(gR);return new Pf(n).toPromise()}function t0(){const n=indexedDB.open(gR,Y9);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Hp,{keyPath:_R})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Hp)?e(i):(i.close(),await J9(),e(await t0()))})})}async function nI(n,e,t){const i=zg(n,!0).put({[_R]:e,value:t});return new Pf(i).toPromise()}async function Z9(n,e){const t=zg(n,!1).get(e),i=await new Pf(t).toPromise();return i===void 0?null:i.value}function iI(n,e){const t=zg(n,!0).delete(e);return new Pf(t).toPromise()}const Q9=800,$9=3;class yR{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await t0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>$9)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pR()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Bg._getInstance(W9()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await j9(),!this.activeServiceWorker)return;this.sender=new G9(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||K9()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await t0();return await nI(e,Gp,"1"),await iI(e,Gp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>nI(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>Z9(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iI(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=zg(s,!1).getAll();return new Pf(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Q9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}yR.type="LOCAL";const X9=yR;new Rf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vR(n,e){return e?zo(e):(at(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT extends uR{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yc(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function eB(n){return D9(n.auth,new AT(n),n.bypassAuthState)}function tB(n){const{auth:e,user:t}=n;return at(t,e,"internal-error"),k9(t,new AT(n),n.bypassAuthState)}async function nB(n){const{auth:e,user:t}=n;return at(t,e,"internal-error"),P9(t,new AT(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e,t,i,s,o=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:t,sessionId:i,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return eB;case"linkViaPopup":case"linkViaRedirect":return nB;case"reauthViaPopup":case"reauthViaRedirect":return tB;default:uo(this.auth,"internal-error")}}resolve(e){Jo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iB=new Rf(2e3,1e4);async function sB(n,e,t){if(ar(n.app))return Promise.reject(Rr(n,"operation-not-supported-in-this-environment"));const i=Fg(n);$F(n,e,bT);const s=vR(i,t);return new fu(i,"signInViaPopup",e,s).executeNotNull()}class fu extends TR{constructor(e,t,i,s,o){super(e,t,s,o),this.provider=i,this.authWindow=null,this.pollId=null,fu.currentPopupAction&&fu.currentPopupAction.cancel(),fu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return at(e,this.auth,"internal-error"),e}async onExecution(){Jo(this.filter.length===1,"Popup operations only handle one event");const e=IT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Rr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Rr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,iB.get())};e()}}fu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rB="pendingRedirect",mp=new Map;class oB extends TR{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=mp.get(this.auth._key());if(!e){try{const i=await aB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}mp.set(this.auth._key(),e)}return this.bypassAuthState||mp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function aB(n,e){const t=cB(e),i=uB(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function lB(n,e){mp.set(n._key(),e)}function uB(n){return zo(n._redirectPersistence)}function cB(n){return fp(rB,n.config.apiKey,n.name)}async function dB(n,e,t=!1){if(ar(n.app))return Promise.reject(gu(n));const i=Fg(n),s=vR(i,e),l=await new oB(i,s,t).execute();return l&&!t&&(delete l.user._redirectEventId,await i._persistUserIfCurrent(l.user),await i._setRedirectUser(null,e)),l}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hB=600*1e3;class fB{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mB(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!ER(e)){const s=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(Rr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hB&&this.cachedEventUids.clear(),this.cachedEventUids.has(sI(e))}saveEventToCache(e){this.cachedEventUids.add(sI(e)),this.lastProcessedEventTime=Date.now()}}function sI(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ER({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function mB(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ER(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pB(n,e={}){return Ad(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_B=/^https?/;async function yB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await pB(n);for(const t of e)try{if(vB(t))return}catch{}uo(n,"unauthorized-domain")}function vB(n){const e=Xv(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const l=new URL(n);return l.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&l.hostname===i}if(!_B.test(t))return!1;if(gB.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TB=new Rf(3e4,6e4);function rI(){const n=oo().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function EB(n){return new Promise((e,t)=>{var s,o,l;function i(){rI(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rI(),t(Rr(n,"network-request-failed"))},timeout:TB.get()})}if((o=(s=oo().gapi)==null?void 0:s.iframes)!=null&&o.Iframe)e(gapi.iframes.getContext());else if((l=oo().gapi)!=null&&l.load)i();else{const d=C9("iframefcb");return oo()[d]=()=>{gapi.load?i():t(Rr(n,"network-request-failed"))},w9(`${S9()}?onload=${d}`).catch(h=>t(h))}}).catch(e=>{throw pp=null,e})}let pp=null;function xB(n){return pp=pp||EB(n),pp}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wB=new Rf(5e3,15e3),SB="__/auth/iframe",CB="emulator/auth/iframe",bB={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},IB=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AB(n){const e=n.config;at(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ET(e,CB):`https://${n.config.authDomain}/${SB}`,i={apiKey:e.apiKey,appName:n.name,v:Fu},s=IB.get(n.config.apiHost);s&&(i.eid=s);const o=n._getFrameworks();return o.length&&(i.fw=o.join(",")),`${t}?${Id(i).slice(1)}`}async function NB(n){const e=await xB(n),t=oo().gapi;return at(t,n,"internal-error"),e.open({where:document.body,url:AB(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bB,dontclear:!0},i=>new Promise(async(s,o)=>{await i.restyle({setHideOnLeave:!1});const l=Rr(n,"network-request-failed"),d=oo().setTimeout(()=>{o(l)},wB.get());function h(){oo().clearTimeout(d),s(i)}i.ping(h).then(h,()=>{o(l)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},MB=500,PB=600,kB="_blank",DB="http://localhost";class oI{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function LB(n,e,t,i=MB,s=PB){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),l=Math.max((window.screen.availWidth-i)/2,0).toString();let d="";const h={...RB,width:i.toString(),height:s.toString(),top:o,left:l},p=ii().toLowerCase();t&&(d=tR(p)?kB:t),XN(p)&&(e=e||DB,h.scrollbars="yes");const T=Object.entries(h).reduce((C,[A,D])=>`${C}${A}=${D},`,"");if(p9(p)&&d!=="_self")return VB(e||"",d),new oI(null);const x=window.open(e||"",d,T);at(x,n,"popup-blocked");try{x.focus()}catch{}return new oI(x)}function VB(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OB="__/auth/handler",UB="emulator/auth/handler",FB=encodeURIComponent("fac");async function aI(n,e,t,i,s,o){at(n.config.authDomain,n,"auth-domain-config-required"),at(n.config.apiKey,n,"invalid-api-key");const l={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Fu,eventId:s};if(e instanceof bT){e.setDefaultLanguage(n.languageCode),l.providerId=e.providerId||"",Wv(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[T,x]of Object.entries({}))l[T]=x}if(e instanceof Mf){const T=e.getScopes().filter(x=>x!=="");T.length>0&&(l.scopes=T.join(","))}n.tenantId&&(l.tid=n.tenantId);const d=l;for(const T of Object.keys(d))d[T]===void 0&&delete d[T];const h=await n._getAppCheckToken(),p=h?`#${FB}=${encodeURIComponent(h)}`:"";return`${BB(n)}?${Id(d).slice(1)}${p}`}function BB({config:n}){return n.emulator?ET(n,UB):`https://${n.authDomain}/${OB}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yv="webStorageSupport";class zB{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mR,this._completeRedirectFn=dB,this._overrideRedirectResult=lB}async _openPopup(e,t,i,s){var l;Jo((l=this.eventManagers[e._key()])==null?void 0:l.manager,"_initialize() not called before _openPopup()");const o=await aI(e,t,i,Xv(),s);return LB(e,o,IT())}async _openRedirect(e,t,i,s){await this._originValidation(e);const o=await aI(e,t,i,Xv(),s);return H9(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(Jo(o,"If manager is not set, promise should be"),o)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await NB(e),i=new fB(e);return t.register("authEvent",s=>(at(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yv,{type:yv},s=>{var l;const o=(l=s==null?void 0:s[0])==null?void 0:l[yv];o!==void 0&&t(!!o),uo(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oR()||eR()||ST()}}const qB=zB;var lI="@firebase/auth",uI="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){at(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HB(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function jB(n){xu(new ll("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=i.options;at(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});const h={apiKey:l,authDomain:d,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:aR(n)},p=new E9(i,s,o,h);return I9(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),xu(new ll("auth-internal",e=>{const t=Fg(e.getProvider("auth").getImmediate());return(i=>new GB(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ro(lI,uI,HB(n)),ro(lI,uI,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB=300,WB=PN("authIdTokenMaxAge")||KB;let cI=null;const YB=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>WB)return;const s=t==null?void 0:t.token;cI!==s&&(cI=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function JB(n=yT()){const e=Ug(n,"auth");if(e.isInitialized())return e.getImmediate();const t=b9(n,{popupRedirectResolver:qB,persistence:[X9,z9,mR]}),i=PN("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(i,location.origin);if(location.origin===o.origin){const l=YB(o.toString());V9(t,l,()=>l(t.currentUser)),L9(t,d=>l(d))}}const s=NN("auth");return s&&A9(t,`http://${s}`),t}function ZB(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}x9({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const o=Rr("internal-error");o.customData=s,t(o)},i.type="text/javascript",i.charset="UTF-8",ZB().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});jB("Browser");var dI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var nl,xR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,B){function O(){}O.prototype=B.prototype,k.F=B.prototype,k.prototype=new O,k.prototype.constructor=k,k.D=function(q,G,W){for(var z=Array(arguments.length-2),Ge=2;Ge<arguments.length;Ge++)z[Ge-2]=arguments[Ge];return B.prototype[G].apply(q,z)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,B,O){O||(O=0);const q=Array(16);if(typeof B=="string")for(var G=0;G<16;++G)q[G]=B.charCodeAt(O++)|B.charCodeAt(O++)<<8|B.charCodeAt(O++)<<16|B.charCodeAt(O++)<<24;else for(G=0;G<16;++G)q[G]=B[O++]|B[O++]<<8|B[O++]<<16|B[O++]<<24;B=k.g[0],O=k.g[1],G=k.g[2];let W=k.g[3],z;z=B+(W^O&(G^W))+q[0]+3614090360&4294967295,B=O+(z<<7&4294967295|z>>>25),z=W+(G^B&(O^G))+q[1]+3905402710&4294967295,W=B+(z<<12&4294967295|z>>>20),z=G+(O^W&(B^O))+q[2]+606105819&4294967295,G=W+(z<<17&4294967295|z>>>15),z=O+(B^G&(W^B))+q[3]+3250441966&4294967295,O=G+(z<<22&4294967295|z>>>10),z=B+(W^O&(G^W))+q[4]+4118548399&4294967295,B=O+(z<<7&4294967295|z>>>25),z=W+(G^B&(O^G))+q[5]+1200080426&4294967295,W=B+(z<<12&4294967295|z>>>20),z=G+(O^W&(B^O))+q[6]+2821735955&4294967295,G=W+(z<<17&4294967295|z>>>15),z=O+(B^G&(W^B))+q[7]+4249261313&4294967295,O=G+(z<<22&4294967295|z>>>10),z=B+(W^O&(G^W))+q[8]+1770035416&4294967295,B=O+(z<<7&4294967295|z>>>25),z=W+(G^B&(O^G))+q[9]+2336552879&4294967295,W=B+(z<<12&4294967295|z>>>20),z=G+(O^W&(B^O))+q[10]+4294925233&4294967295,G=W+(z<<17&4294967295|z>>>15),z=O+(B^G&(W^B))+q[11]+2304563134&4294967295,O=G+(z<<22&4294967295|z>>>10),z=B+(W^O&(G^W))+q[12]+1804603682&4294967295,B=O+(z<<7&4294967295|z>>>25),z=W+(G^B&(O^G))+q[13]+4254626195&4294967295,W=B+(z<<12&4294967295|z>>>20),z=G+(O^W&(B^O))+q[14]+2792965006&4294967295,G=W+(z<<17&4294967295|z>>>15),z=O+(B^G&(W^B))+q[15]+1236535329&4294967295,O=G+(z<<22&4294967295|z>>>10),z=B+(G^W&(O^G))+q[1]+4129170786&4294967295,B=O+(z<<5&4294967295|z>>>27),z=W+(O^G&(B^O))+q[6]+3225465664&4294967295,W=B+(z<<9&4294967295|z>>>23),z=G+(B^O&(W^B))+q[11]+643717713&4294967295,G=W+(z<<14&4294967295|z>>>18),z=O+(W^B&(G^W))+q[0]+3921069994&4294967295,O=G+(z<<20&4294967295|z>>>12),z=B+(G^W&(O^G))+q[5]+3593408605&4294967295,B=O+(z<<5&4294967295|z>>>27),z=W+(O^G&(B^O))+q[10]+38016083&4294967295,W=B+(z<<9&4294967295|z>>>23),z=G+(B^O&(W^B))+q[15]+3634488961&4294967295,G=W+(z<<14&4294967295|z>>>18),z=O+(W^B&(G^W))+q[4]+3889429448&4294967295,O=G+(z<<20&4294967295|z>>>12),z=B+(G^W&(O^G))+q[9]+568446438&4294967295,B=O+(z<<5&4294967295|z>>>27),z=W+(O^G&(B^O))+q[14]+3275163606&4294967295,W=B+(z<<9&4294967295|z>>>23),z=G+(B^O&(W^B))+q[3]+4107603335&4294967295,G=W+(z<<14&4294967295|z>>>18),z=O+(W^B&(G^W))+q[8]+1163531501&4294967295,O=G+(z<<20&4294967295|z>>>12),z=B+(G^W&(O^G))+q[13]+2850285829&4294967295,B=O+(z<<5&4294967295|z>>>27),z=W+(O^G&(B^O))+q[2]+4243563512&4294967295,W=B+(z<<9&4294967295|z>>>23),z=G+(B^O&(W^B))+q[7]+1735328473&4294967295,G=W+(z<<14&4294967295|z>>>18),z=O+(W^B&(G^W))+q[12]+2368359562&4294967295,O=G+(z<<20&4294967295|z>>>12),z=B+(O^G^W)+q[5]+4294588738&4294967295,B=O+(z<<4&4294967295|z>>>28),z=W+(B^O^G)+q[8]+2272392833&4294967295,W=B+(z<<11&4294967295|z>>>21),z=G+(W^B^O)+q[11]+1839030562&4294967295,G=W+(z<<16&4294967295|z>>>16),z=O+(G^W^B)+q[14]+4259657740&4294967295,O=G+(z<<23&4294967295|z>>>9),z=B+(O^G^W)+q[1]+2763975236&4294967295,B=O+(z<<4&4294967295|z>>>28),z=W+(B^O^G)+q[4]+1272893353&4294967295,W=B+(z<<11&4294967295|z>>>21),z=G+(W^B^O)+q[7]+4139469664&4294967295,G=W+(z<<16&4294967295|z>>>16),z=O+(G^W^B)+q[10]+3200236656&4294967295,O=G+(z<<23&4294967295|z>>>9),z=B+(O^G^W)+q[13]+681279174&4294967295,B=O+(z<<4&4294967295|z>>>28),z=W+(B^O^G)+q[0]+3936430074&4294967295,W=B+(z<<11&4294967295|z>>>21),z=G+(W^B^O)+q[3]+3572445317&4294967295,G=W+(z<<16&4294967295|z>>>16),z=O+(G^W^B)+q[6]+76029189&4294967295,O=G+(z<<23&4294967295|z>>>9),z=B+(O^G^W)+q[9]+3654602809&4294967295,B=O+(z<<4&4294967295|z>>>28),z=W+(B^O^G)+q[12]+3873151461&4294967295,W=B+(z<<11&4294967295|z>>>21),z=G+(W^B^O)+q[15]+530742520&4294967295,G=W+(z<<16&4294967295|z>>>16),z=O+(G^W^B)+q[2]+3299628645&4294967295,O=G+(z<<23&4294967295|z>>>9),z=B+(G^(O|~W))+q[0]+4096336452&4294967295,B=O+(z<<6&4294967295|z>>>26),z=W+(O^(B|~G))+q[7]+1126891415&4294967295,W=B+(z<<10&4294967295|z>>>22),z=G+(B^(W|~O))+q[14]+2878612391&4294967295,G=W+(z<<15&4294967295|z>>>17),z=O+(W^(G|~B))+q[5]+4237533241&4294967295,O=G+(z<<21&4294967295|z>>>11),z=B+(G^(O|~W))+q[12]+1700485571&4294967295,B=O+(z<<6&4294967295|z>>>26),z=W+(O^(B|~G))+q[3]+2399980690&4294967295,W=B+(z<<10&4294967295|z>>>22),z=G+(B^(W|~O))+q[10]+4293915773&4294967295,G=W+(z<<15&4294967295|z>>>17),z=O+(W^(G|~B))+q[1]+2240044497&4294967295,O=G+(z<<21&4294967295|z>>>11),z=B+(G^(O|~W))+q[8]+1873313359&4294967295,B=O+(z<<6&4294967295|z>>>26),z=W+(O^(B|~G))+q[15]+4264355552&4294967295,W=B+(z<<10&4294967295|z>>>22),z=G+(B^(W|~O))+q[6]+2734768916&4294967295,G=W+(z<<15&4294967295|z>>>17),z=O+(W^(G|~B))+q[13]+1309151649&4294967295,O=G+(z<<21&4294967295|z>>>11),z=B+(G^(O|~W))+q[4]+4149444226&4294967295,B=O+(z<<6&4294967295|z>>>26),z=W+(O^(B|~G))+q[11]+3174756917&4294967295,W=B+(z<<10&4294967295|z>>>22),z=G+(B^(W|~O))+q[2]+718787259&4294967295,G=W+(z<<15&4294967295|z>>>17),z=O+(W^(G|~B))+q[9]+3951481745&4294967295,k.g[0]=k.g[0]+B&4294967295,k.g[1]=k.g[1]+(G+(z<<21&4294967295|z>>>11))&4294967295,k.g[2]=k.g[2]+G&4294967295,k.g[3]=k.g[3]+W&4294967295}i.prototype.v=function(k,B){B===void 0&&(B=k.length);const O=B-this.blockSize,q=this.C;let G=this.h,W=0;for(;W<B;){if(G==0)for(;W<=O;)s(this,k,W),W+=this.blockSize;if(typeof k=="string"){for(;W<B;)if(q[G++]=k.charCodeAt(W++),G==this.blockSize){s(this,q),G=0;break}}else for(;W<B;)if(q[G++]=k[W++],G==this.blockSize){s(this,q),G=0;break}}this.h=G,this.o+=B},i.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var B=1;B<k.length-8;++B)k[B]=0;B=this.o*8;for(var O=k.length-8;O<k.length;++O)k[O]=B&255,B/=256;for(this.v(k),k=Array(16),B=0,O=0;O<4;++O)for(let q=0;q<32;q+=8)k[B++]=this.g[O]>>>q&255;return k};function o(k,B){var O=d;return Object.prototype.hasOwnProperty.call(O,k)?O[k]:O[k]=B(k)}function l(k,B){this.h=B;const O=[];let q=!0;for(let G=k.length-1;G>=0;G--){const W=k[G]|0;q&&W==B||(O[G]=W,q=!1)}this.g=O}var d={};function h(k){return-128<=k&&k<128?o(k,function(B){return new l([B|0],B<0?-1:0)}):new l([k|0],k<0?-1:0)}function p(k){if(isNaN(k)||!isFinite(k))return x;if(k<0)return H(p(-k));const B=[];let O=1;for(let q=0;k>=O;q++)B[q]=k/O|0,O*=4294967296;return new l(B,0)}function T(k,B){if(k.length==0)throw Error("number format error: empty string");if(B=B||10,B<2||36<B)throw Error("radix out of range: "+B);if(k.charAt(0)=="-")return H(T(k.substring(1),B));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const O=p(Math.pow(B,8));let q=x;for(let W=0;W<k.length;W+=8){var G=Math.min(8,k.length-W);const z=parseInt(k.substring(W,W+G),B);G<8?(G=p(Math.pow(B,G)),q=q.j(G).add(p(z))):(q=q.j(O),q=q.add(p(z)))}return q}var x=h(0),C=h(1),A=h(16777216);n=l.prototype,n.m=function(){if(F(this))return-H(this).m();let k=0,B=1;for(let O=0;O<this.g.length;O++){const q=this.i(O);k+=(q>=0?q:4294967296+q)*B,B*=4294967296}return k},n.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(D(this))return"0";if(F(this))return"-"+H(this).toString(k);const B=p(Math.pow(k,6));var O=this;let q="";for(;;){const G=he(O,B).g;O=X(O,G.j(B));let W=((O.g.length>0?O.g[0]:O.h)>>>0).toString(k);if(O=G,D(O))return W+q;for(;W.length<6;)W="0"+W;q=W+q}},n.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function D(k){if(k.h!=0)return!1;for(let B=0;B<k.g.length;B++)if(k.g[B]!=0)return!1;return!0}function F(k){return k.h==-1}n.l=function(k){return k=X(this,k),F(k)?-1:D(k)?0:1};function H(k){const B=k.g.length,O=[];for(let q=0;q<B;q++)O[q]=~k.g[q];return new l(O,~k.h).add(C)}n.abs=function(){return F(this)?H(this):this},n.add=function(k){const B=Math.max(this.g.length,k.g.length),O=[];let q=0;for(let G=0;G<=B;G++){let W=q+(this.i(G)&65535)+(k.i(G)&65535),z=(W>>>16)+(this.i(G)>>>16)+(k.i(G)>>>16);q=z>>>16,W&=65535,z&=65535,O[G]=z<<16|W}return new l(O,O[O.length-1]&-2147483648?-1:0)};function X(k,B){return k.add(H(B))}n.j=function(k){if(D(this)||D(k))return x;if(F(this))return F(k)?H(this).j(H(k)):H(H(this).j(k));if(F(k))return H(this.j(H(k)));if(this.l(A)<0&&k.l(A)<0)return p(this.m()*k.m());const B=this.g.length+k.g.length,O=[];for(var q=0;q<2*B;q++)O[q]=0;for(q=0;q<this.g.length;q++)for(let G=0;G<k.g.length;G++){const W=this.i(q)>>>16,z=this.i(q)&65535,Ge=k.i(G)>>>16,$e=k.i(G)&65535;O[2*q+2*G]+=z*$e,re(O,2*q+2*G),O[2*q+2*G+1]+=W*$e,re(O,2*q+2*G+1),O[2*q+2*G+1]+=z*Ge,re(O,2*q+2*G+1),O[2*q+2*G+2]+=W*Ge,re(O,2*q+2*G+2)}for(k=0;k<B;k++)O[k]=O[2*k+1]<<16|O[2*k];for(k=B;k<2*B;k++)O[k]=0;return new l(O,0)};function re(k,B){for(;(k[B]&65535)!=k[B];)k[B+1]+=k[B]>>>16,k[B]&=65535,B++}function Q(k,B){this.g=k,this.h=B}function he(k,B){if(D(B))throw Error("division by zero");if(D(k))return new Q(x,x);if(F(k))return B=he(H(k),B),new Q(H(B.g),H(B.h));if(F(B))return B=he(k,H(B)),new Q(H(B.g),B.h);if(k.g.length>30){if(F(k)||F(B))throw Error("slowDivide_ only works with positive integers.");for(var O=C,q=B;q.l(k)<=0;)O=fe(O),q=fe(q);var G=Y(O,1),W=Y(q,1);for(q=Y(q,2),O=Y(O,2);!D(q);){var z=W.add(q);z.l(k)<=0&&(G=G.add(O),W=z),q=Y(q,1),O=Y(O,1)}return B=X(k,G.j(B)),new Q(G,B)}for(G=x;k.l(B)>=0;){for(O=Math.max(1,Math.floor(k.m()/B.m())),q=Math.ceil(Math.log(O)/Math.LN2),q=q<=48?1:Math.pow(2,q-48),W=p(O),z=W.j(B);F(z)||z.l(k)>0;)O-=q,W=p(O),z=W.j(B);D(W)&&(W=C),G=G.add(W),k=X(k,z)}return new Q(G,k)}n.B=function(k){return he(this,k).h},n.and=function(k){const B=Math.max(this.g.length,k.g.length),O=[];for(let q=0;q<B;q++)O[q]=this.i(q)&k.i(q);return new l(O,this.h&k.h)},n.or=function(k){const B=Math.max(this.g.length,k.g.length),O=[];for(let q=0;q<B;q++)O[q]=this.i(q)|k.i(q);return new l(O,this.h|k.h)},n.xor=function(k){const B=Math.max(this.g.length,k.g.length),O=[];for(let q=0;q<B;q++)O[q]=this.i(q)^k.i(q);return new l(O,this.h^k.h)};function fe(k){const B=k.g.length+1,O=[];for(let q=0;q<B;q++)O[q]=k.i(q)<<1|k.i(q-1)>>>31;return new l(O,k.h)}function Y(k,B){const O=B>>5;B%=32;const q=k.g.length-O,G=[];for(let W=0;W<q;W++)G[W]=B>0?k.i(W+O)>>>B|k.i(W+O+1)<<32-B:k.i(W+O);return new l(G,k.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,xR=i,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=p,l.fromString=T,nl=l}).apply(typeof dI<"u"?dI:typeof self<"u"?self:typeof window<"u"?window:{});var ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wR,Oh,SR,gp,n0,CR,bR,IR;(function(){var n,e=Object.defineProperty;function t(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof ep=="object"&&ep];for(var I=0;I<v.length;++I){var M=v[I];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var i=t(this);function s(v,I){if(I)e:{var M=i;v=v.split(".");for(var U=0;U<v.length-1;U++){var ne=v[U];if(!(ne in M))break e;M=M[ne]}v=v[v.length-1],U=M[v],I=I(U),I!=U&&I!=null&&e(M,v,{configurable:!0,writable:!0,value:I})}}s("Symbol.dispose",function(v){return v||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(v){return v||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(v){return v||function(I){var M=[],U;for(U in I)Object.prototype.hasOwnProperty.call(I,U)&&M.push([U,I[U]]);return M}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function d(v){var I=typeof v;return I=="object"&&v!=null||I=="function"}function h(v,I,M){return v.call.apply(v.bind,arguments)}function p(v,I,M){return p=h,p.apply(null,arguments)}function T(v,I){var M=Array.prototype.slice.call(arguments,1);return function(){var U=M.slice();return U.push.apply(U,arguments),v.apply(this,U)}}function x(v,I){function M(){}M.prototype=I.prototype,v.Z=I.prototype,v.prototype=new M,v.prototype.constructor=v,v.Ob=function(U,ne,de){for(var Re=Array(arguments.length-2),st=2;st<arguments.length;st++)Re[st-2]=arguments[st];return I.prototype[ne].apply(U,Re)}}var C=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?v=>v&&AsyncContext.Snapshot.wrap(v):v=>v;function A(v){const I=v.length;if(I>0){const M=Array(I);for(let U=0;U<I;U++)M[U]=v[U];return M}return[]}function D(v,I){for(let U=1;U<arguments.length;U++){const ne=arguments[U];var M=typeof ne;if(M=M!="object"?M:ne?Array.isArray(ne)?"array":M:"null",M=="array"||M=="object"&&typeof ne.length=="number"){M=v.length||0;const de=ne.length||0;v.length=M+de;for(let Re=0;Re<de;Re++)v[M+Re]=ne[Re]}else v.push(ne)}}class F{constructor(I,M){this.i=I,this.j=M,this.h=0,this.g=null}get(){let I;return this.h>0?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function H(v){l.setTimeout(()=>{throw v},0)}function X(){var v=k;let I=null;return v.g&&(I=v.g,v.g=v.g.next,v.g||(v.h=null),I.next=null),I}class re{constructor(){this.h=this.g=null}add(I,M){const U=Q.get();U.set(I,M),this.h?this.h.next=U:this.g=U,this.h=U}}var Q=new F(()=>new he,v=>v.reset());class he{constructor(){this.next=this.g=this.h=null}set(I,M){this.h=I,this.g=M,this.next=null}reset(){this.next=this.g=this.h=null}}let fe,Y=!1,k=new re,B=()=>{const v=Promise.resolve(void 0);fe=()=>{v.then(O)}};function O(){for(var v;v=X();){try{v.h.call(v.g)}catch(M){H(M)}var I=Q;I.j(v),I.h<100&&(I.h++,v.next=I.g,I.g=v)}Y=!1}function q(){this.u=this.u,this.C=this.C}q.prototype.u=!1,q.prototype.dispose=function(){this.u||(this.u=!0,this.N())},q.prototype[Symbol.dispose]=function(){this.dispose()},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function G(v,I){this.type=v,this.g=this.target=I,this.defaultPrevented=!1}G.prototype.h=function(){this.defaultPrevented=!0};var W=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var v=!1,I=Object.defineProperty({},"passive",{get:function(){v=!0}});try{const M=()=>{};l.addEventListener("test",M,I),l.removeEventListener("test",M,I)}catch{}return v})();function z(v){return/^[\s\xa0]*$/.test(v)}function Ge(v,I){G.call(this,v?v.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,v&&this.init(v,I)}x(Ge,G),Ge.prototype.init=function(v,I){const M=this.type=v.type,U=v.changedTouches&&v.changedTouches.length?v.changedTouches[0]:null;this.target=v.target||v.srcElement,this.g=I,I=v.relatedTarget,I||(M=="mouseover"?I=v.fromElement:M=="mouseout"&&(I=v.toElement)),this.relatedTarget=I,U?(this.clientX=U.clientX!==void 0?U.clientX:U.pageX,this.clientY=U.clientY!==void 0?U.clientY:U.pageY,this.screenX=U.screenX||0,this.screenY=U.screenY||0):(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0),this.button=v.button,this.key=v.key||"",this.ctrlKey=v.ctrlKey,this.altKey=v.altKey,this.shiftKey=v.shiftKey,this.metaKey=v.metaKey,this.pointerId=v.pointerId||0,this.pointerType=v.pointerType,this.state=v.state,this.i=v,v.defaultPrevented&&Ge.Z.h.call(this)},Ge.prototype.h=function(){Ge.Z.h.call(this);const v=this.i;v.preventDefault?v.preventDefault():v.returnValue=!1};var $e="closure_listenable_"+(Math.random()*1e6|0),se=0;function Ce(v,I,M,U,ne){this.listener=v,this.proxy=null,this.src=I,this.type=M,this.capture=!!U,this.ha=ne,this.key=++se,this.da=this.fa=!1}function be(v){v.da=!0,v.listener=null,v.proxy=null,v.src=null,v.ha=null}function it(v,I,M){for(const U in v)I.call(M,v[U],U,v)}function Pe(v,I){for(const M in v)I.call(void 0,v[M],M,v)}function K(v){const I={};for(const M in v)I[M]=v[M];return I}const me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ie(v,I){let M,U;for(let ne=1;ne<arguments.length;ne++){U=arguments[ne];for(M in U)v[M]=U[M];for(let de=0;de<me.length;de++)M=me[de],Object.prototype.hasOwnProperty.call(U,M)&&(v[M]=U[M])}}function le(v){this.src=v,this.g={},this.h=0}le.prototype.add=function(v,I,M,U,ne){const de=v.toString();v=this.g[de],v||(v=this.g[de]=[],this.h++);const Re=we(v,I,U,ne);return Re>-1?(I=v[Re],M||(I.fa=!1)):(I=new Ce(I,this.src,de,!!U,ne),I.fa=M,v.push(I)),I};function ge(v,I){const M=I.type;if(M in v.g){var U=v.g[M],ne=Array.prototype.indexOf.call(U,I,void 0),de;(de=ne>=0)&&Array.prototype.splice.call(U,ne,1),de&&(be(I),v.g[M].length==0&&(delete v.g[M],v.h--))}}function we(v,I,M,U){for(let ne=0;ne<v.length;++ne){const de=v[ne];if(!de.da&&de.listener==I&&de.capture==!!M&&de.ha==U)return ne}return-1}var Ke="closure_lm_"+(Math.random()*1e6|0),Fe={};function Ye(v,I,M,U,ne){if(Array.isArray(I)){for(let de=0;de<I.length;de++)Ye(v,I[de],M,U,ne);return null}return M=Se(M),v&&v[$e]?v.J(I,M,d(U)?!!U.capture:!1,ne):Nt(v,I,M,!1,U,ne)}function Nt(v,I,M,U,ne,de){if(!I)throw Error("Invalid event type");const Re=d(ne)?!!ne.capture:!!ne;let st=Rt(v);if(st||(v[Ke]=st=new le(v)),M=st.add(I,M,U,Re,de),M.proxy)return M;if(U=Jt(),M.proxy=U,U.src=v,U.listener=M,v.addEventListener)W||(ne=Re),ne===void 0&&(ne=!1),v.addEventListener(I.toString(),U,ne);else if(v.attachEvent)v.attachEvent(Rn(I.toString()),U);else if(v.addListener&&v.removeListener)v.addListener(U);else throw Error("addEventListener and attachEvent are unavailable.");return M}function Jt(){function v(M){return I.call(v.src,v.listener,M)}const I=Yt;return v}function ct(v,I,M,U,ne){if(Array.isArray(I))for(var de=0;de<I.length;de++)ct(v,I[de],M,U,ne);else U=d(U)?!!U.capture:!!U,M=Se(M),v&&v[$e]?(v=v.i,de=String(I).toString(),de in v.g&&(I=v.g[de],M=we(I,M,U,ne),M>-1&&(be(I[M]),Array.prototype.splice.call(I,M,1),I.length==0&&(delete v.g[de],v.h--)))):v&&(v=Rt(v))&&(I=v.g[I.toString()],v=-1,I&&(v=we(I,M,U,ne)),(M=v>-1?I[v]:null)&&mn(M))}function mn(v){if(typeof v!="number"&&v&&!v.da){var I=v.src;if(I&&I[$e])ge(I.i,v);else{var M=v.type,U=v.proxy;I.removeEventListener?I.removeEventListener(M,U,v.capture):I.detachEvent?I.detachEvent(Rn(M),U):I.addListener&&I.removeListener&&I.removeListener(U),(M=Rt(I))?(ge(M,v),M.h==0&&(M.src=null,I[Ke]=null)):be(v)}}}function Rn(v){return v in Fe?Fe[v]:Fe[v]="on"+v}function Yt(v,I){if(v.da)v=!0;else{I=new Ge(I,this);const M=v.listener,U=v.ha||v.src;v.fa&&mn(v),v=M.call(U,I)}return v}function Rt(v){return v=v[Ke],v instanceof le?v:null}var Mt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Se(v){return typeof v=="function"?v:(v[Mt]||(v[Mt]=function(I){return v.handleEvent(I)}),v[Mt])}function Qe(){q.call(this),this.i=new le(this),this.M=this,this.G=null}x(Qe,q),Qe.prototype[$e]=!0,Qe.prototype.removeEventListener=function(v,I,M,U){ct(this,v,I,M,U)};function _e(v,I){var M,U=v.G;if(U)for(M=[];U;U=U.G)M.push(U);if(v=v.M,U=I.type||I,typeof I=="string")I=new G(I,v);else if(I instanceof G)I.target=I.target||v;else{var ne=I;I=new G(U,v),Ie(I,ne)}ne=!0;let de,Re;if(M)for(Re=M.length-1;Re>=0;Re--)de=I.g=M[Re],ne=ke(de,U,!0,I)&&ne;if(de=I.g=v,ne=ke(de,U,!0,I)&&ne,ne=ke(de,U,!1,I)&&ne,M)for(Re=0;Re<M.length;Re++)de=I.g=M[Re],ne=ke(de,U,!1,I)&&ne}Qe.prototype.N=function(){if(Qe.Z.N.call(this),this.i){var v=this.i;for(const I in v.g){const M=v.g[I];for(let U=0;U<M.length;U++)be(M[U]);delete v.g[I],v.h--}}this.G=null},Qe.prototype.J=function(v,I,M,U){return this.i.add(String(v),I,!1,M,U)},Qe.prototype.K=function(v,I,M,U){return this.i.add(String(v),I,!0,M,U)};function ke(v,I,M,U){if(I=v.i.g[String(I)],!I)return!0;I=I.concat();let ne=!0;for(let de=0;de<I.length;++de){const Re=I[de];if(Re&&!Re.da&&Re.capture==M){const st=Re.listener,Vt=Re.ha||Re.src;Re.fa&&ge(v.i,Re),ne=st.call(Vt,U)!==!1&&ne}}return ne&&!U.defaultPrevented}function He(v,I){if(typeof v!="function")if(v&&typeof v.handleEvent=="function")v=p(v.handleEvent,v);else throw Error("Invalid listener argument");return Number(I)>2147483647?-1:l.setTimeout(v,I||0)}function mt(v){v.g=He(()=>{v.g=null,v.i&&(v.i=!1,mt(v))},v.l);const I=v.h;v.h=null,v.m.apply(null,I)}class lt extends q{constructor(I,M){super(),this.m=I,this.l=M,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:mt(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function un(v){q.call(this),this.h=v,this.g={}}x(un,q);var ri=[];function Ji(v){it(v.g,function(I,M){this.g.hasOwnProperty(M)&&mn(I)},v),v.g={}}un.prototype.N=function(){un.Z.N.call(this),Ji(this)},un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pn=l.JSON.stringify,Ts=l.JSON.parse,Vr=class{stringify(v){return l.JSON.stringify(v,void 0)}parse(v){return l.JSON.parse(v,void 0)}};function Or(){}function ho(){}var vi={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ne(){G.call(this,"d")}x(Ne,G);function ht(){G.call(this,"c")}x(ht,G);var dt={},rn=null;function wi(){return rn=rn||new Qe}dt.Ia="serverreachability";function Es(v){G.call(this,dt.Ia,v)}x(Es,G);function Fn(v){const I=wi();_e(I,new Es(I))}dt.STAT_EVENT="statevent";function Zi(v,I){G.call(this,dt.STAT_EVENT,v),this.stat=I}x(Zi,G);function gn(v){const I=wi();_e(I,new Zi(I,v))}dt.Ja="timingevent";function Bi(v,I){G.call(this,dt.Ja,v),this.size=I}x(Bi,G);function zi(v,I){if(typeof v!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){v()},I)}function Xn(){this.g=!0}Xn.prototype.ua=function(){this.g=!1};function Od(v,I,M,U,ne,de){v.info(function(){if(v.g)if(de){var Re="",st=de.split("&");for(let Ot=0;Ot<st.length;Ot++){var Vt=st[Ot].split("=");if(Vt.length>1){const dn=Vt[0];Vt=Vt[1];const ss=dn.split("_");Re=ss.length>=2&&ss[1]=="type"?Re+(dn+"="+Vt+"&"):Re+(dn+"=redacted&")}}}else Re=null;else Re=de;return"XMLHTTP REQ ("+U+") [attempt "+ne+"]: "+I+`
`+M+`
`+Re})}function Hu(v,I,M,U,ne,de,Re){v.info(function(){return"XMLHTTP RESP ("+U+") [ attempt "+ne+"]: "+I+`
`+M+`
`+de+" "+Re})}function Hs(v,I,M,U){v.info(function(){return"XMLHTTP TEXT ("+I+"): "+Ud(v,M)+(U?" "+U:"")})}function cr(v,I){v.info(function(){return"TIMEOUT: "+I})}Xn.prototype.info=function(){};function Ud(v,I){if(!v.g)return I;if(!I)return null;try{const de=JSON.parse(I);if(de){for(v=0;v<de.length;v++)if(Array.isArray(de[v])){var M=de[v];if(!(M.length<2)){var U=M[1];if(Array.isArray(U)&&!(U.length<1)){var ne=U[0];if(ne!="noop"&&ne!="stop"&&ne!="close")for(let Re=1;Re<U.length;Re++)U[Re]=""}}}}return pn(de)}catch{return I}}var fo={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},xl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},wl;function oi(){}x(oi,Or),oi.prototype.g=function(){return new XMLHttpRequest},wl=new oi;function Be(v){return encodeURIComponent(String(v))}function Sl(v){var I=1;v=v.split(":");const M=[];for(;I>0&&v.length;)M.push(v.shift()),I--;return v.length&&M.push(v.join(":")),M}function Qi(v,I,M,U){this.j=v,this.i=I,this.l=M,this.S=U||1,this.V=new un(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new $i}function $i(){this.i=null,this.g="",this.h=!1}var bn={},Mn={};function xs(v,I,M){v.M=1,v.A=Zt(yn(I)),v.u=M,v.R=!0,ws(v,null)}function ws(v,I){v.F=Date.now(),js(v),v.B=yn(v.A);var M=v.B,U=v.S;Array.isArray(U)||(U=[String(U)]),Fr(M.i,"t",U),v.C=0,M=v.j.L,v.h=new $i,v.g=Ml(v.j,M?I:null,!v.u),v.P>0&&(v.O=new lt(p(v.Y,v,v.g),v.P)),I=v.V,M=v.g,U=v.ba;var ne="readystatechange";Array.isArray(ne)||(ne&&(ri[0]=ne.toString()),ne=ri);for(let de=0;de<ne.length;de++){const Re=Ye(M,ne[de],U||I.handleEvent,!1,I.h||I);if(!Re)break;I.g[Re.key]=Re}I=v.J?K(v.J):{},v.u?(v.v||(v.v="POST"),I["Content-Type"]="application/x-www-form-urlencoded",v.g.ea(v.B,v.v,v.u,I)):(v.v="GET",v.g.ea(v.B,v.v,null,I)),Fn(),Od(v.i,v.v,v.B,v.l,v.S,v.u)}Qi.prototype.ba=function(v){v=v.target;const I=this.O;I&&Is(v)==3?I.j():this.Y(v)},Qi.prototype.Y=function(v){try{if(v==this.g)e:{const st=Is(this.g),Vt=this.g.ya(),Ot=this.g.ca();if(!(st<3)&&(st!=3||this.g&&(this.h.h||this.g.la()||Kn(this.g)))){this.K||st!=4||Vt==7||(Vt==8||Ot<=0?Fn(3):Fn(2)),Ss(this);var I=this.g.ca();this.X=I;var M=ju(this);if(this.o=I==200,Hu(this.i,this.v,this.B,this.l,this.S,st,I),this.o){if(this.U&&!this.L){t:{if(this.g){var U,ne=this.g;if((U=ne.g?ne.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(U)){var de=U;break t}}de=null}if(v=de)Hs(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ks(this,v);else{this.o=!1,this.m=3,gn(12),ai(this),Xi(this);break e}}if(this.R){v=!0;let dn;for(;!this.K&&this.C<M.length;)if(dn=Wu(this,M),dn==Mn){st==4&&(this.m=4,gn(14),v=!1),Hs(this.i,this.l,null,"[Incomplete Response]");break}else if(dn==bn){this.m=4,gn(15),Hs(this.i,this.l,M,"[Invalid Chunk]"),v=!1;break}else Hs(this.i,this.l,dn,null),Ks(this,dn);if(Ku(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||M.length!=0||this.h.h||(this.m=1,gn(16),v=!1),this.o=this.o&&v,!v)Hs(this.i,this.l,M,"[Invalid Chunked Response]"),ai(this),Xi(this);else if(M.length>0&&!this.W){this.W=!0;var Re=this.j;Re.g==this&&Re.aa&&!Re.P&&(Re.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Nl(Re),Re.P=!0,gn(11))}}else Hs(this.i,this.l,M,null),Ks(this,M);st==4&&ai(this),this.o&&!this.K&&(st==4?Hi(this.j,this):(this.o=!1,js(this)))}else As(this.g),I==400&&M.indexOf("Unknown SID")>0?(this.m=3,gn(12)):(this.m=0,gn(13)),ai(this),Xi(this)}}}catch{}finally{}};function ju(v){if(!Ku(v))return v.g.la();const I=Kn(v.g);if(I==="")return"";let M="";const U=I.length,ne=Is(v.g)==4;if(!v.h.i){if(typeof TextDecoder>"u")return ai(v),Xi(v),"";v.h.i=new l.TextDecoder}for(let de=0;de<U;de++)v.h.h=!0,M+=v.h.i.decode(I[de],{stream:!(ne&&de==U-1)});return I.length=0,v.h.g+=M,v.C=0,v.h.g}function Ku(v){return v.g?v.v=="GET"&&v.M!=2&&v.j.Aa:!1}function Wu(v,I){var M=v.C,U=I.indexOf(`
`,M);return U==-1?Mn:(M=Number(I.substring(M,U)),isNaN(M)?bn:(U+=1,U+M>I.length?Mn:(I=I.slice(U,U+M),v.C=U+M,I)))}Qi.prototype.cancel=function(){this.K=!0,ai(this)};function js(v){v.T=Date.now()+v.H,oa(v,v.H)}function oa(v,I){if(v.D!=null)throw Error("WatchDog timer not null");v.D=zi(p(v.aa,v),I)}function Ss(v){v.D&&(l.clearTimeout(v.D),v.D=null)}Qi.prototype.aa=function(){this.D=null;const v=Date.now();v-this.T>=0?(cr(this.i,this.B),this.M!=2&&(Fn(),gn(17)),ai(this),this.m=2,Xi(this)):oa(this,this.T-v)};function Xi(v){v.j.I==0||v.K||Hi(v.j,v)}function ai(v){Ss(v);var I=v.O;I&&typeof I.dispose=="function"&&I.dispose(),v.O=null,Ji(v.V),v.g&&(I=v.g,v.g=null,I.abort(),I.dispose())}function Ks(v,I){try{var M=v.j;if(M.I!=0&&(M.g==v||es(M.h,v))){if(!v.L&&es(M.h,v)&&M.I==3){try{var U=M.Ba.g.parse(I)}catch{U=null}if(Array.isArray(U)&&U.length==3){var ne=U;if(ne[0]==0){e:if(!M.v){if(M.g)if(M.g.F+3e3<v.F)fa(M),Gr(M);else break e;vo(M),gn(18)}}else M.xa=ne[1],0<M.xa-M.K&&ne[2]<37500&&M.F&&M.A==0&&!M.C&&(M.C=zi(p(M.Va,M),6e3));Ws(M.h)<=1&&M.ta&&(M.ta=void 0)}else Ns(M,11)}else if((v.L||M.g==v)&&fa(M),!z(I))for(ne=M.Ba.g.parse(I),I=0;I<ne.length;I++){let Ot=ne[I];const dn=Ot[0];if(!(dn<=M.K))if(M.K=dn,Ot=Ot[1],M.I==2)if(Ot[0]=="c"){M.M=Ot[1],M.ba=Ot[2];const ss=Ot[3];ss!=null&&(M.ka=ss,M.j.info("VER="+M.ka));const rs=Ot[4];rs!=null&&(M.za=rs,M.j.info("SVER="+M.za));const ji=Ot[5];ji!=null&&typeof ji=="number"&&ji>0&&(U=1.5*ji,M.O=U,M.j.info("backChannelRequestTimeoutMs_="+U)),U=M;const Ms=v.g;if(Ms){const To=Ms.g?Ms.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(To){var de=U.h;de.g||To.indexOf("spdy")==-1&&To.indexOf("quic")==-1&&To.indexOf("h2")==-1||(de.j=de.l,de.g=new Set,de.h&&(dr(de,de.h),de.h=null))}if(U.G){const Eo=Ms.g?Ms.g.getResponseHeader("X-HTTP-Session-Id"):null;Eo&&(U.wa=Eo,Ue(U.J,U.G,Eo))}}M.I=3,M.l&&M.l.ra(),M.aa&&(M.T=Date.now()-v.F,M.j.info("Handshake RTT: "+M.T+"ms")),U=M;var Re=v;if(U.na=Rl(U,U.L?U.ba:null,U.W),Re.L){aa(U.h,Re);var st=Re,Vt=U.O;Vt&&(st.H=Vt),st.D&&(Ss(st),js(st)),U.g=Re}else Al(U);M.i.length>0&&Ii(M)}else Ot[0]!="stop"&&Ot[0]!="close"||Ns(M,7);else M.I==3&&(Ot[0]=="stop"||Ot[0]=="close"?Ot[0]=="stop"?Ns(M,7):yt(M):Ot[0]!="noop"&&M.l&&M.l.qa(Ot),M.A=0)}}Fn(4)}catch{}}var Pn=class{constructor(v,I){this.g=v,this.map=I}};function Cl(v){this.l=v||10,l.PerformanceNavigationTiming?(v=l.performance.getEntriesByType("navigation"),v=v.length>0&&(v[0].nextHopProtocol=="hq"||v[0].nextHopProtocol=="h2")):v=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=v?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function bl(v){return v.h?!0:v.g?v.g.size>=v.j:!1}function Ws(v){return v.h?1:v.g?v.g.size:0}function es(v,I){return v.h?v.h==I:v.g?v.g.has(I):!1}function dr(v,I){v.g?v.g.add(I):v.h=I}function aa(v,I){v.h&&v.h==I?v.h=null:v.g&&v.g.has(I)&&v.g.delete(I)}Cl.prototype.cancel=function(){if(this.i=la(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const v of this.g.values())v.cancel();this.g.clear()}};function la(v){if(v.h!=null)return v.i.concat(v.h.G);if(v.g!=null&&v.g.size!==0){let I=v.i;for(const M of v.g.values())I=I.concat(M.G);return I}return A(v.i)}var Ur=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vt(v,I){if(v){v=v.split("&");for(let M=0;M<v.length;M++){const U=v[M].indexOf("=");let ne,de=null;U>=0?(ne=v[M].substring(0,U),de=v[M].substring(U+1)):ne=v[M],I(ne,de?decodeURIComponent(de.replace(/\+/g," ")):"")}}}function xt(v){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let I;v instanceof xt?(this.l=v.l,vn(this,v.j),this.o=v.o,this.g=v.g,qi(this,v.u),this.h=v.h,mo(this,_o(v.i)),this.m=v.m):v&&(I=String(v).match(Ur))?(this.l=!1,vn(this,I[1]||"",!0),this.o=ts(I[2]||""),this.g=ts(I[3]||"",!0),qi(this,I[4]),this.h=ts(I[5]||"",!0),mo(this,I[6]||"",!0),this.m=ts(I[7]||"")):(this.l=!1,this.i=new ns(null,this.l))}xt.prototype.toString=function(){const v=[];var I=this.j;I&&v.push(Ys(I,ua,!0),":");var M=this.g;return(M||I=="file")&&(v.push("//"),(I=this.o)&&v.push(Ys(I,ua,!0),"@"),v.push(Be(M).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M=this.u,M!=null&&v.push(":",String(M))),(M=this.h)&&(this.g&&M.charAt(0)!="/"&&v.push("/"),v.push(Ys(M,M.charAt(0)=="/"?Cs:po,!0))),(M=this.i.toString())&&v.push("?",M),(M=this.m)&&v.push("#",Ys(M,Js)),v.join("")},xt.prototype.resolve=function(v){const I=yn(this);let M=!!v.j;M?vn(I,v.j):M=!!v.o,M?I.o=v.o:M=!!v.g,M?I.g=v.g:M=v.u!=null;var U=v.h;if(M)qi(I,v.u);else if(M=!!v.h){if(U.charAt(0)!="/")if(this.g&&!this.h)U="/"+U;else{var ne=I.h.lastIndexOf("/");ne!=-1&&(U=I.h.slice(0,ne+1)+U)}if(ne=U,ne==".."||ne==".")U="";else if(ne.indexOf("./")!=-1||ne.indexOf("/.")!=-1){U=ne.lastIndexOf("/",0)==0,ne=ne.split("/");const de=[];for(let Re=0;Re<ne.length;){const st=ne[Re++];st=="."?U&&Re==ne.length&&de.push(""):st==".."?((de.length>1||de.length==1&&de[0]!="")&&de.pop(),U&&Re==ne.length&&de.push("")):(de.push(st),U=!0)}U=de.join("/")}else U=ne}return M?I.h=U:M=v.i.toString()!=="",M?mo(I,_o(v.i)):M=!!v.m,M&&(I.m=v.m),I};function yn(v){return new xt(v)}function vn(v,I,M){v.j=M?ts(I,!0):I,v.j&&(v.j=v.j.replace(/:$/,""))}function qi(v,I){if(I){if(I=Number(I),isNaN(I)||I<0)throw Error("Bad port number "+I);v.u=I}else v.u=null}function mo(v,I,M){I instanceof ns?(v.i=I,Br(v.i,v.l)):(M||(I=Ys(I,Qt)),v.i=new ns(I,v.l))}function Ue(v,I,M){v.i.set(I,M)}function Zt(v){return Ue(v,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),v}function ts(v,I){return v?I?decodeURI(v.replace(/%25/g,"%2525")):decodeURIComponent(v):""}function Ys(v,I,M){return typeof v=="string"?(v=encodeURI(v).replace(I,cn),M&&(v=v.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v):null}function cn(v){return v=v.charCodeAt(0),"%"+(v>>4&15).toString(16)+(v&15).toString(16)}var ua=/[#\/\?@]/g,po=/[#\?:]/g,Cs=/[#\?]/g,Qt=/[#\?@]/g,Js=/#/g;function ns(v,I){this.h=this.g=null,this.i=v||null,this.j=!!I}function jn(v){v.g||(v.g=new Map,v.h=0,v.i&&vt(v.i,function(I,M){v.add(decodeURIComponent(I.replace(/\+/g," ")),M)}))}n=ns.prototype,n.add=function(v,I){jn(this),this.i=null,v=Zs(this,v);let M=this.g.get(v);return M||this.g.set(v,M=[]),M.push(I),this.h+=1,this};function ca(v,I){jn(v),I=Zs(v,I),v.g.has(I)&&(v.i=null,v.h-=v.g.get(I).length,v.g.delete(I))}function hr(v,I){return jn(v),I=Zs(v,I),v.g.has(I)}n.forEach=function(v,I){jn(this),this.g.forEach(function(M,U){M.forEach(function(ne){v.call(I,ne,U,this)},this)},this)};function go(v,I){jn(v);let M=[];if(typeof I=="string")hr(v,I)&&(M=M.concat(v.g.get(Zs(v,I))));else for(v=Array.from(v.g.values()),I=0;I<v.length;I++)M=M.concat(v[I]);return M}n.set=function(v,I){return jn(this),this.i=null,v=Zs(this,v),hr(this,v)&&(this.h-=this.g.get(v).length),this.g.set(v,[I]),this.h+=1,this},n.get=function(v,I){return v?(v=go(this,v),v.length>0?String(v[0]):I):I};function Fr(v,I,M){ca(v,I),M.length>0&&(v.i=null,v.g.set(Zs(v,I),A(M)),v.h+=M.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const v=[],I=Array.from(this.g.keys());for(let U=0;U<I.length;U++){var M=I[U];const ne=Be(M);M=go(this,M);for(let de=0;de<M.length;de++){let Re=ne;M[de]!==""&&(Re+="="+Be(M[de])),v.push(Re)}}return this.i=v.join("&")};function _o(v){const I=new ns;return I.i=v.i,v.g&&(I.g=new Map(v.g),I.h=v.h),I}function Zs(v,I){return I=String(I),v.j&&(I=I.toLowerCase()),I}function Br(v,I){I&&!v.j&&(jn(v),v.i=null,v.g.forEach(function(M,U){const ne=U.toLowerCase();U!=ne&&(ca(this,U),Fr(this,ne,M))},v)),v.j=I}function Si(v,I){const M=new Xn;if(l.Image){const U=new Image;U.onload=T(Ci,M,"TestLoadImage: loaded",!0,I,U),U.onerror=T(Ci,M,"TestLoadImage: error",!1,I,U),U.onabort=T(Ci,M,"TestLoadImage: abort",!1,I,U),U.ontimeout=T(Ci,M,"TestLoadImage: timeout",!1,I,U),l.setTimeout(function(){U.ontimeout&&U.ontimeout()},1e4),U.src=v}else I(!1)}function da(v,I){const M=new Xn,U=new AbortController,ne=setTimeout(()=>{U.abort(),Ci(M,"TestPingServer: timeout",!1,I)},1e4);fetch(v,{signal:U.signal}).then(de=>{clearTimeout(ne),de.ok?Ci(M,"TestPingServer: ok",!0,I):Ci(M,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(ne),Ci(M,"TestPingServer: error",!1,I)})}function Ci(v,I,M,U,ne){try{ne&&(ne.onload=null,ne.onerror=null,ne.onabort=null,ne.ontimeout=null),U(M)}catch{}}function zr(){this.g=new Vr}function tt(v){this.i=v.Sb||null,this.h=v.ab||!1}x(tt,Or),tt.prototype.g=function(){return new li(this.i,this.h)};function li(v,I){Qe.call(this),this.H=v,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}x(li,Qe),n=li.prototype,n.open=function(v,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=v,this.D=I,this.readyState=1,Gi(this)},n.send=function(v){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const I={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};v&&(I.body=v),(this.H||l).fetch(new Request(this.D,I)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,fr(this)),this.readyState=0},n.Pa=function(v){if(this.g&&(this.l=v,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=v.headers,this.readyState=2,Gi(this)),this.g&&(this.readyState=3,Gi(this),this.g)))if(this.responseType==="arraybuffer")v.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in v){if(this.j=v.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ft(this)}else v.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ft(v){v.j.read().then(v.Ma.bind(v)).catch(v.ga.bind(v))}n.Ma=function(v){if(this.g){if(this.o&&v.value)this.response.push(v.value);else if(!this.o){var I=v.value?v.value:new Uint8Array(0);(I=this.B.decode(I,{stream:!v.done}))&&(this.response=this.responseText+=I)}v.done?fr(this):Gi(this),this.readyState==3&&Ft(this)}},n.Oa=function(v){this.g&&(this.response=this.responseText=v,fr(this))},n.Na=function(v){this.g&&(this.response=v,fr(this))},n.ga=function(){this.g&&fr(this)};function fr(v){v.readyState=4,v.l=null,v.j=null,v.B=null,Gi(v)}n.setRequestHeader=function(v,I){this.A.append(v,I)},n.getResponseHeader=function(v){return this.h&&this.h.get(v.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const v=[],I=this.h.entries();for(var M=I.next();!M.done;)M=M.value,v.push(M[0]+": "+M[1]),M=I.next();return v.join(`\r
`)};function Gi(v){v.onreadystatechange&&v.onreadystatechange.call(v)}Object.defineProperty(li.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(v){this.m=v?"include":"same-origin"}});function bi(v){let I="";return it(v,function(M,U){I+=U,I+=":",I+=M,I+=`\r
`}),I}function mr(v,I,M){e:{for(U in M){var U=!1;break e}U=!0}U||(M=bi(M),typeof v=="string"?M!=null&&Be(M):Ue(v,I,M))}function Pt(v){Qe.call(this),this.headers=new Map,this.L=v||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}x(Pt,Qe);var is=/^https?$/i,pr=["POST","PUT"];n=Pt.prototype,n.Fa=function(v){this.H=v},n.ea=function(v,I,M,U){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+v);I=I?I.toUpperCase():"GET",this.D=v,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():wl.g(),this.g.onreadystatechange=C(p(this.Ca,this));try{this.B=!0,this.g.open(I,String(v),!0),this.B=!1}catch(de){Tn(this,de);return}if(v=M||"",M=new Map(this.headers),U)if(Object.getPrototypeOf(U)===Object.prototype)for(var ne in U)M.set(ne,U[ne]);else if(typeof U.keys=="function"&&typeof U.get=="function")for(const de of U.keys())M.set(de,U.get(de));else throw Error("Unknown input type for opt_headers: "+String(U));U=Array.from(M.keys()).find(de=>de.toLowerCase()=="content-type"),ne=l.FormData&&v instanceof l.FormData,!(Array.prototype.indexOf.call(pr,I,void 0)>=0)||U||ne||M.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[de,Re]of M)this.g.setRequestHeader(de,Re);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(v),this.v=!1}catch(de){Tn(this,de)}};function Tn(v,I){v.h=!1,v.g&&(v.j=!0,v.g.abort(),v.j=!1),v.l=I,v.o=5,bs(v),Qs(v)}function bs(v){v.A||(v.A=!0,_e(v,"complete"),_e(v,"error"))}n.abort=function(v){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=v||7,_e(this,"complete"),_e(this,"abort"),Qs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qs(this,!0)),Pt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?qr(this):this.Xa())},n.Xa=function(){qr(this)};function qr(v){if(v.h&&typeof o<"u"){if(v.v&&Is(v)==4)setTimeout(v.Ca.bind(v),0);else if(_e(v,"readystatechange"),Is(v)==4){v.h=!1;try{const de=v.ca();e:switch(de){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break e;default:I=!1}var M;if(!(M=I)){var U;if(U=de===0){let Re=String(v.D).match(Ur)[1]||null;!Re&&l.self&&l.self.location&&(Re=l.self.location.protocol.slice(0,-1)),U=!is.test(Re?Re.toLowerCase():"")}M=U}if(M)_e(v,"complete"),_e(v,"success");else{v.o=6;try{var ne=Is(v)>2?v.g.statusText:""}catch{ne=""}v.l=ne+" ["+v.ca()+"]",bs(v)}}finally{Qs(v)}}}}function Qs(v,I){if(v.g){v.m&&(clearTimeout(v.m),v.m=null);const M=v.g;v.g=null,I||_e(v,"ready");try{M.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Is(v){return v.g?v.g.readyState:0}n.ca=function(){try{return Is(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(v){if(this.g){var I=this.g.responseText;return v&&I.indexOf(v)==0&&(I=I.substring(v.length)),Ts(I)}};function Kn(v){try{if(!v.g)return null;if("response"in v.g)return v.g.response;switch(v.F){case"":case"text":return v.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in v.g)return v.g.mozResponseArrayBuffer}return null}catch{return null}}function As(v){const I={};v=(v.g&&Is(v)>=2&&v.g.getAllResponseHeaders()||"").split(`\r
`);for(let U=0;U<v.length;U++){if(z(v[U]))continue;var M=Sl(v[U]);const ne=M[0];if(M=M[1],typeof M!="string")continue;M=M.trim();const de=I[ne]||[];I[ne]=de,de.push(M)}Pe(I,function(U){return U.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function $s(v,I,M){return M&&M.internalChannelParams&&M.internalChannelParams[v]||I}function gr(v){this.za=0,this.i=[],this.j=new Xn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=$s("failFast",!1,v),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=$s("baseRetryDelayMs",5e3,v),this.Za=$s("retryDelaySeedMs",1e4,v),this.Ta=$s("forwardChannelMaxRetries",2,v),this.va=$s("forwardChannelRequestTimeoutMs",2e4,v),this.ma=v&&v.xmlHttpFactory||void 0,this.Ua=v&&v.Rb||void 0,this.Aa=v&&v.useFetchStreams||!1,this.O=void 0,this.L=v&&v.supportsCrossDomainXhr||!1,this.M="",this.h=new Cl(v&&v.concurrentRequestLimit),this.Ba=new zr,this.S=v&&v.fastHandshake||!1,this.R=v&&v.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=v&&v.Pb||!1,v&&v.ua&&this.j.ua(),v&&v.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&v&&v.detectBufferingProxy||!1,this.ia=void 0,v&&v.longPollingTimeout&&v.longPollingTimeout>0&&(this.ia=v.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=gr.prototype,n.ka=8,n.I=1,n.connect=function(v,I,M,U){gn(0),this.W=v,this.H=I||{},M&&U!==void 0&&(this.H.OSID=M,this.H.OAID=U),this.F=this.X,this.J=Rl(this,null,this.W),Ii(this)};function yt(v){if(ui(v),v.I==3){var I=v.V++,M=yn(v.J);if(Ue(M,"SID",v.M),Ue(M,"RID",I),Ue(M,"TYPE","terminate"),_r(v,M),I=new Qi(v,v.j,I),I.M=2,I.A=Zt(yn(M)),M=!1,l.navigator&&l.navigator.sendBeacon)try{M=l.navigator.sendBeacon(I.A.toString(),"")}catch{}!M&&l.Image&&(new Image().src=I.A,M=!0),M||(I.g=Ml(I.j,null),I.g.ea(I.A)),I.F=Date.now(),js(I)}Rs(v)}function Gr(v){v.g&&(Nl(v),v.g.cancel(),v.g=null)}function ui(v){Gr(v),v.v&&(l.clearTimeout(v.v),v.v=null),fa(v),v.h.cancel(),v.m&&(typeof v.m=="number"&&l.clearTimeout(v.m),v.m=null)}function Ii(v){if(!bl(v.h)&&!v.m){v.m=!0;var I=v.Ea;fe||B(),Y||(fe(),Y=!0),k.add(I,v),v.D=0}}function yo(v,I){return Ws(v.h)>=v.h.j-(v.m?1:0)?!1:v.m?(v.i=I.G.concat(v.i),!0):v.I==1||v.I==2||v.D>=(v.Sa?0:v.Ta)?!1:(v.m=zi(p(v.Ea,v,I),Ju(v,v.D)),v.D++,!0)}n.Ea=function(v){if(this.m)if(this.m=null,this.I==1){if(!v){this.V=Math.floor(Math.random()*1e5),v=this.V++;const ne=new Qi(this,this.j,v);let de=this.o;if(this.U&&(de?(de=K(de),Ie(de,this.U)):de=this.U),this.u!==null||this.R||(ne.J=de,de=null),this.S)e:{for(var I=0,M=0;M<this.i.length;M++){t:{var U=this.i[M];if("__data__"in U.map&&(U=U.map.__data__,typeof U=="string")){U=U.length;break t}U=void 0}if(U===void 0)break;if(I+=U,I>4096){I=M;break e}if(I===4096||M===this.i.length-1){I=M+1;break e}}I=1e3}else I=1e3;I=Yu(this,ne,I),M=yn(this.J),Ue(M,"RID",v),Ue(M,"CVER",22),this.G&&Ue(M,"X-HTTP-Session-Id",this.G),_r(this,M),de&&(this.R?I="headers="+Be(bi(de))+"&"+I:this.u&&mr(M,this.u,de)),dr(this.h,ne),this.Ra&&Ue(M,"TYPE","init"),this.S?(Ue(M,"$req",I),Ue(M,"SID","null"),ne.U=!0,xs(ne,M,null)):xs(ne,M,I),this.I=2}}else this.I==3&&(v?Il(this,v):this.i.length==0||bl(this.h)||Il(this))};function Il(v,I){var M;I?M=I.l:M=v.V++;const U=yn(v.J);Ue(U,"SID",v.M),Ue(U,"RID",M),Ue(U,"AID",v.K),_r(v,U),v.u&&v.o&&mr(U,v.u,v.o),M=new Qi(v,v.j,M,v.D+1),v.u===null&&(M.J=v.o),I&&(v.i=I.G.concat(v.i)),I=Yu(v,M,1e3),M.H=Math.round(v.va*.5)+Math.round(v.va*.5*Math.random()),dr(v.h,M),xs(M,U,I)}function _r(v,I){v.H&&it(v.H,function(M,U){Ue(I,U,M)}),v.l&&it({},function(M,U){Ue(I,U,M)})}function Yu(v,I,M){M=Math.min(v.i.length,M);const U=v.l?p(v.l.Ka,v.l,v):null;e:{var ne=v.i;let st=-1;for(;;){const Vt=["count="+M];st==-1?M>0?(st=ne[0].g,Vt.push("ofs="+st)):st=0:Vt.push("ofs="+st);let Ot=!0;for(let dn=0;dn<M;dn++){var de=ne[dn].g;const ss=ne[dn].map;if(de-=st,de<0)st=Math.max(0,ne[dn].g-100),Ot=!1;else try{de="req"+de+"_"||"";try{var Re=ss instanceof Map?ss:Object.entries(ss);for(const[rs,ji]of Re){let Ms=ji;d(ji)&&(Ms=pn(ji)),Vt.push(de+rs+"="+encodeURIComponent(Ms))}}catch(rs){throw Vt.push(de+"type="+encodeURIComponent("_badmap")),rs}}catch{U&&U(ss)}}if(Ot){Re=Vt.join("&");break e}}Re=void 0}return v=v.i.splice(0,M),I.G=v,Re}function Al(v){if(!v.g&&!v.v){v.Y=1;var I=v.Da;fe||B(),Y||(fe(),Y=!0),k.add(I,v),v.A=0}}function vo(v){return v.g||v.v||v.A>=3?!1:(v.Y++,v.v=zi(p(v.Da,v),Ju(v,v.A)),v.A++,!0)}n.Da=function(){if(this.v=null,ha(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var v=4*this.T;this.j.info("BP detection timer enabled: "+v),this.B=zi(p(this.Wa,this),v)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,gn(10),Gr(this),ha(this))};function Nl(v){v.B!=null&&(l.clearTimeout(v.B),v.B=null)}function ha(v){v.g=new Qi(v,v.j,"rpc",v.Y),v.u===null&&(v.g.J=v.o),v.g.P=0;var I=yn(v.na);Ue(I,"RID","rpc"),Ue(I,"SID",v.M),Ue(I,"AID",v.K),Ue(I,"CI",v.F?"0":"1"),!v.F&&v.ia&&Ue(I,"TO",v.ia),Ue(I,"TYPE","xmlhttp"),_r(v,I),v.u&&v.o&&mr(I,v.u,v.o),v.O&&(v.g.H=v.O);var M=v.g;v=v.ba,M.M=1,M.A=Zt(yn(I)),M.u=null,M.R=!0,ws(M,v)}n.Va=function(){this.C!=null&&(this.C=null,Gr(this),vo(this),gn(19))};function fa(v){v.C!=null&&(l.clearTimeout(v.C),v.C=null)}function Hi(v,I){var M=null;if(v.g==I){fa(v),Nl(v),v.g=null;var U=2}else if(es(v.h,I))M=I.G,aa(v.h,I),U=1;else return;if(v.I!=0){if(I.o)if(U==1){M=I.u?I.u.length:0,I=Date.now()-I.F;var ne=v.D;U=wi(),_e(U,new Bi(U,M)),Ii(v)}else Al(v);else if(ne=I.m,ne==3||ne==0&&I.X>0||!(U==1&&yo(v,I)||U==2&&vo(v)))switch(M&&M.length>0&&(I=v.h,I.i=I.i.concat(M)),ne){case 1:Ns(v,5);break;case 4:Ns(v,10);break;case 3:Ns(v,6);break;default:Ns(v,2)}}}function Ju(v,I){let M=v.Qa+Math.floor(Math.random()*v.Za);return v.isActive()||(M*=2),M*I}function Ns(v,I){if(v.j.info("Error code "+I),I==2){var M=p(v.bb,v),U=v.Ua;const ne=!U;U=new xt(U||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||vn(U,"https"),Zt(U),ne?Si(U.toString(),M):da(U.toString(),M)}else gn(2);v.I=0,v.l&&v.l.pa(I),Rs(v),ui(v)}n.bb=function(v){v?(this.j.info("Successfully pinged google.com"),gn(2)):(this.j.info("Failed to ping google.com"),gn(1))};function Rs(v){if(v.I=0,v.ja=[],v.l){const I=la(v.h);(I.length!=0||v.i.length!=0)&&(D(v.ja,I),D(v.ja,v.i),v.h.i.length=0,A(v.i),v.i.length=0),v.l.oa()}}function Rl(v,I,M){var U=M instanceof xt?yn(M):new xt(M);if(U.g!="")I&&(U.g=I+"."+U.g),qi(U,U.u);else{var ne=l.location;U=ne.protocol,I=I?I+"."+ne.hostname:ne.hostname,ne=+ne.port;const de=new xt(null);U&&vn(de,U),I&&(de.g=I),ne&&qi(de,ne),M&&(de.h=M),U=de}return M=v.G,I=v.wa,M&&I&&Ue(U,M,I),Ue(U,"VER",v.ka),_r(v,U),U}function Ml(v,I,M){if(I&&!v.L)throw Error("Can't create secondary domain capable XhrIo object.");return I=v.Aa&&!v.ma?new Pt(new tt({ab:M})):new Pt(v.ma),I.Fa(v.L),I}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ma(){}n=ma.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Hr(){}Hr.prototype.g=function(v,I){return new ci(v,I)};function ci(v,I){Qe.call(this),this.g=new gr(I),this.l=v,this.h=I&&I.messageUrlParams||null,v=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(v?v["X-Client-Protocol"]="webchannel":v={"X-Client-Protocol":"webchannel"}),this.g.o=v,v=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(v?v["X-WebChannel-Content-Type"]=I.messageContentType:v={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.sa&&(v?v["X-WebChannel-Client-Profile"]=I.sa:v={"X-WebChannel-Client-Profile":I.sa}),this.g.U=v,(v=I&&I.Qb)&&!z(v)&&(this.g.u=v),this.A=I&&I.supportsCrossDomainXhr||!1,this.v=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!z(I)&&(this.g.G=I,v=this.h,v!==null&&I in v&&(v=this.h,I in v&&delete v[I])),this.j=new yr(this)}x(ci,Qe),ci.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ci.prototype.close=function(){yt(this.g)},ci.prototype.o=function(v){var I=this.g;if(typeof v=="string"){var M={};M.__data__=v,v=M}else this.v&&(M={},M.__data__=pn(v),v=M);I.i.push(new Pn(I.Ya++,v)),I.I==3&&Ii(I)},ci.prototype.N=function(){this.g.l=null,delete this.j,yt(this.g),delete this.g,ci.Z.N.call(this)};function Pl(v){Ne.call(this),v.__headers__&&(this.headers=v.__headers__,this.statusCode=v.__status__,delete v.__headers__,delete v.__status__);var I=v.__sm__;if(I){e:{for(const M in I){v=M;break e}v=void 0}(this.i=v)&&(v=this.i,I=I!==null&&v in I?I[v]:void 0),this.data=I}else this.data=v}x(Pl,Ne);function Zu(){ht.call(this),this.status=1}x(Zu,ht);function yr(v){this.g=v}x(yr,ma),yr.prototype.ra=function(){_e(this.g,"a")},yr.prototype.qa=function(v){_e(this.g,new Pl(v))},yr.prototype.pa=function(v){_e(this.g,new Zu)},yr.prototype.oa=function(){_e(this.g,"b")},Hr.prototype.createWebChannel=Hr.prototype.g,ci.prototype.send=ci.prototype.o,ci.prototype.open=ci.prototype.m,ci.prototype.close=ci.prototype.close,IR=function(){return new Hr},bR=function(){return wi()},CR=dt,n0={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},fo.NO_ERROR=0,fo.TIMEOUT=8,fo.HTTP_ERROR=6,gp=fo,xl.COMPLETE="complete",SR=xl,ho.EventType=vi,vi.OPEN="a",vi.CLOSE="b",vi.ERROR="c",vi.MESSAGE="d",Qe.prototype.listen=Qe.prototype.J,Oh=ho,Pt.prototype.listenOnce=Pt.prototype.K,Pt.prototype.getLastError=Pt.prototype.Ha,Pt.prototype.getLastErrorCode=Pt.prototype.ya,Pt.prototype.getStatus=Pt.prototype.ca,Pt.prototype.getResponseJson=Pt.prototype.La,Pt.prototype.getResponseText=Pt.prototype.la,Pt.prototype.send=Pt.prototype.ea,Pt.prototype.setWithCredentials=Pt.prototype.Fa,wR=Pt}).apply(typeof ep<"u"?ep:typeof self<"u"?self:typeof window<"u"?window:{});const hI="@firebase/firestore",fI="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gi.UNAUTHENTICATED=new gi(null),gi.GOOGLE_CREDENTIALS=new gi("google-credentials-uid"),gi.FIRST_PARTY=new gi("first-party-uid"),gi.MOCK_USER=new gi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nd="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Su=new Og("@firebase/firestore");function Lc(){return Su.logLevel}function Ae(n,...e){if(Su.logLevel<=bt.DEBUG){const t=e.map(NT);Su.debug(`Firestore (${Nd}): ${n}`,...t)}}function qn(n,...e){if(Su.logLevel<=bt.ERROR){const t=e.map(NT);Su.error(`Firestore (${Nd}): ${n}`,...t)}}function Cu(n,...e){if(Su.logLevel<=bt.WARN){const t=e.map(NT);Su.warn(`Firestore (${Nd}): ${n}`,...t)}}function NT(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ze(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,AR(n,i,t)}function AR(n,e,t){let i=`FIRESTORE (${Nd}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw qn(i),new Error(i)}function Ze(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||AR(e,s,i)}function je(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ve={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class De extends na{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class QB{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(gi.UNAUTHENTICATED)))}shutdown(){}}class $B{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class XB{constructor(e){this.t=e,this.currentUser=gi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ze(this.o===void 0,42304);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let o=new Ho;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ho,e.enqueueRetryable((()=>s(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},d=h=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ho)}}),0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Ze(typeof i.accessToken=="string",31837,{l:i}),new NR(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ze(e===null||typeof e=="string",2055,{h:e}),new gi(e)}}class ez{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=gi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tz{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new ez(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(gi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class mI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nz{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ar(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ze(this.o===void 0,3512);const i=o=>{o.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Ae("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>i(o)))};const s=o=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new mI(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Ze(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new mI(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iz(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RT{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=iz(40);for(let o=0;o<s.length;++o)i.length<20&&s[o]<t&&(i+=e.charAt(s[o]%62))}return i}}function ut(n,e){return n<e?-1:n>e?1:0}function i0(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const s=n.charAt(i),o=e.charAt(i);if(s!==o)return vv(s)===vv(o)?ut(s,o):vv(s)?1:-1}return ut(n.length,e.length)}const sz=55296,rz=57343;function vv(n){const e=n.charCodeAt(0);return e>=sz&&e<=rz}function nd(n,e,t){return n.length===e.length&&n.every(((i,s)=>t(i,e[s])))}function RR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pI="__name__";class to{constructor(e,t,i){t===void 0?t=0:t>e.length&&ze(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&ze(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return to.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof to?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const o=to.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return ut(e.length,t.length)}static compareSegments(e,t){const i=to.isNumericId(e),s=to.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?to.extractNumericId(e).compare(to.extractNumericId(t)):i0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return nl.fromString(e.substring(4,e.length-2))}}class Kt extends to{construct(e,t,i){return new Kt(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new De(ve.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((s=>s.length>0)))}return new Kt(t)}static emptyPath(){return new Kt([])}}const oz=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class An extends to{construct(e,t,i){return new An(e,t,i)}static isValidIdentifier(e){return oz.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),An.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===pI}static keyField(){return new An([pI])}static fromServerFormat(e){const t=[];let i="",s=0;const o=()=>{if(i.length===0)throw new De(ve.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let l=!1;for(;s<e.length;){const d=e[s];if(d==="\\"){if(s+1===e.length)throw new De(ve.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new De(ve.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=h,s+=2}else d==="`"?(l=!l,s++):d!=="."||l?(i+=d,s++):(o(),s++)}if(o(),l)throw new De(ve.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new An(t)}static emptyPath(){return new An([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e){this.path=e}static fromPath(e){return new Ve(Kt.fromString(e))}static fromName(e){return new Ve(Kt.fromString(e).popFirst(5))}static empty(){return new Ve(Kt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Kt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Kt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ve(new Kt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(n,e,t){if(!t)throw new De(ve.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function az(n,e,t,i){if(e===!0&&i===!0)throw new De(ve.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gI(n){if(!Ve.isDocumentKey(n))throw new De(ve.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _I(n){if(Ve.isDocumentKey(n))throw new De(ve.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function PR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function qg(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ze(12329,{type:typeof n})}function Bs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new De(ve.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=qg(n);throw new De(ve.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(n,e){const t={typeString:n};return e&&(t.value=e),t}function kf(n,e){if(!PR(n))throw new De(ve.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const s=e[i].typeString,o="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const l=n[i];if(s&&typeof l!==s){t=`JSON field '${i}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){t=`Expected '${i}' field to equal '${o.value}'`;break}}if(t)throw new De(ve.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yI=-62135596800,vI=1e6;class en{static now(){return en.fromMillis(Date.now())}static fromDate(e){return en.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*vI);return new en(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new De(ve.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new De(ve.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<yI)throw new De(ve.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new De(ve.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/vI}_compareTo(e){return this.seconds===e.seconds?ut(this.nanoseconds,e.nanoseconds):ut(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:en._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(kf(e,en._jsonSchema))return new en(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-yI;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}en._jsonSchemaVersion="firestore/timestamp/1.0",en._jsonSchema={type:$n("string",en._jsonSchemaVersion),seconds:$n("number"),nanoseconds:$n("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{static fromTimestamp(e){return new et(e)}static min(){return new et(new en(0,0))}static max(){return new et(new en(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const id=-1;class jp{constructor(e,t,i,s){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=s}}function s0(n){return n.fields.find((e=>e.kind===2))}function ru(n){return n.fields.filter((e=>e.kind!==2))}jp.UNKNOWN_ID=-1;class _p{constructor(e,t){this.fieldPath=e,this.kind=t}}class hf{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new hf(0,Gs.min())}}function kR(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=et.fromTimestamp(i===1e9?new en(t+1,0):new en(t,i));return new Gs(s,Ve.empty(),e)}function DR(n){return new Gs(n.readTime,n.key,id)}class Gs{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Gs(et.min(),Ve.empty(),id)}static max(){return new Gs(et.max(),Ve.empty(),id)}}function MT(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ve.comparator(n.documentKey,e.documentKey),t!==0?t:ut(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _l(n){if(n.code!==ve.FAILED_PRECONDITION||n.message!==LR)throw n;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ze(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ie(((i,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(i,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(i,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ie?t:ie.resolve(t)}catch(t){return ie.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ie.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ie.reject(t)}static resolve(e){return new ie(((t,i)=>{t(e)}))}static reject(e){return new ie(((t,i)=>{i(e)}))}static waitFor(e){return new ie(((t,i)=>{let s=0,o=0,l=!1;e.forEach((d=>{++s,d.next((()=>{++o,l&&o===s&&t()}),(h=>i(h)))})),l=!0,o===s&&t()}))}static or(e){let t=ie.resolve(!1);for(const i of e)t=t.next((s=>s?ie.resolve(s):i()));return t}static forEach(e,t){const i=[];return e.forEach(((s,o)=>{i.push(t.call(this,s,o))})),this.waitFor(i)}static mapArray(e,t){return new ie(((i,s)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const p=h;t(e[p]).next((T=>{l[p]=T,++d,d===o&&i(l)}),(T=>s(T)))}}))}static doWhile(e,t){return new ie(((i,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):i()};o()}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us="SimpleDb";class Gg{static open(e,t,i,s){try{return new Gg(t,e.transaction(s,i))}catch(o){throw new Kh(t,o)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Ho,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Kh(e,t.error)):this.S.resolve()},this.transaction.onerror=i=>{const s=PT(i.target.error);this.S.reject(new Kh(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Ae(Us,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new uz(t)}}class il{static delete(e){return Ae(Us,"Removing database:",e),lu(AN().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!UN())return!1;if(il.F())return!0;const e=ii(),t=il.M(e),i=0<t&&t<10,s=OR(e),o=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||o)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}constructor(e,t,i){this.name=e,this.version=t,this.N=i,this.B=null,il.M(ii())===12.2&&qn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Ae(Us,"Opening database:",this.name),this.db=await new Promise(((t,i)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=o=>{const l=o.target.result;t(l)},s.onblocked=()=>{i(new Kh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const l=o.target.error;l.name==="VersionError"?i(new De(ve.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):l.name==="InvalidStateError"?i(new De(ve.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+l)):i(new Kh(e,l))},s.onupgradeneeded=o=>{Ae(Us,'Database "'+this.name+'" requires upgrade from version:',o.oldVersion);const l=o.target.result;this.N.k(l,s.transaction,o.oldVersion,this.version).next((()=>{Ae(Us,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,s){const o=t==="readonly";let l=0;for(;;){++l;try{this.db=await this.L(e);const d=Gg.open(this.db,e,o?"readonly":"readwrite",i),h=s(d).next((p=>(d.C(),p))).catch((p=>(d.abort(p),ie.reject(p)))).toPromise();return h.catch((()=>{})),await d.D,h}catch(d){const h=d,p=h.name!=="FirebaseError"&&l<3;if(Ae(Us,"Transaction failed with error:",h.message,"Retrying:",p),this.close(),!p)return Promise.reject(h)}}}close(){this.db&&this.db.close(),this.db=void 0}}function OR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class lz{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return lu(this.U.delete())}}class Kh extends De{constructor(e,t){super(ve.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function yl(n){return n.name==="IndexedDbTransactionError"}class uz{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(Ae(Us,"PUT",this.store.name,e,t),i=this.store.put(t,e)):(Ae(Us,"PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),lu(i)}add(e){return Ae(Us,"ADD",this.store.name,e,e),lu(this.store.add(e))}get(e){return lu(this.store.get(e)).next((t=>(t===void 0&&(t=null),Ae(Us,"GET",this.store.name,e,t),t)))}delete(e){return Ae(Us,"DELETE",this.store.name,e),lu(this.store.delete(e))}count(){return Ae(Us,"COUNT",this.store.name),lu(this.store.count())}J(e,t){const i=this.options(e,t),s=i.index?this.store.index(i.index):this.store;if(typeof s.getAll=="function"){const o=s.getAll(i.range);return new ie(((l,d)=>{o.onerror=h=>{d(h.target.error)},o.onsuccess=h=>{l(h.target.result)}}))}{const o=this.cursor(i),l=[];return this.H(o,((d,h)=>{l.push(h)})).next((()=>l))}}Y(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new ie(((s,o)=>{i.onerror=l=>{o(l.target.error)},i.onsuccess=l=>{s(l.target.result)}}))}Z(e,t){Ae(Us,"DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const s=this.cursor(i);return this.H(s,((o,l,d)=>d.delete()))}ee(e,t){let i;t?i=e:(i={},t=e);const s=this.cursor(i);return this.H(s,t)}te(e){const t=this.cursor({});return new ie(((i,s)=>{t.onerror=o=>{const l=PT(o.target.error);s(l)},t.onsuccess=o=>{const l=o.target.result;l?e(l.primaryKey,l.value).next((d=>{d?l.continue():i()})):i()}}))}H(e,t){const i=[];return new ie(((s,o)=>{e.onerror=l=>{o(l.target.error)},e.onsuccess=l=>{const d=l.target.result;if(!d)return void s();const h=new lz(d),p=t(d.primaryKey,d.value,h);if(p instanceof ie){const T=p.catch((x=>(h.done(),ie.reject(x))));i.push(T)}h.isDone?s():h.G===null?d.continue():d.continue(h.G)}})).next((()=>ie.waitFor(i)))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function lu(n){return new ie(((e,t)=>{n.onsuccess=i=>{const s=i.target.result;e(s)},n.onerror=i=>{const s=PT(i.target.error);t(s)}}))}let TI=!1;function PT(n){const e=il.M(ii());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new De("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return TI||(TI=!0,setTimeout((()=>{throw i}),0)),i}}return n}const Wh="IndexBackfiller";class cz{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Ae(Wh,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();Ae(Wh,`Documents written: ${t}`)}catch(t){yl(t)?Ae(Wh,"Ignoring IndexedDB error during index backfill: ",t):await _l(t)}await this.re(6e4)}))}}class dz{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const i=new Set;let s=t,o=!0;return ie.doWhile((()=>o===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((l=>{if(l!==null&&!i.has(l))return Ae(Wh,`Processing collection: ${l}`),this.oe(e,l,s).next((d=>{s-=d,i.add(l)}));o=!1})))).next((()=>t-s))}oe(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((s=>this.localStore.localDocuments.getNextDocuments(e,t,s,i).next((o=>{const l=o.changes;return this.localStore.indexManager.updateIndexEntries(e,l).next((()=>this._e(s,o))).next((d=>(Ae(Wh,`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d)))).next((()=>l.size))}))))}_e(e,t){let i=e;return t.changes.forEach(((s,o)=>{const l=DR(o);MT(l,i)>0&&(i=l)})),new Gs(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ms.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _u=-1;function Hg(n){return n==null}function ff(n){return n===0&&1/n==-1/0}function UR(n){return typeof n=="number"&&Number.isInteger(n)&&!ff(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kp="";function Ui(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=EI(e)),e=hz(n.get(t),e);return EI(e)}function hz(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Kp:t+="";break;default:t+=o}}return t}function EI(n){return n+Kp+""}function io(n){const e=n.length;if(Ze(e>=2,64408,{path:n}),e===2)return Ze(n.charAt(0)===Kp&&n.charAt(1)==="",56145,{path:n}),Kt.emptyPath();const t=e-2,i=[];let s="";for(let o=0;o<e;){const l=n.indexOf(Kp,o);switch((l<0||l>t)&&ze(50515,{path:n}),n.charAt(l+1)){case"":const d=n.substring(o,l);let h;s.length===0?h=d:(s+=d,h=s,s=""),i.push(h);break;case"":s+=n.substring(o,l),s+="\0";break;case"":s+=n.substring(o,l+1);break;default:ze(61167,{path:n})}o=l+2}return new Kt(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou="remoteDocuments",Df="owner",Ac="owner",mf="mutationQueues",fz="userId",Cr="mutations",xI="batchId",mu="userMutationsIndex",wI=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(n,e){return[n,Ui(e)]}function FR(n,e,t){return[n,Ui(e),t]}const mz={},sd="documentMutations",Wp="remoteDocumentsV14",pz=["prefixPath","collectionGroup","readTime","documentId"],vp="documentKeyIndex",gz=["prefixPath","collectionGroup","documentId"],BR="collectionGroupIndex",_z=["collectionGroup","readTime","prefixPath","documentId"],pf="remoteDocumentGlobal",r0="remoteDocumentGlobalKey",rd="targets",zR="queryTargetsIndex",yz=["canonicalId","targetId"],od="targetDocuments",vz=["targetId","path"],kT="documentTargetsIndex",Tz=["path","targetId"],Yp="targetGlobalKey",yu="targetGlobal",gf="collectionParents",Ez=["collectionId","parent"],ad="clientMetadata",xz="clientId",jg="bundles",wz="bundleId",Kg="namedQueries",Sz="name",DT="indexConfiguration",Cz="indexId",o0="collectionGroupIndex",bz="collectionGroup",Yh="indexState",Iz=["indexId","uid"],qR="sequenceNumberIndex",Az=["uid","sequenceNumber"],Jh="indexEntries",Nz=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],GR="documentKeyIndex",Rz=["indexId","uid","orderedDocumentKey"],Wg="documentOverlays",Mz=["userId","collectionPath","documentId"],a0="collectionPathOverlayIndex",Pz=["userId","collectionPath","largestBatchId"],HR="collectionGroupOverlayIndex",kz=["userId","collectionGroup","largestBatchId"],LT="globals",Dz="name",jR=[mf,Cr,sd,ou,rd,Df,yu,od,ad,pf,gf,jg,Kg],Lz=[...jR,Wg],KR=[mf,Cr,sd,Wp,rd,Df,yu,od,ad,pf,gf,jg,Kg,Wg],WR=KR,VT=[...WR,DT,Yh,Jh],Vz=VT,YR=[...VT,LT],Oz=YR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0 extends VR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function si(n,e){const t=je(n);return il.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SI(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function vl(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function JR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nn=class u0{constructor(e,t){this.comparator=e,this.root=t||sl.EMPTY}insert(e,t){return new u0(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sl.BLACK,null,null))}remove(e){return new u0(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tp(this.root,e,this.comparator,!1)}getReverseIterator(){return new tp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tp(this.root,e,this.comparator,!0)}},tp=class{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},sl=class Oo{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??Oo.RED,this.left=s??Oo.EMPTY,this.right=o??Oo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,o){return new Oo(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Oo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Oo.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Oo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Oo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ze(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ze(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ze(27949);return e+(this.isRed()?0:1)}};sl.EMPTY=null,sl.RED=!0,sl.BLACK=!1;sl.EMPTY=new class{constructor(){this.size=0}get key(){throw ze(57766)}get value(){throw ze(16141)}get color(){throw ze(16727)}get left(){throw ze(29726)}get right(){throw ze(36894)}copy(e,t,i,s,o){return this}insert(e,t,i){return new sl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this.comparator=e,this.data=new Nn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new CI(this.data.getIterator())}getIteratorFrom(e){return new CI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof sn)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=i.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new sn(this.comparator);return t.data=e,t}}class CI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Nc(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e){this.fields=e,e.sort(An.comparator)}static empty(){return new ps([])}unionWith(e){let t=new sn(An.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new ps(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return nd(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ZR("Invalid base64 string: "+o):o}})(e);return new Hn(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o})(e);return new Hn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ut(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hn.EMPTY_BYTE_STRING=new Hn("");const Uz=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zo(n){if(Ze(!!n,39018),typeof n=="string"){let e=0;const t=Uz.exec(n);if(Ze(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Cn(n.seconds),nanos:Cn(n.nanos)}}function Cn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qo(n){return typeof n=="string"?Hn.fromBase64String(n):Hn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR="server_timestamp",$R="__type__",XR="__previous_value__",e2="__local_write_time__";function OT(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[$R])==null?void 0:i.stringValue)===QR}function Yg(n){const e=n.mapValue.fields[XR];return OT(e)?Yg(e):e}function _f(n){const e=Zo(n.mapValue.fields[e2].timestampValue);return new en(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fz{constructor(e,t,i,s,o,l,d,h,p,T){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=p,this.isUsingEmulator=T}}const Jp="(default)";class bu{constructor(e,t){this.projectId=e,this.database=t||Jp}static empty(){return new bu("","")}get isDefaultDatabase(){return this.database===Jp}isEqual(e){return e instanceof bu&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT="__type__",t2="__max__",$a={mapValue:{fields:{__type__:{stringValue:t2}}}},FT="__vector__",ld="value",Tp={nullValue:"NULL_VALUE"};function ul(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?OT(n)?4:n2(n)?9007199254740991:Jg(n)?10:11:ze(28295,{value:n})}function co(n,e){if(n===e)return!0;const t=ul(n);if(t!==ul(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return _f(n).isEqual(_f(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=Zo(s.timestampValue),d=Zo(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return Qo(s.bytesValue).isEqual(Qo(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return Cn(s.geoPointValue.latitude)===Cn(o.geoPointValue.latitude)&&Cn(s.geoPointValue.longitude)===Cn(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Cn(s.integerValue)===Cn(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=Cn(s.doubleValue),d=Cn(o.doubleValue);return l===d?ff(l)===ff(d):isNaN(l)&&isNaN(d)}return!1})(n,e);case 9:return nd(n.arrayValue.values||[],e.arrayValue.values||[],co);case 10:case 11:return(function(s,o){const l=s.mapValue.fields||{},d=o.mapValue.fields||{};if(SI(l)!==SI(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!co(l[h],d[h])))return!1;return!0})(n,e);default:return ze(52216,{left:n})}}function yf(n,e){return(n.values||[]).find((t=>co(t,e)))!==void 0}function cl(n,e){if(n===e)return 0;const t=ul(n),i=ul(e);if(t!==i)return ut(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return ut(n.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=Cn(o.integerValue||o.doubleValue),h=Cn(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(n,e);case 3:return bI(n.timestampValue,e.timestampValue);case 4:return bI(_f(n),_f(e));case 5:return i0(n.stringValue,e.stringValue);case 6:return(function(o,l){const d=Qo(o),h=Qo(l);return d.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let p=0;p<d.length&&p<h.length;p++){const T=ut(d[p],h[p]);if(T!==0)return T}return ut(d.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=ut(Cn(o.latitude),Cn(l.latitude));return d!==0?d:ut(Cn(o.longitude),Cn(l.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return II(n.arrayValue,e.arrayValue);case 10:return(function(o,l){var C,A,D,F;const d=o.fields||{},h=l.fields||{},p=(C=d[ld])==null?void 0:C.arrayValue,T=(A=h[ld])==null?void 0:A.arrayValue,x=ut(((D=p==null?void 0:p.values)==null?void 0:D.length)||0,((F=T==null?void 0:T.values)==null?void 0:F.length)||0);return x!==0?x:II(p,T)})(n.mapValue,e.mapValue);case 11:return(function(o,l){if(o===$a.mapValue&&l===$a.mapValue)return 0;if(o===$a.mapValue)return 1;if(l===$a.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),p=l.fields||{},T=Object.keys(p);h.sort(),T.sort();for(let x=0;x<h.length&&x<T.length;++x){const C=i0(h[x],T[x]);if(C!==0)return C;const A=cl(d[h[x]],p[T[x]]);if(A!==0)return A}return ut(h.length,T.length)})(n.mapValue,e.mapValue);default:throw ze(23264,{he:t})}}function bI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ut(n,e);const t=Zo(n),i=Zo(e),s=ut(t.seconds,i.seconds);return s!==0?s:ut(t.nanos,i.nanos)}function II(n,e){const t=n.values||[],i=e.values||[];for(let s=0;s<t.length&&s<i.length;++s){const o=cl(t[s],i[s]);if(o)return o}return ut(t.length,i.length)}function ud(n){return c0(n)}function c0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=Zo(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Qo(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Ve.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",s=!0;for(const o of t.values||[])s?s=!1:i+=",",i+=c0(o);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const l of i)o?o=!1:s+=",",s+=`${l}:${c0(t.fields[l])}`;return s+"}"})(n.mapValue):ze(61005,{value:n})}function Ep(n){switch(ul(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Yg(n);return e?16+Ep(e):16;case 5:return 2*n.stringValue.length;case 6:return Qo(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((s,o)=>s+Ep(o)),0)})(n.arrayValue);case 10:case 11:return(function(i){let s=0;return vl(i.fields,((o,l)=>{s+=o.length+Ep(l)})),s})(n.mapValue);default:throw ze(13486,{value:n})}}function vf(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function d0(n){return!!n&&"integerValue"in n}function Tf(n){return!!n&&"arrayValue"in n}function AI(n){return!!n&&"nullValue"in n}function NI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xp(n){return!!n&&"mapValue"in n}function Jg(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[UT])==null?void 0:i.stringValue)===FT}function Zh(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return vl(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=Zh(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zh(n.arrayValue.values[t]);return e}return{...n}}function n2(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===t2}const i2={mapValue:{fields:{[UT]:{stringValue:FT},[ld]:{arrayValue:{}}}}};function Bz(n){return"nullValue"in n?Tp:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?vf(bu.empty(),Ve.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Jg(n)?i2:{mapValue:{}}:ze(35942,{value:n})}function zz(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?vf(bu.empty(),Ve.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?i2:"mapValue"in n?Jg(n)?{mapValue:{}}:$a:ze(61959,{value:n})}function RI(n,e){const t=cl(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function MI(n,e){const t=cl(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e){this.value=e}static empty(){return new Li({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!xp(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zh(t)}setAll(e){let t=An.emptyPath(),i={},s=[];e.forEach(((l,d)=>{if(!t.isImmediateParentOf(d)){const h=this.getFieldsMap(t);this.applyChanges(h,i,s),i={},s=[],t=d.popLast()}l?i[d.lastSegment()]=Zh(l):s.push(d.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,i,s)}delete(e){const t=this.field(e.popLast());xp(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return co(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];xp(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){vl(t,((s,o)=>e[s]=o));for(const s of i)delete e[s]}clone(){return new Li(Zh(this.value))}}function s2(n){const e=[];return vl(n.fields,((t,i)=>{const s=new An([t]);if(xp(i)){const o=s2(i.mapValue).fields;if(o.length===0)e.push(s);else for(const l of o)e.push(s.child(l))}else e.push(s)})),new ps(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,t,i,s,o,l,d){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Vn(e,0,et.min(),et.min(),et.min(),Li.empty(),0)}static newFoundDocument(e,t,i,s){return new Vn(e,1,t,et.min(),i,s,0)}static newNoDocument(e,t){return new Vn(e,2,t,et.min(),et.min(),Li.empty(),0)}static newUnknownDocument(e,t){return new Vn(e,3,t,et.min(),et.min(),Li.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Li.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Li.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Vn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Vn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e,t){this.position=e,this.inclusive=t}}function PI(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const o=e[s],l=n.position[s];if(o.field.isKeyField()?i=Ve.comparator(Ve.fromName(l.referenceValue),t.key):i=cl(l,t.data.field(o.field)),o.dir==="desc"&&(i*=-1),i!==0)break}return i}function kI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!co(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e,t="asc"){this.field=e,this.dir=t}}function qz(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{}class Lt extends r2{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Gz(e,t,i):t==="array-contains"?new Kz(e,i):t==="in"?new d2(e,i):t==="not-in"?new Wz(e,i):t==="array-contains-any"?new Yz(e,i):new Lt(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Hz(e,i):new jz(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(cl(t,this.value)):t!==null&&ul(this.value)===ul(t)&&this.matchesComparison(cl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ze(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tn extends r2{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new tn(e,t)}matches(e){return dd(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function dd(n){return n.op==="and"}function h0(n){return n.op==="or"}function BT(n){return o2(n)&&dd(n)}function o2(n){for(const e of n.filters)if(e instanceof tn)return!1;return!0}function f0(n){if(n instanceof Lt)return n.field.canonicalString()+n.op.toString()+ud(n.value);if(BT(n))return n.filters.map((e=>f0(e))).join(",");{const e=n.filters.map((t=>f0(t))).join(",");return`${n.op}(${e})`}}function a2(n,e){return n instanceof Lt?(function(i,s){return s instanceof Lt&&i.op===s.op&&i.field.isEqual(s.field)&&co(i.value,s.value)})(n,e):n instanceof tn?(function(i,s){return s instanceof tn&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce(((o,l,d)=>o&&a2(l,s.filters[d])),!0):!1})(n,e):void ze(19439)}function l2(n,e){const t=n.filters.concat(e);return tn.create(t,n.op)}function u2(n){return n instanceof Lt?(function(t){return`${t.field.canonicalString()} ${t.op} ${ud(t.value)}`})(n):n instanceof tn?(function(t){return t.op.toString()+" {"+t.getFilters().map(u2).join(" ,")+"}"})(n):"Filter"}class Gz extends Lt{constructor(e,t,i){super(e,t,i),this.key=Ve.fromName(i.referenceValue)}matches(e){const t=Ve.comparator(e.key,this.key);return this.matchesComparison(t)}}class Hz extends Lt{constructor(e,t){super(e,"in",t),this.keys=c2("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class jz extends Lt{constructor(e,t){super(e,"not-in",t),this.keys=c2("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function c2(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((i=>Ve.fromName(i.referenceValue)))}class Kz extends Lt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Tf(t)&&yf(t.arrayValue,this.value)}}class d2 extends Lt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&yf(this.value.arrayValue,t)}}class Wz extends Lt{constructor(e,t){super(e,"not-in",t)}matches(e){if(yf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!yf(this.value.arrayValue,t)}}class Yz extends Lt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Tf(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>yf(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e,t=null,i=[],s=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function m0(n,e=null,t=[],i=[],s=null,o=null,l=null){return new Jz(n,e,t,i,s,o,l)}function Iu(n){const e=je(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>f0(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(o){return o.field.canonicalString()+o.dir})(i))).join(","),Hg(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>ud(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>ud(i))).join(",")),e.Te=t}return e.Te}function Lf(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!qz(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!a2(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!kI(n.startAt,e.startAt)&&kI(n.endAt,e.endAt)}function Qp(n){return Ve.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $p(n,e){return n.filters.filter((t=>t instanceof Lt&&t.field.isEqual(e)))}function DI(n,e,t){let i=Tp,s=!0;for(const o of $p(n,e)){let l=Tp,d=!0;switch(o.op){case"<":case"<=":l=Bz(o.value);break;case"==":case"in":case">=":l=o.value;break;case">":l=o.value,d=!1;break;case"!=":case"not-in":l=Tp}RI({value:i,inclusive:s},{value:l,inclusive:d})<0&&(i=l,s=d)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const l=t.position[o];RI({value:i,inclusive:s},{value:l,inclusive:t.inclusive})<0&&(i=l,s=t.inclusive);break}}return{value:i,inclusive:s}}function LI(n,e,t){let i=$a,s=!0;for(const o of $p(n,e)){let l=$a,d=!0;switch(o.op){case">=":case">":l=zz(o.value),d=!1;break;case"==":case"in":case"<=":l=o.value;break;case"<":l=o.value,d=!1;break;case"!=":case"not-in":l=$a}MI({value:i,inclusive:s},{value:l,inclusive:d})>0&&(i=l,s=d)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){const l=t.position[o];MI({value:i,inclusive:s},{value:l,inclusive:t.inclusive})>0&&(i=l,s=t.inclusive);break}}return{value:i,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e,t=null,i=[],s=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function h2(n,e,t,i,s,o,l,d){return new Vf(n,e,t,i,s,o,l,d)}function Zg(n){return new Vf(n)}function VI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function f2(n){return n.collectionGroup!==null}function Qh(n){const e=je(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new sn(An.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((p=>{p.isInequality()&&(d=d.add(p.field))}))})),d})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Zp(o,i))})),t.has(An.keyField().canonicalString())||e.Ie.push(new Zp(An.keyField(),i))}return e.Ie}function zs(n){const e=je(n);return e.Ee||(e.Ee=Zz(e,Qh(n))),e.Ee}function Zz(n,e){if(n.limitType==="F")return m0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Zp(s.field,o)}));const t=n.endAt?new cd(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new cd(n.startAt.position,n.startAt.inclusive):null;return m0(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function p0(n,e){const t=n.filters.concat([e]);return new Vf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function g0(n,e,t){return new Vf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Qg(n,e){return Lf(zs(n),zs(e))&&n.limitType===e.limitType}function m2(n){return`${Iu(zs(n))}|lt:${n.limitType}`}function Vc(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((s=>u2(s))).join(", ")}]`),Hg(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((s=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(s))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((s=>ud(s))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((s=>ud(s))).join(",")),`Target(${i})`})(zs(n))}; limitType=${n.limitType})`}function Of(n,e){return e.isFoundDocument()&&(function(i,s){const o=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):Ve.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o)})(n,e)&&(function(i,s){for(const o of Qh(i))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(i,s){for(const o of i.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(i,s){return!(i.startAt&&!(function(l,d,h){const p=PI(l,d,h);return l.inclusive?p<=0:p<0})(i.startAt,Qh(i),s)||i.endAt&&!(function(l,d,h){const p=PI(l,d,h);return l.inclusive?p>=0:p>0})(i.endAt,Qh(i),s))})(n,e)}function p2(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function g2(n){return(e,t)=>{let i=!1;for(const s of Qh(n)){const o=Qz(s,e,t);if(o!==0)return o;i=i||s.field.isKeyField()}return 0}}function Qz(n,e,t){const i=n.field.isKeyField()?Ve.comparator(e.key,t.key):(function(o,l,d){const h=l.data.field(o),p=d.data.field(o);return h!==null&&p!==null?cl(h,p):ze(42886)})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return ze(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,o]of i)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){vl(this.inner,((t,i)=>{for(const[s,o]of i)e(s,o)}))}isEmpty(){return JR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $z=new Nn(Ve.comparator);function Fs(){return $z}const _2=new Nn(Ve.comparator);function Uh(...n){let e=_2;for(const t of n)e=e.insert(t.key,t);return e}function y2(n){let e=_2;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function so(){return $h()}function v2(){return $h()}function $h(){return new sa((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Xz=new Nn(Ve.comparator),e7=new sn(Ve.comparator);function Tt(...n){let e=e7;for(const t of n)e=e.add(t);return e}const t7=new sn(ut);function zT(){return t7}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qT(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ff(e)?"-0":e}}function T2(n){return{integerValue:""+n}}function n7(n,e){return UR(e)?T2(e):qT(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(){this._=void 0}}function i7(n,e,t){return n instanceof hd?(function(s,o){const l={fields:{[$R]:{stringValue:QR},[e2]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&OT(o)&&(o=Yg(o)),o&&(l.fields[XR]=o),{mapValue:l}})(t,e):n instanceof Au?x2(n,e):n instanceof fd?w2(n,e):(function(s,o){const l=E2(s,o),d=OI(l)+OI(s.Ae);return d0(l)&&d0(s.Ae)?T2(d):qT(s.serializer,d)})(n,e)}function s7(n,e,t){return n instanceof Au?x2(n,e):n instanceof fd?w2(n,e):t}function E2(n,e){return n instanceof Ef?(function(i){return d0(i)||(function(o){return!!o&&"doubleValue"in o})(i)})(e)?e:{integerValue:0}:null}class hd extends $g{}class Au extends $g{constructor(e){super(),this.elements=e}}function x2(n,e){const t=S2(e);for(const i of n.elements)t.some((s=>co(s,i)))||t.push(i);return{arrayValue:{values:t}}}class fd extends $g{constructor(e){super(),this.elements=e}}function w2(n,e){let t=S2(e);for(const i of n.elements)t=t.filter((s=>!co(s,i)));return{arrayValue:{values:t}}}class Ef extends $g{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function OI(n){return Cn(n.integerValue||n.doubleValue)}function S2(n){return Tf(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(e,t){this.field=e,this.transform=t}}function r7(n,e){return n.field.isEqual(e.field)&&(function(i,s){return i instanceof Au&&s instanceof Au||i instanceof fd&&s instanceof fd?nd(i.elements,s.elements,co):i instanceof Ef&&s instanceof Ef?co(i.Ae,s.Ae):i instanceof hd&&s instanceof hd})(n.transform,e.transform)}class o7{constructor(e,t){this.version=e,this.transformResults=t}}class Oi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Oi}static exists(e){return new Oi(void 0,e)}static updateTime(e){return new Oi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function wp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Xg{}function C2(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new e_(n.key,Oi.none()):new Rd(n.key,n.data,Oi.none());{const t=n.data,i=Li.empty();let s=new sn(An.comparator);for(let o of e.fields)if(!s.has(o)){let l=t.field(o);l===null&&o.length>1&&(o=o.popLast(),l=t.field(o)),l===null?i.delete(o):i.set(o,l),s=s.add(o)}return new ra(n.key,i,new ps(s.toArray()),Oi.none())}}function a7(n,e,t){n instanceof Rd?(function(s,o,l){const d=s.value.clone(),h=FI(s.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(n,e,t):n instanceof ra?(function(s,o,l){if(!wp(s.precondition,o))return void o.convertToUnknownDocument(l.version);const d=FI(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(b2(s)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,t)}function Xh(n,e,t,i){return n instanceof Rd?(function(o,l,d,h){if(!wp(o.precondition,l))return d;const p=o.value.clone(),T=BI(o.fieldTransforms,h,l);return p.setAll(T),l.convertToFoundDocument(l.version,p).setHasLocalMutations(),null})(n,e,t,i):n instanceof ra?(function(o,l,d,h){if(!wp(o.precondition,l))return d;const p=BI(o.fieldTransforms,h,l),T=l.data;return T.setAll(b2(o)),T.setAll(p),l.convertToFoundDocument(l.version,T).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((x=>x.field)))})(n,e,t,i):(function(o,l,d){return wp(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(n,e,t)}function l7(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),o=E2(i.transform,s||null);o!=null&&(t===null&&(t=Li.empty()),t.set(i.field,o))}return t||null}function UI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&nd(i,s,((o,l)=>r7(o,l)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Rd extends Xg{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ra extends Xg{constructor(e,t,i,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function b2(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function FI(n,e,t){const i=new Map;Ze(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],l=o.transform,d=e.data.field(o.field);i.set(o.field,s7(l,d,t[s]))}return i}function BI(n,e,t){const i=new Map;for(const s of n){const o=s.transform,l=t.data.field(s.field);i.set(s.field,i7(o,l,e))}return i}class e_ extends Xg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class I2 extends Xg{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&a7(o,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Xh(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Xh(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=v2();return this.mutations.forEach((s=>{const o=e.get(s.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=t.has(s.key)?null:d;const h=C2(l,d);h!==null&&i.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(et.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Tt())}isEqual(e){return this.batchId===e.batchId&&nd(this.mutations,e.mutations,((t,i)=>UI(t,i)))&&nd(this.baseMutations,e.baseMutations,((t,i)=>UI(t,i)))}}class jT{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){Ze(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let s=(function(){return Xz})();const o=e.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,i[l].version);return new jT(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u7{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qn,Ut;function c7(n){switch(n){case ve.OK:return ze(64938);case ve.CANCELLED:case ve.UNKNOWN:case ve.DEADLINE_EXCEEDED:case ve.RESOURCE_EXHAUSTED:case ve.INTERNAL:case ve.UNAVAILABLE:case ve.UNAUTHENTICATED:return!1;case ve.INVALID_ARGUMENT:case ve.NOT_FOUND:case ve.ALREADY_EXISTS:case ve.PERMISSION_DENIED:case ve.FAILED_PRECONDITION:case ve.ABORTED:case ve.OUT_OF_RANGE:case ve.UNIMPLEMENTED:case ve.DATA_LOSS:return!0;default:return ze(15467,{code:n})}}function A2(n){if(n===void 0)return qn("GRPC error has no .code"),ve.UNKNOWN;switch(n){case Qn.OK:return ve.OK;case Qn.CANCELLED:return ve.CANCELLED;case Qn.UNKNOWN:return ve.UNKNOWN;case Qn.DEADLINE_EXCEEDED:return ve.DEADLINE_EXCEEDED;case Qn.RESOURCE_EXHAUSTED:return ve.RESOURCE_EXHAUSTED;case Qn.INTERNAL:return ve.INTERNAL;case Qn.UNAVAILABLE:return ve.UNAVAILABLE;case Qn.UNAUTHENTICATED:return ve.UNAUTHENTICATED;case Qn.INVALID_ARGUMENT:return ve.INVALID_ARGUMENT;case Qn.NOT_FOUND:return ve.NOT_FOUND;case Qn.ALREADY_EXISTS:return ve.ALREADY_EXISTS;case Qn.PERMISSION_DENIED:return ve.PERMISSION_DENIED;case Qn.FAILED_PRECONDITION:return ve.FAILED_PRECONDITION;case Qn.ABORTED:return ve.ABORTED;case Qn.OUT_OF_RANGE:return ve.OUT_OF_RANGE;case Qn.UNIMPLEMENTED:return ve.UNIMPLEMENTED;case Qn.DATA_LOSS:return ve.DATA_LOSS;default:return ze(39323,{code:n})}}(Ut=Qn||(Qn={}))[Ut.OK=0]="OK",Ut[Ut.CANCELLED=1]="CANCELLED",Ut[Ut.UNKNOWN=2]="UNKNOWN",Ut[Ut.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ut[Ut.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ut[Ut.NOT_FOUND=5]="NOT_FOUND",Ut[Ut.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ut[Ut.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ut[Ut.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ut[Ut.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ut[Ut.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ut[Ut.ABORTED=10]="ABORTED",Ut[Ut.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ut[Ut.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ut[Ut.INTERNAL=13]="INTERNAL",Ut[Ut.UNAVAILABLE=14]="UNAVAILABLE",Ut[Ut.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d7(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h7=new nl([4294967295,4294967295],0);function zI(n){const e=d7().encode(n),t=new xR;return t.update(e),new Uint8Array(t.digest())}function qI(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new nl([t,i],0),new nl([s,o],0)]}class WT{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Fh(`Invalid padding: ${t}`);if(i<0)throw new Fh(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Fh(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Fh(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=nl.fromNumber(this.ge)}ye(e,t,i){let s=e.add(t.multiply(nl.fromNumber(i)));return s.compare(h7)===1&&(s=new nl([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=zI(e),[i,s]=qI(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(i,s,o);if(!this.we(l))return!1}return!0}static create(e,t,i){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new WT(o,s,t);return i.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const t=zI(e),[i,s]=qI(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(i,s,o);this.Se(l)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Fh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,t,i,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const s=new Map;return s.set(e,Ff.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new Uf(et.min(),s,new Nn(ut),Fs(),Tt())}}class Ff{constructor(e,t,i,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Ff(i,t,Tt(),Tt(),Tt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e,t,i,s){this.be=e,this.removedTargetIds=t,this.key=i,this.De=s}}class N2{constructor(e,t){this.targetId=e,this.Ce=t}}class R2{constructor(e,t,i=Hn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=s}}class GI{constructor(){this.ve=0,this.Fe=HI(),this.Me=Hn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Tt(),t=Tt(),i=Tt();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:i=i.add(s);break;default:ze(38017,{changeType:o})}})),new Ff(this.Me,this.xe,e,t,i)}qe(){this.Oe=!1,this.Fe=HI()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ze(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class f7{constructor(e){this.Ge=e,this.ze=new Map,this.je=Fs(),this.Je=np(),this.He=np(),this.Ye=new Nn(ut)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:ze(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((i,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,i=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(Qp(o))if(i===0){const l=new Ve(o.path);this.et(t,l,Vn.newNoDocument(l,et.min()))}else Ze(i===1,20013,{expectedCount:i});else{const l=this._t(t);if(l!==i){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(t);const p=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,p)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=t;let l,d;try{l=Qo(i).toUint8Array()}catch(h){if(h instanceof ZR)return Cu("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new WT(l,s,o)}catch(h){return Cu(h instanceof Fh?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let s=0;return i.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&Qp(d.target)){const h=new Ve(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Vn.newNoDocument(h,e))}o.Be&&(t.set(l,o.ke()),o.qe())}}));let i=Tt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const p=this.ot(h);return!p||p.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(i=i.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const s=new Uf(e,t,this.Ye,this.je,i);return this.je=Fs(),this.Je=np(),this.He=np(),this.Ye=new Nn(ut),s}Xe(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,i),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new GI,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new sn(ut),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new sn(ut),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new GI),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function np(){return new Nn(Ve.comparator)}function HI(){return new Nn(Ve.comparator)}const m7={asc:"ASCENDING",desc:"DESCENDING"},p7={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},g7={and:"AND",or:"OR"};class _7{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _0(n,e){return n.useProto3Json||Hg(e)?e:{value:e}}function md(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function M2(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function y7(n,e){return md(n,e.toTimestamp())}function Yi(n){return Ze(!!n,49232),et.fromTimestamp((function(t){const i=Zo(t);return new en(i.seconds,i.nanos)})(n))}function YT(n,e){return y0(n,e).canonicalString()}function y0(n,e){const t=(function(s){return new Kt(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function P2(n){const e=Kt.fromString(n);return Ze(z2(e),10190,{key:e.toString()}),e}function Xp(n,e){return YT(n.databaseId,e.path)}function vu(n,e){const t=P2(e);if(t.get(1)!==n.databaseId.projectId)throw new De(ve.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new De(ve.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ve(L2(t))}function k2(n,e){return YT(n.databaseId,e)}function D2(n){const e=P2(n);return e.length===4?Kt.emptyPath():L2(e)}function v0(n){return new Kt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function L2(n){return Ze(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function jI(n,e,t){return{name:Xp(n,e),fields:t.value.mapValue.fields}}function v7(n,e,t){const i=vu(n,e.name),s=Yi(e.updateTime),o=e.createTime?Yi(e.createTime):et.min(),l=new Li({mapValue:{fields:e.fields}}),d=Vn.newFoundDocument(i,s,o,l);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function T7(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:ze(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(p,T){return p.useProto3Json?(Ze(T===void 0||typeof T=="string",58123),Hn.fromBase64String(T||"")):(Ze(T===void 0||T instanceof Buffer||T instanceof Uint8Array,16193),Hn.fromUint8Array(T||new Uint8Array))})(n,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(p){const T=p.code===void 0?ve.UNKNOWN:A2(p.code);return new De(T,p.message||"")})(l);t=new R2(i,s,o,d||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=vu(n,i.document.name),o=Yi(i.document.updateTime),l=i.document.createTime?Yi(i.document.createTime):et.min(),d=new Li({mapValue:{fields:i.document.fields}}),h=Vn.newFoundDocument(s,o,l,d),p=i.targetIds||[],T=i.removedTargetIds||[];t=new Sp(p,T,h.key,h)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=vu(n,i.document),o=i.readTime?Yi(i.readTime):et.min(),l=Vn.newNoDocument(s,o),d=i.removedTargetIds||[];t=new Sp([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=vu(n,i.document),o=i.removedTargetIds||[];t=new Sp([],o,s,null)}else{if(!("filter"in e))return ze(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:s=0,unchangedNames:o}=i,l=new u7(s,o),d=i.targetId;t=new N2(d,l)}}return t}function eg(n,e){let t;if(e instanceof Rd)t={update:jI(n,e.key,e.value)};else if(e instanceof e_)t={delete:Xp(n,e.key)};else if(e instanceof ra)t={update:jI(n,e.key,e.data),updateMask:b7(e.fieldMask)};else{if(!(e instanceof I2))return ze(16599,{Vt:e.type});t={verify:Xp(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(o,l){const d=l.transform;if(d instanceof hd)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Au)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof fd)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Ef)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw ze(20930,{transform:l.transform})})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:y7(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:ze(27497)})(n,e.precondition)),t}function T0(n,e){const t=e.currentDocument?(function(o){return o.updateTime!==void 0?Oi.updateTime(Yi(o.updateTime)):o.exists!==void 0?Oi.exists(o.exists):Oi.none()})(e.currentDocument):Oi.none(),i=e.updateTransforms?e.updateTransforms.map((s=>(function(l,d){let h=null;if("setToServerValue"in d)Ze(d.setToServerValue==="REQUEST_TIME",16630,{proto:d}),h=new hd;else if("appendMissingElements"in d){const T=d.appendMissingElements.values||[];h=new Au(T)}else if("removeAllFromArray"in d){const T=d.removeAllFromArray.values||[];h=new fd(T)}else"increment"in d?h=new Ef(l,d.increment):ze(16584,{proto:d});const p=An.fromServerFormat(d.fieldPath);return new GT(p,h)})(n,s))):[];if(e.update){e.update.name;const s=vu(n,e.update.name),o=new Li({mapValue:{fields:e.update.fields}});if(e.updateMask){const l=(function(h){const p=h.fieldPaths||[];return new ps(p.map((T=>An.fromServerFormat(T))))})(e.updateMask);return new ra(s,o,l,t,i)}return new Rd(s,o,t,i)}if(e.delete){const s=vu(n,e.delete);return new e_(s,t)}if(e.verify){const s=vu(n,e.verify);return new I2(s,t)}return ze(1463,{proto:e})}function E7(n,e){return n&&n.length>0?(Ze(e!==void 0,14353),n.map((t=>(function(s,o){let l=s.updateTime?Yi(s.updateTime):Yi(o);return l.isEqual(et.min())&&(l=Yi(o)),new o7(l,s.transformResults||[])})(t,e)))):[]}function V2(n,e){return{documents:[k2(n,e.path)]}}function O2(n,e){const t={structuredQuery:{}},i=e.path;let s;e.collectionGroup!==null?(s=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=k2(n,s);const o=(function(p){if(p.length!==0)return B2(tn.create(p,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const l=(function(p){if(p.length!==0)return p.map((T=>(function(C){return{field:Oc(C.field),direction:w7(C.dir)}})(T)))})(e.orderBy);l&&(t.structuredQuery.orderBy=l);const d=_0(n,e.limit);return d!==null&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:t,parent:s}}function U2(n){let e=D2(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){Ze(i===1,65062);const T=t.from[0];T.allDescendants?s=T.collectionId:e=e.child(T.collectionId)}let o=[];t.where&&(o=(function(x){const C=F2(x);return C instanceof tn&&BT(C)?C.getFilters():[C]})(t.where));let l=[];t.orderBy&&(l=(function(x){return x.map((C=>(function(D){return new Zp(Uc(D.field),(function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(C)))})(t.orderBy));let d=null;t.limit&&(d=(function(x){let C;return C=typeof x=="object"?x.value:x,Hg(C)?null:C})(t.limit));let h=null;t.startAt&&(h=(function(x){const C=!!x.before,A=x.values||[];return new cd(A,C)})(t.startAt));let p=null;return t.endAt&&(p=(function(x){const C=!x.before,A=x.values||[];return new cd(A,C)})(t.endAt)),h2(e,s,l,o,d,"F",h,p)}function x7(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ze(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function F2(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Uc(t.unaryFilter.field);return Lt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=Uc(t.unaryFilter.field);return Lt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Uc(t.unaryFilter.field);return Lt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Uc(t.unaryFilter.field);return Lt.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ze(61313);default:return ze(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Lt.create(Uc(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ze(58110);default:return ze(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return tn.create(t.compositeFilter.filters.map((i=>F2(i))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ze(1026)}})(t.compositeFilter.op))})(n):ze(30097,{filter:n})}function w7(n){return m7[n]}function S7(n){return p7[n]}function C7(n){return g7[n]}function Oc(n){return{fieldPath:n.canonicalString()}}function Uc(n){return An.fromServerFormat(n.fieldPath)}function B2(n){return n instanceof Lt?(function(t){if(t.op==="=="){if(NI(t.value))return{unaryFilter:{field:Oc(t.field),op:"IS_NAN"}};if(AI(t.value))return{unaryFilter:{field:Oc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(NI(t.value))return{unaryFilter:{field:Oc(t.field),op:"IS_NOT_NAN"}};if(AI(t.value))return{unaryFilter:{field:Oc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oc(t.field),op:S7(t.op),value:t.value}}})(n):n instanceof tn?(function(t){const i=t.getFilters().map((s=>B2(s)));return i.length===1?i[0]:{compositeFilter:{op:C7(t.op),filters:i}}})(n):ze(54877,{filter:n})}function b7(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function z2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,t,i,s,o=et.min(),l=et.min(),d=Hn.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new qo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new qo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new qo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new qo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e){this.yt=e}}function I7(n,e){let t;if(e.document)t=v7(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=Ve.fromSegments(e.noDocument.path),s=Ru(e.noDocument.readTime);t=Vn.newNoDocument(i,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ze(56709);{const i=Ve.fromSegments(e.unknownDocument.path),s=Ru(e.unknownDocument.version);t=Vn.newUnknownDocument(i,s)}}return e.readTime&&t.setReadTime((function(s){const o=new en(s[0],s[1]);return et.fromTimestamp(o)})(e.readTime)),t}function KI(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:tg(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=(function(o,l){return{name:Xp(o,l.key),fields:l.data.value.mapValue.fields,updateTime:md(o,l.version.toTimestamp()),createTime:md(o,l.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Nu(e.version)};else{if(!e.isUnknownDocument())return ze(57904,{document:e});i.unknownDocument={path:t.path.toArray(),version:Nu(e.version)}}return i}function tg(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Nu(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ru(n){const e=new en(n.seconds,n.nanoseconds);return et.fromTimestamp(e)}function uu(n,e){const t=(e.baseMutations||[]).map((o=>T0(n.yt,o)));for(let o=0;o<e.mutations.length-1;++o){const l=e.mutations[o];if(o+1<e.mutations.length&&e.mutations[o+1].transform!==void 0){const d=e.mutations[o+1];l.updateTransforms=d.transform.fieldTransforms,e.mutations.splice(o+1,1),++o}}const i=e.mutations.map((o=>T0(n.yt,o))),s=en.fromMillis(e.localWriteTimeMs);return new HT(e.batchId,s,t,i)}function Bh(n){const e=Ru(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ru(n.lastLimboFreeSnapshotVersion):et.min();let i;return i=(function(o){return o.documents!==void 0})(n.query)?(function(o){const l=o.documents.length;return Ze(l===1,1966,{count:l}),zs(Zg(D2(o.documents[0])))})(n.query):(function(o){return zs(U2(o))})(n.query),new qo(i,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Hn.fromBase64String(n.resumeToken))}function G2(n,e){const t=Nu(e.snapshotVersion),i=Nu(e.lastLimboFreeSnapshotVersion);let s;s=Qp(e.target)?V2(n.yt,e.target):O2(n.yt,e.target).ft;const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Iu(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:s}}function H2(n){const e=U2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?g0(e,e.limit,"L"):e}function Tv(n,e){return new KT(e.largestBatchId,T0(n.yt,e.overlayMutation))}function WI(n,e){const t=e.path.lastSegment();return[n,Ui(e.path.popLast()),t]}function YI(n,e,t,i){return{indexId:n,uid:e,sequenceNumber:t,readTime:Nu(i.readTime),documentKey:Ui(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A7{getBundleMetadata(e,t){return JI(e).get(t).next((i=>{if(i)return(function(o){return{id:o.bundleId,createTime:Ru(o.createTime),version:o.version}})(i)}))}saveBundleMetadata(e,t){return JI(e).put((function(s){return{bundleId:s.id,createTime:Nu(Yi(s.createTime)),version:s.version}})(t))}getNamedQuery(e,t){return ZI(e).get(t).next((i=>{if(i)return(function(o){return{name:o.name,query:H2(o.bundledQuery),readTime:Ru(o.readTime)}})(i)}))}saveNamedQuery(e,t){return ZI(e).put((function(s){return{name:s.name,readTime:Nu(Yi(s.readTime)),bundledQuery:s.bundledQuery}})(t))}}function JI(n){return si(n,jg)}function ZI(n){return si(n,Kg)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const i=t.uid||"";return new t_(e,i)}getOverlay(e,t){return Ch(e).get(WI(this.userId,t)).next((i=>i?Tv(this.serializer,i):null))}getOverlays(e,t){const i=so();return ie.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&i.set(s,o)})))).next((()=>i))}saveOverlays(e,t,i){const s=[];return i.forEach(((o,l)=>{const d=new KT(t,l);s.push(this.St(e,d))})),ie.waitFor(s)}removeOverlaysForBatchId(e,t,i){const s=new Set;t.forEach((l=>s.add(Ui(l.getCollectionPath()))));const o=[];return s.forEach((l=>{const d=IDBKeyRange.bound([this.userId,l,i],[this.userId,l,i+1],!1,!0);o.push(Ch(e).Z(a0,d))})),ie.waitFor(o)}getOverlaysForCollection(e,t,i){const s=so(),o=Ui(t),l=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,Number.POSITIVE_INFINITY],!0);return Ch(e).J(a0,l).next((d=>{for(const h of d){const p=Tv(this.serializer,h);s.set(p.getKey(),p)}return s}))}getOverlaysForCollectionGroup(e,t,i,s){const o=so();let l;const d=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ch(e).ee({index:HR,range:d},((h,p,T)=>{const x=Tv(this.serializer,p);o.size()<s||x.largestBatchId===l?(o.set(x.getKey(),x),l=x.largestBatchId):T.done()})).next((()=>o))}St(e,t){return Ch(e).put((function(s,o,l){const[d,h,p]=WI(o,l.mutation.key);return{userId:o,collectionPath:h,documentId:p,collectionGroup:l.mutation.key.getCollectionGroup(),largestBatchId:l.largestBatchId,overlayMutation:eg(s.yt,l.mutation)}})(this.serializer,this.userId,t))}}function Ch(n){return si(n,Wg)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N7{bt(e){return si(e,LT)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const i=t==null?void 0:t.value;return i?Hn.fromUint8Array(i):Hn.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Cn(e.integerValue));else if("doubleValue"in e){const i=Cn(e.doubleValue);isNaN(i)?this.Ft(t,13):(this.Ft(t,15),ff(i)?t.Mt(0):t.Mt(i))}else if("timestampValue"in e){let i=e.timestampValue;this.Ft(t,20),typeof i=="string"&&(i=Zo(i)),t.xt(`${i.seconds||""}`),t.Mt(i.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Qo(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.Ft(t,45),t.Mt(i.latitude||0),t.Mt(i.longitude||0)}else"mapValue"in e?n2(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Jg(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ze(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const i=e.fields||{};this.Ft(t,55);for(const s of Object.keys(i))this.Ot(s,t),this.Ct(i[s],t)}kt(e,t){var l,d;const i=e.fields||{};this.Ft(t,53);const s=ld,o=((d=(l=i[s].arrayValue)==null?void 0:l.values)==null?void 0:d.length)||0;this.Ft(t,15),t.Mt(Cn(o)),this.Ot(s,t),this.Ct(i[s],t)}Qt(e,t){const i=e.values||[];this.Ft(t,50);for(const s of i)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),Ve.fromName(e).path.forEach((i=>{this.Ft(t,60),this.Ut(i,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}cu.Kt=new cu;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc=255;function R7(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function QI(n){const e=64-(function(i){let s=0;for(let o=0;o<8;++o){const l=R7(255&i[o]);if(s+=l,l!==8)break}return s})(n);return Math.ceil(e/8)}class M7{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Gt(i.value),i=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Jt(i.value),i=t.next();this.Ht()}Yt(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Gt(i);else if(i<2048)this.Gt(960|i>>>6),this.Gt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Jt(i);else if(i<2048)this.Jt(960|i>>>6),this.Jt(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),i=QI(t);this.tn(1+i),this.buffer[this.position++]=255&i;for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),i=QI(t);this.tn(1+i),this.buffer[this.position++]=~(255&i);for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Rc),this.sn(255)}_n(){this.an(Rc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(o){const l=new DataView(new ArrayBuffer(8));return l.setFloat64(0,o,!1),new Uint8Array(l.buffer)})(e),i=!!(128&t[0]);t[0]^=i?255:128;for(let s=1;s<t.length;++s)t[s]^=i?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Rc?(this.sn(Rc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Rc?(this.an(Rc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const s=new Uint8Array(i);s.set(this.buffer),this.buffer=s}}class P7{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class k7{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class bh{constructor(){this.cn=new M7,this.ln=new P7(this.cn),this.hn=new k7(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e,t,i,s){this.Tn=e,this.In=t,this.En=i,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.dn,0),t!==e?i.set([0],this.dn.length):++i[i.length-1],new du(this.Tn,this.In,this.En,i)}Rn(e,t,i){return{indexId:this.Tn,uid:e,arrayValue:Cp(this.En),directionalValue:Cp(this.dn),orderedDocumentKey:Cp(t),documentKey:i.path.toArray()}}Vn(e,t,i){const s=this.Rn(e,t,i);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ha(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=$I(n.En,e.En),t!==0?t:(t=$I(n.dn,e.dn),t!==0?t:Ve.comparator(n.In,e.In)))}function $I(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}function Cp(n){return ON()?(function(t){let i="";for(let s=0;s<t.length;s++)i+=String.fromCharCode(t[s]);return i})(n):n}function XI(n){return typeof n!="string"?n:(function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i})(n)}class eA{constructor(e){this.mn=new sn(((t,i)=>An.comparator(t.field,i.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const i=t;i.isInequality()?this.mn=this.mn.add(i):this.gn.push(i)}}get pn(){return this.mn.size>1}yn(e){if(Ze(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=s0(e);if(t!==void 0&&!this.wn(t))return!1;const i=ru(e);let s=new Set,o=0,l=0;for(;o<i.length&&this.wn(i[o]);++o)s=s.add(i[o].fieldPath.canonicalString());if(o===i.length)return!0;if(this.mn.size>0){const d=this.mn.getIterator().getNext();if(!s.has(d.field.canonicalString())){const h=i[o];if(!this.Sn(d,h)||!this.bn(this.fn[l++],h))return!1}++o}for(;o<i.length;++o){const d=i[o];if(l>=this.fn.length||!this.bn(this.fn[l++],d))return!1}return!0}Dn(){if(this.pn)return null;let e=new sn(An.comparator);const t=[];for(const i of this.gn)if(!i.field.isKeyField())if(i.op==="array-contains"||i.op==="array-contains-any")t.push(new _p(i.field,2));else{if(e.has(i.field))continue;e=e.add(i.field),t.push(new _p(i.field,0))}for(const i of this.fn)i.field.isKeyField()||e.has(i.field)||(e=e.add(i.field),t.push(new _p(i.field,i.dir==="asc"?0:1)));return new jp(jp.UNKNOWN_ID,this.collectionId,t,hf.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j2(n){var t,i;if(Ze(n instanceof Lt||n instanceof tn,20012),n instanceof Lt){if(n instanceof d2){const s=((i=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:i.map((o=>Lt.create(n.field,"==",o))))||[];return tn.create(s,"or")}return n}const e=n.filters.map((s=>j2(s)));return tn.create(e,n.op)}function D7(n){if(n.getFilters().length===0)return[];const e=w0(j2(n));return Ze(K2(e),7391),E0(e)||x0(e)?[e]:e.getFilters()}function E0(n){return n instanceof Lt}function x0(n){return n instanceof tn&&BT(n)}function K2(n){return E0(n)||x0(n)||(function(t){if(t instanceof tn&&h0(t)){for(const i of t.getFilters())if(!E0(i)&&!x0(i))return!1;return!0}return!1})(n)}function w0(n){if(Ze(n instanceof Lt||n instanceof tn,34018),n instanceof Lt)return n;if(n.filters.length===1)return w0(n.filters[0]);const e=n.filters.map((i=>w0(i)));let t=tn.create(e,n.op);return t=ng(t),K2(t)?t:(Ze(t instanceof tn,64498),Ze(dd(t),40251),Ze(t.filters.length>1,57927),t.filters.reduce(((i,s)=>JT(i,s))))}function JT(n,e){let t;return Ze(n instanceof Lt||n instanceof tn,38388),Ze(e instanceof Lt||e instanceof tn,25473),t=n instanceof Lt?e instanceof Lt?(function(s,o){return tn.create([s,o],"and")})(n,e):tA(n,e):e instanceof Lt?tA(e,n):(function(s,o){if(Ze(s.filters.length>0&&o.filters.length>0,48005),dd(s)&&dd(o))return l2(s,o.getFilters());const l=h0(s)?s:o,d=h0(s)?o:s,h=l.filters.map((p=>JT(p,d)));return tn.create(h,"or")})(n,e),ng(t)}function tA(n,e){if(dd(e))return l2(e,n.getFilters());{const t=e.filters.map((i=>JT(n,i)));return tn.create(t,"or")}}function ng(n){if(Ze(n instanceof Lt||n instanceof tn,11850),n instanceof Lt)return n;const e=n.getFilters();if(e.length===1)return ng(e[0]);if(o2(n))return n;const t=e.map((s=>ng(s))),i=[];return t.forEach((s=>{s instanceof Lt?i.push(s):s instanceof tn&&(s.op===n.op?i.push(...s.filters):i.push(s))})),i.length===1?i[0]:tn.create(i,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L7{constructor(){this.Cn=new ZT}addToCollectionParentIndex(e,t){return this.Cn.add(t),ie.resolve()}getCollectionParents(e,t){return ie.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ie.resolve()}deleteFieldIndex(e,t){return ie.resolve()}deleteAllFieldIndexes(e){return ie.resolve()}createTargetIndexes(e,t){return ie.resolve()}getDocumentsMatchingTarget(e,t){return ie.resolve(null)}getIndexType(e,t){return ie.resolve(0)}getFieldIndexes(e,t){return ie.resolve([])}getNextCollectionGroupToUpdate(e){return ie.resolve(null)}getMinOffset(e,t){return ie.resolve(Gs.min())}getMinOffsetFromCollectionGroup(e,t){return ie.resolve(Gs.min())}updateCollectionGroup(e,t,i){return ie.resolve()}updateIndexEntries(e,t){return ie.resolve()}}class ZT{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new sn(Kt.comparator),o=!s.has(i);return this.index[t]=s.add(i),o}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new sn(Kt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nA="IndexedDbIndexManager",ip=new Uint8Array(0);class V7{constructor(e,t){this.databaseId=t,this.vn=new ZT,this.Fn=new sa((i=>Iu(i)),((i,s)=>Lf(i,s))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const i=t.lastSegment(),s=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const o={collectionId:i,parent:Ui(s)};return iA(e).put(o)}return ie.resolve()}getCollectionParents(e,t){const i=[],s=IDBKeyRange.bound([t,""],[RR(t),""],!1,!0);return iA(e).J(s).next((o=>{for(const l of o){if(l.collectionId!==t)break;i.push(io(l.parent))}return i}))}addFieldIndex(e,t){const i=Ih(e),s=(function(d){return{indexId:d.indexId,collectionGroup:d.collectionGroup,fields:d.fields.map((h=>[h.fieldPath.canonicalString(),h.kind]))}})(t);delete s.indexId;const o=i.add(s);if(t.indexState){const l=Pc(e);return o.next((d=>{l.put(YI(d,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return o.next()}deleteFieldIndex(e,t){const i=Ih(e),s=Pc(e),o=Mc(e);return i.delete(t.indexId).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Ih(e),i=Mc(e),s=Pc(e);return t.Z().next((()=>i.Z())).next((()=>s.Z()))}createTargetIndexes(e,t){return ie.forEach(this.Mn(t),(i=>this.getIndexType(e,i).next((s=>{if(s===0||s===1){const o=new eA(i).Dn();if(o!=null)return this.addFieldIndex(e,o)}}))))}getDocumentsMatchingTarget(e,t){const i=Mc(e);let s=!0;const o=new Map;return ie.forEach(this.Mn(t),(l=>this.xn(e,l).next((d=>{s&&(s=!!d),o.set(l,d)})))).next((()=>{if(s){let l=Tt();const d=[];return ie.forEach(o,((h,p)=>{Ae(nA,`Using index ${(function(Q){return`id=${Q.indexId}|cg=${Q.collectionGroup}|f=${Q.fields.map((he=>`${he.fieldPath}:${he.kind}`)).join(",")}`})(h)} to execute ${Iu(t)}`);const T=(function(Q,he){const fe=s0(he);if(fe===void 0)return null;for(const Y of $p(Q,fe.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null})(p,h),x=(function(Q,he){const fe=new Map;for(const Y of ru(he))for(const k of $p(Q,Y.fieldPath))switch(k.op){case"==":case"in":fe.set(Y.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return fe.set(Y.fieldPath.canonicalString(),k.value),Array.from(fe.values())}return null})(p,h),C=(function(Q,he){const fe=[];let Y=!0;for(const k of ru(he)){const B=k.kind===0?DI(Q,k.fieldPath,Q.startAt):LI(Q,k.fieldPath,Q.startAt);fe.push(B.value),Y&&(Y=B.inclusive)}return new cd(fe,Y)})(p,h),A=(function(Q,he){const fe=[];let Y=!0;for(const k of ru(he)){const B=k.kind===0?LI(Q,k.fieldPath,Q.endAt):DI(Q,k.fieldPath,Q.endAt);fe.push(B.value),Y&&(Y=B.inclusive)}return new cd(fe,Y)})(p,h),D=this.On(h,p,C),F=this.On(h,p,A),H=this.Nn(h,p,x),X=this.Bn(h.indexId,T,D,C.inclusive,F,A.inclusive,H);return ie.forEach(X,(re=>i.Y(re,t.limit).next((Q=>{Q.forEach((he=>{const fe=Ve.fromSegments(he.documentKey);l.has(fe)||(l=l.add(fe),d.push(fe))}))}))))})).next((()=>d))}return ie.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=D7(tn.create(e.filters,"and")).map((i=>m0(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,i,s,o,l,d){const h=(t!=null?t.length:1)*Math.max(i.length,o.length),p=h/(t!=null?t.length:1),T=[];for(let x=0;x<h;++x){const C=t?this.Ln(t[x/p]):ip,A=this.kn(e,C,i[x%p],s),D=this.qn(e,C,o[x%p],l),F=d.map((H=>this.kn(e,C,H,!0)));T.push(...this.createRange(A,D,F))}return T}kn(e,t,i,s){const o=new du(e,Ve.empty(),t,i);return s?o:o.An()}qn(e,t,i,s){const o=new du(e,Ve.empty(),t,i);return s?o.An():o}xn(e,t){const i=new eA(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next((o=>{let l=null;for(const d of o)i.yn(d)&&(!l||d.fields.length>l.fields.length)&&(l=d);return l}))}getIndexType(e,t){let i=2;const s=this.Mn(t);return ie.forEach(s,(o=>this.xn(e,o).next((l=>{l?i!==0&&l.fields.length<(function(h){let p=new sn(An.comparator),T=!1;for(const x of h.filters)for(const C of x.getFlattenedFilters())C.field.isKeyField()||(C.op==="array-contains"||C.op==="array-contains-any"?T=!0:p=p.add(C.field));for(const x of h.orderBy)x.field.isKeyField()||(p=p.add(x.field));return p.size+(T?1:0)})(o)&&(i=1):i=0})))).next((()=>(function(l){return l.limit!==null})(t)&&s.length>1&&i===2?1:i))}Qn(e,t){const i=new bh;for(const s of ru(e)){const o=t.data.field(s.fieldPath);if(o==null)return null;const l=i.Pn(s.kind);cu.Kt.Dt(o,l)}return i.un()}Ln(e){const t=new bh;return cu.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const i=new bh;return cu.Kt.Dt(vf(this.databaseId,t),i.Pn((function(o){const l=ru(o);return l.length===0?0:l[l.length-1].kind})(e))),i.un()}Nn(e,t,i){if(i===null)return[];let s=[];s.push(new bh);let o=0;for(const l of ru(e)){const d=i[o++];for(const h of s)if(this.Un(t,l.fieldPath)&&Tf(d))s=this.Kn(s,l,d);else{const p=h.Pn(l.kind);cu.Kt.Dt(d,p)}}return this.Wn(s)}On(e,t,i){return this.Nn(e,t,i.position)}Wn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].un();return t}Kn(e,t,i){const s=[...e],o=[];for(const l of i.arrayValue.values||[])for(const d of s){const h=new bh;h.seed(d.un()),cu.Kt.Dt(l,h.Pn(t.kind)),o.push(h)}return o}Un(e,t){return!!e.filters.find((i=>i instanceof Lt&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in")))}getFieldIndexes(e,t){const i=Ih(e),s=Pc(e);return(t?i.J(o0,IDBKeyRange.bound(t,t)):i.J()).next((o=>{const l=[];return ie.forEach(o,(d=>s.get([d.indexId,this.uid]).next((h=>{l.push((function(T,x){const C=x?new hf(x.sequenceNumber,new Gs(Ru(x.readTime),new Ve(io(x.documentKey)),x.largestBatchId)):hf.empty(),A=T.fields.map((([D,F])=>new _p(An.fromServerFormat(D),F)));return new jp(T.indexId,T.collectionGroup,A,C)})(d,h))})))).next((()=>l))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((i,s)=>{const o=i.indexState.sequenceNumber-s.indexState.sequenceNumber;return o!==0?o:ut(i.collectionGroup,s.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,i){const s=Ih(e),o=Pc(e);return this.Gn(e).next((l=>s.J(o0,IDBKeyRange.bound(t,t)).next((d=>ie.forEach(d,(h=>o.put(YI(h.indexId,this.uid,l,i))))))))}updateIndexEntries(e,t){const i=new Map;return ie.forEach(t,((s,o)=>{const l=i.get(s.collectionGroup);return(l?ie.resolve(l):this.getFieldIndexes(e,s.collectionGroup)).next((d=>(i.set(s.collectionGroup,d),ie.forEach(d,(h=>this.zn(e,s,h).next((p=>{const T=this.jn(o,h);return p.isEqual(T)?ie.resolve():this.Jn(e,o,h,p,T)})))))))}))}Hn(e,t,i,s){return Mc(e).put(s.Rn(this.uid,this.$n(i,t.key),t.key))}Yn(e,t,i,s){return Mc(e).delete(s.Vn(this.uid,this.$n(i,t.key),t.key))}zn(e,t,i){const s=Mc(e);let o=new sn(Ha);return s.ee({index:GR,range:IDBKeyRange.only([i.indexId,this.uid,Cp(this.$n(i,t))])},((l,d)=>{o=o.add(new du(i.indexId,t,XI(d.arrayValue),XI(d.directionalValue)))})).next((()=>o))}jn(e,t){let i=new sn(Ha);const s=this.Qn(t,e);if(s==null)return i;const o=s0(t);if(o!=null){const l=e.data.field(o.fieldPath);if(Tf(l))for(const d of l.arrayValue.values||[])i=i.add(new du(t.indexId,e.key,this.Ln(d),s))}else i=i.add(new du(t.indexId,e.key,ip,s));return i}Jn(e,t,i,s,o){Ae(nA,"Updating index entries for document '%s'",t.key);const l=[];return(function(h,p,T,x,C){const A=h.getIterator(),D=p.getIterator();let F=Nc(A),H=Nc(D);for(;F||H;){let X=!1,re=!1;if(F&&H){const Q=T(F,H);Q<0?re=!0:Q>0&&(X=!0)}else F!=null?re=!0:X=!0;X?(x(H),H=Nc(D)):re?(C(F),F=Nc(A)):(F=Nc(A),H=Nc(D))}})(s,o,Ha,(d=>{l.push(this.Hn(e,t,i,d))}),(d=>{l.push(this.Yn(e,t,i,d))})),ie.waitFor(l)}Gn(e){let t=1;return Pc(e).ee({index:qR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((i,s,o)=>{o.done(),t=s.sequenceNumber+1})).next((()=>t))}createRange(e,t,i){i=i.sort(((l,d)=>Ha(l,d))).filter(((l,d,h)=>!d||Ha(l,h[d-1])!==0));const s=[];s.push(e);for(const l of i){const d=Ha(l,e),h=Ha(l,t);if(d===0)s[0]=e.An();else if(d>0&&h<0)s.push(l),s.push(l.An());else if(h>0)break}s.push(t);const o=[];for(let l=0;l<s.length;l+=2){if(this.Zn(s[l],s[l+1]))return[];const d=s[l].Vn(this.uid,ip,Ve.empty()),h=s[l+1].Vn(this.uid,ip,Ve.empty());o.push(IDBKeyRange.bound(d,h))}return o}Zn(e,t){return Ha(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sA)}getMinOffset(e,t){return ie.mapArray(this.Mn(t),(i=>this.xn(e,i).next((s=>s||ze(44426))))).next(sA)}}function iA(n){return si(n,gf)}function Mc(n){return si(n,Jh)}function Ih(n){return si(n,DT)}function Pc(n){return si(n,Yh)}function sA(n){Ze(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const s=n[i].indexState.offset;MT(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Gs(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},W2=41943040;class Pi{static withCacheSize(e){return new Pi(e,Pi.DEFAULT_COLLECTION_PERCENTILE,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(n,e,t){const i=n.store(Cr),s=n.store(sd),o=[],l=IDBKeyRange.only(t.batchId);let d=0;const h=i.ee({range:l},((T,x,C)=>(d++,C.delete())));o.push(h.next((()=>{Ze(d===1,47070,{batchId:t.batchId})})));const p=[];for(const T of t.mutations){const x=FR(e,T.key.path,t.batchId);o.push(s.delete(x)),p.push(T.key)}return ie.waitFor(o).next((()=>p))}function ig(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ze(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pi.DEFAULT_COLLECTION_PERCENTILE=10,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pi.DEFAULT=new Pi(W2,Pi.DEFAULT_COLLECTION_PERCENTILE,Pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pi.DISABLED=new Pi(-1,0,0);class n_{constructor(e,t,i,s){this.userId=e,this.serializer=t,this.indexManager=i,this.referenceDelegate=s,this.Xn={}}static wt(e,t,i,s){Ze(e.uid!=="",64387);const o=e.isAuthenticated()?e.uid:"";return new n_(o,t,i,s)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ja(e).ee({index:mu,range:i},((s,o,l)=>{t=!1,l.done()})).next((()=>t))}addMutationBatch(e,t,i,s){const o=Fc(e),l=ja(e);return l.add({}).next((d=>{Ze(typeof d=="number",49019);const h=new HT(d,t,i,s),p=(function(A,D,F){const H=F.baseMutations.map((re=>eg(A.yt,re))),X=F.mutations.map((re=>eg(A.yt,re)));return{userId:D,batchId:F.batchId,localWriteTimeMs:F.localWriteTime.toMillis(),baseMutations:H,mutations:X}})(this.serializer,this.userId,h),T=[];let x=new sn(((C,A)=>ut(C.canonicalString(),A.canonicalString())));for(const C of s){const A=FR(this.userId,C.key.path,d);x=x.add(C.key.path.popLast()),T.push(l.put(p)),T.push(o.put(A,mz))}return x.forEach((C=>{T.push(this.indexManager.addToCollectionParentIndex(e,C))})),e.addOnCommittedListener((()=>{this.Xn[d]=h.keys()})),ie.waitFor(T).next((()=>h))}))}lookupMutationBatch(e,t){return ja(e).get(t).next((i=>i?(Ze(i.userId===this.userId,48,"Unexpected user for mutation batch",{userId:i.userId,batchId:t}),uu(this.serializer,i)):null))}er(e,t){return this.Xn[t]?ie.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((i=>{if(i){const s=i.keys();return this.Xn[t]=s,s}return null}))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=IDBKeyRange.lowerBound([this.userId,i]);let o=null;return ja(e).ee({index:mu,range:s},((l,d,h)=>{d.userId===this.userId&&(Ze(d.batchId>=i,47524,{tr:i}),o=uu(this.serializer,d)),h.done()})).next((()=>o))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=_u;return ja(e).ee({index:mu,range:t,reverse:!0},((s,o,l)=>{i=o.batchId,l.done()})).next((()=>i))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,_u],[this.userId,Number.POSITIVE_INFINITY]);return ja(e).J(mu,t).next((i=>i.map((s=>uu(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=yp(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=[];return Fc(e).ee({range:s},((l,d,h)=>{const[p,T,x]=l,C=io(T);if(p===this.userId&&t.path.isEqual(C))return ja(e).get(x).next((A=>{if(!A)throw ze(61480,{nr:l,batchId:x});Ze(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:x}),o.push(uu(this.serializer,A))}));h.done()})).next((()=>o))}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new sn(ut);const s=[];return t.forEach((o=>{const l=yp(this.userId,o.path),d=IDBKeyRange.lowerBound(l),h=Fc(e).ee({range:d},((p,T,x)=>{const[C,A,D]=p,F=io(A);C===this.userId&&o.path.isEqual(F)?i=i.add(D):x.done()}));s.push(h)})),ie.waitFor(s).next((()=>this.rr(e,i)))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1,o=yp(this.userId,i),l=IDBKeyRange.lowerBound(o);let d=new sn(ut);return Fc(e).ee({range:l},((h,p,T)=>{const[x,C,A]=h,D=io(C);x===this.userId&&i.isPrefixOf(D)?D.length===s&&(d=d.add(A)):T.done()})).next((()=>this.rr(e,d)))}rr(e,t){const i=[],s=[];return t.forEach((o=>{s.push(ja(e).get(o).next((l=>{if(l===null)throw ze(35274,{batchId:o});Ze(l.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:l.userId,batchId:o}),i.push(uu(this.serializer,l))})))})),ie.waitFor(s).next((()=>i))}removeMutationBatch(e,t){return Y2(e.le,this.userId,t).next((i=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),ie.forEach(i,(s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ie.resolve();const i=IDBKeyRange.lowerBound((function(l){return[l]})(this.userId)),s=[];return Fc(e).ee({range:i},((o,l,d)=>{if(o[0]===this.userId){const h=io(o[1]);s.push(h)}else d.done()})).next((()=>{Ze(s.length===0,56720,{sr:s.map((o=>o.canonicalString()))})}))}))}containsKey(e,t){return J2(e,this.userId,t)}_r(e){return Z2(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:_u,lastStreamToken:""}))}}function J2(n,e,t){const i=yp(e,t.path),s=i[1],o=IDBKeyRange.lowerBound(i);let l=!1;return Fc(n).ee({range:o,X:!0},((d,h,p)=>{const[T,x,C]=d;T===e&&x===s&&(l=!0),p.done()})).next((()=>l))}function ja(n){return si(n,Cr)}function Fc(n){return si(n,sd)}function Z2(n){return si(n,mf)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Mu(0)}static cr(){return new Mu(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O7{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const i=new Mu(t.highestTargetId);return t.highestTargetId=i.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>et.fromTimestamp(new en(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,i){return this.lr(e).next((s=>(s.highestListenSequenceNumber=t,i&&(s.lastRemoteSnapshotVersion=i.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((i=>(i.targetCount+=1,this.Tr(t,i),this.hr(e,i))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>kc(e).delete(t.targetId))).next((()=>this.lr(e))).next((i=>(Ze(i.targetCount>0,8065),i.targetCount-=1,this.hr(e,i))))}removeTargets(e,t,i){let s=0;const o=[];return kc(e).ee(((l,d)=>{const h=Bh(d);h.sequenceNumber<=t&&i.get(h.targetId)===null&&(s++,o.push(this.removeTargetData(e,h)))})).next((()=>ie.waitFor(o))).next((()=>s))}forEachTarget(e,t){return kc(e).ee(((i,s)=>{const o=Bh(s);t(o)}))}lr(e){return oA(e).get(Yp).next((t=>(Ze(t!==null,2888),t)))}hr(e,t){return oA(e).put(Yp,t)}Pr(e,t){return kc(e).put(G2(this.serializer,t))}Tr(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const i=Iu(t),s=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let o=null;return kc(e).ee({range:s,index:zR},((l,d,h)=>{const p=Bh(d);Lf(t,p.target)&&(o=p,h.done())})).next((()=>o))}addMatchingKeys(e,t,i){const s=[],o=Za(e);return t.forEach((l=>{const d=Ui(l.path);s.push(o.put({targetId:i,path:d})),s.push(this.referenceDelegate.addReference(e,i,l))})),ie.waitFor(s)}removeMatchingKeys(e,t,i){const s=Za(e);return ie.forEach(t,(o=>{const l=Ui(o.path);return ie.waitFor([s.delete([i,l]),this.referenceDelegate.removeReference(e,i,o)])}))}removeMatchingKeysForTargetId(e,t){const i=Za(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(s)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),s=Za(e);let o=Tt();return s.ee({range:i,X:!0},((l,d,h)=>{const p=io(l[1]),T=new Ve(p);o=o.add(T)})).next((()=>o))}containsKey(e,t){const i=Ui(t.path),s=IDBKeyRange.bound([i],[RR(i)],!1,!0);let o=0;return Za(e).ee({index:kT,X:!0,range:s},(([l,d],h,p)=>{l!==0&&(o++,p.done())})).next((()=>o>0))}At(e,t){return kc(e).get(t).next((i=>i?Bh(i):null))}}function kc(n){return si(n,rd)}function oA(n){return si(n,yu)}function Za(n){return si(n,od)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA="LruGarbageCollector",U7=1048576;function lA([n,e],[t,i]){const s=ut(n,t);return s===0?ut(e,i):s}class F7{constructor(e){this.Ir=e,this.buffer=new sn(lA),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();lA(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Q2{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ae(aA,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){yl(t)?Ae(aA,"Ignoring IndexedDB error during garbage collection: ",t):await _l(t)}await this.Vr(3e5)}))}}class B7{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((i=>Math.floor(t/100*i)))}nthSequenceNumber(e,t){if(t===0)return ie.resolve(ms.ce);const i=new F7(t);return this.mr.forEachTarget(e,(s=>i.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>i.Ar(s))))).next((()=>i.maxValue))}removeTargets(e,t,i){return this.mr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ae("LruGarbageCollector","Garbage collection skipped; disabled"),ie.resolve(rA)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(Ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rA):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let i,s,o,l,d,h,p;const T=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((x=>(x>this.params.maximumSequenceNumbersToCollect?(Ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${x}`),s=this.params.maximumSequenceNumbersToCollect):s=x,l=Date.now(),this.nthSequenceNumber(e,s)))).next((x=>(i=x,d=Date.now(),this.removeTargets(e,i,t)))).next((x=>(o=x,h=Date.now(),this.removeOrphanedDocuments(e,i)))).next((x=>(p=Date.now(),Lc()<=bt.DEBUG&&Ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-T}ms
	Determined least recently used ${s} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${x} documents in `+(p-h)+`ms
Total Duration: ${p-T}ms`),ie.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:x}))))}}function $2(n,e){return new B7(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z7{constructor(e,t){this.db=e,this.garbageCollector=$2(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((i=>t.next((s=>i+s))))}wr(e){let t=0;return this.pr(e,(i=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((i,s)=>t(s)))}addReference(e,t,i){return sp(e,i)}removeReference(e,t,i){return sp(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return sp(e,t)}br(e,t){return(function(s,o){let l=!1;return Z2(s).te((d=>J2(s,d,o).next((h=>(h&&(l=!0),ie.resolve(!h)))))).next((()=>l))})(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.Sr(e,((l,d)=>{if(d<=t){const h=this.br(e,l).next((p=>{if(!p)return o++,i.getEntry(e,l).next((()=>(i.removeEntry(l,et.min()),Za(e).delete((function(x){return[0,Ui(x.path)]})(l)))))}));s.push(h)}})).next((()=>ie.waitFor(s))).next((()=>i.apply(e))).next((()=>o))}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return sp(e,t)}Sr(e,t){const i=Za(e);let s,o=ms.ce;return i.ee({index:kT},(([l,d],{path:h,sequenceNumber:p})=>{l===0?(o!==ms.ce&&t(new Ve(io(s)),o),o=p,s=h):o=ms.ce})).next((()=>{o!==ms.ce&&t(new Ve(io(s)),o)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sp(n,e){return Za(n).put((function(i,s){return{targetId:0,path:Ui(i.path),sequenceNumber:s}})(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(){this.changes=new sa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Vn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ie.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q7{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return iu(e).put(i)}removeEntry(e,t,i){return iu(e).delete((function(o,l){const d=o.path.toArray();return[d.slice(0,d.length-2),d[d.length-2],tg(l),d[d.length-1]]})(t,i))}updateMetadata(e,t){return this.getMetadata(e).next((i=>(i.byteSize+=t,this.Dr(e,i))))}getEntry(e,t){let i=Vn.newInvalidDocument(t);return iu(e).ee({index:vp,range:IDBKeyRange.only(Ah(t))},((s,o)=>{i=this.Cr(t,o)})).next((()=>i))}vr(e,t){let i={size:0,document:Vn.newInvalidDocument(t)};return iu(e).ee({index:vp,range:IDBKeyRange.only(Ah(t))},((s,o)=>{i={document:this.Cr(t,o),size:ig(o)}})).next((()=>i))}getEntries(e,t){let i=Fs();return this.Fr(e,t,((s,o)=>{const l=this.Cr(s,o);i=i.insert(s,l)})).next((()=>i))}Mr(e,t){let i=Fs(),s=new Nn(Ve.comparator);return this.Fr(e,t,((o,l)=>{const d=this.Cr(o,l);i=i.insert(o,d),s=s.insert(o,ig(l))})).next((()=>({documents:i,Or:s})))}Fr(e,t,i){if(t.isEmpty())return ie.resolve();let s=new sn(dA);t.forEach((h=>s=s.add(h)));const o=IDBKeyRange.bound(Ah(s.first()),Ah(s.last())),l=s.getIterator();let d=l.getNext();return iu(e).ee({index:vp,range:o},((h,p,T)=>{const x=Ve.fromSegments([...p.prefixPath,p.collectionGroup,p.documentId]);for(;d&&dA(d,x)<0;)i(d,null),d=l.getNext();d&&d.isEqual(x)&&(i(d,p),d=l.hasNext()?l.getNext():null),d?T.j(Ah(d)):T.done()})).next((()=>{for(;d;)i(d,null),d=l.hasNext()?l.getNext():null}))}getDocumentsMatchingQuery(e,t,i,s,o){const l=t.path,d=[l.popLast().toArray(),l.lastSegment(),tg(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],h=[l.popLast().toArray(),l.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return iu(e).J(IDBKeyRange.bound(d,h,!0)).next((p=>{o==null||o.incrementDocumentReadCount(p.length);let T=Fs();for(const x of p){const C=this.Cr(Ve.fromSegments(x.prefixPath.concat(x.collectionGroup,x.documentId)),x);C.isFoundDocument()&&(Of(t,C)||s.has(C.key))&&(T=T.insert(C.key,C))}return T}))}getAllFromCollectionGroup(e,t,i,s){let o=Fs();const l=cA(t,i),d=cA(t,Gs.max());return iu(e).ee({index:BR,range:IDBKeyRange.bound(l,d,!0)},((h,p,T)=>{const x=this.Cr(Ve.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);o=o.insert(x.key,x),o.size===s&&T.done()})).next((()=>o))}newChangeBuffer(e){return new G7(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return uA(e).get(r0).next((t=>(Ze(!!t,20021),t)))}Dr(e,t){return uA(e).put(r0,t)}Cr(e,t){if(t){const i=I7(this.serializer,t);if(!(i.isNoDocument()&&i.version.isEqual(et.min())))return i}return Vn.newInvalidDocument(e)}}function eM(n){return new q7(n)}class G7 extends X2{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new sa((i=>i.toString()),((i,s)=>i.isEqual(s)))}applyChanges(e){const t=[];let i=0,s=new sn(((o,l)=>ut(o.canonicalString(),l.canonicalString())));return this.changes.forEach(((o,l)=>{const d=this.Br.get(o);if(t.push(this.Nr.removeEntry(e,o,d.readTime)),l.isValidDocument()){const h=KI(this.Nr.serializer,l);s=s.add(o.path.popLast());const p=ig(h);i+=p-d.size,t.push(this.Nr.addEntry(e,o,h))}else if(i-=d.size,this.trackRemovals){const h=KI(this.Nr.serializer,l.convertToNoDocument(et.min()));t.push(this.Nr.addEntry(e,o,h))}})),s.forEach((o=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,o))})),t.push(this.Nr.updateMetadata(e,i)),ie.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((i=>(this.Br.set(t,{size:i.size,readTime:i.document.readTime}),i.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:i,Or:s})=>(s.forEach(((o,l)=>{this.Br.set(o,{size:l,readTime:i.get(o).readTime})})),i)))}}function uA(n){return si(n,pf)}function iu(n){return si(n,Wp)}function Ah(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function cA(n,e){const t=e.documentKey.path.toArray();return[n,tg(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function dA(n,e){const t=n.path.toArray(),i=e.path.toArray();let s=0;for(let o=0;o<t.length-2&&o<i.length-2;++o)if(s=ut(t[o],i[o]),s)return s;return s=ut(t.length,i.length),s||(s=ut(t[t.length-2],i[i.length-2]),s||ut(t[t.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H7{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(i=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(i!==null&&Xh(i.mutation,s,ps.empty(),en.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,Tt()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=Tt()){const s=so();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,i).next((o=>{let l=Uh();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,t){const i=so();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,Tt())))}populateOverlays(e,t,i){const s=[];return i.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((l,d)=>{t.set(l,d)}))}))}computeViews(e,t,i,s){let o=Fs();const l=$h(),d=(function(){return $h()})();return t.forEach(((h,p)=>{const T=i.get(p.key);s.has(p.key)&&(T===void 0||T.mutation instanceof ra)?o=o.insert(p.key,p):T!==void 0?(l.set(p.key,T.mutation.getFieldMask()),Xh(T.mutation,p,T.mutation.getFieldMask(),en.now())):l.set(p.key,ps.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((p,T)=>l.set(p,T))),t.forEach(((p,T)=>d.set(p,new H7(T,l.get(p)??null)))),d)))}recalculateAndSaveOverlays(e,t){const i=$h();let s=new Nn(((l,d)=>l-d)),o=Tt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((l=>{for(const d of l)d.keys().forEach((h=>{const p=t.get(h);if(p===null)return;let T=i.get(h)||ps.empty();T=d.applyToLocalView(p,T),i.set(h,T);const x=(s.get(d.batchId)||Tt()).add(h);s=s.insert(d.batchId,x)}))})).next((()=>{const l=[],d=s.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),p=h.key,T=h.value,x=v2();T.forEach((C=>{if(!o.has(C)){const A=C2(t.get(C),i.get(C));A!==null&&x.set(C,A),o=o.add(C)}})),l.push(this.documentOverlayCache.saveOverlays(e,p,x))}return ie.waitFor(l)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,s){return(function(l){return Ve.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):f2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next((o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-o.size):ie.resolve(so());let d=id,h=o;return l.next((p=>ie.forEach(p,((T,x)=>(d<x.largestBatchId&&(d=x.largestBatchId),o.get(T)?ie.resolve():this.remoteDocumentCache.getEntry(e,T).next((C=>{h=h.insert(T,C)}))))).next((()=>this.populateOverlays(e,p,o))).next((()=>this.computeViews(e,h,p,Tt()))).next((T=>({batchId:d,changes:y2(T)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ve(t)).next((i=>{let s=Uh();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const o=t.collectionGroup;let l=Uh();return this.indexManager.getCollectionParents(e,o).next((d=>ie.forEach(d,(h=>{const p=(function(x,C){return new Vf(C,null,x.explicitOrderBy.slice(),x.filters.slice(),x.limit,x.limitType,x.startAt,x.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,p,i,s).next((T=>{T.forEach(((x,C)=>{l=l.insert(x,C)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,t,i,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,o,s)))).next((l=>{o.forEach(((h,p)=>{const T=p.getKey();l.get(T)===null&&(l=l.insert(T,Vn.newInvalidDocument(T)))}));let d=Uh();return l.forEach(((h,p)=>{const T=o.get(h);T!==void 0&&Xh(T.mutation,p,ps.empty(),en.now()),Of(t,p)&&(d=d.insert(h,p))})),d}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j7{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ie.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Yi(s.createTime)}})(t)),ie.resolve()}getNamedQuery(e,t){return ie.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:H2(s.bundledQuery),readTime:Yi(s.readTime)}})(t)),ie.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K7{constructor(){this.overlays=new Nn(Ve.comparator),this.qr=new Map}getOverlay(e,t){return ie.resolve(this.overlays.get(t))}getOverlays(e,t){const i=so();return ie.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&i.set(s,o)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((s,o)=>{this.St(e,t,o)})),ie.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.qr.get(i);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(i)),ie.resolve()}getOverlaysForCollection(e,t,i){const s=so(),o=t.length+1,l=new Ve(t.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,p=h.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===o&&h.largestBatchId>i&&s.set(h.getKey(),h)}return ie.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let o=new Nn(((p,T)=>p-T));const l=this.overlays.getIterator();for(;l.hasNext();){const p=l.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>i){let T=o.get(p.largestBatchId);T===null&&(T=so(),o=o.insert(p.largestBatchId,T)),T.set(p.getKey(),p)}}const d=so(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((p,T)=>d.set(p,T))),!(d.size()>=s)););return ie.resolve(d)}St(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const l=this.qr.get(s.largestBatchId).delete(i.key);this.qr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(i.key,new KT(t,i));let o=this.qr.get(t);o===void 0&&(o=Tt(),this.qr.set(t,o)),this.qr.set(t,o.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W7{constructor(){this.sessionToken=Hn.EMPTY_BYTE_STRING}getSessionToken(e){return ie.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ie.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{constructor(){this.Qr=new sn(pi.$r),this.Ur=new sn(pi.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const i=new pi(e,t);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Gr(new pi(e,t))}zr(e,t){e.forEach((i=>this.removeReference(i,t)))}jr(e){const t=new Ve(new Kt([])),i=new pi(t,e),s=new pi(t,e+1),o=[];return this.Ur.forEachInRange([i,s],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Ve(new Kt([])),i=new pi(t,e),s=new pi(t,e+1);let o=Tt();return this.Ur.forEachInRange([i,s],(l=>{o=o.add(l.key)})),o}containsKey(e){const t=new pi(e,0),i=this.Qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class pi{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Ve.comparator(e.key,t.key)||ut(e.Yr,t.Yr)}static Kr(e,t){return ut(e.Yr,t.Yr)||Ve.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y7{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new sn(pi.$r)}checkEmpty(e){return ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new HT(o,t,i,s);this.mutationQueue.push(l);for(const d of s)this.Zr=this.Zr.add(new pi(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return ie.resolve(l)}lookupMutationBatch(e,t){return ie.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.ei(i),o=s<0?0:s;return ie.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return ie.resolve(this.mutationQueue.length===0?_u:this.tr-1)}getAllMutationBatches(e){return ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new pi(t,0),s=new pi(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([i,s],(l=>{const d=this.Xr(l.Yr);o.push(d)})),ie.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new sn(ut);return t.forEach((s=>{const o=new pi(s,0),l=new pi(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{i=i.add(d.Yr)}))})),ie.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let o=i;Ve.isDocumentKey(o)||(o=o.child(""));const l=new pi(new Ve(o),0);let d=new sn(ut);return this.Zr.forEachWhile((h=>{const p=h.key.path;return!!i.isPrefixOf(p)&&(p.length===s&&(d=d.add(h.Yr)),!0)}),l),ie.resolve(this.ti(d))}ti(e){const t=[];return e.forEach((i=>{const s=this.Xr(i);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){Ze(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return ie.forEach(t.mutations,(s=>{const o=new pi(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=i}))}ir(e){}containsKey(e,t){const i=new pi(t,0),s=this.Zr.firstAfterOrEqual(i);return ie.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ie.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J7{constructor(e){this.ri=e,this.docs=(function(){return new Nn(Ve.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),o=s?s.size:0,l=this.ri(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ie.resolve(i?i.document.mutableCopy():Vn.newInvalidDocument(t))}getEntries(e,t){let i=Fs();return t.forEach((s=>{const o=this.docs.get(s);i=i.insert(s,o?o.document.mutableCopy():Vn.newInvalidDocument(s))})),ie.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let o=Fs();const l=t.path,d=new Ve(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:p,value:{document:T}}=h.getNext();if(!l.isPrefixOf(p.path))break;p.path.length>l.length+1||MT(DR(T),i)<=0||(s.has(T.key)||Of(t,T))&&(o=o.insert(T.key,T.mutableCopy()))}return ie.resolve(o)}getAllFromCollectionGroup(e,t,i,s){ze(9500)}ii(e,t){return ie.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new Z7(this)}getSize(e){return ie.resolve(this.size)}}class Z7 extends X2{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(i)})),ie.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q7{constructor(e){this.persistence=e,this.si=new sa((t=>Iu(t)),Lf),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.oi=0,this._i=new QT,this.targetCount=0,this.ai=Mu.ur()}forEachTarget(e,t){return this.si.forEach(((i,s)=>t(s))),ie.resolve()}getLastRemoteSnapshotVersion(e){return ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ie.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.oi&&(this.oi=t),ie.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Mu(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ie.resolve()}updateTargetData(e,t){return this.Pr(t),ie.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ie.resolve()}removeTargets(e,t,i){let s=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=t&&i.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),s++)})),ie.waitFor(o).next((()=>s))}getTargetCount(e){return ie.resolve(this.targetCount)}getTargetData(e,t){const i=this.si.get(t)||null;return ie.resolve(i)}addMatchingKeys(e,t,i){return this._i.Wr(t,i),ie.resolve()}removeMatchingKeys(e,t,i){this._i.zr(t,i);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((l=>{o.push(s.markPotentiallyOrphaned(e,l))})),ie.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ie.resolve()}getMatchingKeysForTargetId(e,t){const i=this._i.Hr(t);return ie.resolve(i)}containsKey(e,t){return ie.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $T{constructor(e,t){this.ui={},this.overlays={},this.ci=new ms(0),this.li=!1,this.li=!0,this.hi=new W7,this.referenceDelegate=e(this),this.Pi=new Q7(this),this.indexManager=new L7,this.remoteDocumentCache=(function(s){return new J7(s)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new q2(t),this.Ii=new j7(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new K7,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ui[e.toKey()];return i||(i=new Y7(t,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,i){Ae("MemoryPersistence","Starting transaction:",e);const s=new $7(this.ci.next());return this.referenceDelegate.Ei(),i(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return ie.or(Object.values(this.ui).map((i=>()=>i.containsKey(e,t))))}}class $7 extends VR{constructor(e){super(),this.currentSequenceNumber=e}}class i_{constructor(e){this.persistence=e,this.Ri=new QT,this.Vi=null}static mi(e){return new i_(e)}get fi(){if(this.Vi)return this.Vi;throw ze(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.fi.delete(i.toString()),ie.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.fi.add(i.toString()),ie.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ie.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>i.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ie.forEach(this.fi,(i=>{const s=Ve.fromPath(i);return this.gi(e,s).next((o=>{o||t.removeEntry(s,et.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((i=>{i?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return ie.or([()=>ie.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class sg{constructor(e,t){this.persistence=e,this.pi=new sa((i=>Ui(i.path)),((i,s)=>i.isEqual(s))),this.garbageCollector=$2(this,t)}static mi(e,t){return new sg(e,t)}Ei(){}di(e){return ie.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>t.next((s=>i+s))))}wr(e){let t=0;return this.pr(e,(i=>{t++})).next((()=>t))}pr(e,t){return ie.forEach(this.pi,((i,s)=>this.br(e,i,s).next((o=>o?ie.resolve():t(s)))))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(l=>this.br(e,l,t).next((d=>{d||(i++,o.removeEntry(l,et.min()))})))).next((()=>o.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ie.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),ie.resolve()}removeReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),ie.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ie.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ep(e.data.value)),t}br(e,t,i){return ie.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return ie.resolve(s!==void 0&&s>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X7{constructor(e){this.serializer=e}k(e,t,i,s){const o=new Gg("createOrUpgrade",t);i<1&&s>=1&&((function(h){h.createObjectStore(Df)})(e),(function(h){h.createObjectStore(mf,{keyPath:fz}),h.createObjectStore(Cr,{keyPath:xI,autoIncrement:!0}).createIndex(mu,wI,{unique:!0}),h.createObjectStore(sd)})(e),hA(e),(function(h){h.createObjectStore(ou)})(e));let l=ie.resolve();return i<3&&s>=3&&(i!==0&&((function(h){h.deleteObjectStore(od),h.deleteObjectStore(rd),h.deleteObjectStore(yu)})(e),hA(e)),l=l.next((()=>(function(h){const p=h.store(yu),T={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:et.min().toTimestamp(),targetCount:0};return p.put(Yp,T)})(o)))),i<4&&s>=4&&(i!==0&&(l=l.next((()=>(function(h,p){return p.store(Cr).J().next((x=>{h.deleteObjectStore(Cr),h.createObjectStore(Cr,{keyPath:xI,autoIncrement:!0}).createIndex(mu,wI,{unique:!0});const C=p.store(Cr),A=x.map((D=>C.put(D)));return ie.waitFor(A)}))})(e,o)))),l=l.next((()=>{(function(h){h.createObjectStore(ad,{keyPath:xz})})(e)}))),i<5&&s>=5&&(l=l.next((()=>this.yi(o)))),i<6&&s>=6&&(l=l.next((()=>((function(h){h.createObjectStore(pf)})(e),this.wi(o))))),i<7&&s>=7&&(l=l.next((()=>this.Si(o)))),i<8&&s>=8&&(l=l.next((()=>this.bi(e,o)))),i<9&&s>=9&&(l=l.next((()=>{(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(e)}))),i<10&&s>=10&&(l=l.next((()=>this.Di(o)))),i<11&&s>=11&&(l=l.next((()=>{(function(h){h.createObjectStore(jg,{keyPath:wz})})(e),(function(h){h.createObjectStore(Kg,{keyPath:Sz})})(e)}))),i<12&&s>=12&&(l=l.next((()=>{(function(h){const p=h.createObjectStore(Wg,{keyPath:Mz});p.createIndex(a0,Pz,{unique:!1}),p.createIndex(HR,kz,{unique:!1})})(e)}))),i<13&&s>=13&&(l=l.next((()=>(function(h){const p=h.createObjectStore(Wp,{keyPath:pz});p.createIndex(vp,gz),p.createIndex(BR,_z)})(e))).next((()=>this.Ci(e,o))).next((()=>e.deleteObjectStore(ou)))),i<14&&s>=14&&(l=l.next((()=>this.Fi(e,o)))),i<15&&s>=15&&(l=l.next((()=>(function(h){h.createObjectStore(DT,{keyPath:Cz,autoIncrement:!0}).createIndex(o0,bz,{unique:!1}),h.createObjectStore(Yh,{keyPath:Iz}).createIndex(qR,Az,{unique:!1}),h.createObjectStore(Jh,{keyPath:Nz}).createIndex(GR,Rz,{unique:!1})})(e)))),i<16&&s>=16&&(l=l.next((()=>{t.objectStore(Yh).clear()})).next((()=>{t.objectStore(Jh).clear()}))),i<17&&s>=17&&(l=l.next((()=>{(function(h){h.createObjectStore(LT,{keyPath:Dz})})(e)}))),i<18&&s>=18&&ON()&&(l=l.next((()=>{t.objectStore(Yh).clear()})).next((()=>{t.objectStore(Jh).clear()}))),l}wi(e){let t=0;return e.store(ou).ee(((i,s)=>{t+=ig(s)})).next((()=>{const i={byteSize:t};return e.store(pf).put(r0,i)}))}yi(e){const t=e.store(mf),i=e.store(Cr);return t.J().next((s=>ie.forEach(s,(o=>{const l=IDBKeyRange.bound([o.userId,_u],[o.userId,o.lastAcknowledgedBatchId]);return i.J(mu,l).next((d=>ie.forEach(d,(h=>{Ze(h.userId===o.userId,18650,"Cannot process batch from unexpected user",{batchId:h.batchId});const p=uu(this.serializer,h);return Y2(e,o.userId,p).next((()=>{}))}))))}))))}Si(e){const t=e.store(od),i=e.store(ou);return e.store(yu).get(Yp).next((s=>{const o=[];return i.ee(((l,d)=>{const h=new Kt(l),p=(function(x){return[0,Ui(x)]})(h);o.push(t.get(p).next((T=>T?ie.resolve():(x=>t.put({targetId:0,path:Ui(x),sequenceNumber:s.highestListenSequenceNumber}))(h))))})).next((()=>ie.waitFor(o)))}))}bi(e,t){e.createObjectStore(gf,{keyPath:Ez});const i=t.store(gf),s=new ZT,o=l=>{if(s.add(l)){const d=l.lastSegment(),h=l.popLast();return i.put({collectionId:d,parent:Ui(h)})}};return t.store(ou).ee({X:!0},((l,d)=>{const h=new Kt(l);return o(h.popLast())})).next((()=>t.store(sd).ee({X:!0},(([l,d,h],p)=>{const T=io(d);return o(T.popLast())}))))}Di(e){const t=e.store(rd);return t.ee(((i,s)=>{const o=Bh(s),l=G2(this.serializer,o);return t.put(l)}))}Ci(e,t){const i=t.store(ou),s=[];return i.ee(((o,l)=>{const d=t.store(Wp),h=(function(x){return x.document?new Ve(Kt.fromString(x.document.name).popFirst(5)):x.noDocument?Ve.fromSegments(x.noDocument.path):x.unknownDocument?Ve.fromSegments(x.unknownDocument.path):ze(36783)})(l).path.toArray(),p={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:l.readTime||[0,0],unknownDocument:l.unknownDocument,noDocument:l.noDocument,document:l.document,hasCommittedMutations:!!l.hasCommittedMutations};s.push(d.put(p))})).next((()=>ie.waitFor(s)))}Fi(e,t){const i=t.store(Cr),s=eM(this.serializer),o=new $T(i_.mi,this.serializer.yt);return i.J().next((l=>{const d=new Map;return l.forEach((h=>{let p=d.get(h.userId)??Tt();uu(this.serializer,h).keys().forEach((T=>p=p.add(T))),d.set(h.userId,p)})),ie.forEach(d,((h,p)=>{const T=new gi(p),x=t_.wt(this.serializer,T),C=o.getIndexManager(T),A=n_.wt(T,this.serializer,C,o.referenceDelegate);return new tM(s,A,x,C).recalculateAndSaveOverlaysForDocumentKeys(new l0(t,ms.ce),h).next()}))}))}}function hA(n){n.createObjectStore(od,{keyPath:vz}).createIndex(kT,Tz,{unique:!0}),n.createObjectStore(rd,{keyPath:"targetId"}).createIndex(zR,yz,{unique:!0}),n.createObjectStore(yu)}const Ka="IndexedDbPersistence",Ev=18e5,xv=5e3,wv="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",e8="main";class XT{constructor(e,t,i,s,o,l,d,h,p,T,x=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Mi=o,this.window=l,this.document=d,this.xi=p,this.Oi=T,this.Ni=x,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=C=>Promise.resolve(),!XT.v())throw new De(ve.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new z7(this,s),this.$i=t+e8,this.serializer=new q2(h),this.Ui=new il(this.$i,this.Ni,new X7(this.serializer)),this.hi=new N7,this.Pi=new O7(this.referenceDelegate,this.serializer),this.remoteDocumentCache=eM(this.serializer),this.Ii=new A7,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,T===!1&&qn(Ka,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new De(ve.FAILED_PRECONDITION,wv);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new ms(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>rp(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(yl(e))return Ae(Ka,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Ae(Ka,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Nh(e).get(Ac).next((t=>ie.resolve(this.es(t))))}ts(e){return rp(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ev)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const i=si(t,ad);return i.J().next((s=>{const o=this.ss(s,Ev),l=s.filter((d=>o.indexOf(d)===-1));return ie.forEach(l,(d=>i.delete(d.clientId))).next((()=>l))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?ie.resolve(!0):Nh(e).get(Ac).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,xv)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new De(ve.FAILED_PRECONDITION,wv);return!1}}return!(!this.networkEnabled||!this.inForeground)||rp(e).J().next((i=>this.ss(i,xv).find((s=>{if(this.clientId!==s.clientId){const o=!this.networkEnabled&&s.networkEnabled,l=!this.inForeground&&s.inForeground,d=this.networkEnabled===s.networkEnabled;if(o||l&&d)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&Ae(Ka,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Df,ad],(e=>{const t=new l0(e,ms.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((i=>this.rs(i.updateTimeMs,t)&&!this.us(i.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>rp(e).J().next((t=>this.ss(t,Ev).map((i=>i.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return n_.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new V7(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return t_.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,i){Ae(Ka,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",o=(function(h){return h===18?Oz:h===17?YR:h===16?Vz:h===15?VT:h===14?WR:h===13?KR:h===12?Lz:h===11?jR:void ze(60245)})(this.Ni);let l;return this.Ui.runTransaction(e,s,o,(d=>(l=new l0(d,this.ci?this.ci.next():ms.ce),t==="readwrite-primary"?this.Hi(l).next((h=>!!h||this.Yi(l))).next((h=>{if(!h)throw qn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new De(ve.FAILED_PRECONDITION,LR);return i(l)})).next((h=>this.Xi(l).next((()=>h)))):this.Is(l).next((()=>i(l)))))).then((d=>(l.raiseOnCommittedEvent(),d)))}Is(e){return Nh(e).get(Ac).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,xv)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new De(ve.FAILED_PRECONDITION,wv)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nh(e).put(Ac,t)}static v(){return il.v()}Zi(e){const t=Nh(e);return t.get(Ac).next((i=>this.es(i)?(Ae(Ka,"Releasing primary lease."),t.delete(Ac)):ie.resolve()))}rs(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(qn(`Detected an update time that is in the future: ${e} > ${i}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;VN()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const i=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Ae(Ka,`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return qn(Ka,"Failed to get zombied client id.",i),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){qn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Nh(n){return si(n,Df)}function rp(n){return si(n,ad)}function nM(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Es=i,this.ds=s}static As(e,t){let i=Tt(),s=Tt();for(const o of t.docChanges)switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new eE(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t8{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return VN()?8:OR(ii())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,s){const o={result:null};return this.ys(e,t).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,t,s,i).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new t8;return this.Ss(e,t,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,t,l,d.size)}))})).next((()=>o.result))}bs(e,t,i,s){return i.documentReadCount<this.fs?(Lc()<=bt.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",Vc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ie.resolve()):(Lc()<=bt.DEBUG&&Ae("QueryEngine","Query:",Vc(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.gs*s?(Lc()<=bt.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",Vc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zs(t))):ie.resolve())}ys(e,t){if(VI(t))return ie.resolve(null);let i=zs(t);return this.indexManager.getIndexType(e,i).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=g0(t,null,"F"),i=zs(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((o=>{const l=Tt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,i).next((h=>{const p=this.Ds(t,d);return this.Cs(t,p,l,h.readTime)?this.ys(e,g0(t,null,"F")):this.vs(e,p,t,h)}))))})))))}ws(e,t,i,s){return VI(t)||s.isEqual(et.min())?ie.resolve(null):this.ps.getDocuments(e,i).next((o=>{const l=this.Ds(t,o);return this.Cs(t,l,i,s)?ie.resolve(null):(Lc()<=bt.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Vc(t)),this.vs(e,l,t,kR(s,id)).next((d=>d)))}))}Ds(e,t){let i=new sn(g2(e));return t.forEach(((s,o)=>{Of(e,o)&&(i=i.add(o))})),i}Cs(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,i){return Lc()<=bt.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",Vc(t)),this.ps.getDocumentsMatchingQuery(e,t,Gs.min(),i)}vs(e,t,i,s){return this.ps.getDocumentsMatchingQuery(e,i,s).next((o=>(t.forEach((l=>{o=o.insert(l.key,l)})),o)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE="LocalStore",n8=3e8;class i8{constructor(e,t,i,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Nn(ut),this.xs=new sa((o=>Iu(o)),Lf),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tM(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function sM(n,e,t,i){return new i8(n,e,t,i)}async function rM(n,e){const t=je(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(i)))).next((o=>{const l=[],d=[];let h=Tt();for(const p of s){l.push(p.batchId);for(const T of p.mutations)h=h.add(T.key)}for(const p of o){d.push(p.batchId);for(const T of p.mutations)h=h.add(T.key)}return t.localDocuments.getDocuments(i,h).next((p=>({Ls:p,removedBatchIds:l,addedBatchIds:d})))}))}))}function s8(n,e){const t=je(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,p,T){const x=p.batch,C=x.keys();let A=ie.resolve();return C.forEach((D=>{A=A.next((()=>T.getEntry(h,D))).next((F=>{const H=p.docVersions.get(D);Ze(H!==null,48541),F.version.compareTo(H)<0&&(x.applyToRemoteDocument(F,p),F.isValidDocument()&&(F.setReadTime(p.commitVersion),T.addEntry(F)))}))})),A.next((()=>d.mutationQueue.removeMutationBatch(h,x)))})(t,i,e,o).next((()=>o.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(d){let h=Tt();for(let p=0;p<d.mutationResults.length;++p)d.mutationResults[p].transformResults.length>0&&(h=h.add(d.batch.mutations[p].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(i,s)))}))}function oM(n){const e=je(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function r8(n,e){const t=je(n),i=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const d=[];e.targetChanges.forEach(((T,x)=>{const C=s.get(x);if(!C)return;d.push(t.Pi.removeMatchingKeys(o,T.removedDocuments,x).next((()=>t.Pi.addMatchingKeys(o,T.addedDocuments,x))));let A=C.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(x)!==null?A=A.withResumeToken(Hn.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):T.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(T.resumeToken,i)),s=s.insert(x,A),(function(F,H,X){return F.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=n8?!0:X.addedDocuments.size+X.modifiedDocuments.size+X.removedDocuments.size>0})(C,A,T)&&d.push(t.Pi.updateTargetData(o,A))}));let h=Fs(),p=Tt();if(e.documentUpdates.forEach((T=>{e.resolvedLimboDocuments.has(T)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(o,T))})),d.push(o8(o,l,e.documentUpdates).next((T=>{h=T.ks,p=T.qs}))),!i.isEqual(et.min())){const T=t.Pi.getLastRemoteSnapshotVersion(o).next((x=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,i)));d.push(T)}return ie.waitFor(d).next((()=>l.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,p))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function o8(n,e,t){let i=Tt(),s=Tt();return t.forEach((o=>i=i.add(o))),e.getEntries(n,i).next((o=>{let l=Fs();return t.forEach(((d,h)=>{const p=o.get(d);h.isFoundDocument()!==p.isFoundDocument()&&(s=s.add(d)),h.isNoDocument()&&h.version.isEqual(et.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!p.isValidDocument()||h.version.compareTo(p.version)>0||h.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Ae(tE,"Ignoring outdated watch update for ",d,". Current version:",p.version," Watch version:",h.version)})),{ks:l,qs:s}}))}function a8(n,e){const t=je(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=_u),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function rg(n,e){const t=je(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let s;return t.Pi.getTargetData(i,e).next((o=>o?(s=o,ie.resolve(s)):t.Pi.allocateTargetId(i).next((l=>(s=new qo(e,l,"TargetPurposeListen",i.currentSequenceNumber),t.Pi.addTargetData(i,s).next((()=>s)))))))})).then((i=>{const s=t.Ms.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.xs.set(e,i.targetId)),i}))}async function pd(n,e,t){const i=je(n),s=i.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",o,(l=>i.persistence.referenceDelegate.removeTarget(l,s)))}catch(l){if(!yl(l))throw l;Ae(tE,`Failed to update sequence numbers for target ${e}: ${l}`)}i.Ms=i.Ms.remove(e),i.xs.delete(s.target)}function S0(n,e,t){const i=je(n);let s=et.min(),o=Tt();return i.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,p,T){const x=je(h),C=x.xs.get(T);return C!==void 0?ie.resolve(x.Ms.get(C)):x.Pi.getTargetData(p,T)})(i,l,zs(e)).next((d=>{if(d)return s=d.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>i.Fs.getDocumentsMatchingQuery(l,e,t?s:et.min(),t?o:Tt()))).next((d=>(uM(i,p2(e),d),{documents:d,Qs:o})))))}function aM(n,e){const t=je(n),i=je(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",(o=>i.At(o,e).next((l=>l?l.target:null))))}function lM(n,e){const t=je(n),i=t.Os.get(e)||et.min();return t.persistence.runTransaction("Get new document changes","readonly",(s=>t.Ns.getAllFromCollectionGroup(s,e,kR(i,id),Number.MAX_SAFE_INTEGER))).then((s=>(uM(t,e,s),s)))}function uM(n,e,t){let i=n.Os.get(e)||et.min();t.forEach(((s,o)=>{o.readTime.compareTo(i)>0&&(i=o.readTime)})),n.Os.set(e,i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM="firestore_clients";function fA(n,e){return`${cM}_${n}_${e}`}const dM="firestore_mutations";function mA(n,e,t){let i=`${dM}_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}const hM="firestore_targets";function Sv(n,e){return`${hM}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const no="SharedClientState";class og{constructor(e,t,i,s){this.user=e,this.batchId=t,this.state=i,this.error=s}static Ws(e,t,i){const s=JSON.parse(i);let o,l=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return l&&s.error&&(l=typeof s.error.message=="string"&&typeof s.error.code=="string",l&&(o=new De(s.error.code,s.error.message))),l?new og(e,t,s.state,o):(qn(no,`Failed to parse mutation state for ID '${t}': ${i}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ef{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Ws(e,t){const i=JSON.parse(t);let s,o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new De(i.error.code,i.error.message))),o?new ef(e,i.state,s):(qn(no,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ag{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const i=JSON.parse(t);let s=typeof i=="object"&&i.activeTargetIds instanceof Array,o=zT();for(let l=0;s&&l<i.activeTargetIds.length;++l)s=UR(i.activeTargetIds[l]),o=o.add(i.activeTargetIds[l]);return s?new ag(e,o):(qn(no,`Failed to parse client data for instance '${e}': ${t}`),null)}}class nE{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new nE(t.clientId,t.onlineState):(qn(no,`Failed to parse online state: ${e}`),null)}}class C0{constructor(){this.activeTargetIds=zT()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Cv{constructor(e,t,i,s,o){this.window=e,this.Mi=t,this.persistenceKey=i,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Nn(ut),this.started=!1,this.Xs=[];const l=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.eo=fA(this.persistenceKey,this.Js),this.no=(function(h){return`firestore_sequence_number_${h}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new C0),this.ro=new RegExp(`^${cM}_${l}_([^_]*)$`),this.io=new RegExp(`^${dM}_${l}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${hM}_${l}_(\\d+)$`),this.oo=(function(h){return`firestore_online_state_${h}`})(this.persistenceKey),this._o=(function(h){return`firestore_bundle_loaded_v2_${h}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const i of e){if(i===this.Js)continue;const s=this.getItem(fA(this.persistenceKey,i));if(s){const o=ag.Ws(i,s);o&&(this.Zs=this.Zs.insert(o.clientId,o))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const i=this.uo(t);i&&this.co(i)}for(const i of this.Xs)this.Ys(i);this.Xs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach(((i,s)=>{s.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,i){this.ho(e,t,i),this.Po(e)}addLocalQueryTarget(e,t=!0){let i="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Sv(this.persistenceKey,e));if(s){const o=ef.Ws(e,s);o&&(i=o.state)}}return t&&this.To.zs(e),this.ao(),i}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Sv(this.persistenceKey,e))}updateQueryState(e,t,i){this.Io(e,t,i)}handleUserChange(e,t,i){t.forEach((s=>{this.Po(s)})),this.currentUser=e,i.forEach((s=>{this.addPendingMutation(s)}))}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Ae(no,"READ",e,t),t}setItem(e,t){Ae(no,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Ae(no,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Ae(no,"EVENT",t.key,t.newValue),t.key===this.eo)return void qn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable((async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const i=this.Ro(t.key);return this.Vo(i,null)}{const i=this.mo(t.key,t.newValue);if(i)return this.Vo(i.clientId,i)}}else if(this.io.test(t.key)){if(t.newValue!==null){const i=this.fo(t.key,t.newValue);if(i)return this.po(i)}}else if(this.so.test(t.key)){if(t.newValue!==null){const i=this.yo(t.key,t.newValue);if(i)return this.wo(i)}}else if(t.key===this.oo){if(t.newValue!==null){const i=this.uo(t.newValue);if(i)return this.co(i)}}else if(t.key===this.no){const i=(function(o){let l=ms.ce;if(o!=null)try{const d=JSON.parse(o);Ze(typeof d=="number",30636,{So:o}),l=d}catch(d){qn(no,"Failed to read sequence number from WebStorage",d)}return l})(t.newValue);i!==ms.ce&&this.sequenceNumberHandler(i)}else if(t.key===this._o){const i=this.bo(t.newValue);await Promise.all(i.map((s=>this.syncEngine.Do(s))))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,i){const s=new og(this.currentUser,e,t,i),o=mA(this.persistenceKey,this.currentUser,e);this.setItem(o,s.Gs())}Po(e){const t=mA(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,i){const s=Sv(this.persistenceKey,e),o=new ef(e,t,i);this.setItem(s,o.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const i=this.Ro(e);return ag.Ws(i,t)}fo(e,t){const i=this.io.exec(e),s=Number(i[1]),o=i[2]!==void 0?i[2]:null;return og.Ws(new gi(o),s,t)}yo(e,t){const i=this.so.exec(e),s=Number(i[1]);return ef.Ws(s,t)}uo(e){return nE.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Ae(no,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const i=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),o=this.lo(i),l=[],d=[];return o.forEach((h=>{s.has(h)||l.push(h)})),s.forEach((h=>{o.has(h)||d.push(h)})),this.syncEngine.Fo(l,d).then((()=>{this.Zs=i}))}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=zT();return e.forEach(((i,s)=>{t=t.unionWith(s.activeTargetIds)})),t}}class fM{constructor(){this.Mo=new C0,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,i){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new C0,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l8{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA="ConnectivityMonitor";class gA{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ae(pA,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ae(pA,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let op=null;function b0(){return op===null?op=(function(){return 268435456+Math.round(2147483648*Math.random())})():op++,"0x"+op.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bv="RestConnection",u8={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class c8{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${i}/databases/${s}`,this.Wo=this.databaseId.database===Jp?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Go(e,t,i,s,o){const l=b0(),d=this.zo(e,t.toUriEncodedString());Ae(bv,`Sending RPC '${e}' ${l}:`,d,i);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:p}=new URL(d),T=gl(p);return this.Jo(e,d,h,i,T).then((x=>(Ae(bv,`Received RPC '${e}' ${l}: `,x),x)),(x=>{throw Cu(bv,`RPC '${e}' ${l} failed with error: `,x,"url: ",d,"request:",i),x}))}Ho(e,t,i,s,o,l){return this.Go(e,t,i,s,o)}jo(e,t,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Nd})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),i&&i.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const i=u8[e];return`${this.Uo}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi="WebChannelConnection";class h8 extends c8{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,s,o){const l=b0();return new Promise(((d,h)=>{const p=new wR;p.setWithCredentials(!0),p.listenOnce(SR.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case gp.NO_ERROR:const x=p.getResponseJson();Ae(Mi,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(x)),d(x);break;case gp.TIMEOUT:Ae(Mi,`RPC '${e}' ${l} timed out`),h(new De(ve.DEADLINE_EXCEEDED,"Request time out"));break;case gp.HTTP_ERROR:const C=p.getStatus();if(Ae(Mi,`RPC '${e}' ${l} failed with status:`,C,"response text:",p.getResponseText()),C>0){let A=p.getResponseJson();Array.isArray(A)&&(A=A[0]);const D=A==null?void 0:A.error;if(D&&D.status&&D.message){const F=(function(X){const re=X.toLowerCase().replace(/_/g,"-");return Object.values(ve).indexOf(re)>=0?re:ve.UNKNOWN})(D.status);h(new De(F,D.message))}else h(new De(ve.UNKNOWN,"Server responded with status "+p.getStatus()))}else h(new De(ve.UNAVAILABLE,"Connection failed."));break;default:ze(9055,{l_:e,streamId:l,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{Ae(Mi,`RPC '${e}' ${l} completed.`)}}));const T=JSON.stringify(s);Ae(Mi,`RPC '${e}' ${l} sending request:`,s),p.send(t,"POST",T,i,15)}))}T_(e,t,i){const s=b0(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=IR(),d=bR(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(h.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,i),h.encodeInitMessageHeaders=!0;const T=o.join("");Ae(Mi,`Creating RPC '${e}' stream ${s}: ${T}`,h);const x=l.createWebChannel(T,h);this.I_(x);let C=!1,A=!1;const D=new d8({Yo:H=>{A?Ae(Mi,`Not sending because RPC '${e}' stream ${s} is closed:`,H):(C||(Ae(Mi,`Opening RPC '${e}' stream ${s} transport.`),x.open(),C=!0),Ae(Mi,`RPC '${e}' stream ${s} sending:`,H),x.send(H))},Zo:()=>x.close()}),F=(H,X,re)=>{H.listen(X,(Q=>{try{re(Q)}catch(he){setTimeout((()=>{throw he}),0)}}))};return F(x,Oh.EventType.OPEN,(()=>{A||(Ae(Mi,`RPC '${e}' stream ${s} transport opened.`),D.o_())})),F(x,Oh.EventType.CLOSE,(()=>{A||(A=!0,Ae(Mi,`RPC '${e}' stream ${s} transport closed`),D.a_(),this.E_(x))})),F(x,Oh.EventType.ERROR,(H=>{A||(A=!0,Cu(Mi,`RPC '${e}' stream ${s} transport errored. Name:`,H.name,"Message:",H.message),D.a_(new De(ve.UNAVAILABLE,"The operation could not be completed")))})),F(x,Oh.EventType.MESSAGE,(H=>{var X;if(!A){const re=H.data[0];Ze(!!re,16349);const Q=re,he=(Q==null?void 0:Q.error)||((X=Q[0])==null?void 0:X.error);if(he){Ae(Mi,`RPC '${e}' stream ${s} received error:`,he);const fe=he.status;let Y=(function(O){const q=Qn[O];if(q!==void 0)return A2(q)})(fe),k=he.message;Y===void 0&&(Y=ve.INTERNAL,k="Unknown error status: "+fe+" with message "+he.message),A=!0,D.a_(new De(Y,k)),x.close()}else Ae(Mi,`RPC '${e}' stream ${s} received:`,re),D.u_(re)}})),F(d,CR.STAT_EVENT,(H=>{H.stat===n0.PROXY?Ae(Mi,`RPC '${e}' stream ${s} detected buffering proxy`):H.stat===n0.NOPROXY&&Ae(Mi,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{D.__()}),0),D}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mM(){return typeof window<"u"?window:null}function bp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(n){return new _7(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(e,t,i=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-i);s>0&&Ae("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _A="PersistentStream";class gM{constructor(e,t,i,s,o,l,d,h){this.Mi=e,this.S_=i,this.b_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new pM(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ve.RESOURCE_EXHAUSTED?(qn(t.toString()),qn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ve.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,s])=>{this.D_===t&&this.G_(i,s)}),(i=>{e((()=>{const s=new De(ve.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(s)}))}))}G_(e,t){const i=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{i((()=>this.z_(s)))})),this.stream.onMessage((s=>{i((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ae(_A,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Ae(_A,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class f8 extends gM{constructor(e,t,i,s,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,s,l),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=T7(this.serializer,e),i=(function(o){if(!("targetChange"in o))return et.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?et.min():l.readTime?Yi(l.readTime):et.min()})(e);return this.listener.H_(t,i)}Y_(e){const t={};t.database=v0(this.serializer),t.addTarget=(function(o,l){let d;const h=l.target;if(d=Qp(h)?{documents:V2(o,h)}:{query:O2(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=M2(o,l.resumeToken);const p=_0(o,l.expectedCount);p!==null&&(d.expectedCount=p)}else if(l.snapshotVersion.compareTo(et.min())>0){d.readTime=md(o,l.snapshotVersion.toTimestamp());const p=_0(o,l.expectedCount);p!==null&&(d.expectedCount=p)}return d})(this.serializer,e);const i=x7(this.serializer,e);i&&(t.labels=i),this.q_(t)}Z_(e){const t={};t.database=v0(this.serializer),t.removeTarget=e,this.q_(t)}}class m8 extends gM{constructor(e,t,i,s,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Ze(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ze(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ze(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=E7(e.writeResults,e.commitTime),i=Yi(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=v0(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>eg(this.serializer,i)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p8{}class g8 extends p8{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new De(ve.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,y0(t,i),s,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===ve.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new De(ve.UNKNOWN,o.toString())}))}Ho(e,t,i,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,y0(t,i),s,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===ve.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new De(ve.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class _8{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(qn(t),this.aa=!1):Ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pu="RemoteStore";class y8{constructor(e,t,i,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{i.enqueueAndForget((async()=>{Bu(this)&&(Ae(Pu,"Restarting streams for network reachability change."),await(async function(h){const p=je(h);p.Ea.add(4),await Bf(p),p.Ra.set("Unknown"),p.Ea.delete(4),await r_(p)})(this))}))})),this.Ra=new _8(i,s)}}async function r_(n){if(Bu(n))for(const e of n.da)await e(!0)}async function Bf(n){for(const e of n.da)await e(!1)}function o_(n,e){const t=je(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),rE(t)?sE(t):Pd(t).O_()&&iE(t,e))}function gd(n,e){const t=je(n),i=Pd(t);t.Ia.delete(e),i.O_()&&_M(t,e),t.Ia.size===0&&(i.O_()?i.L_():Bu(t)&&t.Ra.set("Unknown"))}function iE(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(et.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Pd(n).Y_(e)}function _M(n,e){n.Va.Ue(e),Pd(n).Z_(e)}function sE(n){n.Va=new f7({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Pd(n).start(),n.Ra.ua()}function rE(n){return Bu(n)&&!Pd(n).x_()&&n.Ia.size>0}function Bu(n){return je(n).Ea.size===0}function yM(n){n.Va=void 0}async function v8(n){n.Ra.set("Online")}async function T8(n){n.Ia.forEach(((e,t)=>{iE(n,e)}))}async function E8(n,e){yM(n),rE(n)?(n.Ra.ha(e),sE(n)):n.Ra.set("Unknown")}async function x8(n,e,t){if(n.Ra.set("Online"),e instanceof R2&&e.state===2&&e.cause)try{await(async function(s,o){const l=o.cause;for(const d of o.targetIds)s.Ia.has(d)&&(await s.remoteSyncer.rejectListen(d,l),s.Ia.delete(d),s.Va.removeTarget(d))})(n,e)}catch(i){Ae(Pu,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await lg(n,i)}else if(e instanceof Sp?n.Va.Ze(e):e instanceof N2?n.Va.st(e):n.Va.tt(e),!t.isEqual(et.min()))try{const i=await oM(n.localStore);t.compareTo(i)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,p)=>{if(h.resumeToken.approximateByteSize()>0){const T=o.Ia.get(p);T&&o.Ia.set(p,T.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,p)=>{const T=o.Ia.get(h);if(!T)return;o.Ia.set(h,T.withResumeToken(Hn.EMPTY_BYTE_STRING,T.snapshotVersion)),_M(o,h);const x=new qo(T.target,h,p,T.sequenceNumber);iE(o,x)})),o.remoteSyncer.applyRemoteEvent(d)})(n,t)}catch(i){Ae(Pu,"Failed to raise snapshot:",i),await lg(n,i)}}async function lg(n,e,t){if(!yl(e))throw e;n.Ea.add(1),await Bf(n),n.Ra.set("Offline"),t||(t=()=>oM(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{Ae(Pu,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await r_(n)}))}function vM(n,e){return e().catch((t=>lg(n,t,e)))}async function Md(n){const e=je(n),t=dl(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:_u;for(;w8(e);)try{const s=await a8(e.localStore,i);if(s===null){e.Ta.length===0&&t.L_();break}i=s.batchId,S8(e,s)}catch(s){await lg(e,s)}TM(e)&&EM(e)}function w8(n){return Bu(n)&&n.Ta.length<10}function S8(n,e){n.Ta.push(e);const t=dl(n);t.O_()&&t.X_&&t.ea(e.mutations)}function TM(n){return Bu(n)&&!dl(n).x_()&&n.Ta.length>0}function EM(n){dl(n).start()}async function C8(n){dl(n).ra()}async function b8(n){const e=dl(n);for(const t of n.Ta)e.ea(t.mutations)}async function I8(n,e,t){const i=n.Ta.shift(),s=jT.from(i,e,t);await vM(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Md(n)}async function A8(n,e){e&&dl(n).X_&&await(async function(i,s){if((function(l){return c7(l)&&l!==ve.ABORTED})(s.code)){const o=i.Ta.shift();dl(i).B_(),await vM(i,(()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Md(i)}})(n,e),TM(n)&&EM(n)}async function yA(n,e){const t=je(n);t.asyncQueue.verifyOperationInProgress(),Ae(Pu,"RemoteStore received new credentials");const i=Bu(t);t.Ea.add(3),await Bf(t),i&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await r_(t)}async function I0(n,e){const t=je(n);e?(t.Ea.delete(2),await r_(t)):e||(t.Ea.add(2),await Bf(t),t.Ra.set("Unknown"))}function Pd(n){return n.ma||(n.ma=(function(t,i,s){const o=je(t);return o.sa(),new f8(i,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:v8.bind(null,n),t_:T8.bind(null,n),r_:E8.bind(null,n),H_:x8.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),rE(n)?sE(n):n.Ra.set("Unknown")):(await n.ma.stop(),yM(n))}))),n.ma}function dl(n){return n.fa||(n.fa=(function(t,i,s){const o=je(t);return o.sa(),new m8(i,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:C8.bind(null,n),r_:A8.bind(null,n),ta:b8.bind(null,n),na:I8.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Md(n)):(await n.fa.stop(),n.Ta.length>0&&(Ae(Pu,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,t,i,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=o,this.deferred=new Ho,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,o){const l=Date.now()+i,d=new oE(e,t,l,s,o);return d.start(i),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new De(ve.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function aE(n,e){if(qn("AsyncQueue",`${e}: ${n}`),yl(n))return new De(ve.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{static emptySet(e){return new Jc(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||Ve.comparator(t.key,i.key):(t,i)=>Ve.comparator(t.key,i.key),this.keyedMap=Uh(),this.sortedSet=new Nn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=i.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Jc;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vA{constructor(){this.ga=new Nn(Ve.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ze(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,i)=>{e.push(i)})),e}}class _d{constructor(e,t,i,s,o,l,d,h,p){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=p}static fromInitialDocuments(e,t,i,s,o){const l=[];return t.forEach((d=>{l.push({type:0,doc:d})})),new _d(e,t,Jc.emptySet(t),l,i,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qg(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==i[s].type||!t[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N8{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class R8{constructor(){this.queries=TA(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const s=je(t),o=s.queries;s.queries=TA(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(i)}))})(this,new De(ve.ABORTED,"Firestore shutting down"))}}function TA(){return new sa((n=>m2(n)),Qg)}async function xM(n,e){const t=je(n);let i=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(i=2):(o=new N8,i=e.Da()?0:1);try{switch(i){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(l){const d=aE(l,`Initialization of query '${Vc(e.query)}' failed`);return void e.onError(d)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&lE(t)}async function wM(n,e){const t=je(n),i=e.query;let s=3;const o=t.queries.get(i);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function M8(n,e){const t=je(n);let i=!1;for(const s of e){const o=s.query,l=t.queries.get(o);if(l){for(const d of l.Sa)d.Fa(s)&&(i=!0);l.wa=s}}i&&lE(t)}function P8(n,e,t){const i=je(n),s=i.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);i.queries.delete(e)}function lE(n){n.Ca.forEach((e=>{e.next()}))}var A0,EA;(EA=A0||(A0={})).Ma="default",EA.Cache="cache";class SM{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new _d(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=_d.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==A0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e){this.key=e}}class bM{constructor(e){this.key=e}}class k8{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Tt(),this.mutatedKeys=Tt(),this.eu=g2(e),this.tu=new Jc(this.eu)}get nu(){return this.Ya}ru(e,t){const i=t?t.iu:new vA,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,l=s,d=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,p=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((T,x)=>{const C=s.get(T),A=Of(this.query,x)?x:null,D=!!C&&this.mutatedKeys.has(C.key),F=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let H=!1;C&&A?C.data.isEqual(A.data)?D!==F&&(i.track({type:3,doc:A}),H=!0):this.su(C,A)||(i.track({type:2,doc:A}),H=!0,(h&&this.eu(A,h)>0||p&&this.eu(A,p)<0)&&(d=!0)):!C&&A?(i.track({type:0,doc:A}),H=!0):C&&!A&&(i.track({type:1,doc:C}),H=!0,(h||p)&&(d=!0)),H&&(A?(l=l.add(A),o=F?o.add(T):o.delete(T)):(l=l.delete(T),o=o.delete(T)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const T=this.query.limitType==="F"?l.last():l.first();l=l.delete(T.key),o=o.delete(T.key),i.track({type:1,doc:T})}return{tu:l,iu:i,Cs:d,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((T,x)=>(function(A,D){const F=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ze(20277,{Rt:H})}};return F(A)-F(D)})(T.type,x.type)||this.eu(T.doc,x.doc))),this.ou(i),s=s??!1;const d=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,p=h!==this.Za;return this.Za=h,l.length!==0||p?{snapshot:new _d(this.query,e.tu,o,l,e.mutatedKeys,h===0,p,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new vA,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Tt(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const t=[];return e.forEach((i=>{this.Xa.has(i)||t.push(new bM(i))})),this.Xa.forEach((i=>{e.has(i)||t.push(new CM(i))})),t}cu(e){this.Ya=e.Qs,this.Xa=Tt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return _d.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const kd="SyncEngine";class D8{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class L8{constructor(e){this.key=e,this.hu=!1}}class V8{constructor(e,t,i,s,o,l){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new sa((d=>m2(d)),Qg),this.Iu=new Map,this.Eu=new Set,this.du=new Nn(Ve.comparator),this.Au=new Map,this.Ru=new QT,this.Vu={},this.mu=new Map,this.fu=Mu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function O8(n,e,t=!0){const i=a_(n);let s;const o=i.Tu.get(e);return o?(i.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await IM(i,e,t,!0),s}async function U8(n,e){const t=a_(n);await IM(t,e,!0,!1)}async function IM(n,e,t,i){const s=await rg(n.localStore,zs(e)),o=s.targetId,l=n.sharedClientState.addLocalQueryTarget(o,t);let d;return i&&(d=await uE(n,e,o,l==="current",s.resumeToken)),n.isPrimaryClient&&t&&o_(n.remoteStore,s),d}async function uE(n,e,t,i,s){n.pu=(x,C,A)=>(async function(F,H,X,re){let Q=H.view.ru(X);Q.Cs&&(Q=await S0(F.localStore,H.query,!1).then((({documents:k})=>H.view.ru(k,Q))));const he=re&&re.targetChanges.get(H.targetId),fe=re&&re.targetMismatches.get(H.targetId)!=null,Y=H.view.applyChanges(Q,F.isPrimaryClient,he,fe);return N0(F,H.targetId,Y.au),Y.snapshot})(n,x,C,A);const o=await S0(n.localStore,e,!0),l=new k8(e,o.Qs),d=l.ru(o.documents),h=Ff.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",s),p=l.applyChanges(d,n.isPrimaryClient,h);N0(n,t,p.au);const T=new D8(e,t,l);return n.Tu.set(e,T),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),p.snapshot}async function F8(n,e,t){const i=je(n),s=i.Tu.get(e),o=i.Iu.get(s.targetId);if(o.length>1)return i.Iu.set(s.targetId,o.filter((l=>!Qg(l,e)))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await pd(i.localStore,s.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(s.targetId),t&&gd(i.remoteStore,s.targetId),yd(i,s.targetId)})).catch(_l)):(yd(i,s.targetId),await pd(i.localStore,s.targetId,!0))}async function B8(n,e){const t=je(n),i=t.Tu.get(e),s=t.Iu.get(i.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),gd(t.remoteStore,i.targetId))}async function z8(n,e,t){const i=fE(n);try{const s=await(function(l,d){const h=je(l),p=en.now(),T=d.reduce(((A,D)=>A.add(D.key)),Tt());let x,C;return h.persistence.runTransaction("Locally write mutations","readwrite",(A=>{let D=Fs(),F=Tt();return h.Ns.getEntries(A,T).next((H=>{D=H,D.forEach(((X,re)=>{re.isValidDocument()||(F=F.add(X))}))})).next((()=>h.localDocuments.getOverlayedDocuments(A,D))).next((H=>{x=H;const X=[];for(const re of d){const Q=l7(re,x.get(re.key).overlayedDocument);Q!=null&&X.push(new ra(re.key,Q,s2(Q.value.mapValue),Oi.exists(!0)))}return h.mutationQueue.addMutationBatch(A,p,X,d)})).next((H=>{C=H;const X=H.applyToLocalDocumentSet(x,F);return h.documentOverlayCache.saveOverlays(A,H.batchId,X)}))})).then((()=>({batchId:C.batchId,changes:y2(x)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),(function(l,d,h){let p=l.Vu[l.currentUser.toKey()];p||(p=new Nn(ut)),p=p.insert(d,h),l.Vu[l.currentUser.toKey()]=p})(i,s.batchId,t),await Tl(i,s.changes),await Md(i.remoteStore)}catch(s){const o=aE(s,"Failed to persist write");t.reject(o)}}async function AM(n,e){const t=je(n);try{const i=await r8(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const l=t.Au.get(o);l&&(Ze(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?Ze(l.hu,14607):s.removedDocuments.size>0&&(Ze(l.hu,42227),l.hu=!1))})),await Tl(t,i,e)}catch(i){await _l(i)}}function xA(n,e,t){const i=je(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&s.push(d.snapshot)})),(function(l,d){const h=je(l);h.onlineState=d;let p=!1;h.queries.forEach(((T,x)=>{for(const C of x.Sa)C.va(d)&&(p=!0)})),p&&lE(h)})(i.eventManager,e),s.length&&i.Pu.H_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function q8(n,e,t){const i=je(n);i.sharedClientState.updateQueryState(e,"rejected",t);const s=i.Au.get(e),o=s&&s.key;if(o){let l=new Nn(Ve.comparator);l=l.insert(o,Vn.newNoDocument(o,et.min()));const d=Tt().add(o),h=new Uf(et.min(),new Map,new Nn(ut),l,d);await AM(i,h),i.du=i.du.remove(o),i.Au.delete(e),hE(i)}else await pd(i.localStore,e,!1).then((()=>yd(i,e,t))).catch(_l)}async function G8(n,e){const t=je(n),i=e.batch.batchId;try{const s=await s8(t.localStore,e);dE(t,i,null),cE(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Tl(t,s)}catch(s){await _l(s)}}async function H8(n,e,t){const i=je(n);try{const s=await(function(l,d){const h=je(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let T;return h.mutationQueue.lookupMutationBatch(p,d).next((x=>(Ze(x!==null,37113),T=x.keys(),h.mutationQueue.removeMutationBatch(p,x)))).next((()=>h.mutationQueue.performConsistencyCheck(p))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(p,T,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,T))).next((()=>h.localDocuments.getDocuments(p,T)))}))})(i.localStore,e);dE(i,e,t),cE(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Tl(i,s)}catch(s){await _l(s)}}function cE(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function dE(n,e,t){const i=je(n);let s=i.Vu[i.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),i.Vu[i.currentUser.toKey()]=s}}function yd(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((i=>{n.Ru.containsKey(i)||NM(n,i)}))}function NM(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(gd(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),hE(n))}function N0(n,e,t){for(const i of t)i instanceof CM?(n.Ru.addReference(i.key,e),j8(n,i)):i instanceof bM?(Ae(kd,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,e),n.Ru.containsKey(i.key)||NM(n,i.key)):ze(19791,{wu:i})}function j8(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Eu.has(i)||(Ae(kd,"New document in limbo: "+t),n.Eu.add(i),hE(n))}function hE(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Ve(Kt.fromString(e)),i=n.fu.next();n.Au.set(i,new L8(t)),n.du=n.du.insert(t,i),o_(n.remoteStore,new qo(zs(Zg(t.path)),i,"TargetPurposeLimboResolution",ms.ce))}}async function Tl(n,e,t){const i=je(n),s=[],o=[],l=[];i.Tu.isEmpty()||(i.Tu.forEach(((d,h)=>{l.push(i.pu(h,e,t).then((p=>{var T;if((p||t)&&i.isPrimaryClient){const x=p?!p.fromCache:(T=t==null?void 0:t.targetChanges.get(h.targetId))==null?void 0:T.current;i.sharedClientState.updateQueryState(h.targetId,x?"current":"not-current")}if(p){s.push(p);const x=eE.As(h.targetId,p);o.push(x)}})))})),await Promise.all(l),i.Pu.H_(s),await(async function(h,p){const T=je(h);try{await T.persistence.runTransaction("notifyLocalViewChanges","readwrite",(x=>ie.forEach(p,(C=>ie.forEach(C.Es,(A=>T.persistence.referenceDelegate.addReference(x,C.targetId,A))).next((()=>ie.forEach(C.ds,(A=>T.persistence.referenceDelegate.removeReference(x,C.targetId,A)))))))))}catch(x){if(!yl(x))throw x;Ae(tE,"Failed to update sequence numbers: "+x)}for(const x of p){const C=x.targetId;if(!x.fromCache){const A=T.Ms.get(C),D=A.snapshotVersion,F=A.withLastLimboFreeSnapshotVersion(D);T.Ms=T.Ms.insert(C,F)}}})(i.localStore,o))}async function K8(n,e){const t=je(n);if(!t.currentUser.isEqual(e)){Ae(kd,"User change. New user:",e.toKey());const i=await rM(t.localStore,e);t.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new De(ve.CANCELLED,l))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Tl(t,i.Ls)}}function W8(n,e){const t=je(n),i=t.Au.get(e);if(i&&i.hu)return Tt().add(i.key);{let s=Tt();const o=t.Iu.get(e);if(!o)return s;for(const l of o){const d=t.Tu.get(l);s=s.unionWith(d.view.nu)}return s}}async function Y8(n,e){const t=je(n),i=await S0(t.localStore,e.query,!0),s=e.view.cu(i);return t.isPrimaryClient&&N0(t,e.targetId,s.au),s}async function J8(n,e){const t=je(n);return lM(t.localStore,e).then((i=>Tl(t,i)))}async function Z8(n,e,t,i){const s=je(n),o=await(function(d,h){const p=je(d),T=je(p.mutationQueue);return p.persistence.runTransaction("Lookup mutation documents","readonly",(x=>T.er(x,h).next((C=>C?p.localDocuments.getDocuments(x,C):ie.resolve(null)))))})(s.localStore,e);o!==null?(t==="pending"?await Md(s.remoteStore):t==="acknowledged"||t==="rejected"?(dE(s,e,i||null),cE(s,e),(function(d,h){je(je(d).mutationQueue).ir(h)})(s.localStore,e)):ze(6720,"Unknown batchState",{Su:t}),await Tl(s,o)):Ae(kd,"Cannot apply mutation batch with id: "+e)}async function Q8(n,e){const t=je(n);if(a_(t),fE(t),e===!0&&t.gu!==!0){const i=t.sharedClientState.getAllActiveQueryTargets(),s=await wA(t,i.toArray());t.gu=!0,await I0(t.remoteStore,!0);for(const o of s)o_(t.remoteStore,o)}else if(e===!1&&t.gu!==!1){const i=[];let s=Promise.resolve();t.Iu.forEach(((o,l)=>{t.sharedClientState.isLocalQueryTarget(l)?i.push(l):s=s.then((()=>(yd(t,l),pd(t.localStore,l,!0)))),gd(t.remoteStore,l)})),await s,await wA(t,i),(function(l){const d=je(l);d.Au.forEach(((h,p)=>{gd(d.remoteStore,p)})),d.Ru.Jr(),d.Au=new Map,d.du=new Nn(Ve.comparator)})(t),t.gu=!1,await I0(t.remoteStore,!1)}}async function wA(n,e,t){const i=je(n),s=[],o=[];for(const l of e){let d;const h=i.Iu.get(l);if(h&&h.length!==0){d=await rg(i.localStore,zs(h[0]));for(const p of h){const T=i.Tu.get(p),x=await Y8(i,T);x.snapshot&&o.push(x.snapshot)}}else{const p=await aM(i.localStore,l);d=await rg(i.localStore,p),await uE(i,RM(p),l,!1,d.resumeToken)}s.push(d)}return i.Pu.H_(o),s}function RM(n){return h2(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function $8(n){return(function(t){return je(je(t).persistence).Ts()})(je(n).localStore)}async function X8(n,e,t,i){const s=je(n);if(s.gu)return void Ae(kd,"Ignoring unexpected query state notification.");const o=s.Iu.get(e);if(o&&o.length>0)switch(t){case"current":case"not-current":{const l=await lM(s.localStore,p2(o[0])),d=Uf.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Hn.EMPTY_BYTE_STRING);await Tl(s,l,d);break}case"rejected":await pd(s.localStore,e,!0),yd(s,e,i);break;default:ze(64155,t)}}async function eq(n,e,t){const i=a_(n);if(i.gu){for(const s of e){if(i.Iu.has(s)&&i.sharedClientState.isActiveQueryTarget(s)){Ae(kd,"Adding an already active target "+s);continue}const o=await aM(i.localStore,s),l=await rg(i.localStore,o);await uE(i,RM(o),l.targetId,!1,l.resumeToken),o_(i.remoteStore,l)}for(const s of t)i.Iu.has(s)&&await pd(i.localStore,s,!1).then((()=>{gd(i.remoteStore,s),yd(i,s)})).catch(_l)}}function a_(n){const e=je(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=AM.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=W8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=q8.bind(null,e),e.Pu.H_=M8.bind(null,e.eventManager),e.Pu.yu=P8.bind(null,e.eventManager),e}function fE(n){const e=je(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=G8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=H8.bind(null,e),e}class xf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=s_(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return sM(this.persistence,new iM,e.initialUser,this.serializer)}Cu(e){return new $T(i_.mi,this.serializer)}Du(e){return new fM}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xf.provider={build:()=>new xf};class tq extends xf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Ze(this.persistence.referenceDelegate instanceof sg,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new Q2(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Pi.withCacheSize(this.cacheSizeBytes):Pi.DEFAULT;return new $T((i=>sg.mi(i,t)),this.serializer)}}class nq extends xf{constructor(e,t,i){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await fE(this.xu.syncEngine),await Md(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return sM(this.persistence,new iM,e.initialUser,this.serializer)}Fu(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new Q2(i,e.asyncQueue,t)}Mu(e,t){const i=new dz(t,this.persistence);return new cz(e.asyncQueue,i)}Cu(e){const t=nM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Pi.withCacheSize(this.cacheSizeBytes):Pi.DEFAULT;return new XT(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,mM(),bp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new fM}}class iq extends nq{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Cv&&(this.sharedClientState.syncEngine={Co:Z8.bind(null,t),vo:X8.bind(null,t),Fo:eq.bind(null,t),Ts:$8.bind(null,t),Do:J8.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async i=>{await Q8(this.xu.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())}))}Du(e){const t=mM();if(!Cv.v(t))throw new De(ve.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=nM(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Cv(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class ug{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>xA(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=K8.bind(null,this.syncEngine),await I0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new R8})()}createDatastore(e){const t=s_(e.databaseInfo.databaseId),i=(function(o){return new h8(o)})(e.databaseInfo);return(function(o,l,d,h){return new g8(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,s,o,l,d){return new y8(i,s,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(t=>xA(this.syncEngine,t,0)),(function(){return gA.v()?new gA:new l8})())}createSyncEngine(e,t){return(function(s,o,l,d,h,p,T){const x=new V8(s,o,l,d,h,p);return T&&(x.gu=!0),x})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(s){const o=je(s);Ae(Pu,"RemoteStore shutting down."),o.Ea.add(5),await Bf(o),o.Aa.shutdown(),o.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}ug.provider={build:()=>new ug};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):qn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hl="FirestoreClient";class sq{constructor(e,t,i,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=gi.UNAUTHENTICATED,this.clientId=RT.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(i,(async l=>{Ae(hl,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(i,(l=>(Ae(hl,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ho;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=aE(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function Iv(n,e){n.asyncQueue.verifyOperationInProgress(),Ae(hl,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async s=>{i.isEqual(s)||(await rM(e.localStore,s),i=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function SA(n,e){n.asyncQueue.verifyOperationInProgress();const t=await rq(n);Ae(hl,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>yA(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,s)=>yA(e.remoteStore,s))),n._onlineComponents=e}async function rq(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ae(hl,"Using user provided OfflineComponentProvider");try{await Iv(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===ve.FAILED_PRECONDITION||s.code===ve.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Cu("Error using user provided cache. Falling back to memory cache: "+t),await Iv(n,new xf)}}else Ae(hl,"Using default OfflineComponentProvider"),await Iv(n,new tq(void 0));return n._offlineComponents}async function PM(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ae(hl,"Using user provided OnlineComponentProvider"),await SA(n,n._uninitializedComponentsProvider._online)):(Ae(hl,"Using default OnlineComponentProvider"),await SA(n,new ug))),n._onlineComponents}function oq(n){return PM(n).then((e=>e.syncEngine))}async function R0(n){const e=await PM(n),t=e.eventManager;return t.onListen=O8.bind(null,e.syncEngine),t.onUnlisten=F8.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=U8.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B8.bind(null,e.syncEngine),t}function aq(n,e,t={}){const i=new Ho;return n.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,p){const T=new MM({next:C=>{T.Nu(),l.enqueueAndForget((()=>wM(o,x))),C.fromCache&&h.source==="server"?p.reject(new De(ve.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(C)},error:C=>p.reject(C)}),x=new SM(d,T,{includeMetadataChanges:!0,qa:!0});return xM(o,x)})(await R0(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kM(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CA=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM="firestore.googleapis.com",bA=!0;class IA{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new De(ve.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=DM,this.ssl=bA}else this.host=e.host,this.ssl=e.ssl??bA;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=W2;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<U7)throw new De(ve.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}az("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kM(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new De(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new De(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new De(ve.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,s){return i.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class l_{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new IA({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new De(ve.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new De(ve.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new IA(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new QB;switch(i.type){case"firstParty":return new tz(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new De(ve.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=CA.get(t);i&&(Ae("ComponentProvider","Removing Datastore"),CA.delete(t),i.terminate())})(this),Promise.resolve()}}function lq(n,e,t,i={}){var p;n=Bs(n,l_);const s=gl(e),o=n._getSettings(),l={...o,emulatorOptions:n._getEmulatorOptions()},d=`${e}:${t}`;s&&(mT(`https://${d}`),pT("Firestore",!0)),o.host!==DM&&o.host!==d&&Cu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:s,emulatorOptions:i};if(!Wo(h,l)&&(n._setSettings(h),i.mockUserToken)){let T,x;if(typeof i.mockUserToken=="string")T=i.mockUserToken,x=gi.MOCK_USER;else{T=kN(i.mockUserToken,(p=n._app)==null?void 0:p.options.projectId);const C=i.mockUserToken.sub||i.mockUserToken.user_id;if(!C)throw new De(ve.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new gi(C)}n._authCredentials=new $B(new NR(T,x))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new zu(this.firestore,e,this._query)}}class Gn{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gn(this.firestore,e,this._key)}toJSON(){return{type:Gn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(kf(t,Gn._jsonSchema))return new Gn(e,i||null,new Ve(Kt.fromString(t.referencePath)))}}Gn._jsonSchemaVersion="firestore/documentReference/1.0",Gn._jsonSchema={type:$n("string",Gn._jsonSchemaVersion),referencePath:$n("string")};class rl extends zu{constructor(e,t,i){super(e,t,Zg(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gn(this.firestore,null,new Ve(e))}withConverter(e){return new rl(this.firestore,e,this._path)}}function Ip(n,e,...t){if(n=Un(n),MR("collection","path",e),n instanceof l_){const i=Kt.fromString(e,...t);return _I(i),new rl(n,null,i)}{if(!(n instanceof Gn||n instanceof rl))throw new De(ve.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Kt.fromString(e,...t));return _I(i),new rl(n.firestore,null,i)}}function tf(n,e,...t){if(n=Un(n),arguments.length===1&&(e=RT.newId()),MR("doc","path",e),n instanceof l_){const i=Kt.fromString(e,...t);return gI(i),new Gn(n,null,new Ve(i))}{if(!(n instanceof Gn||n instanceof rl))throw new De(ve.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Kt.fromString(e,...t));return gI(i),new Gn(n.firestore,n instanceof rl?n.converter:null,new Ve(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AA="AsyncQueue";class NA{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new pM(this,"async_queue_retry"),this._c=()=>{const i=bp();i&&Ae(AA,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=bp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=bp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ho;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!yl(e))throw e;Ae(AA,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,qn("INTERNAL UNHANDLED ERROR: ",RA(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=oE.createAndSchedule(this,e,t,i,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&ze(47125,{Pc:RA(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function RA(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MA(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const s=t;for(const o of i)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class $o extends l_{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new NA,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new NA(e),this._firestoreClient=void 0,await e}}}function uq(n,e){const t=typeof n=="object"?n:yT(),i=typeof n=="string"?n:Jp,s=Ug(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const o=RN("firestore");o&&lq(s,...o)}return s}function mE(n){if(n._terminated)throw new De(ve.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LM(n),n._firestoreClient}function LM(n){var i,s,o;const e=n._freezeSettings(),t=(function(d,h,p,T){return new Fz(d,h,p,T.host,T.ssl,T.experimentalForceLongPolling,T.experimentalAutoDetectLongPolling,kM(T.experimentalLongPollingOptions),T.useFetchStreams,T.isUsingEmulator)})(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new sq(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(d){const h=d==null?void 0:d._online.build();return{_offline:d==null?void 0:d._offline.build(h),_online:h}})(n._componentsProvider))}async function cq(n){Cu("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();dq(n,ug.provider,{build:t=>new iq(t,e.cacheSizeBytes)})}function dq(n,e,t){if((n=Bs(n,$o))._firestoreClient||n._terminated)throw new De(ve.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new De(ve.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},LM(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lr(Hn.fromBase64String(e))}catch(t){throw new De(ve.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lr(Hn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(kf(e,lr._jsonSchema))return lr.fromBase64String(e.bytes)}}lr._jsonSchemaVersion="firestore/bytes/1.0",lr._jsonSchema={type:$n("string",lr._jsonSchemaVersion),bytes:$n("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new De(ve.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new An(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new De(ve.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new De(ve.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ut(this._lat,e._lat)||ut(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ao._jsonSchemaVersion}}static fromJSON(e){if(kf(e,ao._jsonSchema))return new ao(e.latitude,e.longitude)}}ao._jsonSchemaVersion="firestore/geoPoint/1.0",ao._jsonSchema={type:$n("string",ao._jsonSchemaVersion),latitude:$n("number"),longitude:$n("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,s){if(i.length!==s.length)return!1;for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:lo._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(kf(e,lo._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new lo(e.vectorValues);throw new De(ve.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}lo._jsonSchemaVersion="firestore/vectorValue/1.0",lo._jsonSchema={type:$n("string",lo._jsonSchemaVersion),vectorValues:$n("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hq=/^__.*__$/;class fq{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new ra(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rd(e,this.data,t,this.fieldTransforms)}}class VM{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new ra(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function OM(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ze(40011,{Ac:n})}}class c_{constructor(e,t,i,s,o,l){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new c_({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),i=this.Vc({path:t,fc:!1});return i.gc(e),i}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),i=this.Vc({path:t,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return cg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(OM(this.Ac)&&hq.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class mq{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||s_(e)}Cc(e,t,i,s=!1){return new c_({Ac:e,methodName:t,Dc:i,path:An.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function d_(n){const e=n._freezeSettings(),t=s_(n._databaseId);return new mq(n._databaseId,!!e.ignoreUndefinedProperties,t)}function UM(n,e,t,i,s,o={}){const l=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);_E("Data must be an object, but it was:",l,i);const d=FM(i,l);let h,p;if(o.merge)h=new ps(l.fieldMask),p=l.fieldTransforms;else if(o.mergeFields){const T=[];for(const x of o.mergeFields){const C=M0(e,x,t);if(!l.contains(C))throw new De(ve.INVALID_ARGUMENT,`Field '${C}' is specified in your field mask but missing from your input data.`);zM(T,C)||T.push(C)}h=new ps(T),p=l.fieldTransforms.filter((x=>h.covers(x.field)))}else h=null,p=l.fieldTransforms;return new fq(new Li(d),h,p)}class h_ extends zf{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof h_}}function pq(n,e,t){return new c_({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class pE extends zf{_toFieldTransform(e){return new GT(e.path,new hd)}isEqual(e){return e instanceof pE}}class gE extends zf{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=pq(this,e,!0),i=this.vc.map((o=>Dd(o,t))),s=new Au(i);return new GT(e.path,s)}isEqual(e){return e instanceof gE&&Wo(this.vc,e.vc)}}function gq(n,e,t,i){const s=n.Cc(1,e,t);_E("Data must be an object, but it was:",s,i);const o=[],l=Li.empty();vl(i,((h,p)=>{const T=yE(e,h,t);p=Un(p);const x=s.yc(T);if(p instanceof h_)o.push(T);else{const C=Dd(p,x);C!=null&&(o.push(T),l.set(T,C))}}));const d=new ps(o);return new VM(l,d,s.fieldTransforms)}function _q(n,e,t,i,s,o){const l=n.Cc(1,e,t),d=[M0(e,i,t)],h=[s];if(o.length%2!=0)throw new De(ve.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let C=0;C<o.length;C+=2)d.push(M0(e,o[C])),h.push(o[C+1]);const p=[],T=Li.empty();for(let C=d.length-1;C>=0;--C)if(!zM(p,d[C])){const A=d[C];let D=h[C];D=Un(D);const F=l.yc(A);if(D instanceof h_)p.push(A);else{const H=Dd(D,F);H!=null&&(p.push(A),T.set(A,H))}}const x=new ps(p);return new VM(T,x,l.fieldTransforms)}function yq(n,e,t,i=!1){return Dd(t,n.Cc(i?4:3,e))}function Dd(n,e){if(BM(n=Un(n)))return _E("Unsupported field value:",e,n),FM(n,e);if(n instanceof zf)return(function(i,s){if(!OM(s.Ac))throw s.Sc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${i._methodName}() is not currently supported inside arrays`);const o=i._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(i,s){const o=[];let l=0;for(const d of i){let h=Dd(d,s.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(n,e)}return(function(i,s){if((i=Un(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return n7(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const o=en.fromDate(i);return{timestampValue:md(s.serializer,o)}}if(i instanceof en){const o=new en(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:md(s.serializer,o)}}if(i instanceof ao)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof lr)return{bytesValue:M2(s.serializer,i._byteString)};if(i instanceof Gn){const o=s.databaseId,l=i.firestore._databaseId;if(!l.isEqual(o))throw s.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:YT(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof lo)return(function(l,d){return{mapValue:{fields:{[UT]:{stringValue:FT},[ld]:{arrayValue:{values:l.toArray().map((p=>{if(typeof p!="number")throw d.Sc("VectorValues must only contain numeric values.");return qT(d.serializer,p)}))}}}}}})(i,s);throw s.Sc(`Unsupported field value: ${qg(i)}`)})(n,e)}function FM(n,e){const t={};return JR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vl(n,((i,s)=>{const o=Dd(s,e.mc(i));o!=null&&(t[i]=o)})),{mapValue:{fields:t}}}function BM(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof en||n instanceof ao||n instanceof lr||n instanceof Gn||n instanceof zf||n instanceof lo)}function _E(n,e,t){if(!BM(t)||!PR(t)){const i=qg(t);throw i==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+i)}}function M0(n,e,t){if((e=Un(e))instanceof u_)return e._internalPath;if(typeof e=="string")return yE(n,e);throw cg("Field path arguments must be of type string or ",n,!1,void 0,t)}const vq=new RegExp("[~\\*/\\[\\]]");function yE(n,e,t){if(e.search(vq)>=0)throw cg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new u_(...e.split("."))._internalPath}catch{throw cg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function cg(n,e,t,i,s){const o=i&&!i.isEmpty(),l=s!==void 0;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${i}`),l&&(h+=` in document ${s}`),h+=")"),new De(ve.INVALID_ARGUMENT,d+n+h)}function zM(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{constructor(e,t,i,s,o){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Gn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Tq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vE("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Tq extends qM{data(){return super.data()}}function vE(n,e){return typeof e=="string"?yE(n,e):e instanceof u_?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GM(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new De(ve.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class TE{}class Eq extends TE{}function P0(n,e,...t){let i=[];e instanceof TE&&i.push(e),i=i.concat(t),(function(o){const l=o.filter((h=>h instanceof EE)).length,d=o.filter((h=>h instanceof f_)).length;if(l>1||l>0&&d>0)throw new De(ve.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const s of i)n=s._apply(n);return n}class f_ extends Eq{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new f_(e,t,i)}_apply(e){const t=this._parse(e);return HM(e._query,t),new zu(e.firestore,e.converter,p0(e._query,t))}_parse(e){const t=d_(e.firestore);return(function(o,l,d,h,p,T,x){let C;if(p.isKeyField()){if(T==="array-contains"||T==="array-contains-any")throw new De(ve.INVALID_ARGUMENT,`Invalid Query. You can't perform '${T}' queries on documentId().`);if(T==="in"||T==="not-in"){kA(x,T);const D=[];for(const F of x)D.push(PA(h,o,F));C={arrayValue:{values:D}}}else C=PA(h,o,x)}else T!=="in"&&T!=="not-in"&&T!=="array-contains-any"||kA(x,T),C=yq(d,l,x,T==="in"||T==="not-in");return Lt.create(p,T,C)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function k0(n,e,t){const i=e,s=vE("where",n);return f_._create(s,i,t)}class EE extends TE{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new EE(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:tn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,o){let l=s;const d=o.getFlattenedFilters();for(const h of d)HM(l,h),l=p0(l,h)})(e._query,t),new zu(e.firestore,e.converter,p0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function PA(n,e,t){if(typeof(t=Un(t))=="string"){if(t==="")throw new De(ve.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!f2(e)&&t.indexOf("/")!==-1)throw new De(ve.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(Kt.fromString(t));if(!Ve.isDocumentKey(i))throw new De(ve.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return vf(n,new Ve(i))}if(t instanceof Gn)return vf(n,t._key);throw new De(ve.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qg(t)}.`)}function kA(n,e){if(!Array.isArray(n)||n.length===0)throw new De(ve.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HM(n,e){const t=(function(s,o){for(const l of s)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new De(ve.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new De(ve.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class xq{convertValue(e,t="none"){switch(ul(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ze(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return vl(e,((s,o)=>{i[s]=this.convertValue(o,t)})),i}convertVectorValue(e){var i,s,o;const t=(o=(s=(i=e.fields)==null?void 0:i[ld].arrayValue)==null?void 0:s.values)==null?void 0:o.map((l=>Cn(l.doubleValue)));return new lo(t)}convertGeoPoint(e){return new ao(Cn(e.latitude),Cn(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Yg(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(_f(e));default:return null}}convertTimestamp(e){const t=Zo(e);return new en(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Kt.fromString(e);Ze(z2(i),9688,{name:e});const s=new bu(i.get(1),i.get(3)),o=new Ve(i.popFirst(5));return s.isEqual(t)||qn(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class zh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Tu extends qM{constructor(e,t,i,s,o,l){super(e,t,i,s,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ap(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(vE("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new De(ve.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Tu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Tu._jsonSchemaVersion="firestore/documentSnapshot/1.0",Tu._jsonSchema={type:$n("string",Tu._jsonSchemaVersion),bundleSource:$n("string","DocumentSnapshot"),bundleName:$n("string"),bundle:$n("string")};class Ap extends Tu{data(e={}){return super.data(e)}}class Eu{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new zh(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Ap(this._firestore,this._userDataWriter,i.key,i,new zh(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new De(ve.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map((d=>{const h=new Ap(s._firestore,s._userDataWriter,d.doc.key,d.doc,new zh(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new Ap(s._firestore,s._userDataWriter,d.doc.key,d.doc,new zh(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);let p=-1,T=-1;return d.type!==0&&(p=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),T=l.indexOf(d.doc.key)),{type:wq(d.type),doc:h,oldIndex:p,newIndex:T}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new De(ve.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Eu._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=RT.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),i.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function wq(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ze(61501,{type:n})}}Eu._jsonSchemaVersion="firestore/querySnapshot/1.0",Eu._jsonSchema={type:$n("string",Eu._jsonSchemaVersion),bundleSource:$n("string","QuerySnapshot"),bundleName:$n("string"),bundle:$n("string")};class xE extends xq{constructor(e){super(),this.firestore=e}convertBytes(e){return new lr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gn(this.firestore,null,t)}}function Sq(n){n=Bs(n,zu);const e=Bs(n.firestore,$o),t=mE(e),i=new xE(e);return GM(n._query),aq(t,n._query).then((s=>new Eu(e,i,n,s)))}function Cq(n,e,t){n=Bs(n,Gn);const i=Bs(n.firestore,$o),s=jM(n.converter,e,t);return m_(i,[UM(d_(i),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Oi.none())])}function Np(n,e,t,...i){n=Bs(n,Gn);const s=Bs(n.firestore,$o),o=d_(s);let l;return l=typeof(e=Un(e))=="string"||e instanceof u_?_q(o,"updateDoc",n._key,e,t,i):gq(o,"updateDoc",n._key,e),m_(s,[l.toMutation(n._key,Oi.exists(!0))])}function bq(n){return m_(Bs(n.firestore,$o),[new e_(n._key,Oi.none())])}function Iq(n,e){const t=Bs(n.firestore,$o),i=tf(n),s=jM(n.converter,e);return m_(t,[UM(d_(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,Oi.exists(!1))]).then((()=>i))}function Rh(n,...e){var h,p,T;n=Un(n);let t={includeMetadataChanges:!1,source:"default"},i=0;typeof e[i]!="object"||MA(e[i])||(t=e[i++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(MA(e[i])){const x=e[i];e[i]=(h=x.next)==null?void 0:h.bind(x),e[i+1]=(p=x.error)==null?void 0:p.bind(x),e[i+2]=(T=x.complete)==null?void 0:T.bind(x)}let o,l,d;if(n instanceof Gn)l=Bs(n.firestore,$o),d=Zg(n._key.path),o={next:x=>{e[i]&&e[i](Aq(l,n,x))},error:e[i+1],complete:e[i+2]};else{const x=Bs(n,zu);l=Bs(x.firestore,$o),d=x._query;const C=new xE(l);o={next:A=>{e[i]&&e[i](new Eu(l,C,x,A))},error:e[i+1],complete:e[i+2]},GM(n._query)}return(function(C,A,D,F){const H=new MM(F),X=new SM(A,H,D);return C.asyncQueue.enqueueAndForget((async()=>xM(await R0(C),X))),()=>{H.Nu(),C.asyncQueue.enqueueAndForget((async()=>wM(await R0(C),X)))}})(mE(l),d,s,o)}function m_(n,e){return(function(i,s){const o=new Ho;return i.asyncQueue.enqueueAndForget((async()=>z8(await oq(i),s,o))),o.promise})(mE(n),e)}function Aq(n,e,t){const i=t.docs.get(e._key),s=new xE(n);return new Tu(n,s,e._key,i,new zh(t.hasPendingWrites,t.fromCache),e.converter)}function DA(){return new pE("serverTimestamp")}function LA(...n){return new gE("arrayUnion",n)}(function(e,t=!0){(function(s){Nd=s})(Fu),xu(new ll("firestore",((i,{instanceIdentifier:s,options:o})=>{const l=i.getProvider("app").getImmediate(),d=new $o(new XB(i.getProvider("auth-internal")),new nz(l,i.getProvider("app-check-internal")),(function(p,T){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new De(ve.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bu(p.options.projectId,T)})(l,s),l);return o={useFetchStreams:t,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),ro(hI,fI,e),ro(hI,fI,"esm2020")})();var VA={};const OA="@firebase/database",UA="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let KM="";function Nq(n){KM=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rq{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),yi(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:uf(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ia(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WM=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Rq(e)}}catch{}return new Mq},pu=WM("localStorage"),Pq=WM("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Og("@firebase/database"),kq=(function(){let n=1;return function(){return n++}})(),YM=function(n){const e=FU(n),t=new LU;t.update(e);const i=t.digest();return hT.encodeByteArray(i)},qf=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=qf.apply(null,i):typeof i=="object"?e+=yi(i):e+=i,e+=" "}return e};let nf=null,FA=!0;const Dq=function(n,e){Me(!0,"Can't turn on custom loggers persistently."),Zc.logLevel=bt.VERBOSE,nf=Zc.log.bind(Zc)},ki=function(...n){if(FA===!0&&(FA=!1,nf===null&&Pq.get("logging_enabled")===!0&&Dq()),nf){const e=qf.apply(null,n);nf(e)}},Gf=function(n){return function(...e){ki(n,...e)}},D0=function(...n){const e="FIREBASE INTERNAL ERROR: "+qf(...n);Zc.error(e)},Xo=function(...n){const e=`FIREBASE FATAL ERROR: ${qf(...n)}`;throw Zc.error(e),new Error(e)},qs=function(...n){const e="FIREBASE WARNING: "+qf(...n);Zc.warn(e)},Lq=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&qs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},JM=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Vq=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},vd="[MIN_NAME]",ku="[MAX_NAME]",Ld=function(n,e){if(n===e)return 0;if(n===vd||e===ku)return-1;if(e===vd||n===ku)return 1;{const t=BA(n),i=BA(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Oq=function(n,e){return n===e?0:n<e?-1:1},Mh=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+yi(e))},wE=function(n){if(typeof n!="object"||n===null)return yi(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=yi(e[i]),t+=":",t+=wE(n[e[i]]);return t+="}",t},ZM=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function ys(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const QM=function(n){Me(!JM(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,o,l,d,h;n===0?(o=0,l=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(d=Math.min(Math.floor(Math.log(n)/Math.LN2),i),o=d+i,l=Math.round(n*Math.pow(2,t-d)-Math.pow(2,t))):(o=0,l=Math.round(n/Math.pow(2,1-i-t))));const p=[];for(h=t;h;h-=1)p.push(l%2?1:0),l=Math.floor(l/2);for(h=e;h;h-=1)p.push(o%2?1:0),o=Math.floor(o/2);p.push(s?1:0),p.reverse();const T=p.join("");let x="";for(h=0;h<64;h+=8){let C=parseInt(T.substr(h,8),2).toString(16);C.length===1&&(C="0"+C),x=x+C}return x.toLowerCase()},Uq=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Fq=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Bq(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const zq=new RegExp("^-?(0*)\\d{1,10}$"),qq=-2147483648,Gq=2147483647,BA=function(n){if(zq.test(n)){const e=Number(n);if(e>=qq&&e<=Gq)return e}return null},Hf=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw qs("Exception was thrown by user callback.",t),e},Math.floor(0))}},Hq=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},sf=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ar(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){qs(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kq{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(ki("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',qs(e)}}class Rp{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Rp.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SE="5",$M="v",XM="s",eP="r",tP="f",nP=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,iP="ls",sP="p",L0="ac",rP="websocket",oP="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(e,t,i,s,o=!1,l="",d=!1,h=!1,p=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=o,this.persistenceKey=l,this.includeNamespaceInQueryParams=d,this.isUsingEmulator=h,this.emulatorOptions=p,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=pu.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&pu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Wq(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function lP(n,e,t){Me(typeof e=="string","typeof type must == string"),Me(typeof t=="object","typeof params must == object");let i;if(e===rP)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===oP)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Wq(n)&&(t.ns=n.namespace);const s=[];return ys(t,(o,l)=>{s.push(o+"="+l)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yq{constructor(){this.counters_={}}incrementCounter(e,t=1){ia(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return yU(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av={},Nv={};function CE(n){const e=n.toString();return Av[e]||(Av[e]=new Yq),Av[e]}function Jq(n,e){const t=n.toString();return Nv[t]||(Nv[t]=e()),Nv[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zq{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Hf(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA="start",Qq="close",$q="pLPCommand",Xq="pRTLPCB",uP="id",cP="pw",dP="ser",eG="cb",tG="seg",nG="ts",iG="d",sG="dframe",hP=1870,fP=30,rG=hP-fP,oG=25e3,aG=3e4;class zc{constructor(e,t,i,s,o,l,d){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.transportSessionId=l,this.lastSessionId=d,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Gf(e),this.stats_=CE(t),this.urlFn=h=>(this.appCheckToken&&(h[L0]=this.appCheckToken),lP(t,oP,h))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Zq(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(aG)),Vq(()=>{if(this.isClosed_)return;this.scriptTagHolder=new bE((...o)=>{const[l,d,h,p,T]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,l===zA)this.id=d,this.password=h;else if(l===Qq)d?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(d,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+l)},(...o)=>{const[l,d]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(l,d)},()=>{this.onClosed_()},this.urlFn);const i={};i[zA]="t",i[dP]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[eG]=this.scriptTagHolder.uniqueCallbackIdentifier),i[$M]=SE,this.transportSessionId&&(i[XM]=this.transportSessionId),this.lastSessionId&&(i[iP]=this.lastSessionId),this.applicationId&&(i[sP]=this.applicationId),this.appCheckToken&&(i[L0]=this.appCheckToken),typeof location<"u"&&location.hostname&&nP.test(location.hostname)&&(i[eP]=tP);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){zc.forceAllow_=!0}static forceDisallow(){zc.forceDisallow_=!0}static isAvailable(){return zc.forceAllow_?!0:!zc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Uq()&&!Fq()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=yi(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=bN(t),s=ZM(i,rG);for(let o=0;o<s.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[sG]="t",i[uP]=e,i[cP]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=yi(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class bE{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=kq(),window[$q+this.uniqueCallbackIdentifier]=e,window[Xq+this.uniqueCallbackIdentifier]=t,this.myIFrame=bE.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const l="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(d){ki("frame writing exception"),d.stack&&ki(d.stack),ki(d)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ki("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[uP]=this.myID,e[cP]=this.myPW,e[dP]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+fP+i.length<=hP;){const l=this.pendingSegs.shift();i=i+"&"+tG+s+"="+l.seg+"&"+nG+s+"="+l.ts+"&"+iG+s+"="+l.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(oG)),o=()=>{clearTimeout(s),i()};this.addTag(e,o)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{ki("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lG=16384,uG=45e3;let dg=null;typeof MozWebSocket<"u"?dg=MozWebSocket:typeof WebSocket<"u"&&(dg=WebSocket);class br{constructor(e,t,i,s,o,l,d){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Gf(this.connId),this.stats_=CE(t),this.connURL=br.connectionURL_(t,l,d,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,o){const l={};return l[$M]=SE,typeof location<"u"&&location.hostname&&nP.test(location.hostname)&&(l[eP]=tP),t&&(l[XM]=t),i&&(l[iP]=i),s&&(l[L0]=s),o&&(l[sP]=o),lP(e,rP,l)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,pu.set("previous_websocket_failure",!0);try{let i;AU(),this.mySock=new dg(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){br.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&dg!==null&&!br.forceDisallow_}static previouslyFailed(){return pu.isInMemoryStorage||pu.get("previous_websocket_failure")===!0}markConnectionHealthy(){pu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=uf(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Me(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=yi(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=ZM(t,lG);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(uG))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}br.responsesRequiredToBeHealthy=2;br.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{static get ALL_TRANSPORTS(){return[zc,br]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=br&&br.isAvailable();let i=t&&!br.previouslyFailed();if(e.webSocketOnly&&(t||qs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[br];else{const s=this.transports_=[];for(const o of wf.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);wf.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}wf.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cG=6e4,dG=5e3,hG=10*1024,fG=100*1024,Rv="t",qA="d",mG="s",GA="r",pG="e",HA="o",jA="a",KA="n",WA="p",gG="h";class _G{constructor(e,t,i,s,o,l,d,h,p,T){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=o,this.onMessage_=l,this.onReady_=d,this.onDisconnect_=h,this.onKill_=p,this.lastSessionId=T,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Gf("c:"+this.id+":"),this.transportManager_=new wf(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=sf(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>fG?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hG?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Rv in e){const t=e[Rv];t===jA?this.upgradeIfSecondaryHealthy_():t===GA?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===HA&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Mh("t",e),i=Mh("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:WA,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:jA,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:KA,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Mh("t",e),i=Mh("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Mh(Rv,e);if(qA in e){const i=e[qA];if(t===gG){const s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===KA){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===mG?this.onConnectionShutdown_(i):t===GA?this.onReset_(i):t===pG?D0("Server Error: "+i):t===HA?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):D0("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),SE!==i&&qs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),sf(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(cG))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):sf(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dG))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:WA,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(pu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(e){this.allowedEvents_=e,this.listeners_={},Me(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let o=0;o<s.length;o++)if(s[o].callback===t&&(!i||i===s[o].context)){s.splice(o,1);return}}validateEventType_(e){Me(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg extends pP{static getInstance(){return new hg}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!gT()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Me(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=32,JA=768;class fn{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Wt(){return new fn("")}function It(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function fl(n){return n.pieces_.length-n.pieceNum_}function _n(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new fn(n.pieces_,e)}function gP(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function yG(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function _P(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function yP(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new fn(e,0)}function ni(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof fn)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new fn(t,0)}function At(n){return n.pieceNum_>=n.pieces_.length}function gs(n,e){const t=It(n),i=It(e);if(t===null)return e;if(t===i)return gs(_n(n),_n(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function IE(n,e){if(fl(n)!==fl(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Ar(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(fl(n)>fl(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class vG{constructor(e,t){this.errorPrefix_=t,this.parts_=_P(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Vg(this.parts_[i]);vP(this)}}function TG(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Vg(e),vP(n)}function EG(n){const e=n.parts_.pop();n.byteLength_-=Vg(e),n.parts_.length>0&&(n.byteLength_-=1)}function vP(n){if(n.byteLength_>JA)throw new Error(n.errorPrefix_+"has a key path longer than "+JA+" bytes ("+n.byteLength_+").");if(n.parts_.length>YA)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+YA+") or object contains a cycle "+au(n))}function au(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE extends pP{static getInstance(){return new AE}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return Me(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ph=1e3,xG=300*1e3,ZA=30*1e3,wG=1.3,SG=3e4,CG="server_kill",QA=3;class jo extends mP{constructor(e,t,i,s,o,l,d,h){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=d,this.authOverride_=h,this.id=jo.nextPersistentConnectionId_++,this.log_=Gf("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ph,this.maxReconnectDelay_=xG,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");AE.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&hg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,o={r:s,a:e,b:t};this.log_(yi(o)),Me(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new fT,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:l=>{const d=l.d;l.s==="ok"?t.resolve(d):t.reject(d)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(e,t,i,s){this.initConnection_();const o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Me(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Me(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");const d={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(l).set(o,d),this.connected_&&this.sendListen_(d)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const o={p:i},l="q";e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(l,o,d=>{const h=d.d,p=d.s;jo.warnOnListenWarnings_(h,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",d),p!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(p,h))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ia(e,"w")){const i=ed(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();qs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||DU(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ZA)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=kU(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const o=s.s,l=s.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),Me(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const o={p:e},l="n";s&&(o.q=i,o.t=s),this.sendRequest(l,o)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const o={p:t,d:i};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,l=>{s&&setTimeout(()=>{s(l.s,l.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,o){this.initConnection_();const l={p:t,d:i};o!==void 0&&(l.h=o),this.outstandingPuts_.push({action:e,request:l,onComplete:s}),this.outstandingPutCount_++;const d=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(d):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+yi(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):D0("Unrecognized action received from server: "+yi(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Me(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ph,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ph,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>SG&&(this.reconnectDelay_=Ph),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*wG)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+jo.nextConnectionId_++,o=this.lastSessionId;let l=!1,d=null;const h=function(){d?d.close():(l=!0,i())},p=function(x){Me(d,"sendRequest call when we're not connected not allowed."),d.sendRequest(x)};this.realtime_={close:h,sendRequest:p};const T=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[x,C]=await Promise.all([this.authTokenProvider_.getToken(T),this.appCheckTokenProvider_.getToken(T)]);l?ki("getToken() completed but was canceled"):(ki("getToken() completed. Creating connection."),this.authToken_=x&&x.accessToken,this.appCheckToken_=C&&C.token,d=new _G(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,A=>{qs(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(CG)},o))}catch(x){this.log_("Failed to get token: "+x),l||(this.repoInfo_.nodeAdmin&&qs(x),h())}}}interrupt(e){ki("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ki("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Wv(this.interruptReasons_)&&(this.reconnectDelay_=Ph,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(o=>wE(o)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new fn(e).toString();let s;if(this.listens.has(i)){const o=this.listens.get(i);s=o.get(t),o.delete(t),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){ki("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=QA&&(this.reconnectDelay_=ZA,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ki("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=QA&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+KM.replace(/\./g,"-")]=1,gT()?e["framework.cordova"]=1:LN()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=hg.getInstance().currentlyOnline();return Wv(this.interruptReasons_)&&e}}jo.nextPersistentConnectionId_=0;jo.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Et(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p_{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new Et(vd,e),s=new Et(vd,t);return this.compare(i,s)!==0}minPost(){return Et.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ap;class TP extends p_{static get __EMPTY_NODE(){return ap}static set __EMPTY_NODE(e){ap=e}compare(e,t){return Ld(e.name,t.name)}isDefinedOn(e){throw bd("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Et.MIN}maxPost(){return new Et(ku,ap)}makePost(e,t){return Me(typeof e=="string","KeyIndex indexValue must always be a string."),new Et(e,ap)}toString(){return".key"}}const Qc=new TP;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp{constructor(e,t,i,s,o=null){this.isReverse_=s,this.resultGenerator_=o,this.nodeStack_=[];let l=1;for(;!e.isEmpty();)if(e=e,l=t?i(e.key,t):1,s&&(l*=-1),l<0)this.isReverse_?e=e.left:e=e.right;else if(l===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class _i{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??_i.RED,this.left=s??_s.EMPTY_NODE,this.right=o??_s.EMPTY_NODE}copy(e,t,i,s,o){return new _i(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return _s.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return _s.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,_i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,_i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}_i.RED=!0;_i.BLACK=!1;class bG{copy(e,t,i,s,o){return this}insert(e,t,i){return new _i(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _s{constructor(e,t=_s.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new _s(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,_i.BLACK,null,null))}remove(e){return new _s(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,_i.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new lp(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new lp(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new lp(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new lp(this.root_,null,this.comparator_,!0,e)}}_s.EMPTY_NODE=new bG;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IG(n,e){return Ld(n.name,e.name)}function NE(n,e){return Ld(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let V0;function AG(n){V0=n}const EP=function(n){return typeof n=="number"?"number:"+QM(n):"string:"+n},xP=function(n){if(n.isLeafNode()){const e=n.val();Me(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ia(e,".sv"),"Priority must be a string or number.")}else Me(n===V0||n.isEmpty(),"priority of unexpected type.");Me(n===V0||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $A;class mi{static set __childrenNodeConstructor(e){$A=e}static get __childrenNodeConstructor(){return $A}constructor(e,t=mi.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Me(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),xP(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new mi(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:mi.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return At(e)?this:It(e)===".priority"?this.priorityNode_:mi.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:mi.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=It(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(Me(i!==".priority"||fl(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,mi.__childrenNodeConstructor.EMPTY_NODE.updateChild(_n(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+EP(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=QM(this.value_):e+=this.value_,this.lazyHash_=YM(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===mi.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof mi.__childrenNodeConstructor?-1:(Me(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=mi.VALUE_TYPE_ORDER.indexOf(t),o=mi.VALUE_TYPE_ORDER.indexOf(i);return Me(s>=0,"Unknown leaf type: "+t),Me(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}mi.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wP,SP;function NG(n){wP=n}function RG(n){SP=n}class MG extends p_{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),o=i.compareTo(s);return o===0?Ld(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Et.MIN}maxPost(){return new Et(ku,new mi("[PRIORITY-POST]",SP))}makePost(e,t){const i=wP(e);return new Et(t,new mi("[PRIORITY-POST]",i))}toString(){return".priority"}}const On=new MG;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PG=Math.log(2);class kG{constructor(e){const t=o=>parseInt(Math.log(o)/PG,10),i=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const fg=function(n,e,t,i){n.sort(e);const s=function(h,p){const T=p-h;let x,C;if(T===0)return null;if(T===1)return x=n[h],C=t?t(x):x,new _i(C,x.node,_i.BLACK,null,null);{const A=parseInt(T/2,10)+h,D=s(h,A),F=s(A+1,p);return x=n[A],C=t?t(x):x,new _i(C,x.node,_i.BLACK,D,F)}},o=function(h){let p=null,T=null,x=n.length;const C=function(D,F){const H=x-D,X=x;x-=D;const re=s(H+1,X),Q=n[H],he=t?t(Q):Q;A(new _i(he,Q.node,F,null,re))},A=function(D){p?(p.left=D,p=D):(T=D,p=D)};for(let D=0;D<h.count;++D){const F=h.nextBitIsOne(),H=Math.pow(2,h.count-(D+1));F?C(H,_i.BLACK):(C(H,_i.BLACK),C(H,_i.RED))}return T},l=new kG(n.length),d=o(l);return new _s(i||e,d)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mv;const Dc={};class Go{static get Default(){return Me(Dc&&On,"ChildrenNode.ts has not been loaded"),Mv=Mv||new Go({".priority":Dc},{".priority":On}),Mv}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=ed(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof _s?t:null}hasIndex(e){return ia(this.indexSet_,e.toString())}addIndex(e,t){Me(e!==Qc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const o=t.getIterator(Et.Wrap);let l=o.getNext();for(;l;)s=s||e.isDefinedOn(l.node),i.push(l),l=o.getNext();let d;s?d=fg(i,e.getCompare()):d=Dc;const h=e.toString(),p={...this.indexSet_};p[h]=e;const T={...this.indexes_};return T[h]=d,new Go(T,p)}addToIndexes(e,t){const i=Op(this.indexes_,(s,o)=>{const l=ed(this.indexSet_,o);if(Me(l,"Missing index implementation for "+o),s===Dc)if(l.isDefinedOn(e.node)){const d=[],h=t.getIterator(Et.Wrap);let p=h.getNext();for(;p;)p.name!==e.name&&d.push(p),p=h.getNext();return d.push(e),fg(d,l.getCompare())}else return Dc;else{const d=t.get(e.name);let h=s;return d&&(h=h.remove(new Et(e.name,d))),h.insert(e,e.node)}});return new Go(i,this.indexSet_)}removeFromIndexes(e,t){const i=Op(this.indexes_,s=>{if(s===Dc)return s;{const o=t.get(e.name);return o?s.remove(new Et(e.name,o)):s}});return new Go(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kh;class rt{static get EMPTY_NODE(){return kh||(kh=new rt(new _s(NE),null,Go.Default))}constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&xP(this.priorityNode_),this.children_.isEmpty()&&Me(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||kh}updatePriority(e){return this.children_.isEmpty()?this:new rt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?kh:t}}getChild(e){const t=It(e);return t===null?this:this.getImmediateChild(t).getChild(_n(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Me(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new Et(e,t);let s,o;t.isEmpty()?(s=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(i,this.children_));const l=s.isEmpty()?kh:this.priorityNode_;return new rt(s,l,o)}}updateChild(e,t){const i=It(e);if(i===null)return t;{Me(It(e)!==".priority"||fl(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(_n(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,o=!0;if(this.forEachChild(On,(l,d)=>{t[l]=d.val(e),i++,o&&rt.INTEGER_REGEXP_.test(l)?s=Math.max(s,Number(l)):o=!1}),!e&&o&&s<2*i){const l=[];for(const d in t)l[d]=t[d];return l}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+EP(this.getPriority().val())+":"),this.forEachChild(On,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":YM(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const o=s.getPredecessorKey(new Et(e,t));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Et(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Et(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Et.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Et.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,e)>0;)s.getNext(),o=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===jf?-1:0}withIndex(e){if(e===Qc||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new rt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Qc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(On),s=t.getIterator(On);let o=i.getNext(),l=s.getNext();for(;o&&l;){if(o.name!==l.name||!o.node.equals(l.node))return!1;o=i.getNext(),l=s.getNext()}return o===null&&l===null}else return!1;else return!1}}resolveIndex_(e){return e===Qc?null:this.indexMap_.get(e.toString())}}rt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class DG extends rt{constructor(){super(new _s(NE),rt.EMPTY_NODE,Go.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return rt.EMPTY_NODE}isEmpty(){return!1}}const jf=new DG;Object.defineProperties(Et,{MIN:{value:new Et(vd,rt.EMPTY_NODE)},MAX:{value:new Et(ku,jf)}});TP.__EMPTY_NODE=rt.EMPTY_NODE;mi.__childrenNodeConstructor=rt;AG(jf);RG(jf);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LG=!0;function Di(n,e=null){if(n===null)return rt.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Me(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new mi(t,Di(e))}if(!(n instanceof Array)&&LG){const t=[];let i=!1;if(ys(n,(l,d)=>{if(l.substring(0,1)!=="."){const h=Di(d);h.isEmpty()||(i=i||!h.getPriority().isEmpty(),t.push(new Et(l,h)))}}),t.length===0)return rt.EMPTY_NODE;const o=fg(t,IG,l=>l.name,NE);if(i){const l=fg(t,On.getCompare());return new rt(o,Di(e),new Go({".priority":l},{".priority":On}))}else return new rt(o,Di(e),Go.Default)}else{let t=rt.EMPTY_NODE;return ys(n,(i,s)=>{if(ia(n,i)&&i.substring(0,1)!=="."){const o=Di(s);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(i,o))}}),t.updatePriority(Di(e))}}NG(Di);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VG extends p_{constructor(e){super(),this.indexPath_=e,Me(!At(e)&&It(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),o=i.compareTo(s);return o===0?Ld(e.name,t.name):o}makePost(e,t){const i=Di(e),s=rt.EMPTY_NODE.updateChild(this.indexPath_,i);return new Et(t,s)}maxPost(){const e=rt.EMPTY_NODE.updateChild(this.indexPath_,jf);return new Et(ku,e)}toString(){return _P(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OG extends p_{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Ld(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Et.MIN}maxPost(){return Et.MAX}makePost(e,t){const i=Di(e);return new Et(t,i)}toString(){return".value"}}const UG=new OG;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(n){return{type:"value",snapshotNode:n}}function Td(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Sf(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Cf(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function FG(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e){this.index_=e}updateChild(e,t,i,s,o,l){Me(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const d=e.getImmediateChild(t);return d.getChild(s).equals(i.getChild(s))&&d.isEmpty()===i.isEmpty()||(l!=null&&(i.isEmpty()?e.hasChild(t)?l.trackChildChange(Sf(t,d)):Me(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):d.isEmpty()?l.trackChildChange(Td(t,i)):l.trackChildChange(Cf(t,i,d))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(On,(s,o)=>{t.hasChild(s)||i.trackChildChange(Sf(s,o))}),t.isLeafNode()||t.forEachChild(On,(s,o)=>{if(e.hasChild(s)){const l=e.getImmediateChild(s);l.equals(o)||i.trackChildChange(Cf(s,o,l))}else i.trackChildChange(Td(s,o))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?rt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e){this.indexedFilter_=new RE(e.getIndex()),this.index_=e.getIndex(),this.startPost_=bf.getStartPost_(e),this.endPost_=bf.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,o,l){return this.matches(new Et(t,i))||(i=rt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,o,l)}updateFullNode(e,t,i){t.isLeafNode()&&(t=rt.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(rt.EMPTY_NODE);const o=this;return t.forEachChild(On,(l,d)=>{o.matches(new Et(l,d))||(s=s.updateImmediateChild(l,rt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BG{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new bf(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,o,l){return this.rangedFilter_.matches(new Et(t,i))||(i=rt.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,o,l):this.fullLimitUpdateChild_(e,t,i,o,l)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=rt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=rt.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let l=0;for(;o.hasNext()&&l<this.limit_;){const d=o.getNext();if(this.withinDirectionalStart(d))if(this.withinDirectionalEnd(d))s=s.updateImmediateChild(d.name,d.node),l++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(rt.EMPTY_NODE);let o;this.reverse_?o=s.getReverseIterator(this.index_):o=s.getIterator(this.index_);let l=0;for(;o.hasNext();){const d=o.getNext();l<this.limit_&&this.withinDirectionalStart(d)&&this.withinDirectionalEnd(d)?l++:s=s.updateImmediateChild(d.name,rt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,o){let l;if(this.reverse_){const x=this.index_.getCompare();l=(C,A)=>x(A,C)}else l=this.index_.getCompare();const d=e;Me(d.numChildren()===this.limit_,"");const h=new Et(t,i),p=this.reverse_?d.getFirstChild(this.index_):d.getLastChild(this.index_),T=this.rangedFilter_.matches(h);if(d.hasChild(t)){const x=d.getImmediateChild(t);let C=s.getChildAfterChild(this.index_,p,this.reverse_);for(;C!=null&&(C.name===t||d.hasChild(C.name));)C=s.getChildAfterChild(this.index_,C,this.reverse_);const A=C==null?1:l(C,h);if(T&&!i.isEmpty()&&A>=0)return o!=null&&o.trackChildChange(Cf(t,i,x)),d.updateImmediateChild(t,i);{o!=null&&o.trackChildChange(Sf(t,x));const F=d.updateImmediateChild(t,rt.EMPTY_NODE);return C!=null&&this.rangedFilter_.matches(C)?(o!=null&&o.trackChildChange(Td(C.name,C.node)),F.updateImmediateChild(C.name,C.node)):F}}else return i.isEmpty()?e:T&&l(p,h)>=0?(o!=null&&(o.trackChildChange(Sf(p.name,p.node)),o.trackChildChange(Td(t,i))),d.updateImmediateChild(t,i).updateImmediateChild(p.name,rt.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=On}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Me(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Me(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:vd}hasEnd(){return this.endSet_}getIndexEndValue(){return Me(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Me(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ku}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Me(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===On}copy(){const e=new ME;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zG(n){return n.loadsAllData()?new RE(n.getIndex()):n.hasLimit()?new BG(n):new bf(n)}function XA(n){const e={};if(n.isDefault())return e;let t;if(n.index_===On?t="$priority":n.index_===UG?t="$value":n.index_===Qc?t="$key":(Me(n.index_ instanceof VG,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=yi(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=yi(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+yi(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=yi(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+yi(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function e1(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==On&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg extends mP{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Me(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Gf("p:rest:"),this.listens_={}}listen(e,t,i,s){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const l=mg.getListenId_(e,i),d={};this.listens_[l]=d;const h=XA(e._queryParams);this.restRequest_(o+".json",h,(p,T)=>{let x=T;if(p===404&&(x=null,p=null),p===null&&this.onDataUpdate_(o,x,!1,i),ed(this.listens_,l)===d){let C;p?p===401?C="permission_denied":C="rest_error:"+p:C="ok",s(C,null)}})}unlisten(e,t){const i=mg.getListenId_(e,t);delete this.listens_[i]}get(e){const t=XA(e._queryParams),i=e._path.toString(),s=new fT;return this.restRequest_(i+".json",t,(o,l)=>{let d=l;o===404&&(d=null,o=null),o===null?(this.onDataUpdate_(i,d,!1,null),s.resolve(d)):s.reject(new Error(d))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,o])=>{s&&s.accessToken&&(t.auth=s.accessToken),o&&o.token&&(t.ac=o.token);const l=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Id(t);this.log_("Sending REST request for "+l);const d=new XMLHttpRequest;d.onreadystatechange=()=>{if(i&&d.readyState===4){this.log_("REST Response for "+l+" received. status:",d.status,"response:",d.responseText);let h=null;if(d.status>=200&&d.status<300){try{h=uf(d.responseText)}catch{qs("Failed to parse JSON response for "+l+": "+d.responseText)}i(null,h)}else d.status!==401&&d.status!==404&&qs("Got unsuccessful REST response for "+l+" Status: "+d.status),i(d.status);i=null}},d.open("GET",l,!0),d.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qG{constructor(){this.rootNode_=rt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(){return{value:null,children:new Map}}function bP(n,e,t){if(At(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=It(e);n.children.has(i)||n.children.set(i,pg());const s=n.children.get(i);e=_n(e),bP(s,e,t)}}function O0(n,e,t){n.value!==null?t(e,n.value):GG(n,(i,s)=>{const o=new fn(e.toString()+"/"+i);O0(s,o,t)})}function GG(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HG{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&ys(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=10*1e3,jG=30*1e3,KG=300*1e3;class WG{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new HG(e);const i=t1+(jG-t1)*Math.random();sf(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;ys(e,(s,o)=>{o>0&&ia(this.statsToReport_,s)&&(t[s]=o,i=!0)}),i&&this.server_.reportStats(t),sf(this.reportStats_.bind(this),Math.floor(Math.random()*2*KG))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nr;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Nr||(Nr={}));function IP(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function PE(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function kE(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Nr.ACK_USER_WRITE,this.source=IP()}operationForChild(e){if(At(this.path)){if(this.affectedTree.value!=null)return Me(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new fn(e));return new gg(Wt(),t,this.revert)}}else return Me(It(this.path)===e,"operationForChild called for unrelated child."),new gg(_n(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e,t){this.source=e,this.path=t,this.type=Nr.LISTEN_COMPLETE}operationForChild(e){return At(this.path)?new If(this.source,Wt()):new If(this.source,_n(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Nr.OVERWRITE}operationForChild(e){return At(this.path)?new Du(this.source,Wt(),this.snap.getImmediateChild(e)):new Du(this.source,_n(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Nr.MERGE}operationForChild(e){if(At(this.path)){const t=this.children.subtree(new fn(e));return t.isEmpty()?null:t.value?new Du(this.source,Wt(),t.value):new Af(this.source,Wt(),t)}else return Me(It(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Af(this.source,_n(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(At(e))return this.isFullyInitialized()&&!this.filtered_;const t=It(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YG{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function JG(n,e,t,i){const s=[],o=[];return e.forEach(l=>{l.type==="child_changed"&&n.index_.indexedValueChanged(l.oldSnap,l.snapshotNode)&&o.push(FG(l.childName,l.snapshotNode))}),Dh(n,s,"child_removed",e,i,t),Dh(n,s,"child_added",e,i,t),Dh(n,s,"child_moved",o,i,t),Dh(n,s,"child_changed",e,i,t),Dh(n,s,"value",e,i,t),s}function Dh(n,e,t,i,s,o){const l=i.filter(d=>d.type===t);l.sort((d,h)=>QG(n,d,h)),l.forEach(d=>{const h=ZG(n,d,o);s.forEach(p=>{p.respondsTo(d.type)&&e.push(p.createEvent(h,n.query_))})})}function ZG(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function QG(n,e,t){if(e.childName==null||t.childName==null)throw bd("Should only compare child_ events.");const i=new Et(e.childName,e.snapshotNode),s=new Et(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g_(n,e){return{eventCache:n,serverCache:e}}function rf(n,e,t,i){return g_(new Lu(e,t,i),n.serverCache)}function AP(n,e,t,i){return g_(n.eventCache,new Lu(e,t,i))}function U0(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Vu(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pv;const $G=()=>(Pv||(Pv=new _s(Oq)),Pv);class wn{static fromObject(e){let t=new wn(null);return ys(e,(i,s)=>{t=t.set(new fn(i),s)}),t}constructor(e,t=$G()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Wt(),value:this.value};if(At(e))return null;{const i=It(e),s=this.children.get(i);if(s!==null){const o=s.findRootMostMatchingPathAndValue(_n(e),t);return o!=null?{path:ni(new fn(i),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(At(e))return this;{const t=It(e),i=this.children.get(t);return i!==null?i.subtree(_n(e)):new wn(null)}}set(e,t){if(At(e))return new wn(t,this.children);{const i=It(e),o=(this.children.get(i)||new wn(null)).set(_n(e),t),l=this.children.insert(i,o);return new wn(this.value,l)}}remove(e){if(At(e))return this.children.isEmpty()?new wn(null):new wn(null,this.children);{const t=It(e),i=this.children.get(t);if(i){const s=i.remove(_n(e));let o;return s.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,s),this.value===null&&o.isEmpty()?new wn(null):new wn(this.value,o)}else return this}}get(e){if(At(e))return this.value;{const t=It(e),i=this.children.get(t);return i?i.get(_n(e)):null}}setTree(e,t){if(At(e))return t;{const i=It(e),o=(this.children.get(i)||new wn(null)).setTree(_n(e),t);let l;return o.isEmpty()?l=this.children.remove(i):l=this.children.insert(i,o),new wn(this.value,l)}}fold(e){return this.fold_(Wt(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,o)=>{i[s]=o.fold_(ni(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Wt(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(At(e))return null;{const o=It(e),l=this.children.get(o);return l?l.findOnPath_(_n(e),ni(t,o),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Wt(),t)}foreachOnPath_(e,t,i){if(At(e))return this;{this.value&&i(t,this.value);const s=It(e),o=this.children.get(s);return o?o.foreachOnPath_(_n(e),ni(t,s),i):new wn(null)}}foreach(e){this.foreach_(Wt(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(ni(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr{constructor(e){this.writeTree_=e}static empty(){return new Mr(new wn(null))}}function of(n,e,t){if(At(e))return new Mr(new wn(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let o=i.value;const l=gs(s,e);return o=o.updateChild(l,t),new Mr(n.writeTree_.set(s,o))}else{const s=new wn(t),o=n.writeTree_.setTree(e,s);return new Mr(o)}}}function n1(n,e,t){let i=n;return ys(t,(s,o)=>{i=of(i,ni(e,s),o)}),i}function i1(n,e){if(At(e))return Mr.empty();{const t=n.writeTree_.setTree(e,new wn(null));return new Mr(t)}}function F0(n,e){return qu(n,e)!=null}function qu(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(gs(t.path,e)):null}function s1(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(On,(i,s)=>{e.push(new Et(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new Et(i,s.value))}),e}function ol(n,e){if(At(e))return n;{const t=qu(n,e);return t!=null?new Mr(new wn(t)):new Mr(n.writeTree_.subtree(e))}}function B0(n){return n.writeTree_.isEmpty()}function Ed(n,e){return NP(Wt(),n.writeTree_,e)}function NP(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,o)=>{s===".priority"?(Me(o.value!==null,"Priority writes must always be leaf nodes"),i=o.value):t=NP(ni(n,s),o,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ni(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DE(n,e){return kP(e,n)}function XG(n,e,t,i,s){Me(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=of(n.visibleWrites,e,t)),n.lastWriteId=i}function eH(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function tH(n,e){const t=n.allWrites.findIndex(d=>d.writeId===e);Me(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,o=!1,l=n.allWrites.length-1;for(;s&&l>=0;){const d=n.allWrites[l];d.visible&&(l>=t&&nH(d,i.path)?s=!1:Ar(i.path,d.path)&&(o=!0)),l--}if(s){if(o)return iH(n),!0;if(i.snap)n.visibleWrites=i1(n.visibleWrites,i.path);else{const d=i.children;ys(d,h=>{n.visibleWrites=i1(n.visibleWrites,ni(i.path,h))})}return!0}else return!1}function nH(n,e){if(n.snap)return Ar(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ar(ni(n.path,t),e))return!0;return!1}function iH(n){n.visibleWrites=RP(n.allWrites,sH,Wt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function sH(n){return n.visible}function RP(n,e,t){let i=Mr.empty();for(let s=0;s<n.length;++s){const o=n[s];if(e(o)){const l=o.path;let d;if(o.snap)Ar(t,l)?(d=gs(t,l),i=of(i,d,o.snap)):Ar(l,t)&&(d=gs(l,t),i=of(i,Wt(),o.snap.getChild(d)));else if(o.children){if(Ar(t,l))d=gs(t,l),i=n1(i,d,o.children);else if(Ar(l,t))if(d=gs(l,t),At(d))i=n1(i,Wt(),o.children);else{const h=ed(o.children,It(d));if(h){const p=h.getChild(_n(d));i=of(i,Wt(),p)}}}else throw bd("WriteRecord should have .snap or .children")}}return i}function MP(n,e,t,i,s){if(!i&&!s){const o=qu(n.visibleWrites,e);if(o!=null)return o;{const l=ol(n.visibleWrites,e);if(B0(l))return t;if(t==null&&!F0(l,Wt()))return null;{const d=t||rt.EMPTY_NODE;return Ed(l,d)}}}else{const o=ol(n.visibleWrites,e);if(!s&&B0(o))return t;if(!s&&t==null&&!F0(o,Wt()))return null;{const l=function(p){return(p.visible||s)&&(!i||!~i.indexOf(p.writeId))&&(Ar(p.path,e)||Ar(e,p.path))},d=RP(n.allWrites,l,e),h=t||rt.EMPTY_NODE;return Ed(d,h)}}}function rH(n,e,t){let i=rt.EMPTY_NODE;const s=qu(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(On,(o,l)=>{i=i.updateImmediateChild(o,l)}),i;if(t){const o=ol(n.visibleWrites,e);return t.forEachChild(On,(l,d)=>{const h=Ed(ol(o,new fn(l)),d);i=i.updateImmediateChild(l,h)}),s1(o).forEach(l=>{i=i.updateImmediateChild(l.name,l.node)}),i}else{const o=ol(n.visibleWrites,e);return s1(o).forEach(l=>{i=i.updateImmediateChild(l.name,l.node)}),i}}function oH(n,e,t,i,s){Me(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=ni(e,t);if(F0(n.visibleWrites,o))return null;{const l=ol(n.visibleWrites,o);return B0(l)?s.getChild(t):Ed(l,s.getChild(t))}}function aH(n,e,t,i){const s=ni(e,t),o=qu(n.visibleWrites,s);if(o!=null)return o;if(i.isCompleteForChild(t)){const l=ol(n.visibleWrites,s);return Ed(l,i.getNode().getImmediateChild(t))}else return null}function lH(n,e){return qu(n.visibleWrites,e)}function uH(n,e,t,i,s,o,l){let d;const h=ol(n.visibleWrites,e),p=qu(h,Wt());if(p!=null)d=p;else if(t!=null)d=Ed(h,t);else return[];if(d=d.withIndex(l),!d.isEmpty()&&!d.isLeafNode()){const T=[],x=l.getCompare(),C=o?d.getReverseIteratorFrom(i,l):d.getIteratorFrom(i,l);let A=C.getNext();for(;A&&T.length<s;)x(A,i)!==0&&T.push(A),A=C.getNext();return T}else return[]}function cH(){return{visibleWrites:Mr.empty(),allWrites:[],lastWriteId:-1}}function _g(n,e,t,i){return MP(n.writeTree,n.treePath,e,t,i)}function LE(n,e){return rH(n.writeTree,n.treePath,e)}function r1(n,e,t,i){return oH(n.writeTree,n.treePath,e,t,i)}function yg(n,e){return lH(n.writeTree,ni(n.treePath,e))}function dH(n,e,t,i,s,o){return uH(n.writeTree,n.treePath,e,t,i,s,o)}function VE(n,e,t){return aH(n.writeTree,n.treePath,e,t)}function PP(n,e){return kP(ni(n.treePath,e),n.writeTree)}function kP(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hH{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;Me(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Me(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const o=s.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(i,Cf(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(i,Sf(i,s.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(i,Td(i,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(i,Cf(i,e.snapshotNode,s.oldSnap));else throw bd("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fH{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const DP=new fH;class OE{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Lu(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return VE(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Vu(this.viewCache_),o=dH(this.writes_,s,t,1,i,e);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mH(n){return{filter:n}}function pH(n,e){Me(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Me(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function gH(n,e,t,i,s){const o=new hH;let l,d;if(t.type===Nr.OVERWRITE){const p=t;p.source.fromUser?l=z0(n,e,p.path,p.snap,i,s,o):(Me(p.source.fromServer,"Unknown source."),d=p.source.tagged||e.serverCache.isFiltered()&&!At(p.path),l=vg(n,e,p.path,p.snap,i,s,d,o))}else if(t.type===Nr.MERGE){const p=t;p.source.fromUser?l=yH(n,e,p.path,p.children,i,s,o):(Me(p.source.fromServer,"Unknown source."),d=p.source.tagged||e.serverCache.isFiltered(),l=q0(n,e,p.path,p.children,i,s,d,o))}else if(t.type===Nr.ACK_USER_WRITE){const p=t;p.revert?l=EH(n,e,p.path,i,s,o):l=vH(n,e,p.path,p.affectedTree,i,s,o)}else if(t.type===Nr.LISTEN_COMPLETE)l=TH(n,e,t.path,i,o);else throw bd("Unknown operation type: "+t.type);const h=o.getChanges();return _H(e,l,h),{viewCache:l,changes:h}}function _H(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=U0(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&t.push(CP(U0(e)))}}function LP(n,e,t,i,s,o){const l=e.eventCache;if(yg(i,t)!=null)return e;{let d,h;if(At(t))if(Me(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const p=Vu(e),T=p instanceof rt?p:rt.EMPTY_NODE,x=LE(i,T);d=n.filter.updateFullNode(e.eventCache.getNode(),x,o)}else{const p=_g(i,Vu(e));d=n.filter.updateFullNode(e.eventCache.getNode(),p,o)}else{const p=It(t);if(p===".priority"){Me(fl(t)===1,"Can't have a priority with additional path components");const T=l.getNode();h=e.serverCache.getNode();const x=r1(i,t,T,h);x!=null?d=n.filter.updatePriority(T,x):d=l.getNode()}else{const T=_n(t);let x;if(l.isCompleteForChild(p)){h=e.serverCache.getNode();const C=r1(i,t,l.getNode(),h);C!=null?x=l.getNode().getImmediateChild(p).updateChild(T,C):x=l.getNode().getImmediateChild(p)}else x=VE(i,p,e.serverCache);x!=null?d=n.filter.updateChild(l.getNode(),p,x,T,s,o):d=l.getNode()}}return rf(e,d,l.isFullyInitialized()||At(t),n.filter.filtersNodes())}}function vg(n,e,t,i,s,o,l,d){const h=e.serverCache;let p;const T=l?n.filter:n.filter.getIndexedFilter();if(At(t))p=T.updateFullNode(h.getNode(),i,null);else if(T.filtersNodes()&&!h.isFiltered()){const A=h.getNode().updateChild(t,i);p=T.updateFullNode(h.getNode(),A,null)}else{const A=It(t);if(!h.isCompleteForPath(t)&&fl(t)>1)return e;const D=_n(t),H=h.getNode().getImmediateChild(A).updateChild(D,i);A===".priority"?p=T.updatePriority(h.getNode(),H):p=T.updateChild(h.getNode(),A,H,D,DP,null)}const x=AP(e,p,h.isFullyInitialized()||At(t),T.filtersNodes()),C=new OE(s,x,o);return LP(n,x,t,s,C,d)}function z0(n,e,t,i,s,o,l){const d=e.eventCache;let h,p;const T=new OE(s,e,o);if(At(t))p=n.filter.updateFullNode(e.eventCache.getNode(),i,l),h=rf(e,p,!0,n.filter.filtersNodes());else{const x=It(t);if(x===".priority")p=n.filter.updatePriority(e.eventCache.getNode(),i),h=rf(e,p,d.isFullyInitialized(),d.isFiltered());else{const C=_n(t),A=d.getNode().getImmediateChild(x);let D;if(At(C))D=i;else{const F=T.getCompleteChild(x);F!=null?gP(C)===".priority"&&F.getChild(yP(C)).isEmpty()?D=F:D=F.updateChild(C,i):D=rt.EMPTY_NODE}if(A.equals(D))h=e;else{const F=n.filter.updateChild(d.getNode(),x,D,C,T,l);h=rf(e,F,d.isFullyInitialized(),n.filter.filtersNodes())}}}return h}function o1(n,e){return n.eventCache.isCompleteForChild(e)}function yH(n,e,t,i,s,o,l){let d=e;return i.foreach((h,p)=>{const T=ni(t,h);o1(e,It(T))&&(d=z0(n,d,T,p,s,o,l))}),i.foreach((h,p)=>{const T=ni(t,h);o1(e,It(T))||(d=z0(n,d,T,p,s,o,l))}),d}function a1(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function q0(n,e,t,i,s,o,l,d){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h=e,p;At(t)?p=i:p=new wn(null).setTree(t,i);const T=e.serverCache.getNode();return p.children.inorderTraversal((x,C)=>{if(T.hasChild(x)){const A=e.serverCache.getNode().getImmediateChild(x),D=a1(n,A,C);h=vg(n,h,new fn(x),D,s,o,l,d)}}),p.children.inorderTraversal((x,C)=>{const A=!e.serverCache.isCompleteForChild(x)&&C.value===null;if(!T.hasChild(x)&&!A){const D=e.serverCache.getNode().getImmediateChild(x),F=a1(n,D,C);h=vg(n,h,new fn(x),F,s,o,l,d)}}),h}function vH(n,e,t,i,s,o,l){if(yg(s,t)!=null)return e;const d=e.serverCache.isFiltered(),h=e.serverCache;if(i.value!=null){if(At(t)&&h.isFullyInitialized()||h.isCompleteForPath(t))return vg(n,e,t,h.getNode().getChild(t),s,o,d,l);if(At(t)){let p=new wn(null);return h.getNode().forEachChild(Qc,(T,x)=>{p=p.set(new fn(T),x)}),q0(n,e,t,p,s,o,d,l)}else return e}else{let p=new wn(null);return i.foreach((T,x)=>{const C=ni(t,T);h.isCompleteForPath(C)&&(p=p.set(T,h.getNode().getChild(C)))}),q0(n,e,t,p,s,o,d,l)}}function TH(n,e,t,i,s){const o=e.serverCache,l=AP(e,o.getNode(),o.isFullyInitialized()||At(t),o.isFiltered());return LP(n,l,t,i,DP,s)}function EH(n,e,t,i,s,o){let l;if(yg(i,t)!=null)return e;{const d=new OE(i,e,s),h=e.eventCache.getNode();let p;if(At(t)||It(t)===".priority"){let T;if(e.serverCache.isFullyInitialized())T=_g(i,Vu(e));else{const x=e.serverCache.getNode();Me(x instanceof rt,"serverChildren would be complete if leaf node"),T=LE(i,x)}T=T,p=n.filter.updateFullNode(h,T,o)}else{const T=It(t);let x=VE(i,T,e.serverCache);x==null&&e.serverCache.isCompleteForChild(T)&&(x=h.getImmediateChild(T)),x!=null?p=n.filter.updateChild(h,T,x,_n(t),d,o):e.eventCache.getNode().hasChild(T)?p=n.filter.updateChild(h,T,rt.EMPTY_NODE,_n(t),d,o):p=h,p.isEmpty()&&e.serverCache.isFullyInitialized()&&(l=_g(i,Vu(e)),l.isLeafNode()&&(p=n.filter.updateFullNode(p,l,o)))}return l=e.serverCache.isFullyInitialized()||yg(i,Wt())!=null,rf(e,p,l,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xH{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new RE(i.getIndex()),o=zG(i);this.processor_=mH(o);const l=t.serverCache,d=t.eventCache,h=s.updateFullNode(rt.EMPTY_NODE,l.getNode(),null),p=o.updateFullNode(rt.EMPTY_NODE,d.getNode(),null),T=new Lu(h,l.isFullyInitialized(),s.filtersNodes()),x=new Lu(p,d.isFullyInitialized(),o.filtersNodes());this.viewCache_=g_(x,T),this.eventGenerator_=new YG(this.query_)}get query(){return this.query_}}function wH(n){return n.viewCache_.serverCache.getNode()}function SH(n,e){const t=Vu(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!At(e)&&!t.getImmediateChild(It(e)).isEmpty())?t.getChild(e):null}function l1(n){return n.eventRegistrations_.length===0}function CH(n,e){n.eventRegistrations_.push(e)}function u1(n,e,t){const i=[];if(t){Me(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(o=>{const l=o.createCancelEvent(t,s);l&&i.push(l)})}if(e){let s=[];for(let o=0;o<n.eventRegistrations_.length;++o){const l=n.eventRegistrations_[o];if(!l.matches(e))s.push(l);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(o+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function c1(n,e,t,i){e.type===Nr.MERGE&&e.source.queryId!==null&&(Me(Vu(n.viewCache_),"We should always have a full cache before handling merges"),Me(U0(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,o=gH(n.processor_,s,e,t,i);return pH(n.processor_,o.viewCache),Me(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=o.viewCache,VP(n,o.changes,o.viewCache.eventCache.getNode(),null)}function bH(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(On,(o,l)=>{i.push(Td(o,l))}),t.isFullyInitialized()&&i.push(CP(t.getNode())),VP(n,i,t.getNode(),e)}function VP(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return JG(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tg;class IH{constructor(){this.views=new Map}}function AH(n){Me(!Tg,"__referenceConstructor has already been defined"),Tg=n}function NH(){return Me(Tg,"Reference.ts has not been loaded"),Tg}function RH(n){return n.views.size===0}function UE(n,e,t,i){const s=e.source.queryId;if(s!==null){const o=n.views.get(s);return Me(o!=null,"SyncTree gave us an op for an invalid query."),c1(o,e,t,i)}else{let o=[];for(const l of n.views.values())o=o.concat(c1(l,e,t,i));return o}}function MH(n,e,t,i,s){const o=e._queryIdentifier,l=n.views.get(o);if(!l){let d=_g(t,s?i:null),h=!1;d?h=!0:i instanceof rt?(d=LE(t,i),h=!1):(d=rt.EMPTY_NODE,h=!1);const p=g_(new Lu(d,h,!1),new Lu(i,s,!1));return new xH(e,p)}return l}function PH(n,e,t,i,s,o){const l=MH(n,e,i,s,o);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,l),CH(l,t),bH(l,t)}function kH(n,e,t,i){const s=e._queryIdentifier,o=[];let l=[];const d=ml(n);if(s==="default")for(const[h,p]of n.views.entries())l=l.concat(u1(p,t,i)),l1(p)&&(n.views.delete(h),p.query._queryParams.loadsAllData()||o.push(p.query));else{const h=n.views.get(s);h&&(l=l.concat(u1(h,t,i)),l1(h)&&(n.views.delete(s),h.query._queryParams.loadsAllData()||o.push(h.query)))}return d&&!ml(n)&&o.push(new(NH())(e._repo,e._path)),{removed:o,events:l}}function OP(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function $c(n,e){let t=null;for(const i of n.views.values())t=t||SH(i,e);return t}function UP(n,e){if(e._queryParams.loadsAllData())return __(n);{const i=e._queryIdentifier;return n.views.get(i)}}function FP(n,e){return UP(n,e)!=null}function ml(n){return __(n)!=null}function __(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eg;function DH(n){Me(!Eg,"__referenceConstructor has already been defined"),Eg=n}function LH(){return Me(Eg,"Reference.ts has not been loaded"),Eg}let VH=1;class d1{constructor(e){this.listenProvider_=e,this.syncPointTree_=new wn(null),this.pendingWriteTree_=cH(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function OH(n,e,t,i,s){return XG(n.pendingWriteTree_,e,t,i,s),s?Kf(n,new Du(IP(),e,t)):[]}function qc(n,e,t=!1){const i=eH(n.pendingWriteTree_,e);if(tH(n.pendingWriteTree_,e)){let o=new wn(null);return i.snap!=null?o=o.set(Wt(),!0):ys(i.children,l=>{o=o.set(new fn(l),!0)}),Kf(n,new gg(i.path,o,t))}else return[]}function y_(n,e,t){return Kf(n,new Du(PE(),e,t))}function UH(n,e,t){const i=wn.fromObject(t);return Kf(n,new Af(PE(),e,i))}function FH(n,e){return Kf(n,new If(PE(),e))}function BH(n,e,t){const i=FE(n,t);if(i){const s=BE(i),o=s.path,l=s.queryId,d=gs(o,e),h=new If(kE(l),d);return zE(n,o,h)}else return[]}function G0(n,e,t,i,s=!1){const o=e._path,l=n.syncPointTree_.get(o);let d=[];if(l&&(e._queryIdentifier==="default"||FP(l,e))){const h=kH(l,e,t,i);RH(l)&&(n.syncPointTree_=n.syncPointTree_.remove(o));const p=h.removed;if(d=h.events,!s){const T=p.findIndex(C=>C._queryParams.loadsAllData())!==-1,x=n.syncPointTree_.findOnPath(o,(C,A)=>ml(A));if(T&&!x){const C=n.syncPointTree_.subtree(o);if(!C.isEmpty()){const A=GH(C);for(let D=0;D<A.length;++D){const F=A[D],H=F.query,X=GP(n,F);n.listenProvider_.startListening(af(H),xg(n,H),X.hashFn,X.onComplete)}}}!x&&p.length>0&&!i&&(T?n.listenProvider_.stopListening(af(e),null):p.forEach(C=>{const A=n.queryToTagMap.get(v_(C));n.listenProvider_.stopListening(af(C),A)}))}HH(n,p)}return d}function zH(n,e,t,i){const s=FE(n,i);if(s!=null){const o=BE(s),l=o.path,d=o.queryId,h=gs(l,e),p=new Du(kE(d),h,t);return zE(n,l,p)}else return[]}function qH(n,e,t,i){const s=FE(n,i);if(s){const o=BE(s),l=o.path,d=o.queryId,h=gs(l,e),p=wn.fromObject(t),T=new Af(kE(d),h,p);return zE(n,l,T)}else return[]}function h1(n,e,t,i=!1){const s=e._path;let o=null,l=!1;n.syncPointTree_.foreachOnPath(s,(C,A)=>{const D=gs(C,s);o=o||$c(A,D),l=l||ml(A)});let d=n.syncPointTree_.get(s);d?(l=l||ml(d),o=o||$c(d,Wt())):(d=new IH,n.syncPointTree_=n.syncPointTree_.set(s,d));let h;o!=null?h=!0:(h=!1,o=rt.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((A,D)=>{const F=$c(D,Wt());F&&(o=o.updateImmediateChild(A,F))}));const p=FP(d,e);if(!p&&!e._queryParams.loadsAllData()){const C=v_(e);Me(!n.queryToTagMap.has(C),"View does not exist, but we have a tag");const A=jH();n.queryToTagMap.set(C,A),n.tagToQueryMap.set(A,C)}const T=DE(n.pendingWriteTree_,s);let x=PH(d,e,t,T,o,h);if(!p&&!l&&!i){const C=UP(d,e);x=x.concat(KH(n,e,C))}return x}function BP(n,e,t){const s=n.pendingWriteTree_,o=n.syncPointTree_.findOnPath(e,(l,d)=>{const h=gs(l,e),p=$c(d,h);if(p)return p});return MP(s,e,o,t,!0)}function Kf(n,e){return zP(e,n.syncPointTree_,null,DE(n.pendingWriteTree_,Wt()))}function zP(n,e,t,i){if(At(n.path))return qP(n,e,t,i);{const s=e.get(Wt());t==null&&s!=null&&(t=$c(s,Wt()));let o=[];const l=It(n.path),d=n.operationForChild(l),h=e.children.get(l);if(h&&d){const p=t?t.getImmediateChild(l):null,T=PP(i,l);o=o.concat(zP(d,h,p,T))}return s&&(o=o.concat(UE(s,n,i,t))),o}}function qP(n,e,t,i){const s=e.get(Wt());t==null&&s!=null&&(t=$c(s,Wt()));let o=[];return e.children.inorderTraversal((l,d)=>{const h=t?t.getImmediateChild(l):null,p=PP(i,l),T=n.operationForChild(l);T&&(o=o.concat(qP(T,d,h,p)))}),s&&(o=o.concat(UE(s,n,i,t))),o}function GP(n,e){const t=e.query,i=xg(n,t);return{hashFn:()=>(wH(e)||rt.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?BH(n,t._path,i):FH(n,t._path);{const o=Bq(s,t);return G0(n,t,null,o)}}}}function xg(n,e){const t=v_(e);return n.queryToTagMap.get(t)}function v_(n){return n._path.toString()+"$"+n._queryIdentifier}function FE(n,e){return n.tagToQueryMap.get(e)}function BE(n){const e=n.indexOf("$");return Me(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new fn(n.substr(0,e))}}function zE(n,e,t){const i=n.syncPointTree_.get(e);Me(i,"Missing sync point for query tag that we're tracking");const s=DE(n.pendingWriteTree_,e);return UE(i,t,s,null)}function GH(n){return n.fold((e,t,i)=>{if(t&&ml(t))return[__(t)];{let s=[];return t&&(s=OP(t)),ys(i,(o,l)=>{s=s.concat(l)}),s}})}function af(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(LH())(n._repo,n._path):n}function HH(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=v_(i),o=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(o)}}}function jH(){return VH++}function KH(n,e,t){const i=e._path,s=xg(n,e),o=GP(n,t),l=n.listenProvider_.startListening(af(e),s,o.hashFn,o.onComplete),d=n.syncPointTree_.subtree(i);if(s)Me(!ml(d.value),"If we're adding a query, it shouldn't be shadowed");else{const h=d.fold((p,T,x)=>{if(!At(p)&&T&&ml(T))return[__(T).query];{let C=[];return T&&(C=C.concat(OP(T).map(A=>A.query))),ys(x,(A,D)=>{C=C.concat(D)}),C}});for(let p=0;p<h.length;++p){const T=h[p];n.listenProvider_.stopListening(af(T),xg(n,T))}}return l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new qE(t)}node(){return this.node_}}class GE{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ni(this.path_,e);return new GE(this.syncTree_,t)}node(){return BP(this.syncTree_,this.path_)}}const WH=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},f1=function(n,e,t){if(!n||typeof n!="object")return n;if(Me(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return YH(n[".sv"],e,t);if(typeof n[".sv"]=="object")return JH(n[".sv"],e);Me(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},YH=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Me(!1,"Unexpected server value: "+n)}},JH=function(n,e,t){n.hasOwnProperty("increment")||Me(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&Me(!1,"Unexpected increment value: "+i);const s=e.node();if(Me(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const l=s.getValue();return typeof l!="number"?i:l+i},ZH=function(n,e,t,i){return HE(e,new GE(t,n),i)},QH=function(n,e,t){return HE(n,new qE(e),t)};function HE(n,e,t){const i=n.getPriority().val(),s=f1(i,e.getImmediateChild(".priority"),t);let o;if(n.isLeafNode()){const l=n,d=f1(l.getValue(),e,t);return d!==l.getValue()||s!==l.getPriority().val()?new mi(d,Di(s)):n}else{const l=n;return o=l,s!==l.getPriority().val()&&(o=o.updatePriority(new mi(s))),l.forEachChild(On,(d,h)=>{const p=HE(h,e.getImmediateChild(d),t);p!==h&&(o=o.updateImmediateChild(d,p))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function KE(n,e){let t=e instanceof fn?e:new fn(e),i=n,s=It(t);for(;s!==null;){const o=ed(i.node.children,s)||{children:{},childCount:0};i=new jE(s,i,o),t=_n(t),s=It(t)}return i}function Vd(n){return n.node.value}function HP(n,e){n.node.value=e,H0(n)}function jP(n){return n.node.childCount>0}function $H(n){return Vd(n)===void 0&&!jP(n)}function T_(n,e){ys(n.node.children,(t,i)=>{e(new jE(t,n,i))})}function KP(n,e,t,i){t&&e(n),T_(n,s=>{KP(s,e,!0)})}function XH(n,e,t){let i=n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Wf(n){return new fn(n.parent===null?n.name:Wf(n.parent)+"/"+n.name)}function H0(n){n.parent!==null&&ej(n.parent,n.name,n)}function ej(n,e,t){const i=$H(t),s=ia(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,H0(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,H0(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tj=/[\[\].#$\/\u0000-\u001F\u007F]/,nj=/[\[\].#$\u0000-\u001F\u007F]/,kv=10*1024*1024,WP=function(n){return typeof n=="string"&&n.length!==0&&!tj.test(n)},YP=function(n){return typeof n=="string"&&n.length!==0&&!nj.test(n)},ij=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),YP(n)},JP=function(n,e,t){const i=t instanceof fn?new vG(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+au(i));if(typeof e=="function")throw new Error(n+"contains a function "+au(i)+" with contents = "+e.toString());if(JM(e))throw new Error(n+"contains "+e.toString()+" "+au(i));if(typeof e=="string"&&e.length>kv/3&&Vg(e)>kv)throw new Error(n+"contains a string greater than "+kv+" utf8 bytes "+au(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,o=!1;if(ys(e,(l,d)=>{if(l===".value")s=!0;else if(l!==".priority"&&l!==".sv"&&(o=!0,!WP(l)))throw new Error(n+" contains an invalid key ("+l+") "+au(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);TG(i,l),JP(n,d,i),EG(i)}),s&&o)throw new Error(n+' contains ".value" child '+au(i)+" in addition to actual children.")}},ZP=function(n,e,t,i){if(!YP(t))throw new Error(BN(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},sj=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ZP(n,e,t)},rj=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!WP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!ij(t))throw new Error(BN(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function QP(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],o=s.getPath();t!==null&&!IE(o,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(s)}t&&n.eventLists_.push(t)}function $P(n,e,t){QP(n,t),XP(n,i=>IE(i,e))}function Gu(n,e,t){QP(n,t),XP(n,i=>Ar(i,e)||Ar(e,i))}function XP(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const o=s.path;e(o)?(aj(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function aj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();nf&&ki("event: "+t.toString()),Hf(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lj="repo_interrupt",uj=25;class cj{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=pg(),this.transactionQueueTree_=new jE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function dj(n,e,t){if(n.stats_=CE(n.repoInfo_),n.forceRestClient_||Hq())n.server_=new mg(n.repoInfo_,(i,s,o,l)=>{m1(n,i,s,o,l)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>p1(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{yi(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new jo(n.repoInfo_,e,(i,s,o,l)=>{m1(n,i,s,o,l)},i=>{p1(n,i)},i=>{fj(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Jq(n.repoInfo_,()=>new WG(n.stats_,n.server_)),n.infoData_=new qG,n.infoSyncTree_=new d1({startListening:(i,s,o,l)=>{let d=[];const h=n.infoData_.getNode(i._path);return h.isEmpty()||(d=y_(n.infoSyncTree_,i._path,h),setTimeout(()=>{l("ok")},0)),d},stopListening:()=>{}}),WE(n,"connected",!1),n.serverSyncTree_=new d1({startListening:(i,s,o,l)=>(n.server_.listen(i,o,s,(d,h)=>{const p=l(d,h);Gu(n.eventQueue_,i._path,p)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function hj(n){const t=n.infoData_.getNode(new fn(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ek(n){return WH({timestamp:hj(n)})}function m1(n,e,t,i,s){n.dataUpdateCount++;const o=new fn(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let l=[];if(s)if(i){const h=Op(t,p=>Di(p));l=qH(n.serverSyncTree_,o,h,s)}else{const h=Di(t);l=zH(n.serverSyncTree_,o,h,s)}else if(i){const h=Op(t,p=>Di(p));l=UH(n.serverSyncTree_,o,h)}else{const h=Di(t);l=y_(n.serverSyncTree_,o,h)}let d=o;l.length>0&&(d=JE(n,o)),Gu(n.eventQueue_,d,l)}function p1(n,e){WE(n,"connected",e),e===!1&&pj(n)}function fj(n,e){ys(e,(t,i)=>{WE(n,t,i)})}function WE(n,e,t){const i=new fn("/.info/"+e),s=Di(t);n.infoData_.updateSnapshot(i,s);const o=y_(n.infoSyncTree_,i,s);Gu(n.eventQueue_,i,o)}function mj(n){return n.nextWriteId_++}function pj(n){tk(n,"onDisconnectEvents");const e=ek(n),t=pg();O0(n.onDisconnect_,Wt(),(s,o)=>{const l=ZH(s,o,n.serverSyncTree_,e);bP(t,s,l)});let i=[];O0(t,Wt(),(s,o)=>{i=i.concat(y_(n.serverSyncTree_,s,o));const l=Ej(n,s);JE(n,l)}),n.onDisconnect_=pg(),Gu(n.eventQueue_,Wt(),i)}function gj(n,e,t){let i;It(e._path)===".info"?i=h1(n.infoSyncTree_,e,t):i=h1(n.serverSyncTree_,e,t),$P(n.eventQueue_,e._path,i)}function _j(n,e,t){let i;It(e._path)===".info"?i=G0(n.infoSyncTree_,e,t):i=G0(n.serverSyncTree_,e,t),$P(n.eventQueue_,e._path,i)}function yj(n){n.persistentConnection_&&n.persistentConnection_.interrupt(lj)}function tk(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ki(t,...e)}function nk(n,e,t){return BP(n.serverSyncTree_,e,t)||rt.EMPTY_NODE}function YE(n,e=n.transactionQueueTree_){if(e||E_(n,e),Vd(e)){const t=sk(n,e);Me(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&vj(n,Wf(e),t)}else jP(e)&&T_(e,t=>{YE(n,t)})}function vj(n,e,t){const i=t.map(p=>p.currentWriteId),s=nk(n,e,i);let o=s;const l=s.hash();for(let p=0;p<t.length;p++){const T=t[p];Me(T.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),T.status=1,T.retryCount++;const x=gs(e,T.path);o=o.updateChild(x,T.currentOutputSnapshotRaw)}const d=o.val(!0),h=e;n.server_.put(h.toString(),d,p=>{tk(n,"transaction put response",{path:h.toString(),status:p});let T=[];if(p==="ok"){const x=[];for(let C=0;C<t.length;C++)t[C].status=2,T=T.concat(qc(n.serverSyncTree_,t[C].currentWriteId)),t[C].onComplete&&x.push(()=>t[C].onComplete(null,!0,t[C].currentOutputSnapshotResolved)),t[C].unwatcher();E_(n,KE(n.transactionQueueTree_,e)),YE(n,n.transactionQueueTree_),Gu(n.eventQueue_,e,T);for(let C=0;C<x.length;C++)Hf(x[C])}else{if(p==="datastale")for(let x=0;x<t.length;x++)t[x].status===3?t[x].status=4:t[x].status=0;else{qs("transaction at "+h.toString()+" failed: "+p);for(let x=0;x<t.length;x++)t[x].status=4,t[x].abortReason=p}JE(n,e)}},l)}function JE(n,e){const t=ik(n,e),i=Wf(t),s=sk(n,t);return Tj(n,s,i),i}function Tj(n,e,t){if(e.length===0)return;const i=[];let s=[];const l=e.filter(d=>d.status===0).map(d=>d.currentWriteId);for(let d=0;d<e.length;d++){const h=e[d],p=gs(t,h.path);let T=!1,x;if(Me(p!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===4)T=!0,x=h.abortReason,s=s.concat(qc(n.serverSyncTree_,h.currentWriteId,!0));else if(h.status===0)if(h.retryCount>=uj)T=!0,x="maxretry",s=s.concat(qc(n.serverSyncTree_,h.currentWriteId,!0));else{const C=nk(n,h.path,l);h.currentInputSnapshot=C;const A=e[d].update(C.val());if(A!==void 0){JP("transaction failed: Data returned ",A,h.path);let D=Di(A);typeof A=="object"&&A!=null&&ia(A,".priority")||(D=D.updatePriority(C.getPriority()));const H=h.currentWriteId,X=ek(n),re=QH(D,C,X);h.currentOutputSnapshotRaw=D,h.currentOutputSnapshotResolved=re,h.currentWriteId=mj(n),l.splice(l.indexOf(H),1),s=s.concat(OH(n.serverSyncTree_,h.path,re,h.currentWriteId,h.applyLocally)),s=s.concat(qc(n.serverSyncTree_,H,!0))}else T=!0,x="nodata",s=s.concat(qc(n.serverSyncTree_,h.currentWriteId,!0))}Gu(n.eventQueue_,t,s),s=[],T&&(e[d].status=2,(function(C){setTimeout(C,Math.floor(0))})(e[d].unwatcher),e[d].onComplete&&(x==="nodata"?i.push(()=>e[d].onComplete(null,!1,e[d].currentInputSnapshot)):i.push(()=>e[d].onComplete(new Error(x),!1,null))))}E_(n,n.transactionQueueTree_);for(let d=0;d<i.length;d++)Hf(i[d]);YE(n,n.transactionQueueTree_)}function ik(n,e){let t,i=n.transactionQueueTree_;for(t=It(e);t!==null&&Vd(i)===void 0;)i=KE(i,t),e=_n(e),t=It(e);return i}function sk(n,e){const t=[];return rk(n,e,t),t.sort((i,s)=>i.order-s.order),t}function rk(n,e,t){const i=Vd(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);T_(e,s=>{rk(n,s,t)})}function E_(n,e){const t=Vd(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,HP(e,t.length>0?t:void 0)}T_(e,i=>{E_(n,i)})}function Ej(n,e){const t=Wf(ik(n,e)),i=KE(n.transactionQueueTree_,e);return XH(i,s=>{Dv(n,s)}),Dv(n,i),KP(i,s=>{Dv(n,s)}),t}function Dv(n,e){const t=Vd(e);if(t){const i=[];let s=[],o=-1;for(let l=0;l<t.length;l++)t[l].status===3||(t[l].status===1?(Me(o===l-1,"All SENT items should be at beginning of queue."),o=l,t[l].status=3,t[l].abortReason="set"):(Me(t[l].status===0,"Unexpected transaction status in abort"),t[l].unwatcher(),s=s.concat(qc(n.serverSyncTree_,t[l].currentWriteId,!0)),t[l].onComplete&&i.push(t[l].onComplete.bind(null,new Error("set"),!1,null))));o===-1?HP(e,void 0):t.length=o+1,Gu(n.eventQueue_,Wf(e),s);for(let l=0;l<i.length;l++)Hf(i[l])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xj(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function wj(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):qs(`Invalid query segment '${t}' in query '${n}'`)}return e}const g1=function(n,e){const t=Sj(n),i=t.namespace;t.domain==="firebase.com"&&Xo(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Xo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Lq();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new aP(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new fn(t.pathString)}},Sj=function(n){let e="",t="",i="",s="",o="",l=!0,d="https",h=443;if(typeof n=="string"){let p=n.indexOf("//");p>=0&&(d=n.substring(0,p-1),n=n.substring(p+2));let T=n.indexOf("/");T===-1&&(T=n.length);let x=n.indexOf("?");x===-1&&(x=n.length),e=n.substring(0,Math.min(T,x)),T<x&&(s=xj(n.substring(T,x)));const C=wj(n.substring(Math.min(n.length,x)));p=e.indexOf(":"),p>=0?(l=d==="https"||d==="wss",h=parseInt(e.substring(p+1),10)):p=e.length;const A=e.slice(0,p);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const D=e.indexOf(".");i=e.substring(0,D).toLowerCase(),t=e.substring(D+1),o=i}"ns"in C&&(o=C.ns)}return{host:e,port:h,domain:t,subdomain:i,secure:l,scheme:d,pathString:s,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+yi(this.snapshot.exportVal())}}class bj{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Me(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return At(this._path)?null:gP(this._path)}get ref(){return new El(this._repo,this._path)}get _queryIdentifier(){const e=e1(this._queryParams),t=wE(e);return t==="{}"?"default":t}get _queryObject(){return e1(this._queryParams)}isEqual(e){if(e=Un(e),!(e instanceof ZE))return!1;const t=this._repo===e._repo,i=IE(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+yG(this._path)}}class El extends ZE{constructor(e,t){super(e,t,new ME,!1)}get parent(){const e=yP(this._path);return e===null?null:new El(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class wg{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new fn(e),i=j0(this.ref,e);return new wg(this._node.getChild(t),i,On)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new wg(s,j0(this.ref,i),On)))}hasChild(e){const t=new fn(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Aj(n,e){return n=Un(n),n._checkNotDeleted("ref"),j0(n._root,e)}function j0(n,e){return n=Un(n),It(n._path)===null?sj("child","path",e):ZP("child","path",e),new El(n._repo,ni(n._path,e))}class QE{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new Cj("value",this,new wg(e.snapshotNode,new El(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new bj(this,e,t):null}matches(e){return e instanceof QE?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function Nj(n,e,t,i,s){const o=new Ij(t,void 0),l=new QE(o);return gj(n._repo,n,l),()=>_j(n._repo,n,l)}function Rj(n,e,t,i){return Nj(n,"value",e)}AH(El);DH(El);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mj="FIREBASE_DATABASE_EMULATOR_HOST",K0={};let Pj=!1;function kj(n,e,t,i){const s=e.lastIndexOf(":"),o=e.substring(0,s),l=gl(o);n.repoInfo_=new aP(e,l,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function Dj(n,e,t,i,s){let o=i||n.options.databaseURL;o===void 0&&(n.options.projectId||Xo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ki("Using default host for project ",n.options.projectId),o=`${n.options.projectId}-default-rtdb.firebaseio.com`);let l=g1(o,s),d=l.repoInfo,h;typeof process<"u"&&VA&&(h=VA[Mj]),h?(o=`http://${h}?ns=${d.namespace}`,l=g1(o,s),d=l.repoInfo):l.repoInfo.secure;const p=new Kq(n.name,n.options,e);rj("Invalid Firebase Database URL",l),At(l.path)||Xo("Database URL must point to the root of a Firebase Database (not including a child path).");const T=Vj(d,n,p,new jq(n,t));return new Oj(T,n)}function Lj(n,e){const t=K0[e];(!t||t[n.key]!==n)&&Xo(`Database ${e}(${n.repoInfo_}) has already been deleted.`),yj(n),delete t[n.key]}function Vj(n,e,t,i){let s=K0[e.name];s||(s={},K0[e.name]=s);let o=s[n.toURLString()];return o&&Xo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new cj(n,Pj,t,i),s[n.toURLString()]=o,o}class Oj{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(dj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new El(this._repo,Wt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Lj(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Xo("Cannot call "+e+" on a deleted database.")}}function Uj(n=yT(),e){const t=Ug(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=RN("database");i&&Fj(t,...i)}return t}function Fj(n,e,t,i={}){n=Un(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,o=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Wo(i,o.repoInfo_.emulatorOptions))return;Xo("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let l;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&Xo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new Rp(Rp.OWNER);else if(i.mockUserToken){const d=typeof i.mockUserToken=="string"?i.mockUserToken:kN(i.mockUserToken,n.app.options.projectId);l=new Rp(d)}gl(e)&&(mT(e),pT("Database",!0)),kj(o,s,i,l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bj(n){Nq(Fu),xu(new ll("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return Dj(i,s,o,t)},"PUBLIC").setMultipleInstances(!0)),ro(OA,UA,n),ro(OA,UA,"esm2020")}jo.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};jo.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Bj();const zj={apiKey:"AIzaSyBCnLlCaVWh9iKhclzPWJcEPDuyH0OHPUM",authDomain:"ques-trip.firebaseapp.com",projectId:"ques-trip",storageBucket:"ques-trip.firebasestorage.app",messagingSenderId:"765263595886",appId:"1:765263595886:web:3e501d362abe47bfb8597f",measurementId:"G-R1NF9EVRHY"},x_=GN(zj);console.log("Firebase App Initialized:",x_.name);const W0=JB(x_),qj=new Fo,Uo=uq(x_);cq(Uo).catch(n=>{n.code=="failed-precondition"?console.warn("Firestore persistence failed: Multiple tabs open"):n.code=="unimplemented"&&console.warn("Firestore persistence not supported by browser")});const Gj=Uj(x_),Hj=n=>{const e=Aj(Gj,".info/connected");return Rj(e,t=>{t.val()})},jj=({trip:n,currentUser:e,onClose:t,settings:i})=>{const s=nn[i.language]||nn["zh-TW"],[o,l]=Z.useState(""),[d,h]=Z.useState(!1),[p,T]=Z.useState(null),[x,C]=Z.useState(""),[A,D]=Z.useState(""),[F,H]=Z.useState(!1),X=async()=>{if(o){h(!0),C(""),T(null);try{const he=P0(Ip(Uo,"users"),k0("email","==",o)),fe=await Sq(he);if(fe.empty)C(i.language==="zh-TW"?"":"User not found");else{const Y=fe.docs[0];T({id:Y.id,...Y.data()})}}catch(he){console.error(he),C(i.language==="zh-TW"?"":"Search failed")}finally{h(!1)}}},re=async()=>{if(!(!p||!n.id))try{const he=tf(Uo,"itineraries",n.id);await Np(he,{collaborators:LA(p.id),userIds:LA(p.id)}),D(i.language==="zh-TW"?` ${p.username}`:`Invited ${p.username}`),T(null),l(""),setTimeout(()=>D(""),3e3)}catch(he){console.error(he),C(i.language==="zh-TW"?"":"Invite failed")}},Q=()=>{const he=window.location.origin+`?trip=${n.id}`;navigator.clipboard.writeText(he),H(!0),setTimeout(()=>H(!1),2e3)};return pN.createPortal(_.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:_.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-sm overflow-hidden shadow-2xl",children:[_.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[_.jsx("h3",{className:"text-lg font-bold text-ink",children:s.share_trip||"Share Trip"}),_.jsx("button",{onClick:t,className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:_.jsx(LD,{className:"w-5 h-5 text-gray-500"})})]}),_.jsxs("div",{className:"p-6 space-y-6",children:[_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:i.language==="zh-TW"?" ( Email)":"Invite Companion (Enter Email)"}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("input",{type:"email",value:o,onChange:he=>l(he.target.value),placeholder:"friend@example.com",className:"flex-1 p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-coral outline-none text-sm"}),_.jsx("button",{onClick:X,disabled:d||!o,className:"bg-coral text-white p-3 rounded-xl font-bold disabled:opacity-50",children:d?"...":i.language==="zh-TW"?"":"Find"})]}),x&&_.jsx("p",{className:"text-red-500 text-xs font-bold ml-1",children:x}),p&&_.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-3 rounded-xl border border-green-100 animate-slide-up",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("div",{className:"w-8 h-8 bg-green-200 rounded-full flex items-center justify-center text-green-700 font-bold text-xs",children:p.username[0]}),_.jsx("span",{className:"text-sm font-bold text-green-800",children:p.username})]}),_.jsx("button",{onClick:re,className:"bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-700",children:i.language==="zh-TW"?"":"Add"})]}),A&&_.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm font-bold ml-1 animate-fade-in",children:[_.jsx(iC,{className:"w-4 h-4"})," ",A]})]}),_.jsx("div",{className:"w-full h-px bg-gray-100"}),_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:i.language==="zh-TW"?" ()":"Share Link (View Only)"}),_.jsxs("button",{onClick:Q,className:"w-full p-4 bg-gray-50 rounded-2xl border border-gray-200 hover:border-coral transition-colors flex items-center justify-between group",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-400 group-hover:text-coral shadow-sm",children:_.jsx(e5,{className:"w-5 h-5"})}),_.jsxs("div",{className:"text-left",children:[_.jsx("div",{className:"text-sm font-bold text-ink",children:i.language==="zh-TW"?"":"Copy Trip Link"}),_.jsx("div",{className:"text-xs text-gray-400",children:F?i.language==="zh-TW"?"":"Copied!":"nomadai.app/trip/..."})]})]}),F?_.jsx(iC,{className:"w-5 h-5 text-green-500"}):null]})]})]})]})}),document.body)},Kj=({trip:n,user:e,onBack:t,onDelete:i,onUpdateTrip:s,onOpenAI:o,settings:l})=>{var Vr,Or,ho,vi;const d=nn[l.language]||nn["zh-TW"],[h,p]=Z.useState("ITINERARY"),[T,x]=Z.useState(!1),[C,A]=Z.useState(!1),[D,F]=Z.useState(""),[H,X]=Z.useState(null),[re,Q]=Z.useState(!1),he=async Ne=>{const ht=Ne||D;if(ht.trim()){Ne&&F(Ne),Q(!0);try{const dt=await Gh(ht,l.apiKey);dt?X(dt):(Ne||alert("Location not found"),console.log(`Location not found for: ${ht}`))}catch(dt){console.error("Map search failed:",dt)}finally{Q(!1)}}},[fe,Y]=Z.useState(null),[k,B]=Z.useState(""),[O,q]=Z.useState(""),[G,W]=Z.useState(""),[z,Ge]=Z.useState([{name:"",price:""}]),[$e,se]=Z.useState(((Vr=n.budget)==null?void 0:Vr.currency)||"TWD"),[Ce,be]=Z.useState(""),[it,Pe]=Z.useState(0),[K,me]=Z.useState(!1),[Ie,le]=Z.useState(null),[ge,we]=Z.useState(!1),[Ke,Fe]=Z.useState(!1);Z.useEffect(()=>{var Ne;ge&&(se(((Ne=n.budget)==null?void 0:Ne.currency)||"TWD"),be(""))},[ge,(Or=n.budget)==null?void 0:Or.currency]),Z.useEffect(()=>{(async()=>{var dt;const ht=((dt=n.budget)==null?void 0:dt.currency)||"TWD";if(le(null),$e!==ht&&l.apiKey){me(!0);try{const rn=await oT($e,ht);rn?be(rn):le(" (API Key )")}catch(rn){console.error("Failed to fetch rate:",rn),le("")}me(!1)}})()},[$e,(ho=n.budget)==null?void 0:ho.currency,l.apiKey]),Z.useEffect(()=>{const Ne=parseFloat(O)||0,ht=parseFloat(Ce)||1;Pe(Math.round(Ne*ht))},[O,Ce]);const[Ye,Nt]=Z.useState(!1),[Jt,ct]=Z.useState(!1),[mn,Rn]=Z.useState(n.title),[Yt,Rt]=Z.useState(!1),[Mt,Se]=Z.useState(""),[Qe,_e]=Z.useState(!1),ke=()=>{i==null||i(n.id)},He=()=>{mn.trim()&&mn!==n.title&&(s==null||s({...n,title:mn})),ct(!1)},mt=async Ne=>{if(Ne==="upload"){const ht=document.createElement("input");ht.type="file",ht.accept="image/*",ht.onchange=dt=>{var wi,Es;const rn=(Es=(wi=dt.target)==null?void 0:wi.files)==null?void 0:Es[0];if(rn){const Fn=new FileReader;Fn.onload=()=>{const Zi=Fn.result;s==null||s({...n,coverImage:Zi}),Rt(!1)},Fn.readAsDataURL(rn)}},ht.click()}else if(Ne==="url")Mt.trim()&&(s==null||s({...n,coverImage:Mt}),Se(""),Rt(!1));else if(Ne==="ai"){_e(!0);try{const{generateCoverImage:ht}=await Ng(async()=>{const{generateCoverImage:rn}=await Promise.resolve().then(()=>M6);return{generateCoverImage:rn}},void 0),dt=await ht(n.title);s==null||s({...n,coverImage:dt}),Rt(!1)}catch(ht){console.error("Failed to generate cover:",ht),alert("AI ")}finally{_e(!1)}}},lt=Ne=>{Y(Ne),q(""),W(""),Ge([{name:"",price:""}]),we(!0)},un=()=>{var gn,Bi,zi;if(!fe||!O)return;const Ne=parseFloat(O);if(Ne<=0){alert("Amount must be greater than 0");return}const ht=parseFloat(Ce)||1,dt=Math.round(Ne*ht),rn=z.filter(Xn=>Xn.name&&Xn.price).map(Xn=>`${Xn.name}: ${hu($e)}${Xn.price}`).join(", "),wi=G?rn?`${G} (${rn})`:G:rn,Es={id:Date.now().toString(),title:fe.activity,amount:dt,category:"Shopping",date:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],payer:"ME",paymentMethod:"Cash",note:wi,originalCurrency:$e,originalAmount:Ne,exchangeRate:ht},Fn=((gn=n.budget)==null?void 0:gn.expenses)||[],Zi={...n,budget:{...n.budget,total:((Bi=n.budget)==null?void 0:Bi.total)||0,currency:((zi=n.budget)==null?void 0:zi.currency)||"TWD",expenses:[Es,...Fn]}};s==null||s(Zi),we(!1)},ri=(Ne,ht,dt)=>{const rn=[...z];if(rn[Ne][ht]=dt,Ge(rn),ht==="price"){const wi=rn.reduce((Es,Fn)=>Es+(parseInt(Fn.price)||0),0);wi>0&&q(wi.toString())}},Ji=()=>{Ge([...z,{name:"",price:""}])},pn=((vi=n.budget)==null?void 0:vi.currency)||"TWD",Ts=hu(pn);return _.jsxs("div",{className:"flex flex-col h-full bg-paper animate-fade-in relative",children:[_.jsxs("div",{className:"relative h-64 shrink-0 group",children:[_.jsxs("div",{className:"absolute inset-0 bg-gray-200",children:[n.coverImage?_.jsx("img",{src:n.coverImage,alt:n.title,className:`w-full h-full object-cover transition-opacity duration-700 ${C?"opacity-100":"opacity-0"}`,onLoad:()=>A(!0)}):_.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-coral/20 to-sand/30",children:_.jsx(sC,{className:"w-16 h-16 text-coral/40"})}),_.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"})]}),_.jsxs("div",{className:"absolute top-[15px] left-0 right-0 p-4 pt-safe pt-4 flex justify-between items-start z-10",children:[_.jsx("button",{onClick:t,className:"p-2 bg-black/30 backdrop-blur-md rounded-full text-white hover:bg-black/50 transition-colors",children:_.jsx(vs,{className:"w-6 h-6"})}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("button",{onClick:()=>Rt(!0),className:"p-2 bg-black/30 backdrop-blur-md rounded-full text-white hover:bg-black/50 transition-colors opacity-0 group-hover:opacity-100",children:_.jsx(Xa,{className:"w-5 h-5"})}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("button",{onClick:()=>Fe(!0),className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:_.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),_.jsx("button",{onClick:()=>o(n.id),"data-testid":"btn-ai-planner",className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors",children:_.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),_.jsx("button",{onClick:()=>i(n.id),className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-red-500/50 transition-colors",children:_.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),_.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-5 text-white z-10",children:[Jt?_.jsx("div",{className:"flex items-center gap-2 mb-2",children:_.jsx("input",{value:mn,onChange:Ne=>Rn(Ne.target.value),className:"bg-white/20 backdrop-blur-md text-white text-3xl font-black px-2 py-1 rounded-lg outline-none w-full",autoFocus:!0,onBlur:He,onKeyDown:Ne=>Ne.key==="Enter"&&He()})}):_.jsxs("h1",{className:"text-3xl font-black mb-2 leading-tight drop-shadow-md cursor-pointer hover:text-coral/90 transition-colors flex items-center gap-2",onClick:()=>{ct(!0),Rn(n.title)},children:[n.title,_.jsx(I1,{className:"w-5 h-5 opacity-50"})]}),_.jsxs("div",{className:"flex items-center gap-3 text-sm font-bold text-gray-200",children:[_.jsxs("span",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded text-xs",children:[n.days," Days"]}),_.jsxs("span",{children:[n.startDate," - ",n.endDate]})]})]})]}),_.jsx("div",{className:"flex-1 overflow-y-auto bg-paper relative rounded-t-3xl -mt-6 z-20 shadow-[0_-4px_20px_rgba(0,0,0,0.1)]",children:_.jsxs("div",{className:"p-5 min-h-full",children:[h==="ITINERARY"&&_.jsx(O6,{trip:n,settings:l,onUpdateTrip:s,onOpenQuickExpense:lt}),h==="MAP"&&_.jsxs(_.Fragment,{children:[_.jsxs("div",{className:"mb-4 flex gap-2",children:[_.jsxs("div",{className:"flex-1 relative",children:[_.jsx("input",{type:"text",value:D,onChange:Ne=>F(Ne.target.value),onKeyDown:Ne=>Ne.key==="Enter"&&he(),placeholder:d.search_placeholder,className:"w-full pl-10 pr-4 py-2 rounded-full border border-sand focus:border-coral focus:ring-1 focus:ring-coral outline-none text-sm"}),_.jsx(XD,{className:"w-4 h-4 text-gray-400 absolute left-3.5 top-1/2 -translate-y-1/2"})]}),_.jsx("button",{onClick:()=>he(),disabled:re||!D.trim(),className:"bg-ink text-white px-4 py-2 rounded-full text-sm font-bold disabled:opacity-50 flex items-center gap-1",children:re?_.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):d.search_location})]}),_.jsx(mU,{trip:n,settings:l,searchedLocation:H,onItemClick:Ne=>he(Ne),mapSearchQuery:D})]}),h==="BUDGET"&&_.jsx(B6,{trip:n,settings:l,onUpdateTrip:s,currentUserId:e.id}),h==="BOOKINGS"&&_.jsx(z6,{trip:n,settings:l,onUpdateTrip:s}),h==="SHOPPING"&&_.jsx(V6,{items:n.shoppingList||[],onUpdateItems:Ne=>s==null?void 0:s({...n,shoppingList:Ne}),settings:l})]})}),_.jsx("div",{className:"absolute bottom-6 left-6 right-6 bg-white/90 backdrop-blur-xl rounded-full shadow-2xl border border-white/50 p-1.5 flex justify-between items-center z-30",children:[{id:"ITINERARY",icon:b1,label:d.itinerary},{id:"MAP",icon:sC,label:d.map},{id:"BUDGET",icon:x1,label:d.budget},{id:"BOOKINGS",icon:w1,label:d.bookings},{id:"SHOPPING",icon:A1,label:d.shopping}].map(Ne=>_.jsxs("button",{onClick:()=>p(Ne.id),className:`flex-1 flex flex-col items-center justify-center py-2 rounded-full transition-all duration-300 ${h===Ne.id?"bg-ink text-white shadow-lg scale-105":"text-gray-400 hover:text-ink hover:bg-gray-100"}`,children:[_.jsx(Ne.icon,{className:`w-5 h-5 ${h===Ne.id?"stroke-2":"stroke-[1.5]"}`}),h===Ne.id&&_.jsx("span",{className:"text-[10px] font-bold mt-0.5",children:Ne.label})]},Ne.id))}),Ke&&_.jsx(jj,{trip:n,currentUser:e,onClose:()=>Fe(!1),settings:l}),T&&_.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:_.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl animate-scale-in text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(al,{className:"w-8 h-8"})}),_.jsx("h3",{className:"text-xl font-bold text-ink mb-2",children:d.delete_trip}),_.jsx("p",{className:"text-gray-500 mb-6",children:d.delete_trip_confirm.replace("{title}",n.title)}),_.jsxs("div",{className:"flex gap-3",children:[_.jsx("button",{onClick:()=>x(!1),className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold hover:bg-gray-200 transition-colors",children:d.cancel}),_.jsx("button",{onClick:ke,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 shadow-lg shadow-red-500/30 transition-colors",children:d.delete})]})]})}),Yt&&_.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>Rt(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up",onClick:Ne=>Ne.stopPropagation(),children:[_.jsx("h3",{className:"text-xl font-bold text-ink mb-6 text-center",children:""}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("button",{onClick:()=>mt("upload"),className:"w-full py-4 bg-white border border-sand rounded-xl font-bold text-ink hover:bg-gray-50 flex items-center justify-center gap-2",children:[_.jsx("span",{children:""})," "]}),_.jsx("button",{onClick:()=>mt("ai"),disabled:Qe,className:"w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2",children:Qe?_.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):_.jsxs(_.Fragment,{children:[_.jsx("span",{children:""})," AI "]})}),_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"absolute inset-0 flex items-center",children:_.jsx("div",{className:"w-full border-t border-sand"})}),_.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:_.jsx("span",{className:"bg-paper px-2 text-gray-400",children:"OR"})})]}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("input",{value:Mt,onChange:Ne=>Se(Ne.target.value),placeholder:"...",className:"flex-1 bg-white p-3 rounded-xl border border-sand outline-none"}),_.jsx("button",{onClick:()=>mt("url"),disabled:!Mt,className:"bg-ink text-white px-4 rounded-xl font-bold disabled:opacity-50",children:"OK"})]})]})]})}),ge&&_.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-fade-in",onClick:()=>we(!1),children:_.jsxs("div",{className:"bg-paper w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-slide-up",onClick:Ne=>Ne.stopPropagation(),children:[_.jsx("h3",{className:"text-xl font-bold text-ink mb-2 text-center",children:""}),_.jsx("p",{className:"text-center text-gray-400 text-sm mb-6",children:fe==null?void 0:fe.activity}),_.jsxs("div",{className:"space-y-4",children:[z.map((Ne,ht)=>_.jsxs("div",{className:"flex gap-2",children:[_.jsx("input",{value:Ne.name,onChange:dt=>ri(ht,"name",dt.target.value),placeholder:" (: )",className:"flex-1 bg-white p-3 rounded-xl font-bold border-none shadow-sm outline-none",autoFocus:ht===0}),_.jsx("input",{type:"number",value:Ne.price,onChange:dt=>ri(ht,"price",dt.target.value),placeholder:hu($e),className:"w-24 bg-white p-3 rounded-xl font-bold border-none shadow-sm outline-none text-center",onFocus:dt=>dt.target.select()})]},ht)),_.jsx("button",{onClick:Ji,className:"text-xs font-bold text-coral flex items-center gap-1 mx-auto hover:bg-coral/10 px-3 py-1 rounded-lg transition-colors",children:"+ "}),_.jsxs("div",{className:"pt-4 border-t border-sand",children:[_.jsxs("div",{className:"flex justify-between items-center mb-4",children:[_.jsx("div",{className:"flex items-center gap-2",children:_.jsx("select",{value:$e,onChange:Ne=>se(Ne.target.value),className:"bg-transparent font-bold text-gray-400 outline-none text-sm",children:aT.map(Ne=>_.jsx("option",{value:Ne.code,children:Ne.code},Ne.code))})}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("span",{className:"font-bold text-ink text-2xl",children:hu($e)}),_.jsx("input",{type:"number",value:O,onChange:Ne=>q(Ne.target.value),className:"w-32 bg-transparent text-right text-3xl font-black border-none outline-none p-0",placeholder:"0",onFocus:Ne=>Ne.target.select()})]})]}),$e!==pn&&_.jsxs("div",{className:"mb-4 bg-sand/30 p-3 rounded-xl",children:[_.jsxs("div",{className:"flex justify-between items-center mb-2",children:[_.jsxs("label",{className:"text-xs font-bold text-gray-500",children:[" (",$e,"  ",pn,")"]}),_.jsxs("span",{className:"text-xs font-bold text-coral",children:[" ",Ts,it.toLocaleString()]})]}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{value:Ce,onChange:Ne=>be(Ne.target.value),type:"number",step:"0.01",placeholder:K?"...":"Exchange Rate",className:"w-full bg-white p-3 rounded-xl text-sm font-bold border-none shadow-sm outline-none",onFocus:Ne=>Ne.target.select(),disabled:K}),K&&_.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:_.jsx("div",{className:"w-4 h-4 border-2 border-coral border-t-transparent rounded-full animate-spin"})})]}),!l.apiKey&&_.jsx("p",{className:"text-[10px] text-red-400 mt-1",children:"*  API Key "}),Ie&&_.jsxs("p",{className:"text-[10px] text-red-400 mt-1",children:["* ",Ie]})]}),_.jsx("textarea",{value:G,onChange:Ne=>W(Ne.target.value),placeholder:"...",className:"w-full bg-white p-3 rounded-xl text-sm font-medium border-none shadow-sm outline-none min-h-[60px]"})]}),_.jsx("button",{onClick:un,disabled:!O,className:"w-full bg-ink text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-ink/30 mt-2 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",children:""})]})]})})]})},Wj=({onStartGeneration:n,onCancel:e,settings:t,sessions:i,currentSessionId:s,onCreateSession:o,onUpdateSession:l,onDeleteSession:d,onSelectSession:h})=>{const p=nn[t.language]||nn["zh-TW"],[T,x]=Z.useState(""),[C,A]=Z.useState(!1),[D,F]=Z.useState(!1),H=Z.useRef(null),X=i.find(Y=>Y.id===s),re=(X==null?void 0:X.messages)||[],Q=()=>{var Y;(Y=H.current)==null||Y.scrollIntoView({behavior:"smooth"})};Z.useEffect(Q,[re]),Z.useEffect(()=>{s&&re.length===0?l(s,[{role:"ai",content:p.ai_planner_intro,timestamp:Date.now()}]):!s&&i.length===0?o():!s&&i.length>0&&h(i[0].id)},[s,i.length]);const he=()=>{o(),F(!1)},fe=async()=>{if(!T.trim()||!s)return;const Y={role:"user",content:T,timestamp:Date.now()},k=[...re,Y];l(s,k),x(""),A(!0);const B={role:"ai",content:p.ai_planning,timestamp:Date.now()};l(s,[...k,B]),n(T,X==null?void 0:X.tripId).then(O=>{const q={role:"ai",content:p.ai_done,timestamp:Date.now()};O?l(s,[...k,q],O.title,O.tripId):l(s,[...k,q]),A(!1)})};return _.jsxs("div",{className:"flex h-full bg-paper pt-safe relative overflow-hidden",children:[D&&_.jsx("div",{className:"absolute inset-0 bg-black/20 z-20 backdrop-blur-sm",onClick:()=>F(!1)}),_.jsxs("div",{className:`absolute top-0 left-0 bottom-0 w-64 bg-white shadow-2xl z-30 transform transition-transform duration-300 ease-in-out ${D?"translate-x-0":"-translate-x-full"}`,children:[_.jsxs("div",{className:"p-4 border-b border-sand flex justify-between items-center pt-12",children:[_.jsx("h3",{className:"font-bold text-lg text-ink",children:t.language==="zh-TW"?"":"Chat History"}),_.jsx("button",{onClick:he,className:"p-2 bg-coral/10 rounded-full text-coral hover:bg-coral/20",children:_.jsx(Z0,{className:"w-5 h-5"})})]}),_.jsxs("div",{className:"overflow-y-auto h-full pb-20",children:[i.map(Y=>_.jsxs("div",{onClick:()=>{h(Y.id),F(!1)},className:`p-4 border-b border-sand/50 cursor-pointer hover:bg-sand/30 transition-colors ${s===Y.id?"bg-sand/50 border-l-4 border-l-coral":""}`,children:[_.jsx("div",{className:"font-medium text-ink truncate",children:Y.title}),_.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(Y.updatedAt).toLocaleDateString()})]},Y.id)),i.length===0&&_.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:t.language==="zh-TW"?"":"No chat history"})]})]}),_.jsxs("div",{className:"flex-1 flex flex-col h-full w-full",children:[_.jsxs("div",{className:"px-4 py-3 border-b border-sand/50 flex items-center justify-between bg-paper sticky top-0 z-10 pt-safe pt-4",children:[_.jsxs("div",{className:"flex items-center",children:[_.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-white text-gray-500 transition-colors",children:_.jsx(vs,{className:"w-6 h-6"})}),_.jsx("button",{onClick:()=>F(!0),className:"ml-2 p-2 rounded-full hover:bg-white text-gray-500 transition-colors",children:_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),_.jsxs("h2",{className:"text-lg font-bold text-ink ml-2 flex items-center gap-2 truncate max-w-[150px]",children:[_.jsx(S1,{className:"w-5 h-5 text-coral"}),(X==null?void 0:X.title)||p.ai_planner_title]})]}),_.jsx("button",{onClick:he,className:"text-xs font-bold text-coral border border-coral/30 px-3 py-1.5 rounded-full hover:bg-coral/10 transition-colors",children:t.language==="zh-TW"?"":"New Chat"})]}),_.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 pb-24",children:[re.map((Y,k)=>_.jsx("div",{className:`flex ${Y.role==="user"?"justify-end":"justify-start"} animate-slide-up`,children:_.jsx("div",{className:`max-w-[85%] p-4 rounded-2xl text-sm font-medium leading-relaxed shadow-sm whitespace-pre-line ${Y.role==="user"?"bg-coral text-white rounded-tr-none":"bg-white text-ink border border-sand rounded-tl-none"}`,children:Y.content})},k)),C&&_.jsx("div",{className:"flex justify-start",children:_.jsxs("div",{className:"bg-white p-4 rounded-2xl rounded-tl-none border border-sand flex items-center gap-2",children:[_.jsx("div",{className:"w-2 h-2 bg-coral rounded-full animate-bounce"}),_.jsx("div",{className:"w-2 h-2 bg-coral rounded-full animate-bounce delay-100"}),_.jsx("div",{className:"w-2 h-2 bg-coral rounded-full animate-bounce delay-200"}),_.jsx("span",{className:"text-xs text-gray-400 font-bold ml-1",children:p.planning_process})]})}),_.jsx("div",{ref:H})]}),_.jsxs("div",{className:"p-4 bg-white/90 backdrop-blur border-t border-sand pb-32",children:[_.jsxs("div",{className:"flex gap-2",children:[_.jsx("textarea",{value:T,onChange:Y=>x(Y.target.value),onKeyDown:Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),fe())},placeholder:p.input_placeholder,"data-testid":"input-ai-chat",className:"flex-1 bg-paper rounded-2xl px-5 py-3.5 outline-none focus:ring-2 focus:ring-coral/50 transition-all font-medium text-ink placeholder:text-gray-400 border border-sand resize-none min-h-[50px] max-h-[120px]",disabled:C,rows:1}),_.jsx("button",{onClick:fe,"data-testid":"btn-ai-send",disabled:!T.trim()||C,className:"bg-coral text-white p-3.5 rounded-2xl disabled:opacity-50 active:scale-95 transition-transform shadow-lg shadow-coral/20",children:_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:_.jsx("path",{d:"M3.105 2.289a.75.75 0 0 0-.826.95l1.414 4.925A1.5 1.5 0 0 0 5.135 9.25h6.115a.75.75 0 0 1 0 1.5H5.135a1.5 1.5 0 0 0-1.442 1.086l-1.414 4.926a.75.75 0 0 0 .826.95 28.896 28.896 0 0 0 15.293-7.154.75.75 0 0 0 0-1.115A28.897 28.897 0 0 0 3.105 2.289Z"})})})]}),_.jsx("div",{className:"flex gap-2 mt-3 overflow-x-auto no-scrollbar pb-2",children:[p.prompt_tokyo,p.prompt_bangkok,p.prompt_paris].map(Y=>_.jsx("button",{onClick:()=>x(Y),className:"whitespace-nowrap px-4 py-2 bg-white text-gray-500 text-xs font-bold rounded-xl border border-sand hover:text-coral hover:border-coral transition-colors",disabled:C,children:Y},Y))})]})]})]})},Yj="https://api.exchangerate-api.com/v4/latest/TWD";let Lh=null,_1=0;const Jj=1440*60*1e3,Zj=async()=>{const n=Date.now();if(Lh&&n-_1<Jj)return Lh;try{const t=await(await fetch(Yj)).json();return Lh=t,_1=n,t}catch(e){return console.error("Failed to fetch exchange rates:",e),Lh||{base:"TWD",rates:{TWD:1,JPY:.22,KRW:.043,USD:31.5,EUR:34.2}}}},Qj=async(n,e)=>{if(e==="TWD")return n;const i=(await Zj()).rates[e];return i?n/i:(console.warn(`Unknown currency: ${e}`),n)},$j=(n,e="TWD")=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:e==="TWD"?"TWD":e,minimumFractionDigits:0,maximumFractionDigits:0}).format(n),ok=()=>"webkitSpeechRecognition"in window||"SpeechRecognition"in window,$E=()=>"speechSynthesis"in window,Xj=(n="zh-TW",e,t)=>{if(!ok())return t==null||t(""),null;const i=window.webkitSpeechRecognition||window.SpeechRecognition,s=new i;return s.continuous=!1,s.interimResults=!1,s.lang=n,s.onresult=o=>{const l=o.results[0][0].transcript;e(l)},s.onerror=o=>{t==null||t(o.error)},s.start(),s},ak=(n,e="zh-TW",t)=>{if(!$E()){console.error("");return}window.speechSynthesis.cancel();const i=new SpeechSynthesisUtterance(n);i.lang=e,i.rate=1,i.pitch=1,i.volume=1,t&&(i.onend=t),window.speechSynthesis.speak(i)},eK=()=>{$E()&&window.speechSynthesis.cancel()},tK=async(n,e,t,i,s)=>new Promise((o,l)=>{Xj(n,async h=>{t==null||t(h);try{const p=await hN(h,e,n);p?(i==null||i(p),ak(p,e,()=>{o()})):(s==null||s(""),l("Translation failed"))}catch(p){s==null||s(p),l(p)}},h=>{s==null||s(h),l(h)})||l("Speech recognition not supported")}),up={recognition:ok(),synthesis:$E()};function nK({title:n,titleId:e,...t},i){return Z.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":e},t),n?Z.createElement("title",{id:e},n):null,Z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"}))}const iK=Z.forwardRef(nK);function sK({title:n,titleId:e,...t},i){return Z.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":e},t),n?Z.createElement("title",{id:e},n):null,Z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"}))}const rK=Z.forwardRef(sK);function oK({title:n,titleId:e,...t},i){return Z.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":e},t),n?Z.createElement("title",{id:e},n):null,Z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"}))}const y1=Z.forwardRef(oK);function aK({title:n,titleId:e,...t},i){return Z.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":e},t),n?Z.createElement("title",{id:e},n):null,Z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),Z.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 0 1 9 14.437V9.564Z"}))}const lK=Z.forwardRef(aK),uK=({defaultSourceLang:n="zh-TW",defaultTargetLang:e="en-US"})=>{const[t,i]=Z.useState(n),[s,o]=Z.useState(e),[l,d]=Z.useState(""),[h,p]=Z.useState(""),[T,x]=Z.useState(!1),[C,A]=Z.useState(!1),[D,F]=Z.useState(""),H=[{code:"zh-TW",name:""},{code:"en-US",name:"English"},{code:"ja-JP",name:""},{code:"ko-KR",name:""},{code:"th-TH",name:""}],X=async()=>{if(!up.recognition){F("");return}F(""),x(!0),d(""),p("");try{await tK(t,s,fe=>{d(fe)},fe=>{p(fe),A(!0)},fe=>{F(`${fe}`)})}catch(fe){console.error(fe)}finally{x(!1),A(!1)}},re=()=>{i(s),o(t),d(""),p("")},Q=(fe,Y)=>{if(!up.synthesis){F("");return}ak(fe,Y)},he=()=>{eK(),A(!1)};return _.jsxs("div",{className:"max-w-4xl mx-auto p-6 pt-12 bg-paper rounded-3xl shadow-float",children:[_.jsx("h2",{className:"text-2xl font-bold text-ink mb-6 text-center",children:" "}),_.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[_.jsx("select",{value:t,onChange:fe=>i(fe.target.value),className:"flex-1 p-3 rounded-xl border-2 border-sand bg-white text-ink font-medium focus:border-coral outline-none",children:H.map(fe=>_.jsx("option",{value:fe.code,children:fe.name},fe.code))}),_.jsx("button",{onClick:re,className:"p-3 rounded-full bg-coral text-white hover:bg-coralDark active:scale-95 transition-all",children:_.jsx(iK,{className:"w-5 h-5"})}),_.jsx("select",{value:s,onChange:fe=>o(fe.target.value),className:"flex-1 p-3 rounded-xl border-2 border-sand bg-white text-ink font-medium focus:border-coral outline-none",children:H.map(fe=>_.jsx("option",{value:fe.code,children:fe.name},fe.code))})]}),_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[_.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-sand min-h-[120px] flex flex-col",children:[_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:" ()"}),l&&_.jsx("button",{onClick:()=>Q(l,t),className:"p-1 text-coral hover:text-coralDark",children:_.jsx(y1,{className:"w-4 h-4"})})]}),_.jsx("textarea",{value:l,onChange:fe=>d(fe.target.value),placeholder:"...",className:"w-full flex-1 resize-none outline-none text-ink bg-transparent placeholder:text-gray-300"})]}),_.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-sand min-h-[120px]",children:[_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:""}),h&&_.jsx("button",{onClick:()=>Q(h,s),className:"p-1 text-coral hover:text-coralDark",children:_.jsx(y1,{className:"w-4 h-4"})})]}),_.jsx("p",{className:"text-ink whitespace-pre-wrap",children:h||"..."})]})]}),D&&_.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm",children:D}),_.jsxs("div",{className:"flex gap-3",children:[_.jsxs("button",{onClick:X,disabled:T||C,className:`flex-1 py-4 rounded-2xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${T?"bg-red-500 text-white animate-pulse":"bg-coral text-white hover:bg-coralDark active:scale-95"}`,children:[_.jsx(rK,{className:"w-6 h-6"}),T?"...":""]}),(T||C)&&_.jsxs("button",{onClick:he,className:"px-6 py-4 rounded-2xl font-bold bg-gray-500 text-white hover:bg-gray-600 active:scale-95 transition-all flex items-center gap-2",children:[_.jsx(lK,{className:"w-6 h-6"}),""]})]}),(!up.recognition||!up.synthesis)&&_.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-xl text-yellow-800 text-sm",children:"  ChromeEdge  Safari "})]})},cK=({onBack:n})=>_.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:""})]}),_.jsx("div",{className:"p-5 flex items-center justify-center h-full text-gray-400 text-center font-medium",children:_.jsx("p",{children:""})})]}),dK=({onBack:n,t:e,language:t,onOpenSettings:i})=>{var A,D,F,H,X,re;const[s,o]=Z.useState("Taiwan (ROC)"),[l,d]=Z.useState(""),[h,p]=Z.useState(null),[T,x]=Z.useState(!1),C=async()=>{if(l){x(!0),p(null);try{const Q=await oN(s,l,t);p(Q)}catch(Q){console.error(Q),p(null)}finally{x(!1)}}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_visa})]}),_.jsxs("div",{className:"p-5 space-y-4 overflow-y-auto flex-1 pb-32",children:[_.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-card space-y-5 border border-sand",children:[_.jsxs("div",{children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:""}),_.jsxs("select",{value:s,onChange:Q=>o(Q.target.value),className:"w-full mt-2 p-3 bg-paper rounded-xl text-ink font-medium border-none outline-none",children:[_.jsx("option",{value:"Taiwan (ROC)",children:" (Taiwan)"}),_.jsx("option",{value:"Japan",children:" (Japan)"}),_.jsx("option",{value:"USA",children:" (USA)"}),_.jsx("option",{value:"Hong Kong",children:" (Hong Kong)"})]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:""}),_.jsx("input",{value:l,onChange:Q=>d(Q.target.value),placeholder:"...",className:"w-full mt-2 p-3 bg-paper rounded-xl text-ink font-medium border-none outline-none"})]}),_.jsx("button",{onClick:C,disabled:T||!l,className:"w-full bg-coral text-white py-3.5 rounded-xl font-bold shadow-lg shadow-coral/30 disabled:opacity-50",children:T?e.loading:e.confirm})]}),h&&_.jsxs("div",{className:"space-y-4 animate-slide-up",children:[_.jsxs("div",{className:"bg-white p-4 rounded-3xl shadow-sm border border-sand flex justify-between items-center",children:[_.jsx("span",{className:"font-bold text-gray-500 text-sm uppercase",children:""}),_.jsx("span",{className:`px-4 py-1.5 rounded-full font-bold text-sm ${(A=h.difficulty)!=null&&A.includes("Easy")||(D=h.difficulty)!=null&&D.includes("")||(F=h.difficulty)!=null&&F.includes("")?"bg-green-100 text-green-600":(H=h.difficulty)!=null&&H.includes("Hard")||(X=h.difficulty)!=null&&X.includes("")?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:h.difficulty})]}),_.jsx("div",{className:"bg-ink text-white p-6 rounded-3xl shadow-lg",children:_.jsx("p",{className:"font-medium leading-relaxed",children:h.summary})}),_.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-card border border-sand",children:[_.jsxs("h4",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[_.jsx("span",{className:"w-2 h-6 bg-coral rounded-full"}),""]}),_.jsx("ul",{className:"space-y-3",children:(re=h.requirements)==null?void 0:re.map((Q,he)=>_.jsxs("li",{className:"flex gap-3 text-sm text-gray-600",children:[_.jsx("span",{className:"text-coral mt-0.5",children:""}),_.jsx("span",{className:"flex-1",children:Q})]},he))})]})]})]})]})},hK=({onBack:n,t:e,language:t,onOpenSettings:i})=>{var x,C;const[s,o]=Z.useState(""),[l,d]=Z.useState(null),[h,p]=Z.useState(!1),T=async()=>{p(!0),d(null);try{const D=await aN(s||"Kyoto, Japan",t);d(D)}catch(A){console.error(A)}finally{p(!1)}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_culture})]}),_.jsxs("div",{className:"p-5 flex-1 overflow-y-auto pb-32",children:[_.jsx("div",{className:"mb-4",children:_.jsx("input",{value:s,onChange:A=>o(A.target.value),placeholder:" ()...",className:"w-full p-4 bg-white rounded-2xl shadow-sm border border-sand font-medium text-ink outline-none"})}),_.jsx("button",{onClick:T,disabled:h,className:"w-full bg-orange-400 text-white px-4 py-3.5 rounded-2xl font-bold text-sm shadow-md mb-6",children:h?e.loading:e.confirm}),l&&_.jsxs("div",{className:"space-y-4 animate-slide-up",children:[_.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-sm border border-sand",children:[_.jsx("h4",{className:"font-bold text-orange-500 text-sm uppercase mb-2",children:" "}),_.jsx("p",{className:"text-ink text-sm leading-relaxed",children:l.tipping})]}),_.jsxs("div",{className:"bg-green-50 p-5 rounded-3xl border border-green-100",children:[_.jsx("h4",{className:"font-bold text-green-600 text-sm uppercase mb-3",children:" Do's ()"}),_.jsx("ul",{className:"space-y-2",children:(x=l.dos)==null?void 0:x.map((A,D)=>_.jsxs("li",{className:"flex gap-2 text-sm text-green-800",children:[_.jsx("span",{children:""}),_.jsx("span",{children:A})]},D))})]}),_.jsxs("div",{className:"bg-red-50 p-5 rounded-3xl border border-red-100",children:[_.jsx("h4",{className:"font-bold text-red-600 text-sm uppercase mb-3",children:" Don'ts ()"}),_.jsx("ul",{className:"space-y-2",children:(C=l.donts)==null?void 0:C.map((A,D)=>_.jsxs("li",{className:"flex gap-2 text-sm text-red-800",children:[_.jsx("span",{children:""}),_.jsx("span",{children:A})]},D))})]}),_.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-sm border border-sand",children:[_.jsx("h4",{className:"font-bold text-gray-400 text-sm uppercase mb-2",children:" "}),_.jsx("p",{className:"text-ink text-sm leading-relaxed",children:l.dressCode})]})]})]})]})},fK=({onBack:n,t:e})=>_.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_restroom})]}),_.jsx("div",{className:"flex-1 relative rounded-t-3xl overflow-hidden shadow-inner border-t border-sand",children:_.jsx("iframe",{width:"100%",height:"100%",style:{border:0},loading:"lazy",allowFullScreen:!0,src:"https://maps.google.com/maps?q=public+restroom&output=embed"})})]}),mK=({onBack:n,t:e,language:t,onOpenSettings:i})=>{var A;const[s,o]=Z.useState(""),[l,d]=Z.useState(null),[h,p]=Z.useState(null),[T,x]=Z.useState(!1),C=async()=>{if(s){x(!0),d(null),p(null);try{const D=await uN(s,t);D?d(D):p(" API Key ")}catch{p("")}finally{x(!1)}}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_emergency})]}),_.jsxs("div",{className:"p-5 flex-1 overflow-y-auto pb-32",children:[_.jsxs("div",{className:"bg-red-500 text-white p-6 rounded-3xl shadow-lg shadow-red-500/20 mb-6",children:[_.jsx("h2",{className:"text-xl font-bold mb-2",children:"SOS?"}),_.jsxs("p",{className:"opacity-90 text-sm",children:[": ",_.jsx("span",{className:"font-black text-2xl ml-1",children:"112"})]})]}),_.jsxs("div",{className:"space-y-3 mb-6",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase ml-1",children:""}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("input",{value:s,onChange:D=>o(D.target.value),onKeyDown:D=>D.key==="Enter"&&C(),placeholder:" ()...",className:"flex-1 p-4 bg-white rounded-2xl border border-sand shadow-sm outline-none font-bold text-ink"}),_.jsx("button",{onClick:C,disabled:T||!s,className:"px-6 bg-ink text-white rounded-2xl font-bold shadow-lg disabled:opacity-50",children:T?_.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Go"})]})]}),h&&_.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-3xl text-red-600 text-center font-medium animate-fade-in",children:[h,h.includes("API")&&_.jsx("button",{onClick:i,className:"mt-3 text-sm underline hover:text-red-800",children:""})]}),l&&_.jsxs("div",{className:"space-y-6 animate-slide-up",children:[_.jsxs("div",{className:"bg-white rounded-3xl shadow-card border border-sand overflow-hidden",children:[_.jsx("div",{className:"p-4 bg-gray-50 border-b border-sand",children:_.jsx("h4",{className:"font-bold text-gray-500 text-sm uppercase",children:""})}),_.jsx("div",{className:"divide-y divide-sand",children:(A=l.numbers)==null?void 0:A.map((D,F)=>_.jsxs("div",{className:"flex justify-between items-center p-4 hover:bg-gray-50 transition-colors",children:[_.jsx("span",{className:"font-bold text-ink",children:D.label}),_.jsx("a",{href:`tel:${D.number}`,className:"font-black text-xl text-coral bg-coral/10 px-3 py-1 rounded-lg hover:bg-coral hover:text-white transition-colors",children:D.number})]},F))})]}),l.hospital&&_.jsxs("div",{className:"bg-white rounded-3xl shadow-card border border-sand overflow-hidden",children:[_.jsx("div",{className:"p-4 bg-gray-50 border-b border-sand",children:_.jsx("h4",{className:"font-bold text-gray-500 text-sm uppercase",children:""})}),_.jsxs("div",{className:"p-5 space-y-3",children:[_.jsx("h3",{className:"text-lg font-black text-ink",children:l.hospital.name}),_.jsxs("div",{className:"flex items-start gap-3 text-sm text-gray-600",children:[_.jsx("span",{className:"shrink-0 text-xl",children:""}),_.jsx("span",{className:"font-medium leading-relaxed",children:l.hospital.address})]}),_.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[_.jsx("span",{className:"text-xl",children:""}),_.jsx("a",{href:`tel:${l.hospital.phone}`,className:"font-bold text-coral underline decoration-2 underline-offset-2",children:l.hospital.phone})]})]})]})]})]})]})},pK=({onBack:n,t:e,language:t,onOpenSettings:i})=>{var x,C;const[s,o]=Z.useState(""),[l,d]=Z.useState(null),[h,p]=Z.useState(!1),T=async()=>{if(s){p(!0),d(null);try{const A=await cN(s,t);d(A)}catch(A){console.error(A)}finally{p(!1)}}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_card})]}),_.jsxs("div",{className:"p-5 flex-1 overflow-y-auto pb-32",children:[_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase ml-1",children:""}),_.jsx("input",{value:s,onChange:A=>o(A.target.value),placeholder:" ()...",className:"w-full p-4 bg-white rounded-2xl border border-sand shadow-sm outline-none"}),_.jsx("button",{onClick:T,disabled:h||!s,className:"w-full py-3.5 bg-indigo-500 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200",children:h?e.loading:e.confirm})]}),l&&_.jsxs("div",{className:"space-y-4 mt-6 animate-slide-up",children:[_.jsxs("div",{className:"bg-indigo-50 p-5 rounded-3xl border border-indigo-100",children:[_.jsx("h4",{className:"font-bold text-indigo-600 text-sm uppercase mb-3",children:" "}),_.jsx("div",{className:"flex flex-wrap gap-2",children:(x=l.bestCards)==null?void 0:x.map((A,D)=>_.jsx("span",{className:"bg-white text-indigo-600 px-3 py-1 rounded-lg text-sm font-bold shadow-sm",children:A},D))})]}),_.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-sm border border-sand",children:[_.jsx("h4",{className:"font-bold text-gray-400 text-sm uppercase mb-2",children:" "}),_.jsx("p",{className:"text-ink text-sm leading-relaxed",children:l.cashInfo})]}),_.jsxs("div",{className:"bg-white p-5 rounded-3xl shadow-sm border border-sand",children:[_.jsx("h4",{className:"font-bold text-gray-400 text-sm uppercase mb-2",children:" "}),_.jsx("ul",{className:"space-y-2",children:(C=l.tips)==null?void 0:C.map((A,D)=>_.jsxs("li",{className:"flex gap-2 text-sm text-gray-600",children:[_.jsx("span",{className:"text-coral mt-0.5",children:""}),_.jsx("span",{children:A})]},D))})]})]})]})]})};let gK=Uu.icon({iconUrl:xN,shadowUrl:wN,iconSize:[25,41],iconAnchor:[12,41]});Uu.Marker.prototype.options.icon=gK;const v1={Japan:[36.2048,138.2529],Taiwan:[23.6978,120.9605],Thailand:[15.87,100.9925],USA:[37.0902,-95.7129],France:[46.2276,2.2137],"South Korea":[35.9078,127.7669],Vietnam:[14.0583,108.2772],China:[35.8617,104.1954],Germany:[51.1657,10.4515],Italy:[41.8719,12.5674],UK:[55.3781,-3.436],Spain:[40.4637,-3.7492],Australia:[-25.2744,133.7751],Canada:[56.1304,-106.3468],Singapore:[1.3521,103.8198],Malaysia:[4.2105,101.9758],Philippines:[12.8797,121.774],Indonesia:[-.7893,113.9213],India:[20.5937,78.9629],Russia:[61.524,105.3188],Brazil:[-14.235,-51.9253],Mexico:[23.6345,-102.5528],Egypt:[26.8206,30.8025],Turkey:[38.9637,35.2433],Netherlands:[52.1326,5.2913],Switzerland:[46.8182,8.2275],Austria:[47.5162,14.5501],Belgium:[50.5039,4.4699],Sweden:[60.1282,18.6435],Norway:[60.472,8.4689],Denmark:[56.2639,9.5018],Finland:[61.9241,25.7482],"New Zealand":[-40.9006,174.886],"Hong Kong":[22.3193,114.1694],Macau:[22.1987,113.5439]},_K=({onReady:n})=>{const e=Dg();return Z.useEffect(()=>{const t=setTimeout(()=>{e.invalidateSize(),n()},250);return()=>clearTimeout(t)},[e,n]),null},yK=({onBack:n,trips:e,t})=>{const[i,s]=Z.useState(new Set(["Japan","Thailand","Taiwan"])),[o,l]=Z.useState(""),[d,h]=Z.useState(!1);Z.useEffect(()=>{if(e){const x=new Set(i);e.forEach(C=>{(C.title.includes("")||C.title.includes("Japan")||C.title.includes("")||C.title.includes("")||C.title.includes("Tokyo"))&&x.add("Japan"),(C.title.includes("")||C.title.includes("Thailand")||C.title.includes(""))&&x.add("Thailand"),(C.title.includes("")||C.title.includes("Taiwan")||C.title.includes(""))&&x.add("Taiwan"),(C.title.includes("")||C.title.includes("USA"))&&x.add("USA"),(C.title.includes("")||C.title.includes("France")||C.title.includes("Paris"))&&x.add("France"),(C.title.includes("")||C.title.includes("Korea")||C.title.includes(""))&&x.add("South Korea"),(C.title.includes("")||C.title.includes("Vietnam"))&&x.add("Vietnam"),(C.title.includes("")||C.title.includes("China")||C.title.includes("")||C.title.includes(""))&&x.add("China"),(C.title.includes("")||C.title.includes("Hong Kong"))&&x.add("Hong Kong")}),s(x)}},[e]);const p=()=>{if(o.trim()){const x=o.trim(),C=Object.keys(v1).find(A=>A.toLowerCase()===x.toLowerCase());s(C?A=>new Set(A).add(C):A=>new Set(A).add(x)),l("")}},T=x=>{const C=new Set(i);C.delete(x),s(C)};return _.jsxs("div",{className:"flex flex-col h-full bg-[#111827] text-white",children:[_.jsx("div",{className:"bg-[#111827] p-4 pt-9 flex items-center justify-between sticky top-0 z-10 border-b border-gray-800",children:_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-300"})}),_.jsx("h3",{className:"font-bold text-lg",children:t.tool_map})]})}),_.jsxs("div",{className:"p-6 flex-1 overflow-y-auto pb-32",children:[_.jsxs("div",{className:"relative w-full aspect-[1.6] bg-[#1F2937] rounded-3xl overflow-hidden mb-8 shadow-2xl border border-gray-700",children:[_.jsxs(TN,{center:[20,0],zoom:2,style:{height:"100%",width:"100%",background:"#1F2937"},zoomControl:!1,attributionControl:!1,children:[_.jsx(EN,{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors  <a href="https://carto.com/attributions">CARTO</a>'}),_.jsx(_K,{onReady:()=>h(!0)}),Array.from(i).map(x=>{const C=v1[x];return C?_.jsx(cT,{position:C,icon:Uu.divIcon({className:"custom-div-icon",html:'<div style="background-color: #FF6B6B; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px #FF6B6B;"></div>',iconSize:[12,12],iconAnchor:[6,6]}),children:_.jsx(dT,{children:_.jsx("div",{className:"text-ink font-bold",children:x})})},x):null})]}),_.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center pointer-events-none",children:_.jsx("div",{className:"inline-block bg-black/50 backdrop-blur-sm px-3 py-1 rounded-full text-xs text-gray-400 font-mono tracking-widest border border-white/10",children:"[  ]"})})]}),_.jsxs("div",{className:"bg-[#1F2937] rounded-3xl p-6 shadow-lg border border-gray-700 mb-6",children:[_.jsxs("div",{className:"flex justify-between items-center mb-5",children:[_.jsxs("h4",{className:"font-bold text-gray-200",children:[" (",i.size,")"]}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("input",{value:o,onChange:x=>l(x.target.value),placeholder:" ()...",className:"bg-gray-800 border border-gray-600 rounded-lg px-3 py-1.5 text-sm text-white focus:outline-none focus:border-coral w-36 placeholder-gray-500"}),_.jsx("button",{onClick:p,className:"bg-coral p-1.5 rounded-lg text-white hover:bg-coralDark",children:_.jsx(Sg,{className:"w-4 h-4"})})]})]}),_.jsx("div",{className:"flex flex-wrap gap-3",children:Array.from(i).map(x=>_.jsxs("div",{className:"group relative px-4 py-2 bg-coral/10 text-coral rounded-xl text-sm font-bold border border-coral/20 flex items-center gap-2",children:[x," ",_.jsx("button",{onClick:()=>T(x),className:"opacity-0 group-hover:opacity-100 absolute -top-2 -right-2 bg-white text-coral rounded-full p-0.5 transition-opacity",children:_.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},x))})]})]})]})},vK=({onBack:n,t:e})=>{const[t,i]=Z.useState(""),[s,o]=Z.useState("USD"),[l,d]=Z.useState(null),[h,p]=Z.useState(!1),T=[{code:"USD",name:" (USD)"},{code:"JPY",name:" (JPY)"},{code:"KRW",name:" (KRW)"},{code:"EUR",name:" (EUR)"},{code:"CNY",name:" (CNY)"},{code:"THB",name:" (THB)"},{code:"VND",name:" (VND)"}],x=async()=>{if(t){p(!0);try{const C=parseFloat(t),A=await Qj(C,s);d($j(A))}catch{d("")}finally{p(!1)}}};return _.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:""})]}),_.jsxs("div",{className:"p-5 flex-1 overflow-y-auto pb-32",children:[_.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-card border border-sand space-y-5",children:[_.jsxs("div",{children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:""}),_.jsx("input",{type:"number",value:t,onChange:C=>i(C.target.value),placeholder:"...",className:"w-full mt-2 p-4 bg-paper rounded-2xl text-xl font-bold text-ink border-none outline-none"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase",children:""}),_.jsx("select",{value:s,onChange:C=>o(C.target.value),className:"w-full mt-2 p-4 bg-paper rounded-2xl text-ink font-medium border-none outline-none",children:T.map(C=>_.jsx("option",{value:C.code,children:C.name},C.code))})]}),_.jsx("button",{onClick:x,disabled:h||!t,className:"w-full bg-green-500 text-white py-4 rounded-2xl font-bold shadow-lg shadow-green-500/30 disabled:opacity-50 active:scale-95 transition-all",children:h?"...":" (TWD)"})]}),l&&_.jsxs("div",{className:"mt-6 bg-white p-6 rounded-3xl shadow-card border border-sand text-center animate-fade-in",children:[_.jsx("p",{className:"text-gray-400 text-sm font-medium mb-1",children:""}),_.jsx("p",{className:"text-3xl font-black text-ink",children:l})]})]})]})},TK=({onBack:n,t:e,language:t})=>_.jsxs("div",{className:"flex flex-col h-full bg-paper",children:[_.jsxs("div",{className:"bg-paper p-4 pt-9 flex items-center gap-2 sticky top-0 z-10",children:[_.jsx("button",{onClick:n,children:_.jsx(vs,{className:"w-6 h-6 text-gray-500"})}),_.jsx("h3",{className:"font-bold text-lg text-ink",children:e.tool_translation||"Translation"})]}),_.jsx("div",{className:"flex-1 overflow-y-auto pb-32",children:_.jsx(uK,{defaultSourceLang:t})})]}),EK=({onBack:n,trips:e,settings:t,onMagicEditor:i,onOpenSettings:s})=>{const[o,l]=Z.useState("MENU"),d=nn[t.language]||nn["zh-TW"];if(o==="EXPENSE")return _.jsx(cK,{onBack:()=>l("MENU")});if(o==="VISA")return _.jsx(dK,{onBack:()=>l("MENU"),t:d,language:t.language,onOpenSettings:s});if(o==="CULTURE")return _.jsx(hK,{onBack:()=>l("MENU"),t:d,language:t.language,onOpenSettings:s});if(o==="RESTROOM")return _.jsx(fK,{onBack:()=>l("MENU"),t:d});if(o==="SCRATCH_MAP")return _.jsx(yK,{onBack:()=>l("MENU"),trips:e,t:d});if(o==="EMERGENCY")return _.jsx(mK,{onBack:()=>l("MENU"),t:d,language:t.language,onOpenSettings:s});if(o==="CARD_ADVICE")return _.jsx(pK,{onBack:()=>l("MENU"),t:d,language:t.language,onOpenSettings:s});if(o==="TIME_CAPSULE")return _.jsx("div",{onClick:()=>l("MENU"),children:"Coming Soon"});if(o==="TRANSLATION")return _.jsx(TK,{onBack:()=>l("MENU"),t:d,language:t.language});if(o==="CURRENCY")return _.jsx(vK,{onBack:()=>l("MENU"),t:d});const h=[{id:"MAGIC_EDITOR",name:"",icon:Xa,color:"text-pink-500",bg:"bg-pink-50",desc:"AI ",action:i},{id:"CURRENCY",name:"",icon:C1,color:"text-green-500",bg:"bg-green-50",desc:""},{id:"TRANSLATION",name:d.tool_translation,icon:WD,color:"text-purple-500",bg:"bg-purple-50",desc:d.desc_translator},{id:"EMERGENCY",name:d.tool_emergency,icon:jD,color:"text-red-500",bg:"bg-red-50",desc:d.desc_emergency},{id:"CARD_ADVICE",name:d.tool_card,icon:KD,color:"text-indigo-500",bg:"bg-indigo-50",desc:d.desc_card},{id:"SCRATCH_MAP",name:d.tool_map,icon:GD,color:"text-teal-500",bg:"bg-teal-50",desc:d.desc_map},{id:"RESTROOM",name:d.tool_restroom,icon:qD,color:"text-cyan-500",bg:"bg-cyan-50",desc:d.desc_restroom},{id:"VISA",name:d.tool_visa,icon:zD,color:"text-blue-500",bg:"bg-blue-50",desc:d.desc_visa},{id:"CULTURE",name:d.tool_culture,icon:Ov,color:"text-orange-500",bg:"bg-orange-50",desc:d.desc_culture}];return _.jsxs("div",{className:"flex flex-col h-full bg-paper pt-safe",children:[_.jsx("div",{className:"px-5 py-4 pt-9 bg-paper sticky top-0 z-10 flex items-center justify-between border-b border-sand/50",children:_.jsxs("h2",{className:"text-xl font-extrabold text-ink flex items-center gap-2",children:[_.jsx(Z0,{className:"w-6 h-6 text-coral"}),d.tools_title]})}),_.jsx("div",{className:"p-5 grid grid-cols-2 gap-4 pb-32 overflow-y-auto",children:h.map(p=>_.jsxs("div",{onClick:()=>p.action?p.action():l(p.id),className:"bg-white p-5 rounded-3xl shadow-card border border-sand active:scale-95 transition-all cursor-pointer hover:shadow-soft hover:border-coral group",children:[_.jsx("div",{className:`w-12 h-12 ${p.bg} ${p.color} rounded-2xl flex items-center justify-center mb-4 transition-transform group-hover:scale-110`,children:_.jsx(p.icon,{className:"w-6 h-6 stroke-2"})}),_.jsx("h3",{className:"font-bold text-ink mb-1",children:p.name}),_.jsx("p",{className:"text-xs text-gray-400 font-medium",children:p.desc})]},p.id))})]})},xK=({onBack:n,settings:e,onUpdateSettings:t,onResetApp:i,user:s,onLogout:o})=>{const[l,d]=Z.useState(!1),[h,p]=Z.useState(!1),T=nn[e.language]||nn["zh-TW"];Z.useEffect(()=>{const A=localStorage.getItem("nomad_user_api_key");A&&!e.apiKey&&(t({apiKey:A}),localStorage.removeItem("nomad_user_api_key"))},[]);const x=A=>{t({apiKey:A}),localStorage.setItem("geminiApiKey",A),A&&(p(!0),setTimeout(()=>p(!1),2e3))},C=[{name:"",value:"#FF6B6B"},{name:"",value:"#4ECDC4"},{name:"",value:"#FFE66D"},{name:"",value:"#A06CD5"},{name:"",value:"#6BCB77"}];return _.jsxs("div",{className:"h-full flex flex-col bg-paper animate-slide-in",children:[_.jsxs("div",{className:"px-6 py-6 flex items-center justify-between bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-sand",children:[_.jsx("button",{onClick:n,className:"p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors",children:_.jsx(vs,{className:"w-6 h-6 text-ink"})}),_.jsx("h1",{className:"text-xl font-bold text-ink",children:""}),_.jsx("div",{className:"w-10"})]}),_.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[s&&_.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sand",children:[_.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider",children:""}),_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{children:[_.jsx("p",{className:"text-lg font-bold text-ink",children:s.username}),_.jsxs("p",{className:"text-xs text-gray-400",children:["ID: ",s.id]})]}),_.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-xl transition-colors text-sm font-medium",children:[_.jsx(QD,{className:"w-4 h-4"}),""]})]})]}),_.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sand",children:[_.jsxs("h2",{className:"text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider flex items-center gap-2",children:[_.jsx($D,{className:"w-4 h-4"}),T.api_settings||"API "]}),_.jsxs("div",{className:"space-y-3",children:[_.jsx("label",{className:"text-sm font-bold text-ink",children:T.api_key_label||"Gemini API Key"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:"password",value:e.apiKey||"",onChange:A=>x(A.target.value),placeholder:T.api_key_placeholder||" API Key",className:"w-full p-4 pr-20 bg-gray-50 rounded-xl border border-gray-200 focus:border-coral focus:ring-2 focus:ring-coral/20 outline-none transition-all font-mono text-sm"}),h&&_.jsx("div",{className:"text-right mt-1",children:_.jsx("span",{className:"text-green-500 text-xs font-bold animate-fade-in",children:T.api_key_saved||""})})]}),_.jsxs("p",{className:"text-xs text-gray-400 leading-relaxed",children:[T.api_key_help||" Key ",_.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-coral hover:underline ml-1",children:" Key"})]})]})]}),_.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sand",children:[_.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider",children:""}),_.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:[C.map(A=>_.jsx("button",{onClick:()=>t({themeColor:A.value}),className:`w-10 h-10 rounded-full flex-shrink-0 transition-transform ${e.themeColor===A.value?"scale-110 ring-2 ring-offset-2 ring-gray-300":"hover:scale-105"}`,style:{backgroundColor:A.value},"aria-label":A.name},A.value)),_.jsx("button",{onClick:()=>t({themeColor:void 0}),className:`w-10 h-10 rounded-full flex-shrink-0 bg-coral flex items-center justify-center text-white text-xs font-bold transition-transform ${e.themeColor?"hover:scale-105":"scale-110 ring-2 ring-offset-2 ring-gray-300"}`,children:""})]})]}),_.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sand",children:[_.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider",children:""}),_.jsx("div",{className:"space-y-2",children:[{code:"zh-TW",label:""},{code:"en-US",label:"English"},{code:"ja-JP",label:""}].map(A=>_.jsxs("button",{onClick:()=>t({language:A.code}),className:`w-full flex items-center justify-between p-3 rounded-xl transition-colors ${e.language===A.code?"bg-coral/10 text-coral font-bold":"hover:bg-gray-50 text-ink"}`,children:[_.jsx("span",{children:A.label}),e.language===A.code&&_.jsx("div",{className:"w-2 h-2 rounded-full bg-coral"})]},A.code))})]}),_.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sand",children:[_.jsx("h2",{className:"text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider",children:""}),l?_.jsxs("div",{className:"space-y-3 animate-fade-in",children:[_.jsx("p",{className:"text-center text-sm text-red-500 font-medium",children:""}),_.jsxs("div",{className:"flex gap-3",children:[_.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-bold",children:""}),_.jsx("button",{onClick:()=>{i(),d(!1)},className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-bold shadow-lg shadow-red-500/30",children:""})]})]}):_.jsxs("button",{onClick:()=>d(!0),className:"w-full flex items-center justify-center gap-2 p-4 border-2 border-red-100 text-red-500 rounded-xl hover:bg-red-50 transition-colors font-bold",children:[_.jsx(al,{className:"w-5 h-5"}),""]})]}),_.jsxs("div",{className:"text-center text-xs text-gray-400 py-4",children:[_.jsx("p",{children:"NomadAI Travel Journal v1.0.0"}),_.jsx("p",{className:"mt-1",children:"Made with  by NomadAI Team"})]})]})]})},wK=({onLogin:n})=>{const[e,t]=Z.useState(""),[i,s]=Z.useState(!1),o=async()=>{console.log("Attempting Google Login..."),s(!0),t("");try{const l=await sB(W0,qj);console.log("Google Login Success:",l.user.uid)}catch(l){console.error("Login failed",l),t(l.message||"")}finally{s(!1)}};return _.jsx("div",{className:"h-full flex flex-col items-center justify-center p-6 bg-paper",children:_.jsxs("div",{className:"w-full max-w-sm bg-white rounded-3xl shadow-card p-8 border border-sand text-center",children:[_.jsxs("div",{className:"flex flex-col items-center mb-8",children:[_.jsx("div",{className:"w-16 h-16 bg-coral rounded-2xl flex items-center justify-center mb-4 shadow-lg shadow-coral/30",children:_.jsx(Xa,{className:"w-8 h-8 text-white"})}),_.jsx("h1",{className:"text-2xl font-bold text-ink",children:"Ques-trip"}),_.jsx("p",{className:"text-gray-400 text-sm mt-2",children:""})]}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("button",{id:"google-login-btn",onClick:o,disabled:i,className:"w-full bg-white border border-gray-300 text-gray-700 py-3.5 rounded-xl font-bold shadow-sm hover:bg-gray-50 active:scale-95 transition-all flex items-center justify-center gap-3",children:[i?_.jsx("div",{className:"w-5 h-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):_.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[_.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),_.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),_.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z",fill:"#FBBC05"}),_.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]})," Google "]}),e&&_.jsx("div",{className:"text-red-500 text-sm font-medium bg-red-50 p-2 rounded-lg",children:e})]})]})})},SK=({memories:n,onAddMemory:e,onDeleteMemory:t,settings:i})=>{const[s,o]=Z.useState(""),[l,d]=Z.useState(null),h=Z.useRef(null),p=async x=>{var A;const C=(A=x.target.files)==null?void 0:A[0];if(C)try{const{compressImage:D}=await Ng(async()=>{const{compressImage:H}=await import("./image-CYcWJ_KT.js");return{compressImage:H}},[]),F=await D(C);d(F)}catch(D){console.error("Image compression failed",D),alert("")}},T=x=>{if(x.preventDefault(),!l)return;const C={id:Date.now().toString(),userId:"",imageUrl:l,caption:s,date:new Date().toISOString()};e(C),o(""),d(null),h.current&&(h.current.value="")};return _.jsxs("div",{className:"h-full flex flex-col bg-paper animate-slide-in pb-24",children:[_.jsxs("div",{className:"px-6 py-6 bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-sand pt-safe pt-12",children:[_.jsxs("h1",{className:"text-2xl font-bold text-ink flex items-center gap-2",children:[_.jsx(Xc,{className:"w-8 h-8 text-coral"}),""]}),_.jsx("p",{className:"text-sm text-gray-400 mt-1",children:""})]}),_.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[_.jsx("div",{className:"bg-white rounded-3xl p-6 shadow-card border border-sand",children:_.jsxs("form",{onSubmit:T,className:"space-y-4",children:[_.jsxs("div",{onClick:()=>{var x;return(x=h.current)==null?void 0:x.click()},className:`relative w-full aspect-video rounded-2xl border-2 border-dashed border-sand flex flex-col items-center justify-center cursor-pointer transition-all hover:bg-gray-50 ${l?"border-none p-0 overflow-hidden":""}`,children:[l?_.jsx("img",{src:l,alt:"Preview",className:"w-full h-full object-cover"}):_.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[_.jsx(Xc,{className:"w-12 h-12 mb-2"}),_.jsx("span",{className:"font-medium",children:""})]}),_.jsx("input",{type:"file",ref:h,onChange:p,accept:"image/*",className:"hidden"})]}),_.jsx("textarea",{value:s,onChange:x=>o(x.target.value),placeholder:"...",className:"w-full bg-paper rounded-xl p-4 text-ink font-medium outline-none focus:ring-2 focus:ring-coral/50 transition-all border border-sand resize-none h-24"}),_.jsxs("button",{type:"submit",disabled:!l,className:`w-full py-3.5 rounded-xl font-bold shadow-lg transition-all flex items-center justify-center gap-2 ${l?"bg-coral text-white shadow-coral/30 active:scale-95":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[_.jsx(Sg,{className:"w-5 h-5"}),""]})]})}),_.jsx("div",{className:"grid grid-cols-1 gap-6",children:n.length===0?_.jsxs("div",{className:"text-center py-12 text-gray-400",children:[_.jsx("p",{children:""}),_.jsx("p",{className:"text-sm mt-2",children:""})]}):n.map(x=>_.jsxs("div",{className:"bg-white rounded-3xl overflow-hidden shadow-card border border-sand group",children:[_.jsxs("div",{className:"relative aspect-video",children:[_.jsx("img",{src:x.imageUrl,alt:x.caption,className:"w-full h-full object-cover"}),_.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-end p-4",children:_.jsx("button",{onClick:()=>t(x.id),className:"p-2 bg-white/20 backdrop-blur-md text-white rounded-full hover:bg-red-500 transition-colors",children:_.jsx(al,{className:"w-5 h-5"})})})]}),_.jsxs("div",{className:"p-5",children:[_.jsx("p",{className:"text-ink font-medium whitespace-pre-wrap",children:x.caption}),_.jsx("p",{className:"text-xs text-gray-400 mt-3",children:new Date(x.date).toLocaleDateString()})]})]},x.id))})]})]})};function CK(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:i,onRegistered:s,onRegisteredSW:o,onRegisterError:l}=n;let d,h;const p=async(x=!0)=>{await h};async function T(){if("serviceWorker"in navigator){if(d=await Ng(async()=>{const{Workbox:x}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:x}},[]).then(({Workbox:x})=>new x("/sw.js",{scope:"/",type:"classic"})).catch(x=>{l==null||l(x)}),!d)return;d.addEventListener("activated",x=>{(x.isUpdate||x.isExternal)&&window.location.reload()}),d.addEventListener("installed",x=>{x.isUpdate||i==null||i()}),d.register({immediate:e}).then(x=>{o?o("/sw.js",x):s==null||s(x)}).catch(x=>{l==null||l(x)})}}return h=T(),p}function bK(n={}){const{immediate:e=!0,onNeedRefresh:t,onOfflineReady:i,onRegistered:s,onRegisteredSW:o,onRegisterError:l}=n,[d,h]=Z.useState(!1),[p,T]=Z.useState(!1),[x]=Z.useState(()=>CK({immediate:e,onOfflineReady(){T(!0),i==null||i()},onNeedRefresh(){h(!0),t==null||t()},onRegistered:s,onRegisteredSW:o,onRegisterError:l}));return{needRefresh:[d,h],offlineReady:[p,T],updateServiceWorker:x}}const IK=({settings:n})=>{n&&nn[n.language]||nn["zh-TW"];const{offlineReady:[e,t],needRefresh:[i,s],updateServiceWorker:o}=bK({onRegistered(d){console.log("SW Registered: "+d)},onRegisterError(d){console.log("SW registration error",d)}}),l=()=>{t(!1),s(!1)};return!e&&!i?null:_.jsxs("div",{className:"fixed bottom-6 right-6 z-[1000] p-4 bg-ink text-white rounded-xl shadow-2xl animate-slide-up max-w-xs border border-white/10",children:[_.jsx("div",{className:"mb-3 font-bold",children:e?_.jsx("span",{children:"App ready to work offline"}):_.jsx("span",{children:"New content available, click on reload button to update."})}),_.jsxs("div",{className:"flex gap-2",children:[i&&_.jsx("button",{className:"flex-1 px-3 py-2 bg-coral text-white rounded-lg font-bold text-sm hover:bg-coralDark transition-colors",onClick:()=>o(!0),children:"Reload"}),_.jsx("button",{className:"flex-1 px-3 py-2 bg-white/10 text-white rounded-lg font-bold text-sm hover:bg-white/20 transition-colors",onClick:l,children:"Close"})]})]})},AK=()=>{const[n,e]=Z.useState(!1);return Z.useEffect(()=>{const t=()=>e(!1),i=()=>e(!0);window.addEventListener("online",t),window.addEventListener("offline",i);const s=Hj();return e(!navigator.onLine),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i),s()}},[]),n?_.jsx("div",{className:"fixed bottom-24 left-1/2 -translate-x-1/2 z-50 animate-fade-in",children:_.jsxs("div",{className:"bg-gray-800/90 backdrop-blur text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 text-sm font-bold",children:[_.jsx(BD,{className:"w-4 h-4 text-gray-400"}),_.jsx("span",{children:""})]})}):null},NK={USERS:"nomad_app_users_v1",CURRENT_USER:"nomad_app_current_user_v1",getTripsKey:n=>`nomad_app_trips_${n} `,getSettingsKey:n=>`nomad_app_settings_${n} `,getMemoriesKey:n=>`nomad_app_memories_${n} `,getChatSessionsKey:n=>`nomad_app_chat_sessions_${n} `},RK=()=>{console.log("App Component Rendering...");const[n,e]=Z.useState({id:"test-user-id",username:"Test User",password:"",createdAt:new Date().toISOString()}),[t,i]=Z.useState([]),[s,o]=Z.useState([]),[l,d]=Z.useState([]),[h,p]=Z.useState(null),[T,x]=Z.useState({language:"zh-TW",minimalistMode:!1}),[C,A]=Z.useState(!0),[D,F]=Z.useState(null),[H,X]=Z.useState(ot.HOME),[re,Q]=Z.useState(null),[he,fe]=Z.useState([]);Z.useEffect(()=>{console.log("Setting up Auth Listener...");const le=O9(W0,ge=>{if(console.log("Auth State Changed:",ge?"User Logged In":"User Logged Out",ge==null?void 0:ge.uid),ge){const we={id:ge.uid,username:ge.displayName||"Traveler",email:ge.email||"",password:"",createdAt:ge.metadata.creationTime||new Date().toISOString()};e(we),(async()=>{try{const Yt=tf(Uo,"users",ge.uid);await Cq(Yt,{uid:ge.uid,email:ge.email,username:ge.displayName||"Traveler",lastSeen:DA()},{merge:!0})}catch(Yt){console.error("Error syncing user:",Yt)}})(),console.log("Listening to trips for user:",ge.uid);const Fe=P0(Ip(Uo,"itineraries"),k0("userIds","array-contains",ge.uid)),Ye=P0(Ip(Uo,"itineraries"),k0("uid","==",ge.uid));Rh(Fe,Yt=>{}),Rh(Fe,Yt=>{const Rt=[];Yt.forEach(Se=>{Rt.push({id:Se.id,...Se.data()})});const Mt=Rh(Ye,Se=>{const Qe=new Map;Rt.forEach(ke=>Qe.set(ke.id,ke)),Se.forEach(ke=>{const He=ke.data(),mt={id:ke.id,...He};mt.userIds||(console.log("Migrating legacy trip:",mt.id),Np(ke.ref,{userIds:[ge.uid],collaborators:[]}).catch(lt=>console.error("Migration failed",lt))),Qe.set(mt.id,mt)});const _e=Array.from(Qe.values());_e.sort((ke,He)=>{const mt=ke.createdAt?typeof ke.createdAt=="string"?new Date(ke.createdAt).getTime():ke.createdAt.toMillis?ke.createdAt.toMillis():0:0;return(He.createdAt?typeof He.createdAt=="string"?new Date(He.createdAt).getTime():He.createdAt.toMillis?He.createdAt.toMillis():0:0)-mt}),i(_e),A(!0),F(null)});return()=>Mt()});let Nt=[],Jt=[];const ct=()=>{const Yt=new Map;Nt.forEach(Mt=>Yt.set(Mt.id,Mt)),Jt.forEach(Mt=>Yt.set(Mt.id,Mt));const Rt=Array.from(Yt.values());Rt.sort((Mt,Se)=>{const Qe=Mt.createdAt?typeof Mt.createdAt=="string"?new Date(Mt.createdAt).getTime():Mt.createdAt.toMillis?Mt.createdAt.toMillis():0:0;return(Se.createdAt?typeof Se.createdAt=="string"?new Date(Se.createdAt).getTime():Se.createdAt.toMillis?Se.createdAt.toMillis():0:0)-Qe}),i(Rt),A(!0)},mn=Rh(Fe,Yt=>{Nt=[],Yt.forEach(Rt=>{Nt.push({id:Rt.id,...Rt.data()})}),ct()}),Rn=Rh(Ye,Yt=>{Jt=[],Yt.forEach(Rt=>{const Mt=Rt.data();Mt.userIds||(console.log("Migrating legacy trip:",Rt.id),Np(Rt.ref,{userIds:[ge.uid],collaborators:[]}),Jt.push({id:Rt.id,...Mt}))}),ct()});return()=>{mn(),Rn()}}else e(null),i([]),A(!0)});return()=>le()},[]);const Y=async le=>{if(n)try{const{id:ge,...we}=le;await Iq(Ip(Uo,"itineraries"),{...we,...we,uid:n.id,userIds:[n.id],collaborators:[],createdAt:DA()}),H===ot.AI_PLANNER&&X(ot.HOME)}catch(ge){console.error("Error adding trip",ge),F(`Add Trip Error: ${ge.message}`),alert(": "+ge.message)}},k=async le=>{if(!(!n||!le.id))try{const ge=tf(Uo,"itineraries",le.id),{id:we,...Ke}=le;await Np(ge,Ke),(re==null?void 0:re.id)===le.id&&Q(le)}catch(ge){console.error("Error updating trip",ge),alert("")}},B=async le=>{try{await bq(tf(Uo,"itineraries",le)),(re==null?void 0:re.id)===le&&(Q(null),X(ot.HOME))}catch(ge){console.error("Error deleting trip",ge),alert("")}},O=Z.useCallback(async(le,ge)=>{var Ke;console.log("Starting background generation...",{userPrompt:le,tripId:ge});const we=Date.now().toString();fe(Fe=>[...Fe,we]);try{let Fe,Ye=null;ge&&(Ye=t.find(ct=>ct.id===ge)),Ye?(console.log("Updating existing trip:",Ye.title),Fe=await rN(Ye,le,T.language),console.log("Updated Trip Plan:",Fe)):(console.log("Generating new trip..."),Fe=await sN(le,T.language),console.log("New Trip Plan:",Fe));let Nt=Fe.coverImage||(Ye==null?void 0:Ye.coverImage);if(!Nt)try{const ct=Fe.title||le;Nt=await rT(ct)}catch(ct){console.error("Failed to generate cover image:",ct),Nt=`https://placehold.co/800x600/e2e8f0/475569?text=${encodeURIComponent(((Ke=Fe.title)==null?void 0:Ke.split(" ")[0])||"Travel")}`}!Fe.itinerary||Fe.itinerary.length===0?console.warn("AI returned empty itinerary:",Fe):Fe.itinerary=Fe.itinerary.map(ct=>({...ct,day:Number(ct.day)||1,id:ct.id||Math.random().toString(36).substr(2,9),time:ct.time||"09:00",activity:ct.activity||"New Activity",location:ct.location||"",notes:ct.notes||""}));let Jt;return Ye?(Jt={...Ye,...Fe,id:Ye.id,coverImage:Nt},k(Jt)):(Jt={...Fe,id:we,coverImage:Nt,bookings:[],budget:Fe.budget||{total:0,currency:"TWD",expenses:[]},weather:Fe.weather||[]},Y(Jt)),fe(ct=>ct.filter(mn=>mn!==we)),{title:Jt.title,tripId:Jt.id}}catch(Fe){return console.error("Background generation failed",Fe),fe(Ye=>Ye.filter(Nt=>Nt!==we)),null}},[t,T.language]),q=le=>{x(ge=>({...ge,...le}))},G=()=>{n&&W()},W=async()=>{try{await U9(W0),X(ot.HOME),Q(null)}catch(le){console.error("Logout failed",le)}},z=()=>{},Ge=()=>{},$e=le=>{o([le,...s])},se=le=>{o(s.filter(ge=>ge.id!==le))},Ce=()=>{const le={id:Date.now().toString(),title:T.language==="zh-TW"?"":"New Chat",messages:[],createdAt:Date.now(),updatedAt:Date.now()};return d(ge=>[le,...ge]),p(le.id),le.id},be=(le,ge,we,Ke)=>{d(Fe=>Fe.map(Ye=>{if(Ye.id===le){let Nt=Ye.title;if(we)Nt=we;else if(!Ye.messages.some(ct=>ct.role==="user")){const ct=ge.find(mn=>mn.role==="user");ct&&(Nt=ct.content.slice(0,20)+(ct.content.length>20?"...":""))}return{...Ye,messages:ge,title:Nt,tripId:Ke||Ye.tripId,updatedAt:Date.now()}}return Ye}))},it=le=>{d(ge=>ge.filter(we=>we.id!==le)),h===le&&p(null)},Pe=le=>{p(le)};if(Z.useEffect(()=>{const le=document.getElementById("loading-screen");le?(console.log("Removing loading screen..."),le.style.opacity="0",setTimeout(()=>le.remove(),500)):console.log("Loading screen not found (already removed?)")},[]),Z.useEffect(()=>{if(n&&C)try{localStorage.setItem(NK.getSettingsKey(n.id),JSON.stringify(T))}catch(le){console.error("Failed to save settings",le)}T.themeColor?document.documentElement.style.setProperty("--color-coral",T.themeColor):document.documentElement.style.removeProperty("--color-coral")},[T,n,C]),!n)return _.jsx(wK,{onLogin:z,onRegister:Ge});const K=le=>{const ge=l.find(we=>we.tripId===le);if(ge)p(ge.id);else{const we=Ce();d(Ke=>Ke.map(Fe=>{var Ye;return Fe.id===we?{...Fe,tripId:le,title:`${((Ye=t.find(Nt=>Nt.id===le))==null?void 0:Ye.title)||"Trip"} Planning`}:Fe}))}X(ot.AI_PLANNER)},me=()=>{switch(H){case ot.HOME:return _.jsx(t5,{trips:t,onSelectTrip:le=>{Q(le),X(ot.TRIP_DETAILS)},onAddTrip:()=>X(ot.ADD_TRIP),onOpenSettings:()=>X(ot.SETTINGS),settings:T});case ot.ADD_TRIP:return _.jsx(P6,{onSave:le=>{Y(le),X(ot.HOME)},onCancel:()=>X(ot.HOME),settings:T,currentUser:n});case ot.MAGIC_EDITOR:return _.jsx(k6,{settings:T,onBack:()=>X(ot.TOOLS)});case ot.TRIP_MEMORY:return _.jsx(SK,{memories:s,onAddMemory:$e,onDeleteMemory:se,settings:T});case ot.AI_PLANNER:return _.jsx(Wj,{onStartGeneration:O,onCancel:()=>X(ot.HOME),settings:T,sessions:l,currentSessionId:h,onCreateSession:Ce,onUpdateSession:be,onDeleteSession:it,onSelectSession:Pe});case ot.TOOLS:return _.jsx(EK,{onBack:()=>X(ot.HOME),trips:t,settings:T,onMagicEditor:()=>X(ot.MAGIC_EDITOR),onOpenSettings:()=>X(ot.SETTINGS)});case ot.TRIP_DETAILS:return re?_.jsx(Kj,{trip:re,onBack:()=>X(ot.HOME),onDelete:B,onUpdateTrip:k,onOpenAI:K,settings:T,user:n}):null;case ot.SETTINGS:return _.jsx(xK,{onBack:()=>X(ot.HOME),settings:T,onUpdateSettings:q,onResetApp:G,user:n,onLogout:W});default:return null}},Ie=[ot.HOME,ot.TRIP_MEMORY,ot.TOOLS,ot.AI_PLANNER].includes(H);return _.jsxs("div",{className:"h-full w-full max-w-md mx-auto bg-paper shadow-2xl relative overflow-hidden flex flex-col font-sans text-ink",children:[D&&_.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 relative",role:"alert",children:[_.jsx("strong",{className:"font-bold",children:"Error: "}),_.jsx("span",{className:"block sm:inline",children:D}),_.jsx("span",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>F(null),children:_.jsxs("svg",{className:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:[_.jsx("title",{children:"Close"}),_.jsx("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})]})})]}),_.jsx("div",{className:"flex-1 overflow-hidden relative bg-paper",children:me()}),Ie&&_.jsx("div",{className:"absolute bottom-6 left-4 right-4 z-40",children:_.jsxs("div",{className:"bg-white/90 backdrop-blur-xl border border-white/50 shadow-float rounded-3xl px-2 py-3 flex justify-around items-center",children:[_.jsxs("button",{onClick:()=>X(ot.HOME),className:`flex flex-col items-center gap-1 p-2 rounded-2xl transition-all w-16 ${H===ot.HOME?"text-coral scale-105":"text-gray-400 hover:text-gray-600"}`,children:[_.jsx(VD,{className:`w-6 h-6 ${H===ot.HOME?"stroke-2":"stroke-[1.5]"}`}),H===ot.HOME&&_.jsx("span",{className:"w-1 h-1 bg-coral rounded-full mt-1"})]}),_.jsxs("button",{onClick:()=>X(ot.AI_PLANNER),className:`relative flex flex-col items-center gap-1 p-2 rounded-2xl transition-all w-16 ${H===ot.AI_PLANNER?"text-coral scale-105":"text-gray-400 hover:text-gray-600"}`,children:[_.jsxs("div",{className:"relative",children:[_.jsx(S1,{className:`w-6 h-6 ${H===ot.AI_PLANNER?"stroke-2":"stroke-[1.5]"}`}),(he==null?void 0:he.length)>0&&_.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-coral rounded-full animate-ping"}),(he==null?void 0:he.length)>0&&_.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-coral rounded-full border-2 border-white"})]}),H===ot.AI_PLANNER&&_.jsx("span",{className:"w-1 h-1 bg-coral rounded-full mt-1"})]}),_.jsxs("button",{onClick:()=>X(ot.TRIP_MEMORY),className:`flex flex-col items-center gap-1 p-2 rounded-2xl transition-all w-16 ${H===ot.TRIP_MEMORY?"text-coral scale-105":"text-gray-400 hover:text-gray-600"}`,children:[_.jsx(Xc,{className:`w-6 h-6 ${H===ot.TRIP_MEMORY?"stroke-2":"stroke-[1.5]"}`}),H===ot.TRIP_MEMORY&&_.jsx("span",{className:"w-1 h-1 bg-coral rounded-full mt-1"})]}),_.jsxs("button",{onClick:()=>X(ot.TOOLS),className:`flex flex-col items-center gap-1 p-2 rounded-2xl transition-all w-16 ${H===ot.TOOLS?"text-coral scale-105":"text-gray-400 hover:text-gray-600"}`,children:[_.jsx(Z0,{className:`w-6 h-6 ${H===ot.TOOLS?"stroke-2":"stroke-[1.5]"}`}),H===ot.TOOLS&&_.jsx("span",{className:"w-1 h-1 bg-coral rounded-full mt-1"})]})]})}),_.jsx(IK,{settings:T}),_.jsx(AK,{})]})};console.log("NomadAI App Starting...");const lk=document.getElementById("root");if(!lk)throw new Error("Could not find root element to mount to");const MK=DD.createRoot(lk);try{MK.render(_.jsx(lf.StrictMode,{children:_.jsx(RK,{})})),setTimeout(()=>{const n=document.getElementById("loading-screen");n&&(console.warn("Force removing loader after timeout"),n.style.opacity="0",setTimeout(()=>n.remove(),500))},3e3)}catch(n){console.error("React Render Error:",n)}
